/* Phaser v2.3.0 - http://phaser.io - @photonstorm - (c) 2015 Photon Storm Ltd. */

(function(){var e=this,t=t||{};t.WEBGL_RENDERER=0,t.CANVAS_RENDERER=1,t.VERSION="v2.2.8",t._UID=0,"undefined"!=typeof Float32Array?(t.Float32Array=Float32Array,t.Uint16Array=Uint16Array,t.Uint32Array=Uint32Array,t.ArrayBuffer=ArrayBuffer):(t.Float32Array=Array,t.Uint16Array=Array),t.PI_2=2*Math.PI,t.RAD_TO_DEG=180/Math.PI,t.DEG_TO_RAD=Math.PI/180,t.RETINA_PREFIX="@2x",t.defaultRenderOptions={view:null,transparent:!1,antialias:!1,preserveDrawingBuffer:!1,resolution:1,clearBeforeRender:!0,autoResize:!1},t.DisplayObject=function(){this.position=new t.Point(0,0),this.scale=new t.Point(1,1),this.transformCallback=null,this.transformCallbackContext=null,this.pivot=new t.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this.worldTransform=new t.Matrix,this._sr=0,this._cr=1,this.filterArea=null,this._bounds=new t.Rectangle(0,0,1,1),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},t.DisplayObject.prototype.constructor=t.DisplayObject,t.DisplayObject.prototype.destroy=function(){if(this.children){for(var e=this.children.length;e--;)this.children[e].destroy();this.children=[]}this.transformCallback=null,this.transformCallbackContext=null,this.hitArea=null,this.parent=null,this.stage=null,this.worldTransform=null,this.filterArea=null,this._bounds=null,this._currentBounds=null,this._mask=null,this.renderable=!1,this._destroyCachedSprite()},Object.defineProperty(t.DisplayObject.prototype,"worldVisible",{get:function(){var e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}}),Object.defineProperty(t.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask&&(this._mask.isMask=!1),this._mask=e,this._mask&&(this._mask.isMask=!0)}}),Object.defineProperty(t.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(e){if(e){for(var t=[],n=0;n<e.length;n++)for(var r=e[n].passes,i=0;i<r.length;i++)t.push(r[i]);this._filterBlock={target:this,filterPasses:t}}this._filters=e}}),Object.defineProperty(t.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(e){this._cacheAsBitmap!==e&&(e?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=e)}}),t.DisplayObject.prototype.updateTransform=function(){if(this.parent){var e,n,r,i,s,o,u=this.parent.worldTransform,a=this.worldTransform;this.rotation%t.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),e=this._cr*this.scale.x,n=this._sr*this.scale.x,r=-this._sr*this.scale.y,i=this._cr*this.scale.y,s=this.position.x,o=this.position.y,(this.pivot.x||this.pivot.y)&&(s-=this.pivot.x*e+this.pivot.y*r,o-=this.pivot.x*n+this.pivot.y*i),a.a=e*u.a+n*u.c,a.b=e*u.b+n*u.d,a.c=r*u.a+i*u.c,a.d=r*u.b+i*u.d,a.tx=s*u.a+o*u.c+u.tx,a.ty=s*u.b+o*u.d+u.ty):(e=this.scale.x,i=this.scale.y,s=this.position.x-this.pivot.x*e,o=this.position.y-this.pivot.y*i,a.a=e*u.a,a.b=e*u.b,a.c=i*u.c,a.d=i*u.d,a.tx=s*u.a+o*u.c+u.tx,a.ty=s*u.b+o*u.d+u.ty),this.worldAlpha=this.alpha*this.parent.worldAlpha,this.transformCallback&&this.transformCallback.call(this.transformCallbackContext,a,u)}},t.DisplayObject.prototype.displayObjectUpdateTransform=t.DisplayObject.prototype.updateTransform,t.DisplayObject.prototype.getBounds=function(e){return e=e,t.EmptyRectangle},t.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(t.identityMatrix)},t.DisplayObject.prototype.setStageReference=function(e){this.stage=e},t.DisplayObject.prototype.preUpdate=function(){},t.DisplayObject.prototype.generateTexture=function(e,n,r){var i=this.getLocalBounds(),s=new t.RenderTexture(0|i.width,0|i.height,r,n,e);return t.DisplayObject._tempMatrix.tx=-i.x,t.DisplayObject._tempMatrix.ty=-i.y,s.render(this,t.DisplayObject._tempMatrix),s},t.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()},t.DisplayObject.prototype.toGlobal=function(e){return this.displayObjectUpdateTransform(),this.worldTransform.apply(e)},t.DisplayObject.prototype.toLocal=function(e,t){return t&&(e=t.toGlobal(e)),this.displayObjectUpdateTransform(),this.worldTransform.applyInverse(e)},t.DisplayObject.prototype._renderCachedSprite=function(e){this._cachedSprite.worldAlpha=this.worldAlpha,e.gl?t.Sprite.prototype._renderWebGL.call(this._cachedSprite,e):t.Sprite.prototype._renderCanvas.call(this._cachedSprite,e)},t.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=!1;var e=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.texture.resize(0|e.width,0|e.height);else{var n=new t.RenderTexture(0|e.width,0|e.height);this._cachedSprite=new t.Sprite(n),this._cachedSprite.worldTransform=this.worldTransform}var r=this._filters;this._filters=null,this._cachedSprite.filters=r,t.DisplayObject._tempMatrix.tx=-e.x,t.DisplayObject._tempMatrix.ty=-e.y,this._cachedSprite.texture.render(this,t.DisplayObject._tempMatrix,!0),this._cachedSprite.anchor.x=-(e.x/e.width),this._cachedSprite.anchor.y=-(e.y/e.height),this._filters=r,this._cacheAsBitmap=!0},t.DisplayObject.prototype._destroyCachedSprite=function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)},t.DisplayObject.prototype._renderWebGL=function(e){e=e},t.DisplayObject.prototype._renderCanvas=function(e){e=e},Object.defineProperty(t.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(e){this.position.x=e}}),Object.defineProperty(t.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(e){this.position.y=e}}),t.DisplayObjectContainer=function(){t.DisplayObject.call(this),this.children=[]},t.DisplayObjectContainer.prototype=Object.create(t.DisplayObject.prototype),t.DisplayObjectContainer.prototype.constructor=t.DisplayObjectContainer,Object.defineProperty(t.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(e){var t=this.getLocalBounds().width;this.scale.x=0!==t?e/t:1,this._width=e}}),Object.defineProperty(t.DisplayObjectContainer.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(e){var t=this.getLocalBounds().height;this.scale.y=0!==t?e/t:1,this._height=e}}),t.DisplayObjectContainer.prototype.addChild=function(e){return this.addChildAt(e,this.children.length)},t.DisplayObjectContainer.prototype.addChildAt=function(e,t){if(t>=0&&t<=this.children.length)return e.parent&&e.parent.removeChild(e),e.parent=this,this.children.splice(t,0,e),this.stage&&e.setStageReference(this.stage),e;throw new Error(e+"addChildAt: The index "+t+" supplied is out of bounds "+this.children.length)},t.DisplayObjectContainer.prototype.swapChildren=function(e,t){if(e!==t){var n=this.getChildIndex(e),r=this.getChildIndex(t);if(0>n||0>r)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[n]=t,this.children[r]=e}},t.DisplayObjectContainer.prototype.getChildIndex=function(e){var t=this.children.indexOf(e);if(-1===t)throw new Error("The supplied DisplayObject must be a child of the caller");return t},t.DisplayObjectContainer.prototype.setChildIndex=function(e,t){if(0>t||t>=this.children.length)throw new Error("The supplied index is out of bounds");var n=this.getChildIndex(e);this.children.splice(n,1),this.children.splice(t,0,e)},t.DisplayObjectContainer.prototype.getChildAt=function(e){if(0>e||e>=this.children.length)throw new Error("getChildAt: Supplied index "+e+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[e]},t.DisplayObjectContainer.prototype.removeChild=function(e){var t=this.children.indexOf(e);if(-1!==t)return this.removeChildAt(t)},t.DisplayObjectContainer.prototype.removeChildAt=function(e){var t=this.getChildAt(e);return this.stage&&t.removeStageReference(),t.parent=void 0,this.children.splice(e,1),t},t.DisplayObjectContainer.prototype.removeChildren=function(e,t){var n=e||0,r="number"==typeof t?t:this.children.length,i=r-n;if(i>0&&r>=i){for(var s=this.children.splice(n,i),o=0;o<s.length;o++){var u=s[o];this.stage&&u.removeStageReference(),u.parent=void 0}return s}if(0===i&&0===this.children.length)return[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")},t.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(this.displayObjectUpdateTransform(),!this._cacheAsBitmap))for(var e=0,t=this.children.length;t>e;e++)this.children[e].updateTransform()},t.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=t.DisplayObjectContainer.prototype.updateTransform,t.DisplayObjectContainer.prototype.getBounds=function(){if(0===this.children.length)return t.EmptyRectangle;for(var e,n,r,i=1/0,s=1/0,o=-1/0,u=-1/0,a=!1,f=0,l=this.children.length;l>f;f++){var c=this.children[f];c.visible&&(a=!0,e=this.children[f].getBounds(),i=i<e.x?i:e.x,s=s<e.y?s:e.y,n=e.width+e.x,r=e.height+e.y,o=o>n?o:n,u=u>r?u:r)}if(!a)return t.EmptyRectangle;var h=this._bounds;return h.x=i,h.y=s,h.width=o-i,h.height=u-s,h},t.DisplayObjectContainer.prototype.getLocalBounds=function(){var e=this.worldTransform;this.worldTransform=t.identityMatrix;for(var n=0,r=this.children.length;r>n;n++)this.children[n].updateTransform();var i=this.getBounds();return this.worldTransform=e,i},t.DisplayObjectContainer.prototype.setStageReference=function(e){this.stage=e;for(var t=0;t<this.children.length;t++)this.children[t].setStageReference(e)},t.DisplayObjectContainer.prototype.removeStageReference=function(){for(var e=0;e<this.children.length;e++)this.children[e].removeStageReference();this.stage=null},t.DisplayObjectContainer.prototype._renderWebGL=function(e){if(this.visible&&!(this.alpha<=0)){if(this._cacheAsBitmap)return void this._renderCachedSprite(e);var t;if(this._mask||this._filters){for(this._filters&&(e.spriteBatch.flush(),e.filterManager.pushFilter(this._filterBlock)),this._mask&&(e.spriteBatch.stop(),e.maskManager.pushMask(this.mask,e),e.spriteBatch.start()),t=0;t<this.children.length;t++)this.children[t]._renderWebGL(e);e.spriteBatch.stop(),this._mask&&e.maskManager.popMask(this._mask,e),this._filters&&e.filterManager.popFilter(),e.spriteBatch.start()}else for(t=0;t<this.children.length;t++)this.children[t]._renderWebGL(e)}},t.DisplayObjectContainer.prototype._renderCanvas=function(e){if(this.visible!==!1&&0!==this.alpha){if(this._cacheAsBitmap)return void this._renderCachedSprite(e);this._mask&&e.maskManager.pushMask(this._mask,e);for(var t=0;t<this.children.length;t++)this.children[t]._renderCanvas(e);this._mask&&e.maskManager.popMask(e)}},t.Sprite=function(e){t.DisplayObjectContainer.call(this),this.anchor=new t.Point,this.texture=e||t.Texture.emptyTexture,this._width=0,this._height=0,this.tint=16777215,this.blendMode=t.blendModes.NORMAL,this.shader=null,this.texture.baseTexture.hasLoaded&&this.onTextureUpdate(),this.renderable=!0},t.Sprite.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Sprite.prototype.constructor=t.Sprite,Object.defineProperty(t.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(e){this.scale.x=e/this.texture.frame.width,this._width=e}}),Object.defineProperty(t.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(e){this.scale.y=e/this.texture.frame.height,this._height=e}}),t.Sprite.prototype.setTexture=function(e){this.texture=e,this.cachedTint=16777215},t.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},t.Sprite.prototype.getBounds=function(e){var t=this.texture.frame.width,n=this.texture.frame.height,r=t*(1-this.anchor.x),i=t*-this.anchor.x,s=n*(1-this.anchor.y),o=n*-this.anchor.y,u=e||this.worldTransform,a=u.a,f=u.b,l=u.c,c=u.d,h=u.tx,p=u.ty,d=-1/0,v=-1/0,m=1/0,g=1/0;if(0===f&&0===l)0>a&&(a*=-1),0>c&&(c*=-1),m=a*i+h,d=a*r+h,g=c*o+p,v=c*s+p;else{var y=a*i+l*o+h,b=c*o+f*i+p,w=a*r+l*o+h,E=c*o+f*r+p,S=a*r+l*s+h,x=c*s+f*r+p,T=a*i+l*s+h,N=c*s+f*i+p;m=m>y?y:m,m=m>w?w:m,m=m>S?S:m,m=m>T?T:m,g=g>b?b:g,g=g>E?E:g,g=g>x?x:g,g=g>N?N:g,d=y>d?y:d,d=w>d?w:d,d=S>d?S:d,d=T>d?T:d,v=b>v?b:v,v=E>v?E:v,v=x>v?x:v,v=N>v?N:v}var C=this._bounds;return C.x=m,C.width=d-m,C.y=g,C.height=v-g,this._currentBounds=C,C},t.Sprite.prototype._renderWebGL=function(e){if(this.visible&&!(this.alpha<=0)&&this.renderable){var t;if(this._mask||this._filters){var n=e.spriteBatch;for(this._filters&&(n.flush(),e.filterManager.pushFilter(this._filterBlock)),this._mask&&(n.stop(),e.maskManager.pushMask(this.mask,e),n.start()),n.render(this),t=0;t<this.children.length;t++)this.children[t]._renderWebGL(e);n.stop(),this._mask&&e.maskManager.popMask(this._mask,e),this._filters&&e.filterManager.popFilter(),n.start()}else for(e.spriteBatch.render(this),t=0;t<this.children.length;t++)this.children[t]._renderWebGL(e)}},t.Sprite.prototype._renderCanvas=function(e){if(!(this.visible===!1||0===this.alpha||this.renderable===!1||this.texture.crop.width<=0||this.texture.crop.height<=0)){if(this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,e.context.globalCompositeOperation=t.blendModesCanvas[e.currentBlendMode]),this._mask&&e.maskManager.pushMask(this._mask,e),this.texture.valid){var n=this.texture.baseTexture.resolution/e.resolution;e.context.globalAlpha=this.worldAlpha,e.smoothProperty&&e.scaleMode!==this.texture.baseTexture.scaleMode&&(e.scaleMode=this.texture.baseTexture.scaleMode,e.context[e.smoothProperty]=e.scaleMode===t.scaleModes.LINEAR);var r=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,i=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;e.roundPixels?(e.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*e.resolution|0,this.worldTransform.ty*e.resolution|0),r=0|r,i=0|i):e.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*e.resolution,this.worldTransform.ty*e.resolution),16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=t.CanvasTinter.getTintedTexture(this,this.tint)),e.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,r/n,i/n,this.texture.crop.width/n,this.texture.crop.height/n)):e.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,r/n,i/n,this.texture.crop.width/n,this.texture.crop.height/n)}for(var s=0;s<this.children.length;s++)this.children[s]._renderCanvas(e);this._mask&&e.maskManager.popMask(e)}},t.Sprite.fromFrame=function(e){var n=t.TextureCache[e];if(!n)throw new Error('The frameId "'+e+'" does not exist in the texture cache'+this);return new t.Sprite(n)},t.Sprite.fromImage=function(e,n,r){var i=t.Texture.fromImage(e,n,r);return new t.Sprite(i)},t.SpriteBatch=function(e){t.DisplayObjectContainer.call(this),this.textureThing=e,this.ready=!1},t.SpriteBatch.prototype=Object.create(t.DisplayObjectContainer.prototype),t.SpriteBatch.prototype.constructor=t.SpriteBatch,t.SpriteBatch.prototype.initWebGL=function(e){this.fastSpriteBatch=new t.WebGLFastSpriteBatch(e),this.ready=!0},t.SpriteBatch.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},t.SpriteBatch.prototype._renderWebGL=function(e){!this.visible||this.alpha<=0||!this.children.length||(this.ready||this.initWebGL(e.gl),this.fastSpriteBatch.gl!==e.gl&&this.fastSpriteBatch.setContext(e.gl),e.spriteBatch.stop(),e.shaderManager.setShader(e.shaderManager.fastShader),this.fastSpriteBatch.begin(this,e),this.fastSpriteBatch.render(this),e.spriteBatch.start())},t.SpriteBatch.prototype._renderCanvas=function(e){if(this.visible&&!(this.alpha<=0)&&this.children.length){var t=e.context;t.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var n=this.worldTransform,r=!0,i=0;i<this.children.length;i++){var s=this.children[i];if(s.visible){var o=s.texture,u=o.frame;if(t.globalAlpha=this.worldAlpha*s.alpha,s.rotation%(2*Math.PI)===0)r&&(t.setTransform(n.a,n.b,n.c,n.d,n.tx,n.ty),r=!1),t.drawImage(o.baseTexture.source,u.x,u.y,u.width,u.height,s.anchor.x*-u.width*s.scale.x+s.position.x+.5|0,s.anchor.y*-u.height*s.scale.y+s.position.y+.5|0,u.width*s.scale.x,u.height*s.scale.y);else{r||(r=!0),s.displayObjectUpdateTransform();var a=s.worldTransform;e.roundPixels?t.setTransform(a.a,a.b,a.c,a.d,0|a.tx,0|a.ty):t.setTransform(a.a,a.b,a.c,a.d,a.tx,a.ty),t.drawImage(o.baseTexture.source,u.x,u.y,u.width,u.height,s.anchor.x*-u.width+.5|0,s.anchor.y*-u.height+.5|0,u.width,u.height)}}}}},t.Text=function(e,n){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=1,t.Sprite.call(this,t.Texture.fromCanvas(this.canvas)),this.setText(e),this.setStyle(n)},t.Text.prototype=Object.create(t.Sprite.prototype),t.Text.prototype.constructor=t.Text,Object.defineProperty(t.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(e){this.scale.x=e/this.texture.frame.width,this._width=e}}),Object.defineProperty(t.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(e){this.scale.y=e/this.texture.frame.height,this._height=e}}),t.Text.prototype.setStyle=function(e){e=e||{},e.font=e.font||"bold 20pt Arial",e.fill=e.fill||"black",e.align=e.align||"left",e.stroke=e.stroke||"black",e.strokeThickness=e.strokeThickness||0,e.wordWrap=e.wordWrap||!1,e.wordWrapWidth=e.wordWrapWidth||100,e.dropShadow=e.dropShadow||!1,e.dropShadowAngle=e.dropShadowAngle||Math.PI/6,e.dropShadowDistance=e.dropShadowDistance||4,e.dropShadowColor=e.dropShadowColor||"black",this.style=e,this.dirty=!0},t.Text.prototype.setText=function(e){this.text=e.toString()||" ",this.dirty=!0},t.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this.resolution,this.context.font=this.style.font;var e=this.text;this.style.wordWrap&&(e=this.wordWrap(this.text));for(var t=e.split(/(?:\r\n|\r|\n)/),n=[],r=0,i=this.determineFontProperties(this.style.font),s=0;s<t.length;s++){var o=this.context.measureText(t[s]).width;n[s]=o,r=Math.max(r,o)}var u=r+this.style.strokeThickness;this.style.dropShadow&&(u+=this.style.dropShadowDistance),this.canvas.width=(u+this.context.lineWidth)*this.resolution;var a=i.fontSize+this.style.strokeThickness,f=a*t.length;this.style.dropShadow&&(f+=this.style.dropShadowDistance),this.canvas.height=f*this.resolution,this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="alphabetic";var l,c;if(this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;var h=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,p=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance;for(s=0;s<t.length;s++)l=this.style.strokeThickness/2,c=this.style.strokeThickness/2+s*a+i.ascent,"right"===this.style.align?l+=r-n[s]:"center"===this.style.align&&(l+=(r-n[s])/2),this.style.fill&&this.context.fillText(t[s],l+h,c+p)}for(this.context.fillStyle=this.style.fill,s=0;s<t.length;s++)l=this.style.strokeThickness/2,c=this.style.strokeThickness/2+s*a+i.ascent,"right"===this.style.align?l+=r-n[s]:"center"===this.style.align&&(l+=(r-n[s])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(t[s],l,c),this.style.fill&&this.context.fillText(t[s],l,c);this.updateTexture()},t.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.crop.width=this.texture.frame.width=this.canvas.width,this.texture.crop.height=this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,this.texture.baseTexture.dirty()},t.Text.prototype._renderWebGL=function(e){this.dirty&&(this.resolution=e.resolution,this.updateText(),this.dirty=!1),t.Sprite.prototype._renderWebGL.call(this,e)},t.Text.prototype._renderCanvas=function(e){this.dirty&&(this.resolution=e.resolution,this.updateText(),this.dirty=!1),t.Sprite.prototype._renderCanvas.call(this,e)},t.Text.prototype.determineFontProperties=function(e){var n=t.Text.fontPropertiesCache[e];if(!n){n={};var r=t.Text.fontPropertiesCanvas,i=t.Text.fontPropertiesContext;i.font=e;var s=Math.ceil(i.measureText("|MÉq").width),o=Math.ceil(i.measureText("|MÉq").width),u=2*o;o=1.4*o|0,r.width=s,r.height=u,i.fillStyle="#f00",i.fillRect(0,0,s,u),i.font=e,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText("|MÉq",0,o);var a,f,l=i.getImageData(0,0,s,u).data,c=l.length,h=4*s,p=0,d=!1;for(a=0;o>a;a++){for(f=0;h>f;f+=4)if(255!==l[p+f]){d=!0;break}if(d)break;p+=h}for(n.ascent=o-a,p=c-h,d=!1,a=u;a>o;a--){for(f=0;h>f;f+=4)if(255!==l[p+f]){d=!0;break}if(d)break;p-=h}n.descent=a-o,n.descent+=6,n.fontSize=n.ascent+n.descent,t.Text.fontPropertiesCache[e]=n}return n},t.Text.prototype.wordWrap=function(e){for(var t="",n=e.split("\n"),r=0;r<n.length;r++){for(var i=this.style.wordWrapWidth,s=n[r].split(" "),o=0;o<s.length;o++){var u=this.context.measureText(s[o]).width,a=u+this.context.measureText(" ").width;0===o||a>i?(o>0&&(t+="\n"),t+=s[o],i=this.style.wordWrapWidth-u):(i-=a,t+=" "+s[o])}r<n.length-1&&(t+="\n")}return t},t.Text.prototype.getBounds=function(e){return this.dirty&&(this.updateText(),this.dirty=!1),t.Sprite.prototype.getBounds.call(this,e)},t.Text.prototype.destroy=function(e){this.context=null,this.canvas=null,this.texture.destroy(void 0===e?!0:e)},t.Text.fontPropertiesCache={},t.Text.fontPropertiesCanvas=document.createElement("canvas"),t.Text.fontPropertiesContext=t.Text.fontPropertiesCanvas.getContext("2d"),t.BitmapText=function(e,n){t.DisplayObjectContainer.call(this),this.textWidth=0,this.textHeight=0,this.maxWidth=0,this.anchor=new Phaser.Point(0,0),this._prevAnchor=new Phaser.Point(0,0),this._pool=[],this.setText(e),this.setStyle(n),this.updateText(),this.dirty=!1},t.BitmapText.prototype=Object.create(t.DisplayObjectContainer.prototype),t.BitmapText.prototype.constructor=t.BitmapText,t.BitmapText.prototype.setText=function(e){this.text=e||" ",this.dirty=!0},t.BitmapText.prototype.setStyle=function(e){e=e||{},e.align=e.align||"left",this.style=e;var n=e.font.split(" ");this.fontName=n[n.length-1],this.fontSize=n.length>=2?parseInt(n[n.length-2],10):t.BitmapText.fonts[this.fontName].size,this.dirty=!0,this.tint=e.tint},t.BitmapText.prototype.updateText=function(){for(var e=t.BitmapText.fonts[this.fontName],n=new t.Point,r=null,i=[],s=0,o=[],u=0,a=this.fontSize/e.size,f=0,l=0;l<this.text.length;l++){var c=this.text.charCodeAt(l);if(f=/(\s)/.test(this.text.charAt(l))?l:f,/(?:\r\n|\r|\n)/.test(this.text.charAt(l)))o.push(n.x),s=Math.max(s,n.x),u++,n.x=0,n.y+=e.lineHeight,r=null;else if(-1!==f&&this.maxWidth>0&&n.x*a>this.maxWidth)i.splice(f,l-f),l=f,f=-1,o.push(lastLineWidth),s=Math.max(s,lastLineWidth),u++,n.x=0,n.y+=e.lineHeight,r=null;else{var h=e.chars[c];h&&(r&&h.kerning[r]&&(n.x+=h.kerning[r]),i.push({texture:h.texture,line:u,charCode:c,position:new t.Point(n.x+h.xOffset,n.y+h.yOffset)}),n.x+=h.xAdvance,r=c)}}o.push(n.x),s=Math.max(s,n.x);var p=[];for(l=0;u>=l;l++){var d=0;"right"===this.style.align?d=s-o[l]:"center"===this.style.align&&(d=(s-o[l])/2),p.push(d)}var v=this.children.length,m=i.length,g=this.tint||16777215;this.textWidth=s*a,this.textHeight=(n.y+e.lineHeight)*a;var y=this.textWidth*this.anchor.x,w=this.textHeight*this.anchor.y;for(l=0;m>l;l++){var E=v>l?this.children[l]:this._pool.pop();E?E.setTexture(i[l].texture):E=new t.Sprite(i[l].texture),E.position.x=(i[l].position.x+p[i[l].line])*a-y,E.position.y=i[l].position.y*a-w,E.scale.x=E.scale.y=a,E.tint=g,E.parent||this.addChild(E)}for(;this.children.length>m;){var S=this.getChildAt(this.children.length-1);this._pool.push(S),this.removeChild(S)}},t.BitmapText.prototype.updateTransform=function(){(this.dirty||!this.anchor.equals(this._prevAnchor))&&(this.updateText(),this.dirty=!1,this._prevAnchor.copyFrom(this.anchor)),t.DisplayObjectContainer.prototype.updateTransform.call(this)},t.BitmapText.fonts={},t.Stage=function(e){t.DisplayObjectContainer.call(this),this.worldTransform=new t.Matrix,this.stage=this,this.setBackgroundColor(e)},t.Stage.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Stage.prototype.constructor=t.Stage,t.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var e=0;e<this.children.length;e++)this.children[e].updateTransform()},t.Stage.prototype.setBackgroundColor=function(e){this.backgroundColor=e||0,this.backgroundColorSplit=t.hex2rgb(this.backgroundColor);var n=this.backgroundColor.toString(16);n="000000".substr(0,6-n.length)+n,this.backgroundColorString="#"+n},t.hex2rgb=function(e){return[(e>>16&255)/255,(e>>8&255)/255,(255&e)/255]},t.rgb2hex=function(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]},t.canUseNewCanvasBlendModes=function(){if("undefined"==typeof document)return!1;var e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/",t="AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==",n=new Image;n.src=e+"AP804Oa6"+t;var r=new Image;r.src=e+"/wCKxvRF"+t;var i=document.createElement("canvas");i.width=6,i.height=1;var s=i.getContext("2d");s.globalCompositeOperation="multiply",s.drawImage(n,0,0),s.drawImage(r,2,0);var o=s.getImageData(2,0,1,1).data;return 255===o[0]&&0===o[1]&&0===o[2]},t.getNextPowerOfTwo=function(e){if(e>0&&0===(e&e-1))return e;for(var t=1;e>t;)t<<=1;return t},t.isPowerOfTwo=function(e,t){return e>0&&0===(e&e-1)&&t>0&&0===(t&t-1)},t.PolyK={},t.PolyK.Triangulate=function(e){var n=!0,r=e.length>>1;if(3>r)return[];for(var i=[],s=[],o=0;r>o;o++)s.push(o);o=0;for(var u=r;u>3;){var a=s[(o+0)%u],f=s[(o+1)%u],l=s[(o+2)%u],c=e[2*a],h=e[2*a+1],p=e[2*f],d=e[2*f+1],v=e[2*l],m=e[2*l+1],g=!1;if(t.PolyK._convex(c,h,p,d,v,m,n)){g=!0;for(var y=0;u>y;y++){var w=s[y];if(w!==a&&w!==f&&w!==l&&t.PolyK._PointInTriangle(e[2*w],e[2*w+1],c,h,p,d,v,m)){g=!1;break}}}if(g)i.push(a,f,l),s.splice((o+1)%u,1),u--,o=0;else if(o++>3*u){if(!n)return null;for(i=[],s=[],o=0;r>o;o++)s.push(o);o=0,u=r,n=!1}}return i.push(s[0],s[1],s[2]),i},t.PolyK._PointInTriangle=function(e,t,n,r,i,s,o,u){var a=o-n,f=u-r,l=i-n,c=s-r,h=e-n,p=t-r,d=a*a+f*f,v=a*l+f*c,m=a*h+f*p,g=l*l+c*c,y=l*h+c*p,b=1/(d*g-v*v),w=(g*m-v*y)*b,E=(d*y-v*m)*b;return w>=0&&E>=0&&1>w+E},t.PolyK._convex=function(e,t,n,r,i,s,o){return(t-r)*(i-n)+(n-e)*(s-r)>=0===o},t.initDefaultShaders=function(){},t.CompileVertexShader=function(e,n){return t._CompileShader(e,n,e.VERTEX_SHADER)},t.CompileFragmentShader=function(e,n){return t._CompileShader(e,n,e.FRAGMENT_SHADER)},t._CompileShader=function(e,t,n){var r=t.join("\n"),i=e.createShader(n);return e.shaderSource(i,r),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?i:(window.console.log(e.getShaderInfoLog(i)),null)},t.compileProgram=function(e,n,r){var i=t.CompileFragmentShader(e,r),s=t.CompileVertexShader(e,n),o=e.createProgram();return e.attachShader(o,s),e.attachShader(o,i),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS)||window.console.log("Could not initialise shaders"),o},t.PixiShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.textureCount=0,this.firstRun=!0,this.dirty=!0,this.attributes=[],this.init()},t.PixiShader.prototype.constructor=t.PixiShader,t.PixiShader.prototype.init=function(){var e=this.gl,n=t.compileProgram(e,this.vertexSrc||t.PixiShader.defaultVertexSrc,this.fragmentSrc);e.useProgram(n),this.uSampler=e.getUniformLocation(n,"uSampler"),this.projectionVector=e.getUniformLocation(n,"projectionVector"),this.offsetVector=e.getUniformLocation(n,"offsetVector"),this.dimensions=e.getUniformLocation(n,"dimensions"),this.aVertexPosition=e.getAttribLocation(n,"aVertexPosition"),this.aTextureCoord=e.getAttribLocation(n,"aTextureCoord"),this.colorAttribute=e.getAttribLocation(n,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var r in this.uniforms)this.uniforms[r].uniformLocation=e.getUniformLocation(n,r);this.initUniforms(),this.program=n},t.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var e,t=this.gl;for(var n in this.uniforms){e=this.uniforms[n];var r=e.type;"sampler2D"===r?(e._init=!1,null!==e.value&&this.initSampler2D(e)):"mat2"===r||"mat3"===r||"mat4"===r?(e.glMatrix=!0,e.glValueLength=1,"mat2"===r?e.glFunc=t.uniformMatrix2fv:"mat3"===r?e.glFunc=t.uniformMatrix3fv:"mat4"===r&&(e.glFunc=t.uniformMatrix4fv)):(e.glFunc=t["uniform"+r],e.glValueLength="2f"===r||"2i"===r?2:"3f"===r||"3i"===r?3:"4f"===r||"4i"===r?4:1)}},t.PixiShader.prototype.initSampler2D=function(e){if(e.value&&e.value.baseTexture&&e.value.baseTexture.hasLoaded){var t=this.gl;if(t.activeTexture(t["TEXTURE"+this.textureCount]),t.bindTexture(t.TEXTURE_2D,e.value.baseTexture._glTextures[t.id]),e.textureData){var n=e.textureData,r=n.magFilter?n.magFilter:t.LINEAR,i=n.minFilter?n.minFilter:t.LINEAR,s=n.wrapS?n.wrapS:t.CLAMP_TO_EDGE,o=n.wrapT?n.wrapT:t.CLAMP_TO_EDGE,u=n.luminance?t.LUMINANCE:t.RGBA;if(n.repeat&&(s=t.REPEAT,o=t.REPEAT),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!!n.flipY),n.width){var a=n.width?n.width:512,f=n.height?n.height:2,l=n.border?n.border:0;t.texImage2D(t.TEXTURE_2D,0,u,a,f,l,u,t.UNSIGNED_BYTE,null)}else t.texImage2D(t.TEXTURE_2D,0,u,t.RGBA,t.UNSIGNED_BYTE,e.value.baseTexture.source);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,o)}t.uniform1i(e.uniformLocation,this.textureCount),e._init=!0,this.textureCount++}},t.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var e,n=this.gl;for(var r in this.uniforms)e=this.uniforms[r],1===e.glValueLength?e.glMatrix===!0?e.glFunc.call(n,e.uniformLocation,e.transpose,e.value):e.glFunc.call(n,e.uniformLocation,e.value):2===e.glValueLength?e.glFunc.call(n,e.uniformLocation,e.value.x,e.value.y):3===e.glValueLength?e.glFunc.call(n,e.uniformLocation,e.value.x,e.value.y,e.value.z):4===e.glValueLength?e.glFunc.call(n,e.uniformLocation,e.value.x,e.value.y,e.value.z,e.value.w):"sampler2D"===e.type&&(e._init?(n.activeTexture(n["TEXTURE"+this.textureCount]),e.value.baseTexture._dirty[n.id]?t.instances[n.id].updateTexture(e.value.baseTexture):n.bindTexture(n.TEXTURE_2D,e.value.baseTexture._glTextures[n.id]),n.uniform1i(e.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(e))},t.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},t.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],t.PixiFastShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"],this.textureCount=0,this.init()},t.PixiFastShader.prototype.constructor=t.PixiFastShader,t.PixiFastShader.prototype.init=function(){var e=this.gl,n=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(n),this.uSampler=e.getUniformLocation(n,"uSampler"),this.projectionVector=e.getUniformLocation(n,"projectionVector"),this.offsetVector=e.getUniformLocation(n,"offsetVector"),this.dimensions=e.getUniformLocation(n,"dimensions"),this.uMatrix=e.getUniformLocation(n,"uMatrix"),this.aVertexPosition=e.getAttribLocation(n,"aVertexPosition"),this.aPositionCoord=e.getAttribLocation(n,"aPositionCoord"),this.aScale=e.getAttribLocation(n,"aScale"),this.aRotation=e.getAttribLocation(n,"aRotation"),this.aTextureCoord=e.getAttribLocation(n,"aTextureCoord"),this.colorAttribute=e.getAttribLocation(n,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute],this.program=n},t.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},t.StripShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * alpha;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"],this.init()},t.StripShader.prototype.constructor=t.StripShader,t.StripShader.prototype.init=function(){var e=this.gl,n=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(n),this.uSampler=e.getUniformLocation(n,"uSampler"),this.projectionVector=e.getUniformLocation(n,"projectionVector"),this.offsetVector=e.getUniformLocation(n,"offsetVector"),this.colorAttribute=e.getAttribLocation(n,"aColor"),this.aVertexPosition=e.getAttribLocation(n,"aVertexPosition"),this.aTextureCoord=e.getAttribLocation(n,"aTextureCoord"),this.attributes=[this.aVertexPosition,this.aTextureCoord],this.translationMatrix=e.getUniformLocation(n,"translationMatrix"),this.alpha=e.getUniformLocation(n,"alpha"),this.program=n},t.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},t.PrimitiveShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},t.PrimitiveShader.prototype.constructor=t.PrimitiveShader,t.PrimitiveShader.prototype.init=function(){var e=this.gl,n=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(n),this.projectionVector=e.getUniformLocation(n,"projectionVector"),this.offsetVector=e.getUniformLocation(n,"offsetVector"),this.tintColor=e.getUniformLocation(n,"tint"),this.flipY=e.getUniformLocation(n,"flipY"),this.aVertexPosition=e.getAttribLocation(n,"aVertexPosition"),this.colorAttribute=e.getAttribLocation(n,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=e.getUniformLocation(n,"translationMatrix"),this.alpha=e.getUniformLocation(n,"alpha"),this.program=n},t.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},t.ComplexPrimitiveShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"],this.init()},t.ComplexPrimitiveShader.prototype.constructor=t.ComplexPrimitiveShader,t.ComplexPrimitiveShader.prototype.init=function(){var e=this.gl,n=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(n),this.projectionVector=e.getUniformLocation(n,"projectionVector"),this.offsetVector=e.getUniformLocation(n,"offsetVector"),this.tintColor=e.getUniformLocation(n,"tint"),this.color=e.getUniformLocation(n,"color"),this.flipY=e.getUniformLocation(n,"flipY"),this.aVertexPosition=e.getAttribLocation(n,"aVertexPosition"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=e.getUniformLocation(n,"translationMatrix"),this.alpha=e.getUniformLocation(n,"alpha"),this.program=n},t.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},t.WebGLGraphics=function(){},t.WebGLGraphics.renderGraphics=function(e,n){var r,i=n.gl,s=n.projection,o=n.offset,u=n.shaderManager.primitiveShader;e.dirty&&t.WebGLGraphics.updateGraphics(e,i);for(var a=e._webGL[i.id],f=0;f<a.data.length;f++)1===a.data[f].mode?(r=a.data[f],n.stencilManager.pushStencil(e,r,n),i.drawElements(i.TRIANGLE_FAN,4,i.UNSIGNED_SHORT,2*(r.indices.length-4)),n.stencilManager.popStencil(e,r,n)):(r=a.data[f],n.shaderManager.setShader(u),u=n.shaderManager.primitiveShader,i.uniformMatrix3fv(u.translationMatrix,!1,e.worldTransform.toArray(!0)),i.uniform1f(u.flipY,1),i.uniform2f(u.projectionVector,s.x,-s.y),i.uniform2f(u.offsetVector,-o.x,-o.y),i.uniform3fv(u.tintColor,t.hex2rgb(e.tint)),i.uniform1f(u.alpha,e.worldAlpha),i.bindBuffer(i.ARRAY_BUFFER,r.buffer),i.vertexAttribPointer(u.aVertexPosition,2,i.FLOAT,!1,24,0),i.vertexAttribPointer(u.colorAttribute,4,i.FLOAT,!1,24,8),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,r.indexBuffer),i.drawElements(i.TRIANGLE_STRIP,r.indices.length,i.UNSIGNED_SHORT,0))},t.WebGLGraphics.updateGraphics=function(e,n){var r=e._webGL[n.id];r||(r=e._webGL[n.id]={lastIndex:0,data:[],gl:n}),e.dirty=!1;var i;if(e.clearDirty){for(e.clearDirty=!1,i=0;i<r.data.length;i++){var s=r.data[i];s.reset(),t.WebGLGraphics.graphicsDataPool.push(s)}r.data=[],r.lastIndex=0}var o;for(i=r.lastIndex;i<e.graphicsData.length;i++){var u=e.graphicsData[i];if(u.type===t.Graphics.POLY){if(u.points=u.shape.points.slice(),u.shape.closed&&(u.points[0]!==u.points[u.points.length-2]||u.points[1]!==u.points[u.points.length-1])&&u.points.push(u.points[0],u.points[1]),u.fill&&u.points.length>=6)if(u.points.length<12){o=t.WebGLGraphics.switchMode(r,0);var a=t.WebGLGraphics.buildPoly(u,o);a||(o=t.WebGLGraphics.switchMode(r,1),t.WebGLGraphics.buildComplexPoly(u,o))}else o=t.WebGLGraphics.switchMode(r,1),t.WebGLGraphics.buildComplexPoly(u,o);u.lineWidth>0&&(o=t.WebGLGraphics.switchMode(r,0),t.WebGLGraphics.buildLine(u,o))}else o=t.WebGLGraphics.switchMode(r,0),u.type===t.Graphics.RECT?t.WebGLGraphics.buildRectangle(u,o):u.type===t.Graphics.CIRC||u.type===t.Graphics.ELIP?t.WebGLGraphics.buildCircle(u,o):u.type===t.Graphics.RREC&&t.WebGLGraphics.buildRoundedRectangle(u,o);r.lastIndex++}for(i=0;i<r.data.length;i++)o=r.data[i],o.dirty&&o.upload()},t.WebGLGraphics.switchMode=function(e,n){var r;return e.data.length?(r=e.data[e.data.length-1],(r.mode!==n||1===n)&&(r=t.WebGLGraphics.graphicsDataPool.pop()||new t.WebGLGraphicsData(e.gl),r.mode=n,e.data.push(r))):(r=t.WebGLGraphics.graphicsDataPool.pop()||new t.WebGLGraphicsData(e.gl),r.mode=n,e.data.push(r)),r.dirty=!0,r},t.WebGLGraphics.buildRectangle=function(e,n){var r=e.shape,i=r.x,s=r.y,o=r.width,u=r.height;if(e.fill){var a=t.hex2rgb(e.fillColor),f=e.fillAlpha,l=a[0]*f,c=a[1]*f,h=a[2]*f,p=n.points,d=n.indices,v=p.length/6;p.push(i,s),p.push(l,c,h,f),p.push(i+o,s),p.push(l,c,h,f),p.push(i,s+u),p.push(l,c,h,f),p.push(i+o,s+u),p.push(l,c,h,f),d.push(v,v,v+1,v+2,v+3,v+3)}if(e.lineWidth){var m=e.points;e.points=[i,s,i+o,s,i+o,s+u,i,s+u,i,s],t.WebGLGraphics.buildLine(e,n),e.points=m}},t.WebGLGraphics.buildRoundedRectangle=function(e,n){var r=e.shape,i=r.x,s=r.y,o=r.width,u=r.height,a=r.radius,f=[];if(f.push(i,s+a),f=f.concat(t.WebGLGraphics.quadraticBezierCurve(i,s+u-a,i,s+u,i+a,s+u)),f=f.concat(t.WebGLGraphics.quadraticBezierCurve(i+o-a,s+u,i+o,s+u,i+o,s+u-a)),f=f.concat(t.WebGLGraphics.quadraticBezierCurve(i+o,s+a,i+o,s,i+o-a,s)),f=f.concat(t.WebGLGraphics.quadraticBezierCurve(i+a,s,i,s,i,s+a)),e.fill){var l=t.hex2rgb(e.fillColor),c=e.fillAlpha,h=l[0]*c,p=l[1]*c,d=l[2]*c,v=n.points,m=n.indices,g=v.length/6,y=t.PolyK.Triangulate(f),w=0;for(w=0;w<y.length;w+=3)m.push(y[w]+g),m.push(y[w]+g),m.push(y[w+1]+g),m.push(y[w+2]+g),m.push(y[w+2]+g);for(w=0;w<f.length;w++)v.push(f[w],f[++w],h,p,d,c)}if(e.lineWidth){var E=e.points;e.points=f,t.WebGLGraphics.buildLine(e,n),e.points=E}},t.WebGLGraphics.quadraticBezierCurve=function(e,t,n,r,i,s){function o(e,t,n){var r=t-e;return e+r*n}for(var u,a,f,l,c,h,p=20,d=[],v=0,m=0;p>=m;m++)v=m/p,u=o(e,n,v),a=o(t,r,v),f=o(n,i,v),l=o(r,s,v),c=o(u,f,v),h=o(a,l,v),d.push(c,h);return d},t.WebGLGraphics.buildCircle=function(e,n){var r,i,s=e.shape,o=s.x,u=s.y;e.type===t.Graphics.CIRC?(r=s.radius,i=s.radius):(r=s.width,i=s.height);var a=40,f=2*Math.PI/a,l=0;if(e.fill){var c=t.hex2rgb(e.fillColor),h=e.fillAlpha,p=c[0]*h,d=c[1]*h,v=c[2]*h,m=n.points,g=n.indices,y=m.length/6;for(g.push(y),l=0;a+1>l;l++)m.push(o,u,p,d,v,h),m.push(o+Math.sin(f*l)*r,u+Math.cos(f*l)*i,p,d,v,h),g.push(y++,y++);g.push(y-1)}if(e.lineWidth){var w=e.points;for(e.points=[],l=0;a+1>l;l++)e.points.push(o+Math.sin(f*l)*r,u+Math.cos(f*l)*i);t.WebGLGraphics.buildLine(e,n),e.points=w}},t.WebGLGraphics.buildLine=function(e,n){var r=0,i=e.points;if(0!==i.length){if(e.lineWidth%2)for(r=0;r<i.length;r++)i[r]+=.5;var s=new t.Point(i[0],i[1]),o=new t.Point(i[i.length-2],i[i.length-1]);if(s.x===o.x&&s.y===o.y){i=i.slice(),i.pop(),i.pop(),o=new t.Point(i[i.length-2],i[i.length-1]);var u=o.x+.5*(s.x-o.x),a=o.y+.5*(s.y-o.y);i.unshift(u,a),i.push(u,a)}var f,l,c,h,p,d,v,m,g,y,w,E,S,x,T,N,C,k,L,A,O,M,_,D=n.points,P=n.indices,H=i.length/2,B=i.length,j=D.length/6,F=e.lineWidth/2,I=t.hex2rgb(e.lineColor),q=e.lineAlpha,R=I[0]*q,U=I[1]*q,z=I[2]*q;for(c=i[0],h=i[1],p=i[2],d=i[3],g=-(h-d),y=c-p,_=Math.sqrt(g*g+y*y),g/=_,y/=_,g*=F,y*=F,D.push(c-g,h-y,R,U,z,q),D.push(c+g,h+y,R,U,z,q),r=1;H-1>r;r++)c=i[2*(r-1)],h=i[2*(r-1)+1],p=i[2*r],d=i[2*r+1],v=i[2*(r+1)],m=i[2*(r+1)+1],g=-(h-d),y=c-p,_=Math.sqrt(g*g+y*y),g/=_,y/=_,g*=F,y*=F,w=-(d-m),E=p-v,_=Math.sqrt(w*w+E*E),w/=_,E/=_,w*=F,E*=F,T=-y+h-(-y+d),N=-g+p-(-g+c),C=(-g+c)*(-y+d)-(-g+p)*(-y+h),k=-E+m-(-E+d),L=-w+p-(-w+v),A=(-w+v)*(-E+d)-(-w+p)*(-E+m),O=T*L-k*N,Math.abs(O)<.1?(O+=10.1,D.push(p-g,d-y,R,U,z,q),D.push(p+g,d+y,R,U,z,q)):(f=(N*A-L*C)/O,l=(k*C-T*A)/O,M=(f-p)*(f-p)+(l-d)+(l-d),M>19600?(S=g-w,x=y-E,_=Math.sqrt(S*S+x*x),S/=_,x/=_,S*=F,x*=F,D.push(p-S,d-x),D.push(R,U,z,q),D.push(p+S,d+x),D.push(R,U,z,q),D.push(p-S,d-x),D.push(R,U,z,q),B++):(D.push(f,l),D.push(R,U,z,q),D.push(p-(f-p),d-(l-d)),D.push(R,U,z,q)));for(c=i[2*(H-2)],h=i[2*(H-2)+1],p=i[2*(H-1)],d=i[2*(H-1)+1],g=-(h-d),y=c-p,_=Math.sqrt(g*g+y*y),g/=_,y/=_,g*=F,y*=F,D.push(p-g,d-y),D.push(R,U,z,q),D.push(p+g,d+y),D.push(R,U,z,q),P.push(j),r=0;B>r;r++)P.push(j++);P.push(j-1)}},t.WebGLGraphics.buildComplexPoly=function(e,n){var r=e.points.slice();if(!(r.length<6)){var i=n.indices;n.points=r,n.alpha=e.fillAlpha,n.color=t.hex2rgb(e.fillColor);for(var s,o,u=1/0,a=-1/0,f=1/0,l=-1/0,c=0;c<r.length;c+=2)s=r[c],o=r[c+1],u=u>s?s:u,a=s>a?s:a,f=f>o?o:f,l=o>l?o:l;r.push(u,f,a,f,a,l,u,l);var h=r.length/2;for(c=0;h>c;c++)i.push(c)}},t.WebGLGraphics.buildPoly=function(e,n){var r=e.points;if(!(r.length<6)){var i=n.points,s=n.indices,o=r.length/2,u=t.hex2rgb(e.fillColor),a=e.fillAlpha,f=u[0]*a,l=u[1]*a,c=u[2]*a,h=t.PolyK.Triangulate(r);if(!h)return!1;var p=i.length/6,d=0;for(d=0;d<h.length;d+=3)s.push(h[d]+p),s.push(h[d]+p),s.push(h[d+1]+p),s.push(h[d+2]+p),s.push(h[d+2]+p);for(d=0;o>d;d++)i.push(r[2*d],r[2*d+1],f,l,c,a);return!0}},t.WebGLGraphics.graphicsDataPool=[],t.WebGLGraphicsData=function(e){this.gl=e,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0},t.WebGLGraphicsData.prototype.reset=function(){this.points=[],this.indices=[]},t.WebGLGraphicsData.prototype.upload=function(){var e=this.gl;this.glPoints=new t.Float32Array(this.points),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,this.glPoints,e.STATIC_DRAW),this.glIndicies=new t.Uint16Array(this.indices),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.glIndicies,e.STATIC_DRAW),this.dirty=!1},t.glContexts=[],t.instances=[],t.WebGLRenderer=function(e,n,r){if(r)for(var i in t.defaultRenderOptions)"undefined"==typeof r[i]&&(r[i]=t.defaultRenderOptions[i]);else r=t.defaultRenderOptions;t.defaultRenderer||(t.defaultRenderer=this),this.type=t.WEBGL_RENDERER,this.resolution=r.resolution,this.transparent=r.transparent,this.autoResize=r.autoResize||!1,this.preserveDrawingBuffer=r.preserveDrawingBuffer,this.clearBeforeRender=r.clearBeforeRender,this.width=e||800,this.height=n||600,this.view=r.view||document.createElement("canvas"),this.contextLostBound=this.handleContextLost.bind(this),this.contextRestoredBound=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.contextLostBound,!1),this.view.addEventListener("webglcontextrestored",this.contextRestoredBound,!1),this._contextOptions={alpha:this.transparent,antialias:r.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:r.preserveDrawingBuffer},this.projection=new t.Point,this.offset=new t.Point(0,0),this.shaderManager=new t.WebGLShaderManager,this.spriteBatch=new t.WebGLSpriteBatch,this.maskManager=new t.WebGLMaskManager,this.filterManager=new t.WebGLFilterManager,this.stencilManager=new t.WebGLStencilManager,this.blendModeManager=new t.WebGLBlendModeManager,this.renderSession={},this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.blendModeManager=this.blendModeManager,this.renderSession.spriteBatch=this.spriteBatch,this.renderSession.stencilManager=this.stencilManager,this.renderSession.renderer=this,this.renderSession.resolution=this.resolution,this.initContext(),this.mapBlendModes()},t.WebGLRenderer.prototype.constructor=t.WebGLRenderer,t.WebGLRenderer.prototype.initContext=function(){var e=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=e,!e)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=e.id=t.WebGLRenderer.glContextId++,t.glContexts[this.glContextId]=e,t.instances[this.glContextId]=this,e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.enable(e.BLEND),this.shaderManager.setContext(e),this.spriteBatch.setContext(e),this.maskManager.setContext(e),this.filterManager.setContext(e),this.blendModeManager.setContext(e),this.stencilManager.setContext(e),this.renderSession.gl=this.gl,this.resize(this.width,this.height)},t.WebGLRenderer.prototype.render=function(e){if(!this.contextLost){this.__stage!==e&&(this.__stage=e),e.updateTransform();var t=this.gl;t.viewport(0,0,this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,null),this.clearBeforeRender&&(this.transparent?t.clearColor(0,0,0,0):t.clearColor(e.backgroundColorSplit[0],e.backgroundColorSplit[1],e.backgroundColorSplit[2],1),t.clear(t.COLOR_BUFFER_BIT)),this.renderDisplayObject(e,this.projection)}},t.WebGLRenderer.prototype.renderDisplayObject=function(e,n,r){this.renderSession.blendModeManager.setBlendMode(t.blendModes.NORMAL),this.renderSession.drawCount=0,this.renderSession.flipY=r?-1:1,this.renderSession.projection=n,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,r),e._renderWebGL(this.renderSession),this.spriteBatch.end()},t.WebGLRenderer.prototype.resize=function(e,t){this.width=e*this.resolution,this.height=t*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"),this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2/this.resolution,this.projection.y=-this.height/2/this.resolution},t.WebGLRenderer.prototype.updateTexture=function(e){if(e.hasLoaded){var n=this.gl;return e._glTextures[n.id]||(e._glTextures[n.id]=n.createTexture()),n.bindTexture(n.TEXTURE_2D,e._glTextures[n.id]),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultipliedAlpha),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e.source),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e.scaleMode===t.scaleModes.LINEAR?n.LINEAR:n.NEAREST),e.mipmap&&t.isPowerOfTwo(e.width,e.height)?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,e.scaleMode===t.scaleModes.LINEAR?n.LINEAR_MIPMAP_LINEAR:n.NEAREST_MIPMAP_NEAREST),n.generateMipmap(n.TEXTURE_2D)):n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,e.scaleMode===t.scaleModes.LINEAR?n.LINEAR:n.NEAREST),e._powerOf2?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),e._dirty[n.id]=!1,e._glTextures[n.id]}},t.WebGLRenderer.prototype.handleContextLost=function(e){e.preventDefault(),this.contextLost=!0},t.WebGLRenderer.prototype.handleContextRestored=function(){this.initContext();for(var e in t.TextureCache){var n=t.TextureCache[e].baseTexture;n._glTextures=[]}this.contextLost=!1},t.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLostBound),this.view.removeEventListener("webglcontextrestored",this.contextRestoredBound),t.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl=null,this.renderSession=null,t.instances[this.glContextId]=null,t.WebGLRenderer.glContextId--},t.WebGLRenderer.prototype.mapBlendModes=function(){var e=this.gl;t.blendModesWebGL||(t.blendModesWebGL=[],t.blendModesWebGL[t.blendModes.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.ADD]=[e.SRC_ALPHA,e.DST_ALPHA],t.blendModesWebGL[t.blendModes.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.SCREEN]=[e.SRC_ALPHA,e.ONE],t.blendModesWebGL[t.blendModes.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA])},t.WebGLRenderer.glContextId=0,t.WebGLBlendModeManager=function(){this.currentBlendMode=99999},t.WebGLBlendModeManager.prototype.constructor=t.WebGLBlendModeManager,t.WebGLBlendModeManager.prototype.setContext=function(e){this.gl=e},t.WebGLBlendModeManager.prototype.setBlendMode=function(e){if(this.currentBlendMode===e)return!1;this.currentBlendMode=e;var n=t.blendModesWebGL[this.currentBlendMode];return this.gl.blendFunc(n[0],n[1]),!0},t.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null},t.WebGLMaskManager=function(){},t.WebGLMaskManager.prototype.constructor=t.WebGLMaskManager,t.WebGLMaskManager.prototype.setContext=function(e){this.gl=e},t.WebGLMaskManager.prototype.pushMask=function(e,n){var r=n.gl;e.dirty&&t.WebGLGraphics.updateGraphics(e,r),e._webGL[r.id].data.length&&n.stencilManager.pushStencil(e,e._webGL[r.id].data[0],n)},t.WebGLMaskManager.prototype.popMask=function(e,t){var n=this.gl;t.stencilManager.popStencil(e,e._webGL[n.id].data[0],t)},t.WebGLMaskManager.prototype.destroy=function(){this.gl=null},t.WebGLStencilManager=function(){this.stencilStack=[],this.reverse=!0,this.count=0},t.WebGLStencilManager.prototype.setContext=function(e){this.gl=e},t.WebGLStencilManager.prototype.pushStencil=function(e,t,n){var r=this.gl;this.bindGraphics(e,t,n),0===this.stencilStack.length&&(r.enable(r.STENCIL_TEST),r.clear(r.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(t);var i=this.count;r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),1===t.mode?(r.drawElements(r.TRIANGLE_FAN,t.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?(r.stencilFunc(r.EQUAL,255-i,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,i,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(t.indices.length-4)),this.reverse?r.stencilFunc(r.EQUAL,255-(i+1),255):r.stencilFunc(r.EQUAL,i+1,255),this.reverse=!this.reverse):(this.reverse?(r.stencilFunc(r.EQUAL,i,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,255-i,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_STRIP,t.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,i+1,255):r.stencilFunc(r.EQUAL,255-(i+1),255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),this.count++},t.WebGLStencilManager.prototype.bindGraphics=function(e,n,r){this._currentGraphics=e;var i,s=this.gl,o=r.projection,u=r.offset;1===n.mode?(i=r.shaderManager.complexPrimitiveShader,r.shaderManager.setShader(i),s.uniform1f(i.flipY,r.flipY),s.uniformMatrix3fv(i.translationMatrix,!1,e.worldTransform.toArray(!0)),s.uniform2f(i.projectionVector,o.x,-o.y),s.uniform2f(i.offsetVector,-u.x,-u.y),s.uniform3fv(i.tintColor,t.hex2rgb(e.tint)),s.uniform3fv(i.color,n.color),s.uniform1f(i.alpha,e.worldAlpha*n.alpha),s.bindBuffer(s.ARRAY_BUFFER,n.buffer),s.vertexAttribPointer(i.aVertexPosition,2,s.FLOAT,!1,8,0),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,n.indexBuffer)):(i=r.shaderManager.primitiveShader,r.shaderManager.setShader(i),s.uniformMatrix3fv(i.translationMatrix,!1,e.worldTransform.toArray(!0)),s.uniform1f(i.flipY,r.flipY),s.uniform2f(i.projectionVector,o.x,-o.y),s.uniform2f(i.offsetVector,-u.x,-u.y),s.uniform3fv(i.tintColor,t.hex2rgb(e.tint)),s.uniform1f(i.alpha,e.worldAlpha),s.bindBuffer(s.ARRAY_BUFFER,n.buffer),s.vertexAttribPointer(i.aVertexPosition,2,s.FLOAT,!1,24,0),s.vertexAttribPointer(i.colorAttribute,4,s.FLOAT,!1,24,8),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,n.indexBuffer))},t.WebGLStencilManager.prototype.popStencil=function(e,t,n){var r=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)r.disable(r.STENCIL_TEST);else{var i=this.count;this.bindGraphics(e,t,n),r.colorMask(!1,!1,!1,!1),1===t.mode?(this.reverse=!this.reverse,this.reverse?(r.stencilFunc(r.EQUAL,255-(i+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,i+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(t.indices.length-4)),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),r.drawElements(r.TRIANGLE_FAN,t.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,i,255):r.stencilFunc(r.EQUAL,255-i,255)):(this.reverse?(r.stencilFunc(r.EQUAL,i+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,255-(i+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_STRIP,t.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,i,255):r.stencilFunc(r.EQUAL,255-i,255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}},t.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null,this.gl=null},t.WebGLShaderManager=function(){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var e=0;e<this.maxAttibs;e++)this.attribState[e]=!1;this.stack=[]},t.WebGLShaderManager.prototype.constructor=t.WebGLShaderManager,t.WebGLShaderManager.prototype.setContext=function(e){this.gl=e,this.primitiveShader=new t.PrimitiveShader(e),this.complexPrimitiveShader=new t.ComplexPrimitiveShader(e),this.defaultShader=new t.PixiShader(e),this.fastShader=new t.PixiFastShader(e),this.stripShader=new t.StripShader(e),this.setShader(this.defaultShader)},t.WebGLShaderManager.prototype.setAttribs=function(e){var t;for(t=0;t<this.tempAttribState.length;t++)this.tempAttribState[t]=!1;for(t=0;t<e.length;t++){var n=e[t];this.tempAttribState[n]=!0}var r=this.gl;for(t=0;t<this.attribState.length;t++)this.attribState[t]!==this.tempAttribState[t]&&(this.attribState[t]=this.tempAttribState[t],this.tempAttribState[t]?r.enableVertexAttribArray(t):r.disableVertexAttribArray(t))},t.WebGLShaderManager.prototype.setShader=function(e){return this._currentId===e._UID?!1:(this._currentId=e._UID,this.currentShader=e,this.gl.useProgram(e.program),this.setAttribs(e.attributes),!0)},t.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.complexPrimitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.stripShader.destroy(),this.gl=null},t.WebGLSpriteBatch=function(){this.vertSize=5,this.size=2e3;var e=4*this.size*4*this.vertSize,n=6*this.size;this.vertices=new t.ArrayBuffer(e),this.positions=new t.Float32Array(this.vertices),this.colors=new t.Uint32Array(this.vertices),this.indices=new t.Uint16Array(n),this.lastIndexCount=0;for(var r=0,i=0;n>r;r+=6,i+=4)this.indices[r+0]=i+0,this.indices[r+1]=i+1,this.indices[r+2]=i+2,this.indices[r+3]=i+0,this.indices[r+4]=i+2,this.indices[r+5]=i+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.dirty=!0,this.textures=[],this.blendModes=[],this.shaders=[],this.sprites=[],this.defaultShader=new t.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])},t.WebGLSpriteBatch.prototype.setContext=function(e){this.gl=e,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW),this.currentBlendMode=99999;var n=new t.PixiShader(e);n.fragmentSrc=this.defaultShader.fragmentSrc,n.uniforms={},n.init(),this.defaultShader.shaders[e.id]=n},t.WebGLSpriteBatch.prototype.begin=function(e){this.renderSession=e,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},t.WebGLSpriteBatch.prototype.end=function(){this.flush()},t.WebGLSpriteBatch.prototype.render=function(e){var t=e.texture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=t.baseTexture);var n=t._uvs;if(n){var r,i,s,o,u=e.anchor.x,a=e.anchor.y;if(t.trim){var f=t.trim;i=f.x-u*f.width,r=i+t.crop.width,o=f.y-a*f.height,s=o+t.crop.height}else r=t.frame.width*(1-u),i=t.frame.width*-u,s=t.frame.height*(1-a),o=t.frame.height*-a;var l=4*this.currentBatchSize*this.vertSize,c=t.baseTexture.resolution,h=e.worldTransform,p=h.a/c,d=h.b/c,v=h.c/c,m=h.d/c,g=h.tx,y=h.ty,b=this.colors,w=this.positions;this.renderSession.roundPixels?(w[l]=p*i+v*o+g|0,w[l+1]=m*o+d*i+y|0,w[l+5]=p*r+v*o+g|0,w[l+6]=m*o+d*r+y|0,w[l+10]=p*r+v*s+g|0,w[l+11]=m*s+d*r+y|0,w[l+15]=p*i+v*s+g|0,w[l+16]=m*s+d*i+y|0):(w[l]=p*i+v*o+g,w[l+1]=m*o+d*i+y,w[l+5]=p*r+v*o+g,w[l+6]=m*o+d*r+y,w[l+10]=p*r+v*s+g,w[l+11]=m*s+d*r+y,w[l+15]=p*i+v*s+g,w[l+16]=m*s+d*i+y),w[l+2]=n.x0,w[l+3]=n.y0,w[l+7]=n.x1,w[l+8]=n.y1,w[l+12]=n.x2,w[l+13]=n.y2,w[l+17]=n.x3,w[l+18]=n.y3;var E=e.tint;b[l+4]=b[l+9]=b[l+14]=b[l+19]=(E>>16)+(65280&E)+((255&E)<<16)+(255*e.worldAlpha<<24),this.sprites[this.currentBatchSize++]=e}},t.WebGLSpriteBatch.prototype.renderTilingSprite=function(e){var n=e.tilingTexture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=n.baseTexture),e._uvs||(e._uvs=new t.TextureUvs);var r=e._uvs;e.tilePosition.x%=n.baseTexture.width*e.tileScaleOffset.x,e.tilePosition.y%=n.baseTexture.height*e.tileScaleOffset.y;var i=e.tilePosition.x/(n.baseTexture.width*e.tileScaleOffset.x),s=e.tilePosition.y/(n.baseTexture.height*e.tileScaleOffset.y),o=e.width/n.baseTexture.width/(e.tileScale.x*e.tileScaleOffset.x),u=e.height/n.baseTexture.height/(e.tileScale.y*e.tileScaleOffset.y);r.x0=0-i,r.y0=0-s,r.x1=1*o-i,r.y1=0-s,r.x2=1*o-i,r.y2=1*u-s,r.x3=0-i,r.y3=1*u-s;var a=e.tint,f=(a>>16)+(65280&a)+((255&a)<<16)+(255*e.alpha<<24),l=this.positions,c=this.colors,h=e.width,p=e.height,d=e.anchor.x,v=e.anchor.y,m=h*(1-d),g=h*-d,y=p*(1-v),w=p*-v,E=4*this.currentBatchSize*this.vertSize,S=n.baseTexture.resolution,x=e.worldTransform,T=x.a/S,N=x.b/S,C=x.c/S,k=x.d/S,L=x.tx,A=x.ty;l[E++]=T*g+C*w+L,l[E++]=k*w+N*g+A,l[E++]=r.x0,l[E++]=r.y0,c[E++]=f,l[E++]=T*m+C*w+L,l[E++]=k*w+N*m+A,l[E++]=r.x1,l[E++]=r.y1,c[E++]=f,l[E++]=T*m+C*y+L,l[E++]=k*y+N*m+A,l[E++]=r.x2,l[E++]=r.y2,c[E++]=f,l[E++]=T*g+C*y+L,l[E++]=k*y+N*g+A,l[E++]=r.x3,l[E++]=r.y3,c[E++]=f,this.sprites[this.currentBatchSize++]=e},t.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var e,n=this.gl;if(this.dirty){this.dirty=!1,n.activeTexture(n.TEXTURE0),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e=this.defaultShader.shaders[n.id];var r=4*this.vertSize;n.vertexAttribPointer(e.aVertexPosition,2,n.FLOAT,!1,r,0),n.vertexAttribPointer(e.aTextureCoord,2,n.FLOAT,!1,r,8),n.vertexAttribPointer(e.colorAttribute,4,n.UNSIGNED_BYTE,!0,r,16)}if(this.currentBatchSize>.5*this.size)n.bufferSubData(n.ARRAY_BUFFER,0,this.vertices);else{var i=this.positions.subarray(0,4*this.currentBatchSize*this.vertSize);n.bufferSubData(n.ARRAY_BUFFER,0,i)}for(var s,o,u,a,f=0,l=0,c=null,h=this.renderSession.blendModeManager.currentBlendMode,p=null,d=!1,v=!1,m=0,g=this.currentBatchSize;g>m;m++){if(a=this.sprites[m],s=a.texture.baseTexture,o=a.blendMode,u=a.shader||this.defaultShader,d=h!==o,v=p!==u,(c!==s||d||v)&&(this.renderBatch(c,f,l),l=m,f=0,c=s,d&&(h=o,this.renderSession.blendModeManager.setBlendMode(h)),v)){p=u,e=p.shaders[n.id],e||(e=new t.PixiShader(n),e.fragmentSrc=p.fragmentSrc,e.uniforms=p.uniforms,e.init(),p.shaders[n.id]=e),this.renderSession.shaderManager.setShader(e),e.dirty&&e.syncUniforms();var y=this.renderSession.projection;n.uniform2f(e.projectionVector,y.x,y.y);var w=this.renderSession.offset;n.uniform2f(e.offsetVector,w.x,w.y)}f++}this.renderBatch(c,f,l),this.currentBatchSize=0}},t.WebGLSpriteBatch.prototype.renderBatch=function(e,t,n){if(0!==t){var r=this.gl;e._dirty[r.id]?this.renderSession.renderer.updateTexture(e):r.bindTexture(r.TEXTURE_2D,e._glTextures[r.id]),r.drawElements(r.TRIANGLES,6*t,r.UNSIGNED_SHORT,6*n*2),this.renderSession.drawCount++}},t.WebGLSpriteBatch.prototype.stop=function(){this.flush(),this.dirty=!0},t.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0},t.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},t.WebGLFastSpriteBatch=function(e){this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize;var n=4*this.size*this.vertSize,r=6*this.maxSize;this.vertices=new t.Float32Array(n),this.indices=new t.Uint16Array(r),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0;for(var i=0,s=0;r>i;i+=6,s+=4)this.indices[i+0]=s+0,this.indices[i+1]=s+1,this.indices[i+2]=s+2,this.indices[i+3]=s+0,this.indices[i+4]=s+2,this.indices[i+5]=s+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(e)},t.WebGLFastSpriteBatch.prototype.constructor=t.WebGLFastSpriteBatch,t.WebGLFastSpriteBatch.prototype.setContext=function(e){this.gl=e,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW)},t.WebGLFastSpriteBatch.prototype.begin=function(e,t){this.renderSession=t,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=e.worldTransform.toArray(!0),this.start()},t.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},t.WebGLFastSpriteBatch.prototype.render=function(e){var t=e.children,n=t[0];if(n.texture._uvs){this.currentBaseTexture=n.texture.baseTexture,n.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(n.blendMode));for(var r=0,i=t.length;i>r;r++)this.renderSprite(t[r]);this.flush()}},t.WebGLFastSpriteBatch.prototype.renderSprite=function(e){if(e.visible&&(e.texture.baseTexture===this.currentBaseTexture||(this.flush(),this.currentBaseTexture=e.texture.baseTexture,e.texture._uvs))){var t,n,r,i,s,o,u,a,f=this.vertices;if(t=e.texture._uvs,n=e.texture.frame.width,r=e.texture.frame.height,e.texture.trim){var l=e.texture.trim;s=l.x-e.anchor.x*l.width,i=s+e.texture.crop.width,u=l.y-e.anchor.y*l.height,o=u+e.texture.crop.height}else i=e.texture.frame.width*(1-e.anchor.x),s=e.texture.frame.width*-e.anchor.x,o=e.texture.frame.height*(1-e.anchor.y),u=e.texture.frame.height*-e.anchor.y;a=4*this.currentBatchSize*this.vertSize,f[a++]=s,f[a++]=u,f[a++]=e.position.x,f[a++]=e.position.y,f[a++]=e.scale.x,f[a++]=e.scale.y,f[a++]=e.rotation,f[a++]=t.x0,f[a++]=t.y1,f[a++]=e.alpha,f[a++]=i,f[a++]=u,f[a++]=e.position.x,f[a++]=e.position.y,f[a++]=e.scale.x,f[a++]=e.scale.y,f[a++]=e.rotation,f[a++]=t.x1,f[a++]=t.y1,f[a++]=e.alpha,f[a++]=i,f[a++]=o,f[a++]=e.position.x,f[a++]=e.position.y,f[a++]=e.scale.x,f[a++]=e.scale.y,f[a++]=e.rotation,f[a++]=t.x2,f[a++]=t.y2,f[a++]=e.alpha,f[a++]=s,f[a++]=o,f[a++]=e.position.x,f[a++]=e.position.y,f[a++]=e.scale.x,f[a++]=e.scale.y,f[a++]=e.rotation,f[a++]=t.x3,f[a++]=t.y3,f[a++]=e.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush()}},t.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var e=this.gl;if(this.currentBaseTexture._glTextures[e.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,e),e.bindTexture(e.TEXTURE_2D,this.currentBaseTexture._glTextures[e.id]),this.currentBatchSize>.5*this.size)e.bufferSubData(e.ARRAY_BUFFER,0,this.vertices);else{var t=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);e.bufferSubData(e.ARRAY_BUFFER,0,t)}e.drawElements(e.TRIANGLES,6*this.currentBatchSize,e.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},t.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},t.WebGLFastSpriteBatch.prototype.start=function(){var e=this.gl;e.activeTexture(e.TEXTURE0),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var t=this.renderSession.projection;e.uniform2f(this.shader.projectionVector,t.x,t.y),e.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);var n=4*this.vertSize;e.vertexAttribPointer(this.shader.aVertexPosition,2,e.FLOAT,!1,n,0),e.vertexAttribPointer(this.shader.aPositionCoord,2,e.FLOAT,!1,n,8),e.vertexAttribPointer(this.shader.aScale,2,e.FLOAT,!1,n,16),e.vertexAttribPointer(this.shader.aRotation,1,e.FLOAT,!1,n,24),e.vertexAttribPointer(this.shader.aTextureCoord,2,e.FLOAT,!1,n,28),e.vertexAttribPointer(this.shader.colorAttribute,1,e.FLOAT,!1,n,36)},t.WebGLFilterManager=function(){this.filterStack=[],this.offsetX=0,this.offsetY=0},t.WebGLFilterManager.prototype.constructor=t.WebGLFilterManager,t.WebGLFilterManager.prototype.setContext=function(e){this.gl=e,this.texturePool=[],this.initShaderBuffers()},t.WebGLFilterManager.prototype.begin=function(e,t){this.renderSession=e,this.defaultShader=e.shaderManager.defaultShader;var n=this.renderSession.projection;this.width=2*n.x,this.height=2*-n.y,this.buffer=t},t.WebGLFilterManager.prototype.pushFilter=function(e){var n=this.gl,r=this.renderSession.projection,i=this.renderSession.offset;e._filterArea=e.target.filterArea||e.target.getBounds(),this.filterStack.push(e);var s=e.filterPasses[0];this.offsetX+=e._filterArea.x,this.offsetY+=e._filterArea.y;var o=this.texturePool.pop();o?o.resize(this.width,this.height):o=new t.FilterTexture(this.gl,this.width,this.height),n.bindTexture(n.TEXTURE_2D,o.texture);var u=e._filterArea,a=s.padding;u.x-=a,u.y-=a,u.width+=2*a,u.height+=2*a,u.x<0&&(u.x=0),u.width>this.width&&(u.width=this.width),u.y<0&&(u.y=0),u.height>this.height&&(u.height=this.height),n.bindFramebuffer(n.FRAMEBUFFER,o.frameBuffer),n.viewport(0,0,u.width,u.height),r.x=u.width/2,r.y=-u.height/2,i.x=-u.x,i.y=-u.y,n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),e._glFilterTexture=o},t.WebGLFilterManager.prototype.popFilter=function(){var e=this.gl,n=this.filterStack.pop(),r=n._filterArea,i=n._glFilterTexture,s=this.renderSession.projection,o=this.renderSession.offset;if(n.filterPasses.length>1){e.viewport(0,0,r.width,r.height),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=r.height,this.vertexArray[2]=r.width,this.vertexArray[3]=r.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=r.width,this.vertexArray[7]=0,e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexArray),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=r.width/this.width,this.uvArray[5]=r.height/this.height,this.uvArray[6]=r.width/this.width,this.uvArray[7]=r.height/this.height,e.bufferSubData(e.ARRAY_BUFFER,0,this.uvArray);var u=i,a=this.texturePool.pop();a||(a=new t.FilterTexture(this.gl,this.width,this.height)),a.resize(this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,a.frameBuffer),e.clear(e.COLOR_BUFFER_BIT),e.disable(e.BLEND);for(var f=0;f<n.filterPasses.length-1;f++){var l=n.filterPasses[f];e.bindFramebuffer(e.FRAMEBUFFER,a.frameBuffer),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,u.texture),this.applyFilterPass(l,r,r.width,r.height);var c=u;u=a,a=c}e.enable(e.BLEND),i=u,this.texturePool.push(a)}var h=n.filterPasses[n.filterPasses.length-1];this.offsetX-=r.x,this.offsetY-=r.y;var p=this.width,d=this.height,v=0,m=0,g=this.buffer;if(0===this.filterStack.length)e.colorMask(!0,!0,!0,!0);else{var y=this.filterStack[this.filterStack.length-1];r=y._filterArea,p=r.width,d=r.height,v=r.x,m=r.y,g=y._glFilterTexture.frameBuffer}s.x=p/2,s.y=-d/2,o.x=v,o.y=m,r=n._filterArea;var w=r.x-v,E=r.y-m;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=w,this.vertexArray[1]=E+r.height,this.vertexArray[2]=w+r.width,this.vertexArray[3]=E+r.height,this.vertexArray[4]=w,this.vertexArray[5]=E,this.vertexArray[6]=w+r.width,this.vertexArray[7]=E,e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexArray),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=r.width/this.width,this.uvArray[5]=r.height/this.height,this.uvArray[6]=r.width/this.width,this.uvArray[7]=r.height/this.height,e.bufferSubData(e.ARRAY_BUFFER,0,this.uvArray),e.viewport(0,0,p*this.renderSession.resolution,d*this.renderSession.resolution),e.bindFramebuffer(e.FRAMEBUFFER,g),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i.texture),this.applyFilterPass(h,r,p,d),this.texturePool.push(i),n._glFilterTexture=null},t.WebGLFilterManager.prototype.applyFilterPass=function(e,n,r,i){var s=this.gl,o=e.shaders[s.id];o||(o=new t.PixiShader(s),o.fragmentSrc=e.fragmentSrc,o.uniforms=e.uniforms,o.init(),e.shaders[s.id]=o),this.renderSession.shaderManager.setShader(o),s.uniform2f(o.projectionVector,r/2,-i/2),s.uniform2f(o.offsetVector,0,0),e.uniforms.dimensions&&(e.uniforms.dimensions.value[0]=this.width,e.uniforms.dimensions.value[1]=this.height,e.uniforms.dimensions.value[2]=this.vertexArray[0],e.uniforms.dimensions.value[3]=this.vertexArray[5]),o.syncUniforms(),s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer),s.vertexAttribPointer(o.aVertexPosition,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this.uvBuffer),s.vertexAttribPointer(o.aTextureCoord,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this.colorBuffer),s.vertexAttribPointer(o.colorAttribute,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.indexBuffer),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0),this.renderSession.drawCount++},t.WebGLFilterManager.prototype.initShaderBuffers=function(){var e=this.gl;this.vertexBuffer=e.createBuffer(),this.uvBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.vertexArray=new t.Float32Array([0,0,1,0,0,1,1,1]),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.STATIC_DRAW),this.uvArray=new t.Float32Array([0,0,1,0,0,1,1,1]),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvArray,e.STATIC_DRAW),this.colorArray=new t.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colorArray,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),e.STATIC_DRAW)},t.WebGLFilterManager.prototype.destroy=function(){var e=this.gl;this.filterStack=null,this.offsetX=0,this.offsetY=0;for(var t=0;t<this.texturePool.length;t++)this.texturePool[t].destroy();this.texturePool=null,e.deleteBuffer(this.vertexBuffer),e.deleteBuffer(this.uvBuffer),e.deleteBuffer(this.colorBuffer),e.deleteBuffer(this.indexBuffer)},t.FilterTexture=function(e,n,r,i){this.gl=e,this.frameBuffer=e.createFramebuffer(),this.texture=e.createTexture(),i=i||t.scaleModes.DEFAULT,e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,i===t.scaleModes.LINEAR?e.LINEAR:e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i===t.scaleModes.LINEAR?e.LINEAR:e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0),this.renderBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.renderBuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this.renderBuffer),this.resize(n,r)},t.FilterTexture.prototype.constructor=t.FilterTexture,t.FilterTexture.prototype.clear=function(){var e=this.gl;e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)},t.FilterTexture.prototype.resize=function(e,t){if(this.width!==e||this.height!==t){this.width=e,this.height=t;var n=this.gl;n.bindTexture(n.TEXTURE_2D,this.texture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e,t,0,n.RGBA,n.UNSIGNED_BYTE,null),n.bindRenderbuffer(n.RENDERBUFFER,this.renderBuffer),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,e,t)}},t.FilterTexture.prototype.destroy=function(){var e=this.gl;e.deleteFramebuffer(this.frameBuffer),e.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},t.CanvasBuffer=function(e,t){this.width=e,this.height=t,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=e,this.canvas.height=t},t.CanvasBuffer.prototype.constructor=t.CanvasBuffer,t.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height)},t.CanvasBuffer.prototype.resize=function(e,t){this.width=this.canvas.width=e,this.height=this.canvas.height=t},t.CanvasMaskManager=function(){},t.CanvasMaskManager.prototype.constructor=t.CanvasMaskManager,t.CanvasMaskManager.prototype.pushMask=function(e,n){var r=n.context;r.save();var i=e.alpha,s=e.worldTransform,o=n.resolution;r.setTransform(s.a*o,s.b*o,s.c*o,s.d*o,s.tx*o,s.ty*o),t.CanvasGraphics.renderGraphicsMask(e,r),r.clip(),e.worldAlpha=i},t.CanvasMaskManager.prototype.popMask=function(e){e.context.restore()},t.CanvasTinter=function(){},t.CanvasTinter.getTintedTexture=function(e,n){var r=e.texture,i=t.CanvasTinter.canvas||document.createElement("canvas");if(t.CanvasTinter.tintMethod(r,n,i),t.CanvasTinter.convertTintToImage){var s=new Image;s.src=i.toDataURL()}else t.CanvasTinter.canvas=null;return i},t.CanvasTinter.tintWithMultiply=function(e,t,n){var r=n.getContext("2d"),i=e.crop;n.width=i.width,n.height=i.height,r.fillStyle="#"+("00000"+(0|t).toString(16)).substr(-6),r.fillRect(0,0,i.width,i.height),r.globalCompositeOperation="multiply",r.drawImage(e.baseTexture.source,i.x,i.y,i.width,i.height,0,0,i.width,i.height),r.globalCompositeOperation="destination-atop",r.drawImage(e.baseTexture.source,i.x,i.y,i.width,i.height,0,0,i.width,i.height)},t.CanvasTinter.tintWithOverlay=function(e,t,n){var r=n.getContext("2d"),i=e.crop;n.width=i.width,n.height=i.height,r.globalCompositeOperation="copy",r.fillStyle="#"+("00000"+(0|t).toString(16)).substr(-6),r.fillRect(0,0,i.width,i.height),r.globalCompositeOperation="destination-atop",r.drawImage(e.baseTexture.source,i.x,i.y,i.width,i.height,0,0,i.width,i.height)},t.CanvasTinter.tintWithPerPixel=function(e,n,r){var i=r.getContext("2d"),s=e.crop;r.width=s.width,r.height=s.height,i.globalCompositeOperation="copy",i.drawImage(e.baseTexture.source,s.x,s.y,s.width,s.height,0,0,s.width,s.height);for(var o=t.hex2rgb(n),u=o[0],a=o[1],f=o[2],l=i.getImageData(0,0,s.width,s.height),c=l.data,h=0;h<c.length;h+=4)if(c[h+0]*=u,c[h+1]*=a,c[h+2]*=f,!t.CanvasTinter.canHandleAlpha){var p=c[h+3];c[h+0]/=255/p,c[h+1]/=255/p,c[h+2]/=255/p}i.putImageData(l,0,0)},t.CanvasTinter.roundColor=function(e){var n=t.CanvasTinter.cacheStepsPerColorChannel,r=t.hex2rgb(e);return r[0]=Math.min(255,r[0]/n*n),r[1]=Math.min(255,r[1]/n*n),r[2]=Math.min(255,r[2]/n*n),t.rgb2hex(r)},t.CanvasTinter.checkInverseAlpha=function(){var e=new t.CanvasBuffer(2,1);e.context.fillStyle="rgba(10, 20, 30, 0.5)",e.context.fillRect(0,0,1,1);var n=e.context.getImageData(0,0,1,1);e.context.putImageData(n,1,0);var r=e.context.getImageData(1,0,1,1);return r.data[0]===n.data[0]&&r.data[1]===n.data[1]&&r.data[2]===n.data[2]&&r.data[3]===n.data[3]},t.CanvasTinter.cacheStepsPerColorChannel=8,t.CanvasTinter.convertTintToImage=!1,t.CanvasTinter.canHandleAlpha=t.CanvasTinter.checkInverseAlpha(),t.CanvasTinter.canUseMultiply=t.canUseNewCanvasBlendModes(),t.CanvasTinter.tintMethod=t.CanvasTinter.canUseMultiply?t.CanvasTinter.tintWithMultiply:t.CanvasTinter.tintWithPerPixel,t.CanvasRenderer=function(e,n,r){if(r)for(var i in t.defaultRenderOptions)"undefined"==typeof r[i]&&(r[i]=t.defaultRenderOptions[i]);else r=t.defaultRenderOptions;t.defaultRenderer||(t.defaultRenderer=this),this.type=t.CANVAS_RENDERER,this.resolution=r.resolution,this.clearBeforeRender=r.clearBeforeRender,this.transparent=r.transparent,this.autoResize=r.autoResize||!1,this.width=e||800,this.height=n||600,this.width*=this.resolution,this.height*=this.resolution,this.view=r.view||document.createElement("canvas"),this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.view.width=this.width*this.resolution,this.view.height=this.height*this.resolution,this.count=0,this.maskManager=new t.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,roundPixels:!1},this.mapBlendModes(),this.resize(e,n),"imageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="oImageSmoothingEnabled":"msImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="msImageSmoothingEnabled")},t.CanvasRenderer.prototype.constructor=t.CanvasRenderer,t.CanvasRenderer.prototype.render=function(e){e.updateTransform(),this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.renderSession.currentBlendMode=t.blendModes.NORMAL,this.context.globalCompositeOperation=t.blendModesCanvas[t.blendModes.NORMAL],navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=e.backgroundColorString,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(e)},t.CanvasRenderer.prototype.destroy=function(e){"undefined"==typeof e&&(e=!0),e&&this.view.parent&&this.view.parent.removeChild(this.view),this.view=null,this.context=null,this.maskManager=null,this.renderSession=null},t.CanvasRenderer.prototype.resize=function(e,t){this.width=e*this.resolution,this.height=t*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px")},t.CanvasRenderer.prototype.renderDisplayObject=function(e,t){this.renderSession.context=t||this.context,this.renderSession.resolution=this.resolution,e._renderCanvas(this.renderSession)},t.CanvasRenderer.prototype.mapBlendModes=function(){t.blendModesCanvas||(t.blendModesCanvas=[],t.canUseNewCanvasBlendModes()?(t.blendModesCanvas[t.blendModes.NORMAL]="source-over",t.blendModesCanvas[t.blendModes.ADD]="lighter",t.blendModesCanvas[t.blendModes.MULTIPLY]="multiply",t.blendModesCanvas[t.blendModes.SCREEN]="screen",t.blendModesCanvas[t.blendModes.OVERLAY]="overlay",t.blendModesCanvas[t.blendModes.DARKEN]="darken",t.blendModesCanvas[t.blendModes.LIGHTEN]="lighten",t.blendModesCanvas[t.blendModes.COLOR_DODGE]="color-dodge",t.blendModesCanvas[t.blendModes.COLOR_BURN]="color-burn",t.blendModesCanvas[t.blendModes.HARD_LIGHT]="hard-light",t.blendModesCanvas[t.blendModes.SOFT_LIGHT]="soft-light",t.blendModesCanvas[t.blendModes.DIFFERENCE]="difference",t.blendModesCanvas[t.blendModes.EXCLUSION]="exclusion",t.blendModesCanvas[t.blendModes.HUE]="hue",t.blendModesCanvas[t.blendModes.SATURATION]="saturation",t.blendModesCanvas[t.blendModes.COLOR]="color",t.blendModesCanvas[t.blendModes.LUMINOSITY]="luminosity"):(t.blendModesCanvas[t.blendModes.NORMAL]="source-over",t.blendModesCanvas[t.blendModes.ADD]="lighter",t.blendModesCanvas[t.blendModes.MULTIPLY]="source-over",t.blendModesCanvas[t.blendModes.SCREEN]="source-over",t.blendModesCanvas[t.blendModes.OVERLAY]="source-over",t.blendModesCanvas[t.blendModes.DARKEN]="source-over",t.blendModesCanvas[t.blendModes.LIGHTEN]="source-over",t.blendModesCanvas[t.blendModes.COLOR_DODGE]="source-over",t.blendModesCanvas[t.blendModes.COLOR_BURN]="source-over",t.blendModesCanvas[t.blendModes.HARD_LIGHT]="source-over",t.blendModesCanvas[t.blendModes.SOFT_LIGHT]="source-over",t.blendModesCanvas[t.blendModes.DIFFERENCE]="source-over",t.blendModesCanvas[t.blendModes.EXCLUSION]="source-over",t.blendModesCanvas[t.blendModes.HUE]="source-over",t.blendModesCanvas[t.blendModes.SATURATION]="source-over",t.blendModesCanvas[t.blendModes.COLOR]="source-over",t.blendModesCanvas[t.blendModes.LUMINOSITY]="source-over"))},t.CanvasGraphics=function(){},t.CanvasGraphics.renderGraphics=function(e,n){var r=e.worldAlpha;e.dirty&&(this.updateGraphicsTint(e),e.dirty=!1);for(var i=0;i<e.graphicsData.length;i++){var s=e.graphicsData[i],o=s.shape,u=s._fillTint,a=s._lineTint;if(n.lineWidth=s.lineWidth,s.type===t.Graphics.POLY){n.beginPath();var f=o.points;n.moveTo(f[0],f[1]);for(var l=1;l<f.length/2;l++)n.lineTo(f[2*l],f[2*l+1]);o.closed&&n.lineTo(f[0],f[1]),f[0]===f[f.length-2]&&f[1]===f[f.length-1]&&n.closePath(),s.fill&&(n.globalAlpha=s.fillAlpha*r,n.fillStyle="#"+("00000"+(0|u).toString(16)).substr(-6),n.fill()),s.lineWidth&&(n.globalAlpha=s.lineAlpha*r,n.strokeStyle="#"+("00000"+(0|a).toString(16)).substr(-6),n.stroke())}else if(s.type===t.Graphics.RECT)(s.fillColor||0===s.fillColor)&&(n.globalAlpha=s.fillAlpha*r,n.fillStyle="#"+("00000"+(0|u).toString(16)).substr(-6),n.fillRect(o.x,o.y,o.width,o.height)),s.lineWidth&&(n.globalAlpha=s.lineAlpha*r,n.strokeStyle="#"+("00000"+(0|a).toString(16)).substr(-6),n.strokeRect(o.x,o.y,o.width,o.height));else if(s.type===t.Graphics.CIRC)n.beginPath(),n.arc(o.x,o.y,o.radius,0,2*Math.PI),n.closePath(),s.fill&&(n.globalAlpha=s.fillAlpha*r,n.fillStyle="#"+("00000"+(0|u).toString(16)).substr(-6),n.fill()),s.lineWidth&&(n.globalAlpha=s.lineAlpha*r,n.strokeStyle="#"+("00000"+(0|a).toString(16)).substr(-6),n.stroke());else if(s.type===t.Graphics.ELIP){var c=2*o.width,h=2*o.height,p=o.x-c/2,d=o.y-h/2;n.beginPath();var v=.5522848,m=c/2*v,g=h/2*v,y=p+c,w=d+h,E=p+c/2,S=d+h/2;n.moveTo(p,S),n.bezierCurveTo(p,S-g,E-m,d,E,d),n.bezierCurveTo(E+m,d,y,S-g,y,S),n.bezierCurveTo(y,S+g,E+m,w,E,w),n.bezierCurveTo(E-m,w,p,S+g,p,S),n.closePath(),s.fill&&(n.globalAlpha=s.fillAlpha*r,n.fillStyle="#"+("00000"+(0|u).toString(16)).substr(-6),n.fill()),s.lineWidth&&(n.globalAlpha=s.lineAlpha*r,n.strokeStyle="#"+("00000"+(0|a).toString(16)).substr(-6),n.stroke())}else if(s.type===t.Graphics.RREC){var x=o.x,T=o.y,N=o.width,C=o.height,k=o.radius,L=Math.min(N,C)/2|0;k=k>L?L:k,n.beginPath(),n.moveTo(x,T+k),n.lineTo(x,T+C-k),n.quadraticCurveTo(x,T+C,x+k,T+C),n.lineTo(x+N-k,T+C),n.quadraticCurveTo(x+N,T+C,x+N,T+C-k),n.lineTo(x+N,T+k),n.quadraticCurveTo(x+N,T,x+N-k,T),n.lineTo(x+k,T),n.quadraticCurveTo(x,T,x,T+k),n.closePath(),(s.fillColor||0===s.fillColor)&&(n.globalAlpha=s.fillAlpha*r,n.fillStyle="#"+("00000"+(0|u).toString(16)).substr(-6),n.fill()),s.lineWidth&&(n.globalAlpha=s.lineAlpha*r,n.strokeStyle="#"+("00000"+(0|a).toString(16)).substr(-6),n.stroke())}}},t.CanvasGraphics.renderGraphicsMask=function(e,n){var r=e.graphicsData.length;if(0!==r){n.beginPath();for(var i=0;r>i;i++){var s=e.graphicsData[i],o=s.shape;if(s.type===t.Graphics.POLY){var u=o.points;n.moveTo(u[0],u[1]);for(var a=1;a<u.length/2;a++)n.lineTo(u[2*a],u[2*a+1]);u[0]===u[u.length-2]&&u[1]===u[u.length-1]&&n.closePath()}else if(s.type===t.Graphics.RECT)n.rect(o.x,o.y,o.width,o.height),n.closePath();else if(s.type===t.Graphics.CIRC)n.arc(o.x,o.y,o.radius,0,2*Math.PI),n.closePath();else if(s.type===t.Graphics.ELIP){var f=2*o.width,l=2*o.height,c=o.x-f/2,h=o.y-l/2,p=.5522848,d=f/2*p,v=l/2*p,m=c+f,g=h+l,y=c+f/2,w=h+l/2;n.moveTo(c,w),n.bezierCurveTo(c,w-v,y-d,h,y,h),n.bezierCurveTo(y+d,h,m,w-v,m,w),n.bezierCurveTo(m,w+v,y+d,g,y,g),n.bezierCurveTo(y-d,g,c,w+v,c,w),n.closePath()}else if(s.type===t.Graphics.RREC){var E=o.x,S=o.y,x=o.width,T=o.height,N=o.radius,C=Math.min(x,T)/2|0;N=N>C?C:N,n.moveTo(E,S+N),n.lineTo(E,S+T-N),n.quadraticCurveTo(E,S+T,E+N,S+T),n.lineTo(E+x-N,S+T),n.quadraticCurveTo(E+x,S+T,E+x,S+T-N),n.lineTo(E+x,S+N),n.quadraticCurveTo(E+x,S,E+x-N,S),n.lineTo(E+N,S),n.quadraticCurveTo(E,S,E,S+N),n.closePath()}}}},t.CanvasGraphics.updateGraphicsTint=function(e){if(16777215!==e.tint)for(var t=(e.tint>>16&255)/255,n=(e.tint>>8&255)/255,r=(255&e.tint)/255,i=0;i<e.graphicsData.length;i++){var s=e.graphicsData[i],o=0|s.fillColor,u=0|s.lineColor;s._fillTint=((o>>16&255)/255*t*255<<16)+((o>>8&255)/255*n*255<<8)+(255&o)/255*r*255,s._lineTint=((u>>16&255)/255*t*255<<16)+((u>>8&255)/255*n*255<<8)+(255&u)/255*r*255}},t.Graphics=function(){t.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor=0,this.graphicsData=[],this.tint=16777215,this.blendMode=t.blendModes.NORMAL,this.currentPath=null,this._webGL=[],this.isMask=!1,this.boundsPadding=0,this._localBounds=new t.Rectangle(0,0,1,1),this.dirty=!0,this.webGLDirty=!1,this.cachedSpriteDirty=!1},t.Graphics.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Graphics.prototype.constructor=t.Graphics,t.Graphics.prototype.lineStyle=function(e,n,r){return this.lineWidth=e||0,this.lineColor=n||0,this.lineAlpha=void 0===r?1:r,this.currentPath&&(this.currentPath.shape.points.length?this.drawShape(new t.Polygon(this.currentPath.shape.points.slice(-2))):(this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha)),this},t.Graphics.prototype.moveTo=function(e,n){return this.drawShape(new t.Polygon([e,n])),this},t.Graphics.prototype.lineTo=function(e,t){return this.currentPath||this.moveTo(0,0),this.currentPath.shape.points.push(e,t),this.dirty=!0,this},t.Graphics.prototype.quadraticCurveTo=function(e,t,n,r){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var i,s,o=20,u=this.currentPath.shape.points;0===u.length&&this.moveTo(0,0);for(var a=u[u.length-2],f=u[u.length-1],l=0,c=1;o>=c;++c)l=c/o,i=a+(e-a)*l,s=f+(t-f)*l,u.push(i+(e+(n-e)*l-i)*l,s+(t+(r-t)*l-s)*l);return this.dirty=!0,this},t.Graphics.prototype.bezierCurveTo=function(e,t,n,r,i,s){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var o,u,a,f,l,c=20,h=this.currentPath.shape.points,p=h[h.length-2],d=h[h.length-1],v=0,m=1;c>=m;++m)v=m/c,o=1-v,u=o*o,a=u*o,f=v*v,l=f*v,h.push(a*p+3*u*v*e+3*o*f*n+l*i,a*d+3*u*v*t+3*o*f*r+l*s);return this.dirty=!0,this},t.Graphics.prototype.arcTo=function(e,t,n,r,i){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(e,t):this.moveTo(e,t);var s=this.currentPath.shape.points,o=s[s.length-2],u=s[s.length-1],a=u-t,f=o-e,l=r-t,c=n-e,h=Math.abs(a*c-f*l);if(1e-8>h||0===i)(s[s.length-2]!==e||s[s.length-1]!==t)&&s.push(e,t);else{var p=a*a+f*f,d=l*l+c*c,v=a*l+f*c,m=i*Math.sqrt(p)/h,g=i*Math.sqrt(d)/h,y=m*v/p,b=g*v/d,w=m*c+g*f,E=m*l+g*a,S=f*(g+y),x=a*(g+y),T=c*(m+b),N=l*(m+b),C=Math.atan2(x-E,S-w),k=Math.atan2(N-E,T-w);this.arc(w+e,E+t,i,C,k,f*l>c*a)}return this.dirty=!0,this},t.Graphics.prototype.arc=function(e,t,n,r,i,s){if(r===i)return this;"undefined"==typeof s&&(s=!1),!s&&r>=i?i+=2*Math.PI:s&&i>=r&&(r+=2*Math.PI);var o=s?-1*(r-i):i-r,u=40*Math.ceil(Math.abs(o)/(2*Math.PI));if(0===o)return this;var a=e+Math.cos(r)*n,f=t+Math.sin(r)*n;s&&this.filling?this.moveTo(e,t):this.moveTo(a,f);for(var l=this.currentPath.shape.points,c=o/(2*u),h=2*c,p=Math.cos(c),d=Math.sin(c),v=u-1,m=v%1/v,g=0;v>=g;g++){var y=g+m*g,b=c+r+h*y,w=Math.cos(b),E=-Math.sin(b);l.push((p*w+d*E)*n+e,(p*-E+d*w)*n+t)}return this.dirty=!0,this},t.Graphics.prototype.beginFill=function(e,t){return this.filling=!0,this.fillColor=e||0,this.fillAlpha=void 0===t?1:t,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},t.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},t.Graphics.prototype.drawRect=function(e,n,r,i){return this.drawShape(new t.Rectangle(e,n,r,i)),this},t.Graphics.prototype.drawRoundedRect=function(e,n,r,i,s){return this.drawShape(new t.RoundedRectangle(e,n,r,i,s)),this},t.Graphics.prototype.drawCircle=function(e,n,r){return this.drawShape(new t.Circle(e,n,r)),this},t.Graphics.prototype.drawEllipse=function(e,n,r,i){return this.drawShape(new t.Ellipse(e,n,r,i)),this},t.Graphics.prototype.drawPolygon=function(e){var t=e;if(!Array.isArray(t)){t=new Array(arguments.length);for(var n=0;n<t.length;++n)t[n]=arguments[n]}return this.drawShape(new Phaser.Polygon(t)),this},t.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this},t.Graphics.prototype.generateTexture=function(e,n){e=e||1;var r=this.getBounds(),i=new t.CanvasBuffer(r.width*e,r.height*e),s=t.Texture.fromCanvas(i.canvas,n);return s.baseTexture.resolution=e,i.context.scale(e,e),i.context.translate(-r.x,-r.y),t.CanvasGraphics.renderGraphics(this,i.context),s},t.Graphics.prototype._renderWebGL=function(e){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.worldAlpha=this.worldAlpha,void t.Sprite.prototype._renderWebGL.call(this._cachedSprite,e);if(e.spriteBatch.stop(),e.blendModeManager.setBlendMode(this.blendMode),this._mask&&e.maskManager.pushMask(this._mask,e),this._filters&&e.filterManager.pushFilter(this._filterBlock),this.blendMode!==e.spriteBatch.currentBlendMode){e.spriteBatch.currentBlendMode=this.blendMode;var n=t.blendModesWebGL[e.spriteBatch.currentBlendMode];e.spriteBatch.gl.blendFunc(n[0],n[1])}if(this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),t.WebGLGraphics.renderGraphics(this,e),this.children.length){e.spriteBatch.start();for(var r=0;r<this.children.length;r++)this.children[r]._renderWebGL(e);e.spriteBatch.stop()}this._filters&&e.filterManager.popFilter(),this._mask&&e.maskManager.popMask(this.mask,e),e.drawCount++,e.spriteBatch.start()}},t.Graphics.prototype._renderCanvas=function(e){if(this.isMask!==!0){if(this._prevTint!==this.tint&&(this.dirty=!0,this._prevTint=this.tint),this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.alpha=this.alpha,void t.Sprite.prototype._renderCanvas.call(this._cachedSprite,e);var n=e.context,r=this.worldTransform;this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,n.globalCompositeOperation=t.blendModesCanvas[e.currentBlendMode]),this._mask&&e.maskManager.pushMask(this._mask,e);var i=e.resolution;n.setTransform(r.a*i,r.b*i,r.c*i,r.d*i,r.tx*i,r.ty*i),t.CanvasGraphics.renderGraphics(this,n);for(var s=0;s<this.children.length;s++)this.children[s]._renderCanvas(e);this._mask&&e.maskManager.popMask(e)}},t.Graphics.prototype.getBounds=function(e){if(!this._currentBounds){if(!this.renderable)return t.EmptyRectangle;this.dirty&&(this.updateLocalBounds(),this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var n=this._localBounds,r=n.x,i=n.width+n.x,s=n.y,o=n.height+n.y,u=e||this.worldTransform,a=u.a,f=u.b,l=u.c,c=u.d,h=u.tx,p=u.ty,d=a*i+l*o+h,v=c*o+f*i+p,m=a*r+l*o+h,g=c*o+f*r+p,y=a*r+l*s+h,w=c*s+f*r+p,E=a*i+l*s+h,S=c*s+f*i+p,x=d,T=v,N=d,C=v;N=N>m?m:N,N=N>y?y:N,N=N>E?E:N,C=C>g?g:C,C=C>w?w:C,C=C>S?S:C,x=m>x?m:x,x=y>x?y:x,x=E>x?E:x,T=g>T?g:T,T=w>T?w:T,T=S>T?S:T,this._bounds.x=N,this._bounds.width=x-N,this._bounds.y=C,this._bounds.height=T-C,this._currentBounds=this._bounds}return this._currentBounds},t.Graphics.prototype.containsPoint=function(e){this.worldTransform.applyInverse(e,tempPoint);for(var t=this.graphicsData,n=0;n<t.length;n++){var r=t[n];if(r.fill&&r.shape&&r.shape.contains(tempPoint.x,tempPoint.y))return!0}return!1},t.Graphics.prototype.updateLocalBounds=function(){var e=1/0,n=-1/0,r=1/0,i=-1/0;if(this.graphicsData.length)for(var s,o,u,a,f,l,c=0;c<this.graphicsData.length;c++){var h=this.graphicsData[c],p=h.type,d=h.lineWidth;if(s=h.shape,p===t.Graphics.RECT||p===t.Graphics.RREC)u=s.x-d/2,a=s.y-d/2,f=s.width+d,l=s.height+d,e=e>u?u:e,n=u+f>n?u+f:n,r=r>a?a:r,i=a+l>i?a+l:i;else if(p===t.Graphics.CIRC)u=s.x,a=s.y,f=s.radius+d/2,l=s.radius+d/2,e=e>u-f?u-f:e,n=u+f>n?u+f:n,r=r>a-l?a-l:r,i=a+l>i?a+l:i;else if(p===t.Graphics.ELIP)u=s.x,a=s.y,f=s.width+d/2,l=s.height+d/2,e=e>u-f?u-f:e,n=u+f>n?u+f:n,r=r>a-l?a-l:r,i=a+l>i?a+l:i;else{o=s.points;for(var v=0;v<o.length;v++)o[v]instanceof Phaser.Point?(u=o[v].x,a=o[v].y):(u=o[v],a=o[v+1],v<o.length-1&&v++),e=e>u-d?u-d:e,n=u+d>n?u+d:n,r=r>a-d?a-d:r,i=a+d>i?a+d:i}}else e=0,n=0,r=0,i=0;var m=this.boundsPadding;this._localBounds.x=e-m,this._localBounds.width=n-e+2*m,this._localBounds.y=r-m,this._localBounds.height=i-r+2*m},t.Graphics.prototype._generateCachedSprite=function(){var e=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(e.width,e.height);else{var n=new t.CanvasBuffer(e.width,e.height),r=t.Texture.fromCanvas(n.canvas);this._cachedSprite=new t.Sprite(r),this._cachedSprite.buffer=n,this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-(e.x/e.width),this._cachedSprite.anchor.y=-(e.y/e.height),this._cachedSprite.buffer.context.translate(-e.x,-e.y),this.worldAlpha=1,t.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context),this._cachedSprite.alpha=this.alpha},t.Graphics.prototype.updateCachedSpriteTexture=function(){var e=this._cachedSprite,t=e.texture,n=e.buffer.canvas;t.baseTexture.width=n.width,t.baseTexture.height=n.height,t.crop.width=t.frame.width=n.width,t.crop.height=t.frame.height=n.height,e._width=n.width,e._height=n.height,t.baseTexture.dirty()},t.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},t.Graphics.prototype.drawShape=function(e){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null,e instanceof t.Polygon&&e.flatten();var n=new t.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,e);return this.graphicsData.push(n),n.type===t.Graphics.POLY&&(n.shape.closed=this.filling,this.currentPath=n),this.dirty=!0,n},Object.defineProperty(t.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(e){this._cacheAsBitmap=e,this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}}),t.GraphicsData=function(e,t,n,r,i,s,o){this.lineWidth=e,this.lineColor=t,this.lineAlpha=n,this._lineTint=t,this.fillColor=r,this.fillAlpha=i,this._fillTint=r,this.fill=s,this.shape=o,this.type=o.type},t.GraphicsData.prototype.constructor=t.GraphicsData,t.GraphicsData.prototype.clone=function(){return new GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},t.Strip=function(e){t.DisplayObjectContainer.call(this),this.texture=e,this.uvs=new t.Float32Array([0,1,1,1,1,0,0,1]),this.vertices=new t.Float32Array([0,0,100,0,100,100,0,100]),this.colors=new t.Float32Array([1,1,1,1]),this.indices=new t.Uint16Array([0,1,2,3]),this.dirty=!0,this.blendMode=t.blendModes.NORMAL,this.canvasPadding=0,this.drawMode=t.Strip.DrawModes.TRIANGLE_STRIP},t.Strip.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Strip.prototype.constructor=t.Strip,t.Strip.prototype._renderWebGL=function(e){!this.visible||this.alpha<=0||(e.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(e),e.shaderManager.setShader(e.shaderManager.stripShader),this._renderStrip(e),e.spriteBatch.start())},t.Strip.prototype._initWebGL=function(e){var t=e.gl;this._vertexBuffer=t.createBuffer(),this._indexBuffer=t.createBuffer(),this._uvBuffer=t.createBuffer(),this._colorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this._uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvs,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this._colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colors,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW)},t.Strip.prototype._renderStrip=function(e){var n=e.gl,r=e.projection,i=e.offset,s=e.shaderManager.stripShader,o=this.drawMode===t.Strip.DrawModes.TRIANGLE_STRIP?n.TRIANGLE_STRIP:n.TRIANGLES;e.blendModeManager.setBlendMode(this.blendMode),n.uniformMatrix3fv(s.translationMatrix,!1,this.worldTransform.toArray(!0)),n.uniform2f(s.projectionVector,r.x,-r.y),n.uniform2f(s.offsetVector,-i.x,-i.y),n.uniform1f(s.alpha,this.worldAlpha),this.dirty?(this.dirty=!1,n.bindBuffer(n.ARRAY_BUFFER,this._vertexBuffer),n.bufferData(n.ARRAY_BUFFER,this.vertices,n.STATIC_DRAW),n.vertexAttribPointer(s.aVertexPosition,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this._uvBuffer),n.bufferData(n.ARRAY_BUFFER,this.uvs,n.STATIC_DRAW),n.vertexAttribPointer(s.aTextureCoord,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),this.texture.baseTexture._dirty[n.id]?e.renderer.updateTexture(this.texture.baseTexture):n.bindTexture(n.TEXTURE_2D,this.texture.baseTexture._glTextures[n.id]),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this._indexBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,this.indices,n.STATIC_DRAW)):(n.bindBuffer(n.ARRAY_BUFFER,this._vertexBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,this.vertices),n.vertexAttribPointer(s.aVertexPosition,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this._uvBuffer),n.vertexAttribPointer(s.aTextureCoord,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),this.texture.baseTexture._dirty[n.id]?e.renderer.updateTexture(this.texture.baseTexture):n.bindTexture(n.TEXTURE_2D,this.texture.baseTexture._glTextures[n.id]),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this._indexBuffer)),n.drawElements(o,this.indices.length,n.UNSIGNED_SHORT,0)},t.Strip.prototype._renderCanvas=function(e){var n=e.context,r=this.worldTransform;e.roundPixels?n.setTransform(r.a,r.b,r.c,r.d,0|r.tx,0|r.ty):n.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty),this.drawMode===t.Strip.DrawModes.TRIANGLE_STRIP?this._renderCanvasTriangleStrip(n):this._renderCanvasTriangles(n)},t.Strip.prototype._renderCanvasTriangleStrip=function(e){var t=this.vertices,n=this.uvs,r=t.length/2;this.count++;for(var i=0;r-2>i;i++){var s=2*i;this._renderCanvasDrawTriangle(e,t,n,s,s+2,s+4)}},t.Strip.prototype._renderCanvasTriangles=function(e){var t=this.vertices,n=this.uvs,r=this.indices,i=r.length;this.count++;for(var s=0;i>s;s+=3){var o=2*r[s],u=2*r[s+1],a=2*r[s+2];this._renderCanvasDrawTriangle(e,t,n,o,u,a)}},t.Strip.prototype._renderCanvasDrawTriangle=function(e,t,n,r,i,s){var o=this.texture.baseTexture.source,u=this.texture.width,a=this.texture.height,f=t[r],l=t[i],c=t[s],h=t[r+1],p=t[i+1],d=t[s+1],v=n[r]*u,m=n[i]*u,g=n[s]*u,y=n[r+1]*a,b=n[i+1]*a,w=n[s+1]*a;if(this.canvasPadding>0){var E=this.canvasPadding/this.worldTransform.a,S=this.canvasPadding/this.worldTransform.d,x=(f+l+c)/3,T=(h+p+d)/3,N=f-x,C=h-T,k=Math.sqrt(N*N+C*C);f=x+N/k*(k+E),h=T+C/k*(k+S),N=l-x,C=p-T,k=Math.sqrt(N*N+C*C),l=x+N/k*(k+E),p=T+C/k*(k+S),N=c-x,C=d-T,k=Math.sqrt(N*N+C*C),c=x+N/k*(k+E),d=T+C/k*(k+S)}e.save(),e.beginPath(),e.moveTo(f,h),e.lineTo(l,p),e.lineTo(c,d),e.closePath(),e.clip();var L=v*b+y*g+m*w-b*g-y*m-v*w,A=f*b+y*c+l*w-b*c-y*l-f*w,O=v*l+f*g+m*c-l*g-f*m-v*c,M=v*b*c+y*l*g+f*m*w-f*b*g-y*m*c-v*l*w,_=h*b+y*d+p*w-b*d-y*p-h*w,D=v*p+h*g+m*d-p*g-h*m-v*d,P=v*b*d+y*p*g+h*m*w-h*b*g-y*m*d-v*p*w;e.transform(A/L,_/L,O/L,D/L,M/L,P/L),e.drawImage(o,0,0),e.restore()},t.Strip.prototype.renderStripFlat=function(e){var t=this.context,n=e.vertices,r=n.length/2;this.count++,t.beginPath();for(var i=1;r-2>i;i++){var s=2*i,o=n[s],u=n[s+2],a=n[s+4],f=n[s+1],l=n[s+3],c=n[s+5];t.moveTo(o,f),t.lineTo(u,l),t.lineTo(a,c)}t.fillStyle="#FF0000",t.fill(),t.closePath()},t.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},t.Strip.prototype.getBounds=function(e){for(var n=e||this.worldTransform,r=n.a,i=n.b,s=n.c,o=n.d,u=n.tx,a=n.ty,f=-1/0,l=-1/0,c=1/0,h=1/0,p=this.vertices,d=0,v=p.length;v>d;d+=2){var m=p[d],g=p[d+1],y=r*m+s*g+u,w=o*g+i*m+a;c=c>y?y:c,h=h>w?w:h,f=y>f?y:f,l=w>l?w:l}if(c===-1/0||1/0===l)return t.EmptyRectangle;var E=this._bounds;return E.x=c,E.width=f-c,E.y=h,E.height=l-h,this._currentBounds=E,E},t.Strip.DrawModes={TRIANGLE_STRIP:0,TRIANGLES:1},t.Rope=function(e,n){t.Strip.call(this,e),this.points=n,this.vertices=new t.Float32Array(4*n.length),this.uvs=new t.Float32Array(4*n.length),this.colors=new t.Float32Array(2*n.length),this.indices=new t.Uint16Array(2*n.length),this.refresh()},t.Rope.prototype=Object.create(t.Strip.prototype),t.Rope.prototype.constructor=t.Rope,t.Rope.prototype.refresh=function(){var e=this.points;if(!(e.length<1)){var t=this.uvs,n=e[0],r=this.indices,i=this.colors;this.count-=.2,t[0]=0,t[1]=0,t[2]=0,t[3]=1,i[0]=1,i[1]=1,r[0]=0,r[1]=1;for(var s,o,u,a=e.length,f=1;a>f;f++)s=e[f],o=4*f,u=f/(a-1),f%2?(t[o]=u,t[o+1]=0,t[o+2]=u,t[o+3]=1):(t[o]=u,t[o+1]=0,t[o+2]=u,t[o+3]=1),o=2*f,i[o]=1,i[o+1]=1,o=2*f,r[o]=o,r[o+1]=o+1,n=s}},t.Rope.prototype.updateTransform=function(){var e=this.points;if(!(e.length<1)){var n,r=e[0],i={x:0,y:0};this.count-=.2;for(var s,o,u,a,f,l=this.vertices,c=e.length,h=0;c>h;h++)s=e[h],o=4*h,n=h<e.length-1?e[h+1]:s,i.y=-(n.x-r.x),i.x=n.y-r.y,u=10*(1-h/(c-1)),u>1&&(u=1),a=Math.sqrt(i.x*i.x+i.y*i.y),f=this.texture.height/2,i.x/=a,i.y/=a,i.x*=f,i.y*=f,l[o]=s.x+i.x,l[o+1]=s.y+i.y,l[o+2]=s.x-i.x,l[o+3]=s.y-i.y,r=s;t.DisplayObjectContainer.prototype.updateTransform.call(this)}},t.Rope.prototype.setTexture=function(e){this.texture=e},t.TilingSprite=function(e,n,r){t.Sprite.call(this,e),this._width=n||100,this._height=r||100,this.tileScale=new t.Point(1,1),this.tileScaleOffset=new t.Point(1,1),this.tilePosition=new t.Point(0,0),this.renderable=!0,this.tint=16777215,this.blendMode=t.blendModes.NORMAL},t.TilingSprite.prototype=Object.create(t.Sprite.prototype),t.TilingSprite.prototype.constructor=t.TilingSprite,Object.defineProperty(t.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e}}),Object.defineProperty(t.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e}}),t.TilingSprite.prototype.setTexture=function(e){this.texture!==e&&(this.texture=e,this.refreshTexture=!0,this.cachedTint=16777215)},t.TilingSprite.prototype._renderWebGL=function(e){if(this.visible!==!1&&0!==this.alpha){var t,n;for(this._mask&&(e.spriteBatch.stop(),e.maskManager.pushMask(this.mask,e),e.spriteBatch.start()),this._filters&&(e.spriteBatch.flush(),e.filterManager.pushFilter(this._filterBlock)),!this.tilingTexture||this.refreshTexture?(this.generateTilingTexture(!0),this.tilingTexture&&this.tilingTexture.needsUpdate&&(e.renderer.updateTexture(this.tilingTexture.baseTexture),this.tilingTexture.needsUpdate=!1)):e.spriteBatch.renderTilingSprite(this),t=0,n=this.children.length;n>t;t++)this.children[t]._renderWebGL(e);e.spriteBatch.stop(),this._filters&&e.filterManager.popFilter(),this._mask&&e.maskManager.popMask(this._mask,e),e.spriteBatch.start()}},t.TilingSprite.prototype._renderCanvas=function(e){if(this.visible!==!1&&0!==this.alpha){var n=e.context;this._mask&&e.maskManager.pushMask(this._mask,e),n.globalAlpha=this.worldAlpha;var r,i,s=this.worldTransform,o=e.resolution;if(n.setTransform(s.a*o,s.b*o,s.c*o,s.d*o,s.tx*o,s.ty*o),!this.__tilePattern||this.refreshTexture){if(this.generateTilingTexture(!1),!this.tilingTexture)return;this.__tilePattern=n.createPattern(this.tilingTexture.baseTexture.source,"repeat")}this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,n.globalCompositeOperation=t.blendModesCanvas[e.currentBlendMode]);var u=this.tilePosition,a=this.tileScale;for(u.x%=this.tilingTexture.baseTexture.width,u.y%=this.tilingTexture.baseTexture.height,n.scale(a.x,a.y),n.translate(u.x+this.anchor.x*-this._width,u.y+this.anchor.y*-this._height),n.fillStyle=this.__tilePattern,n.fillRect(-u.x,-u.y,this._width/a.x,this._height/a.y),n.scale(1/a.x,1/a.y),n.translate(-u.x+this.anchor.x*this._width,-u.y+this.anchor.y*this._height),this._mask&&e.maskManager.popMask(e),r=0,i=this.children.length;i>r;r++)this.children[r]._renderCanvas(e)}},t.TilingSprite.prototype.getBounds=function(){var e=this._width,t=this._height,n=e*(1-this.anchor.x),r=e*-this.anchor.x,i=t*(1-this.anchor.y),s=t*-this.anchor.y,o=this.worldTransform,u=o.a,a=o.b,f=o.c,l=o.d,c=o.tx,h=o.ty,p=u*r+f*s+c,d=l*s+a*r+h,v=u*n+f*s+c,m=l*s+a*n+h,g=u*n+f*i+c,y=l*i+a*n+h,b=u*r+f*i+c,w=l*i+a*r+h,E=-1/0,S=-1/0,x=1/0,T=1/0;x=x>p?p:x,x=x>v?v:x,x=x>g?g:x,x=x>b?b:x,T=T>d?d:T,T=T>m?m:T,T=T>y?y:T,T=T>w?w:T,E=p>E?p:E,E=v>E?v:E,E=g>E?g:E,E=b>E?b:E,S=d>S?d:S,S=m>S?m:S,S=y>S?y:S,S=w>S?w:S;var N=this._bounds;return N.x=x,N.width=E-x,N.y=T,N.height=S-T,this._currentBounds=N,N},t.TilingSprite.prototype.onTextureUpdate=function(){},t.TilingSprite.prototype.generateTilingTexture=function(e){if(this.texture.baseTexture.hasLoaded){var n,r,i=this.originalTexture||this.texture,s=i.frame,o=s.width!==i.baseTexture.width||s.height!==i.baseTexture.height,u=!1;if(e?(i.crop?(n=t.getNextPowerOfTwo(i.crop.width),r=t.getNextPowerOfTwo(i.crop.height)):(n=t.getNextPowerOfTwo(s.width),r=t.getNextPowerOfTwo(s.height)),u=!0):o&&(i.crop?(n=i.crop.width,r=i.crop.height):(n=s.width,r=s.height),u=!0),u){var a;this.tilingTexture&&this.tilingTexture.isTiling?(a=this.tilingTexture.canvasBuffer,a.resize(n,r),this.tilingTexture.baseTexture.width=n,this.tilingTexture.baseTexture.height=r,this.tilingTexture.needsUpdate=!0):(a=new t.CanvasBuffer(n,r),this.tilingTexture=t.Texture.fromCanvas(a.canvas),this.tilingTexture.canvasBuffer=a,this.tilingTexture.isTiling=!0),a.context.drawImage(i.baseTexture.source,i.crop.x,i.crop.y,i.crop.width,i.crop.height,0,0,n,r),this.tileScaleOffset.x=s.width/n,this.tileScaleOffset.y=s.height/r}else this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0),this.tileScaleOffset.x=1,this.tileScaleOffset.y=1,this.tilingTexture=i;this.refreshTexture=!1,this.originalTexture=this.texture,this.texture=this.tilingTexture,this.tilingTexture.baseTexture._powerOf2=!0}},t.TilingSprite.prototype.destroy=function(){t.Sprite.prototype.destroy.call(this),this.tileScale=null,this.tileScaleOffset=null,this.tilePosition=null,this.tilingTexture&&(this.tilingTexture.destroy(!0),this.tilingTexture=null)},t.BaseTextureCache={},t.BaseTextureCacheIdGenerator=0,t.BaseTexture=function(e,n){this.resolution=1,this.width=100,this.height=100,this.scaleMode=n||t.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=e,this._UID=t._UID++,this.premultipliedAlpha=!0,this._glTextures=[],this.mipmap=!1,this._dirty=[!0,!0,!0,!0],e&&((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height&&(this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty()),this.imageUrl=null,this._powerOf2=!1)},t.BaseTexture.prototype.constructor=t.BaseTexture,t.BaseTexture.prototype.destroy=function(){this.imageUrl?(delete t.BaseTextureCache[this.imageUrl],delete t.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src="")):this.source&&this.source._pixiId&&delete t.BaseTextureCache[this.source._pixiId],this.source=null,this.unloadFromGPU()},t.BaseTexture.prototype.updateSourceImage=function(e){this.hasLoaded=!1,this.source.src=null,this.source.src=e},t.BaseTexture.prototype.dirty=function(){for(var e=0;e<this._glTextures.length;e++)this._dirty[e]=!0},t.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var e=this._glTextures.length-1;e>=0;e--){var n=this._glTextures[e],r=t.glContexts[e];r&&n&&r.deleteTexture(n)}this._glTextures.length=0,this.dirty()},t.BaseTexture.fromImage=function(e,n,r){var i=t.BaseTextureCache[e];if(void 0===n&&-1===e.indexOf("data:")&&(n=!0),!i){var s=new Image;n&&(s.crossOrigin=""),s.src=e,i=new t.BaseTexture(s,r),i.imageUrl=e,t.BaseTextureCache[e]=i,-1!==e.indexOf(t.RETINA_PREFIX+".")&&(i.resolution=2)}return i},t.BaseTexture.fromCanvas=function(e,n){e._pixiId||(e._pixiId="canvas_"+t.TextureCacheIdGenerator++);var r=t.BaseTextureCache[e._pixiId];return r||(r=new t.BaseTexture(e,n),t.BaseTextureCache[e._pixiId]=r),r},t.TextureCache={},t.FrameCache={},t.TextureSilentFail=!1,t.TextureCacheIdGenerator=0,t.Texture=function(e,n,r,i){this.noFrame=!1,n||(this.noFrame=!0,n=new t.Rectangle(0,0,1,1)),e instanceof t.Texture&&(e=e.baseTexture),this.baseTexture=e,this.frame=n,this.trim=i,this.valid=!1,this.requiresUpdate=!1,this._uvs=null,this.width=0,this.height=0,this.crop=r||new t.Rectangle(0,0,1,1),e.hasLoaded&&(this.noFrame&&(n=new t.Rectangle(0,0,e.width,e.height)),this.setFrame(n))},t.Texture.prototype.constructor=t.Texture,t.Texture.prototype.onBaseTextureLoaded=function(){var e=this.baseTexture;this.noFrame&&(this.frame=new t.Rectangle(0,0,e.width,e.height)),this.setFrame(this.frame)},t.Texture.prototype.destroy=function(e){e&&this.baseTexture.destroy(),this.valid=!1},t.Texture.prototype.setFrame=function(e){if(this.noFrame=!1,this.frame=e,this.width=e.width,this.height=e.height,this.crop.x=e.x,this.crop.y=e.y,this.crop.width=e.width,this.crop.height=e.height,!this.trim&&(e.x+e.width>this.baseTexture.width||e.y+e.height>this.baseTexture.height)){if(!t.TextureSilentFail)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);return void (this.valid=!1)}this.valid=e&&e.width&&e.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&this._updateUvs()},t.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new t.TextureUvs);var e=this.crop,n=this.baseTexture.width,r=this.baseTexture.height;this._uvs.x0=e.x/n,this._uvs.y0=e.y/r,this._uvs.x1=(e.x+e.width)/n,this._uvs.y1=e.y/r,this._uvs.x2=(e.x+e.width)/n,this._uvs.y2=(e.y+e.height)/r,this._uvs.x3=e.x/n,this._uvs.y3=(e.y+e.height)/r},t.Texture.fromImage=function(e,n,r){var i=t.TextureCache[e];return i||(i=new t.Texture(t.BaseTexture.fromImage(e,n,r)),t.TextureCache[e]=i),i},t.Texture.fromFrame=function(e){var n=t.TextureCache[e];if(!n)throw new Error('The frameId "'+e+'" does not exist in the texture cache ');return n},t.Texture.fromCanvas=function(e,n){var r=t.BaseTexture.fromCanvas(e,n);return new t.Texture(r)},t.Texture.addTextureToCache=function(e,n){t.TextureCache[n]=e},t.Texture.removeTextureFromCache=function(e){var n=t.TextureCache[e];return delete t.TextureCache[e],delete t.BaseTextureCache[e],n},t.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0},t.RenderTexture=function(e,n,r,i,s){if(this.width=e||100,this.height=n||100,this.resolution=s||1,this.frame=new t.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.crop=new t.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.baseTexture=new t.BaseTexture,this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution,this.baseTexture._glTextures=[],this.baseTexture.resolution=this.resolution,this.baseTexture.scaleMode=i||t.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,t.Texture.call(this,this.baseTexture,new t.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution)),this.renderer=r||t.defaultRenderer,this.renderer.type===t.WEBGL_RENDERER){var o=this.renderer.gl;this.baseTexture._dirty[o.id]=!1,this.textureBuffer=new t.FilterTexture(o,this.width,this.height,this.baseTexture.scaleMode),this.baseTexture._glTextures[o.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new t.Point(.5*this.width,.5*-this.height)}else this.render=this.renderCanvas,this.textureBuffer=new t.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,this._updateUvs()},t.RenderTexture.prototype=Object.create(t.Texture.prototype),t.RenderTexture.prototype.constructor=t.RenderTexture,t.RenderTexture.prototype.resize=function(e,n,r){(e!==this.width||n!==this.height)&&(this.valid=e>0&&n>0,this.width=e,this.height=n,this.frame.width=this.crop.width=e*this.resolution,this.frame.height=this.crop.height=n*this.resolution,r&&(this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution),this.renderer.type===t.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(this.width,this.height))},t.RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===t.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())},t.RenderTexture.prototype.renderWebGL=function(e,t,n){if(this.valid){var r=e.worldTransform;r.identity(),r.translate(0,2*this.projection.y),t&&r.append(t),r.scale(1,-1),e.worldAlpha=1;for(var i=e.children,s=0,o=i.length;o>s;s++)i[s].updateTransform();var u=this.renderer.gl;u.viewport(0,0,this.width*this.resolution,this.height*this.resolution),u.bindFramebuffer(u.FRAMEBUFFER,this.textureBuffer.frameBuffer),n&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(e,this.projection,this.textureBuffer.frameBuffer),this.renderer.spriteBatch.dirty=!0}},t.RenderTexture.prototype.renderCanvas=function(e,t,n){if(this.valid){var r=e.worldTransform;r.identity(),t&&r.append(t),e.worldAlpha=1;for(var i=e.children,s=0,o=i.length;o>s;s++)i[s].updateTransform();n&&this.textureBuffer.clear();var u=this.textureBuffer.context,a=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(e,u),this.renderer.resolution=a}},t.RenderTexture.prototype.getImage=function(){var e=new Image;return e.src=this.getBase64(),e},t.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()},t.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===t.WEBGL_RENDERER){var e=this.renderer.gl,n=this.textureBuffer.width,r=this.textureBuffer.height,i=new Uint8Array(4*n*r);e.bindFramebuffer(e.FRAMEBUFFER,this.textureBuffer.frameBuffer),e.readPixels(0,0,n,r,e.RGBA,e.UNSIGNED_BYTE,i),e.bindFramebuffer(e.FRAMEBUFFER,null);var s=new t.CanvasBuffer(n,r),o=s.context.getImageData(0,0,n,r);return o.data.set(i),s.context.putImageData(o,0,0),s.canvas}return this.textureBuffer.canvas},t.AbstractFilter=function(e,t){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=t||{},this.fragmentSrc=e||[]},t.AbstractFilter.prototype.constructor=t.AbstractFilter,t.AbstractFilter.prototype.syncUniforms=function(){for(var e=0,t=this.shaders.length;t>e;e++)this.shaders[e].dirty=!0},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.PIXI=t):"undefined"!=typeof define&&define.amd?define("PIXI",function(){return e.PIXI=t}()):e.PIXI=t}).call(this),function(){function e(e,t){this._scaleFactor=e,this._deltaMode=t,this.originalEvent=null}var t=this,n=n||{VERSION:"2.3.0",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,ROPE:20,CIRCLE:21,RECTANGLE:22,LINE:23,MATRIX:24,POINT:25,ROUNDEDRECTANGLE:26,blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1}};if(Math.trunc||(Math.trunc=function(e){return 0>e?Math.ceil(e):Math.floor(e)}),Function.prototype.bind||(Function.prototype.bind=function(){var e=Array.prototype.slice;return function(t){function n(){var s=i.concat(e.call(arguments));r.apply(this instanceof n?this:t,s)}var r=this,i=e.call(arguments,1);if("function"!=typeof r)throw new TypeError;return n.prototype=function s(e){return e&&(s.prototype=e),this instanceof s?void 0:new s}(r.prototype),n}}()),Array.isArray||(Array.isArray=function(e){return"[object Array]"==Object.prototype.toString.call(e)}),Array.prototype.forEach||(Array.prototype.forEach=function(e){"use strict";if(void 0===this||null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=arguments.length>=2?arguments[1]:void 0,i=0;n>i;i++)i in t&&e.call(r,t[i],i,t)}),"function"!=typeof window.Uint32Array&&"object"!=typeof window.Uint32Array){var r=function(e){var t=new Array;window[e]=function(e){if("number"==typeof e){Array.call(this,e),this.length=e;for(var t=0;t<this.length;t++)this[t]=0}else{Array.call(this,e.length),this.length=e.length;for(var t=0;t<this.length;t++)this[t]=e[t]}},window[e].prototype=t,window[e].constructor=window[e]};r("Uint32Array"),r("Int16Array")}window.console||(window.console={},window.console.log=window.console.assert=function(){},window.console.warn=window.console.assert=function(){}),n.Utils={getProperty:function(e,t){for(var n=t.split("."),r=n.pop(),i=n.length,s=1,o=n[0];i>s&&(e=e[o]);)o=n[s],s++;return e?e[r]:null},setProperty:function(e,t,n){for(var r=t.split("."),i=r.pop(),s=r.length,o=1,u=r[0];s>o&&(e=e[u]);)u=r[o],o++;return e&&(e[i]=n),e},chanceRoll:function(e){return"undefined"==typeof e&&(e=50),e>0&&100*Math.random()<=e},randomChoice:function(e,t){return Math.random()<.5?e:t},transposeArray:function(e){return n.ArrayUtils.transposeMatrix(e)},rotateArray:function(e,t){return n.ArrayUtils.rotateMatrix(e,t)},shuffle:function(e){return n.ArrayUtils.shuffle(e)},parseDimension:function(e,t){var n=0,r=0;return"string"==typeof e?"%"===e.substr(-1)?(n=parseInt(e,10)/100,r=0===t?window.innerWidth*n:window.innerHeight*n):r=parseInt(e,10):r=e,r},pad:function(e,t,n,r){if("undefined"==typeof t)var t=0;if("undefined"==typeof n)var n=" ";if("undefined"==typeof r)var r=3;var i=0;if(t+1>=e.length)switch(r){case 1:e=(new Array(t+1-e.length)).join(n)+e;break;case 3:var s=Math.ceil((i=t-e.length)/2),o=i-s;e=(new Array(o+1)).join(n)+e+(new Array(s+1)).join(n);break;default:e+=(new Array(t+1-e.length)).join(n)}return e},isPlainObject:function(e){if("object"!=typeof e||e.nodeType||e===e.window)return!1;try{if(e.constructor&&!{}.hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},extend:function(){var e,t,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;for("boolean"==typeof u&&(l=u,u=arguments[1]||{},a=2),f===a&&(u=this,--a);f>a;a++)if(null!=(e=arguments[a]))for(t in e)r=u[t],i=e[t],u!==i&&(l&&i&&(n.Utils.isPlainObject(i)||(s=Array.isArray(i)))?(s?(s=!1,o=r&&Array.isArray(r)?r:[]):o=r&&n.Utils.isPlainObject(r)?r:{},u[t]=n.Utils.extend(l,o,i)):void 0!==i&&(u[t]=i));return u},mixinPrototype:function(e,t,n){"undefined"==typeof n&&(n=!1);for(var r=Object.keys(t),i=0;i<r.length;i++){var s=r[i],o=t[s];!n&&s in e||(!o||"function"!=typeof o.get&&"function"!=typeof o.set?e[s]=o:"function"==typeof o.clone?e[s]=o.clone():Object.defineProperty(e,s,o))}},mixin:function(e,t){if(!e||"object"!=typeof e)return t;for(var r in e){var i=e[r];if(!i.childNodes&&!i.cloneNode){var s=typeof e[r];t[r]=e[r]&&"object"===s?typeof t[r]===s?n.Utils.mixin(e[r],t[r]):n.Utils.mixin(e[r],new i.constructor):e[r]}}return t}},n.Circle=function(e,t,r){e=e||0,t=t||0,r=r||0,this.x=e,this.y=t,this._diameter=r,this._radius=0,r>0&&(this._radius=.5*r),this.type=n.CIRCLE},n.Circle.prototype={circumference:function(){return 2*Math.PI*this._radius},getBounds:function(){return new n.Rectangle(this.x-this.radius,this.y-this.radius,this.diameter,this.diameter)},setTo:function(e,t,n){return this.x=e,this.y=t,this._diameter=n,this._radius=.5*n,this},copyFrom:function(e){return this.setTo(e.x,e.y,e.diameter)},copyTo:function(e){return e.x=this.x,e.y=this.y,e.diameter=this._diameter,e},distance:function(e,t){var r=n.Math.distance(this.x,this.y,e.x,e.y);return t?Math.round(r):r},clone:function(e){return"undefined"==typeof e||null===e?e=new n.Circle(this.x,this.y,this.diameter):e.setTo(this.x,this.y,this.diameter),e},contains:function(e,t){return n.Circle.contains(this,e,t)},circumferencePoint:function(e,t,r){return n.Circle.circumferencePoint(this,e,t,r)},offset:function(e,t){return this.x+=e,this.y+=t,this},offsetPoint:function(e){return this.offset(e.x,e.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}},n.Circle.prototype.constructor=n.Circle,Object.defineProperty(n.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(e){e>0&&(this._diameter=e,this._radius=.5*e)}}),Object.defineProperty(n.Circle.prototype,"radius",{get:function(){return this._radius},set:function(e){e>0&&(this._radius=e,this._diameter=2*e)}}),Object.defineProperty(n.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(e){e>this.x?(this._radius=0,this._diameter=0):this.radius=this.x-e}}),Object.defineProperty(n.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(e){e<this.x?(this._radius=0,this._diameter=0):this.radius=e-this.x}}),Object.defineProperty(n.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(e){e>this.y?(this._radius=0,this._diameter=0):this.radius=this.y-e}}),Object.defineProperty(n.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(e){e<this.y?(this._radius=0,this._diameter=0):this.radius=e-this.y}}),Object.defineProperty(n.Circle.prototype,"area",{get:function(){return this._radius>0?Math.PI*this._radius*this._radius:0}}),Object.defineProperty(n.Circle.prototype,"empty",{get:function(){return 0===this._diameter},set:function(e){e===!0&&this.setTo(0,0,0)}}),n.Circle.contains=function(e,t,n){if(e.radius>0&&t>=e.left&&t<=e.right&&n>=e.top&&n<=e.bottom){var r=(e.x-t)*(e.x-t),i=(e.y-n)*(e.y-n);return r+i<=e.radius*e.radius}return!1},n.Circle.equals=function(e,t){return e.x==t.x&&e.y==t.y&&e.diameter==t.diameter},n.Circle.intersects=function(e,t){return n.Math.distance(e.x,e.y,t.x,t.y)<=e.radius+t.radius},n.Circle.circumferencePoint=function(e,t,r,i){return"undefined"==typeof r&&(r=!1),"undefined"==typeof i&&(i=new n.Point),r===!0&&(t=n.Math.degToRad(t)),i.x=e.x+e.radius*Math.cos(t),i.y=e.y+e.radius*Math.sin(t),i},n.Circle.intersectsRectangle=function(e,t){var n=Math.abs(e.x-t.x-t.halfWidth),r=t.halfWidth+e.radius;if(n>r)return!1;var i=Math.abs(e.y-t.y-t.halfHeight),s=t.halfHeight+e.radius;if(i>s)return!1;if(n<=t.halfWidth||i<=t.halfHeight)return!0;var o=n-t.halfWidth,u=i-t.halfHeight,a=o*o,f=u*u,l=e.radius*e.radius;return l>=a+f},PIXI.Circle=n.Circle,n.Ellipse=function(e,t,r,i){e=e||0,t=t||0,r=r||0,i=i||0,this.x=e,this.y=t,this.width=r,this.height=i,this.type=n.ELLIPSE},n.Ellipse.prototype={setTo:function(e,t,n,r){return this.x=e,this.y=t,this.width=n,this.height=r,this},getBounds:function(){return new n.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},copyFrom:function(e){return this.setTo(e.x,e.y,e.width,e.height)},copyTo:function(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e},clone:function(e){return"undefined"==typeof e||null===e?e=new n.Ellipse(this.x,this.y,this.width,this.height):e.setTo(this.x,this.y,this.width,this.height),e},contains:function(e,t){return n.Ellipse.contains(this,e,t)},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}},n.Ellipse.prototype.constructor=n.Ellipse,Object.defineProperty(n.Ellipse.prototype,"left",{get:function(){return this.x},set:function(e){this.x=e}}),Object.defineProperty(n.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(e){this.width=e<this.x?0:e-this.x}}),Object.defineProperty(n.Ellipse.prototype,"top",{get:function(){return this.y},set:function(e){this.y=e}}),Object.defineProperty(n.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(e){this.height=e<this.y?0:e-this.y}}),Object.defineProperty(n.Ellipse.prototype,"empty",{get:function(){return 0===this.width||0===this.height},set:function(e){e===!0&&this.setTo(0,0,0,0)}}),n.Ellipse.contains=function(e,t,n){if(e.width<=0||e.height<=0)return!1;var r=(t-e.x)/e.width-.5,i=(n-e.y)/e.height-.5;return r*=r,i*=i,.25>r+i},PIXI.Ellipse=n.Ellipse,n.Line=function(e,t,r,i){e=e||0,t=t||0,r=r||0,i=i||0,this.start=new n.Point(e,t),this.end=new n.Point(r,i),this.type=n.LINE},n.Line.prototype={setTo:function(e,t,n,r){return this.start.setTo(e,t),this.end.setTo(n,r),this},fromSprite:function(e,t,n){return"undefined"==typeof n&&(n=!1),n?this.setTo(e.center.x,e.center.y,t.center.x,t.center.y):this.setTo(e.x,e.y,t.x,t.y)},fromAngle:function(e,t,n,r){return this.start.setTo(e,t),this.end.setTo(e+Math.cos(n)*r,t+Math.sin(n)*r),this},intersects:function(e,t,r){return n.Line.intersectsPoints(this.start,this.end,e.start,e.end,t,r)},reflect:function(e){return n.Line.reflect(this,e)},pointOnLine:function(e,t){return(e-this.start.x)*(this.end.y-this.start.y)===(this.end.x-this.start.x)*(t-this.start.y)},pointOnSegment:function(e,t){var n=Math.min(this.start.x,this.end.x),r=Math.max(this.start.x,this.end.x),i=Math.min(this.start.y,this.end.y),s=Math.max(this.start.y,this.end.y);return this.pointOnLine(e,t)&&e>=n&&r>=e&&t>=i&&s>=t},coordinatesOnLine:function(e,t){"undefined"==typeof e&&(e=1),"undefined"==typeof t&&(t=[]);var n=Math.round(this.start.x),r=Math.round(this.start.y),i=Math.round(this.end.x),s=Math.round(this.end.y),o=Math.abs(i-n),u=Math.abs(s-r),a=i>n?1:-1,f=s>r?1:-1,l=o-u;t.push([n,r]);for(var c=1;n!=i||r!=s;){var h=l<<1;h>-u&&(l-=u,n+=a),o>h&&(l+=o,r+=f),c%e===0&&t.push([n,r]),c++}return t},clone:function(e){return"undefined"==typeof e||null===e?e=new n.Line(this.start.x,this.start.y,this.end.x,this.end.y):e.setTo(this.start.x,this.start.y,this.end.x,this.end.y),e}},Object.defineProperty(n.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}}),Object.defineProperty(n.Line.prototype,"angle",{get:function(){return Math.atan2(this.end.y-this.start.y,this.end.x-this.start.x)}}),Object.defineProperty(n.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}}),Object.defineProperty(n.Line.prototype,"perpSlope",{get:function(){return-((this.end.x-this.start.x)/(this.end.y-this.start.y))}}),Object.defineProperty(n.Line.prototype,"x",{get:function(){return Math.min(this.start.x,this.end.x)}}),Object.defineProperty(n.Line.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)}}),Object.defineProperty(n.Line.prototype,"left",{get:function(){return Math.min(this.start.x,this.end.x)}}),Object.defineProperty(n.Line.prototype,"right",{get:function(){return Math.max(this.start.x,this.end.x)}}),Object.defineProperty(n.Line.prototype,"top",{get:function(){return Math.min(this.start.y,this.end.y)}}),Object.defineProperty(n.Line.prototype,"bottom",{get:function(){return Math.max(this.start.y,this.end.y)}}),Object.defineProperty(n.Line.prototype,"width",{get:function(){return Math.abs(this.start.x-this.end.x)}}),Object.defineProperty(n.Line.prototype,"height",{get:function(){return Math.abs(this.start.y-this.end.y)}}),Object.defineProperty(n.Line.prototype,"normalX",{get:function(){return Math.cos(this.angle-1.5707963267948966)}}),Object.defineProperty(n.Line.prototype,"normalY",{get:function(){return Math.sin(this.angle-1.5707963267948966)}}),Object.defineProperty(n.Line.prototype,"normalAngle",{get:function(){return n.Math.wrap(this.angle-1.5707963267948966,-Math.PI,Math.PI)}}),n.Line.intersectsPoints=function(e,t,r,i,s,o){"undefined"==typeof s&&(s=!0),"undefined"==typeof o&&(o=new n.Point);var u=t.y-e.y,a=i.y-r.y,f=e.x-t.x,l=r.x-i.x,c=t.x*e.y-e.x*t.y,h=i.x*r.y-r.x*i.y,p=u*l-a*f;if(0===p)return null;if(o.x=(f*h-l*c)/p,o.y=(a*c-u*h)/p,s){var d=(i.y-r.y)*(t.x-e.x)-(i.x-r.x)*(t.y-e.y),v=((i.x-r.x)*(e.y-r.y)-(i.y-r.y)*(e.x-r.x))/d,m=((t.x-e.x)*(e.y-r.y)-(t.y-e.y)*(e.x-r.x))/d;return v>=0&&1>=v&&m>=0&&1>=m?o:null}return o},n.Line.intersects=function(e,t,r,i){return n.Line.intersectsPoints(e.start,e.end,t.start,t.end,r,i)},n.Line.reflect=function(e,t){return 2*t.normalAngle-3.141592653589793-e.angle},n.Matrix=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this.type=n.MATRIX},n.Matrix.prototype.fromArray=function(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]},n.Matrix.prototype.toArray=function(e){this.array||(this.array=new PIXI.Float32Array(9));var t=this.array;return e?(t[0]=this.a,t[1]=this.b,t[2]=0,t[3]=this.c,t[4]=this.d,t[5]=0,t[6]=this.tx,t[7]=this.ty,t[8]=1):(t[0]=this.a,t[1]=this.c,t[2]=this.tx,t[3]=this.b,t[4]=this.d,t[5]=this.ty,t[6]=0,t[7]=0,t[8]=1),t},n.Matrix.prototype.apply=function(e,t){t=t||new n.Point;var r=e.x,i=e.y;return t.x=this.a*r+this.c*i+this.tx,t.y=this.b*r+this.d*i+this.ty,t},n.Matrix.prototype.applyInverse=function(e,t){t=t||new n.Point;var r=1/(this.a*this.d+this.c*-this.b),i=e.x,s=e.y;return t.x=this.d*r*i+ -this.c*r*s+(this.ty*this.c-this.tx*this.d)*r,t.y=this.a*r*s+ -this.b*r*i+(-this.ty*this.a+this.tx*this.b)*r,t},n.Matrix.prototype.translate=function(e,t){return this.tx+=e,this.ty+=t,this},n.Matrix.prototype.scale=function(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this},n.Matrix.prototype.rotate=function(e){var t=Math.cos(e),n=Math.sin(e),r=this.a,i=this.c,s=this.tx;return this.a=r*t-this.b*n,this.b=r*n+this.b*t,this.c=i*t-this.d*n,this.d=i*n+this.d*t,this.tx=s*t-this.ty*n,this.ty=s*n+this.ty*t,this},n.Matrix.prototype.append=function(e){var t=this.a,n=this.b,r=this.c,i=this.d;return this.a=e.a*t+e.b*r,this.b=e.a*n+e.b*i,this.c=e.c*t+e.d*r,this.d=e.c*n+e.d*i,this.tx=e.tx*t+e.ty*r+this.tx,this.ty=e.tx*n+e.ty*i+this.ty,this},n.Matrix.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},n.identityMatrix=new n.Matrix,PIXI.Matrix=n.Matrix,PIXI.identityMatrix=n.identityMatrix,n.Point=function(e,t){e=e||0,t=t||0,this.x=e,this.y=t,this.type=n.POINT},n.Point.prototype={copyFrom:function(e){return this.setTo(e.x,e.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(e,t){return this.x=e||0,this.y=t||(0!==t?this.x:0),this},set:function(e,t){return this.x=e||0,this.y=t||(0!==t?this.x:0),this},add:function(e,t){return this.x+=e,this.y+=t,this},subtract:function(e,t){return this.x-=e,this.y-=t,this},multiply:function(e,t){return this.x*=e,this.y*=t,this},divide:function(e,t){return this.x/=e,this.y/=t,this},clampX:function(e,t){return this.x=n.Math.clamp(this.x,e,t),this},clampY:function(e,t){return this.y=n.Math.clamp(this.y,e,t),this},clamp:function(e,t){return this.x=n.Math.clamp(this.x,e,t),this.y=n.Math.clamp(this.y,e,t),this},clone:function(e){return"undefined"==typeof e||null===e?e=new n.Point(this.x,this.y):e.setTo(this.x,this.y),e},copyTo:function(e){return e.x=this.x,e.y=this.y,e},distance:function(e,t){return n.Point.distance(this,e,t)},equals:function(e){return e.x===this.x&&e.y===this.y},angle:function(e,t){return"undefined"==typeof t&&(t=!1),t?n.Math.radToDeg(Math.atan2(e.y-this.y,e.x-this.x)):Math.atan2(e.y-this.y,e.x-this.x)},rotate:function(e,t,r,i,s){return n.Point.rotate(this,e,t,r,i,s)},getMagnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},getMagnitudeSq:function(){return this.x*this.x+this.y*this.y},setMagnitude:function(e){return this.normalize().multiply(e,e)},normalize:function(){if(!this.isZero()){var e=this.getMagnitude();this.x/=e,this.y/=e}return this},isZero:function(){return 0===this.x&&0===this.y},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},perp:function(){return this.setTo(-this.y,this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(-1*this.y,this.x)},floor:function(){return this.setTo(Math.floor(this.x),Math.floor(this.y))},ceil:function(){return this.setTo(Math.ceil(this.x),Math.ceil(this.y))},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}},n.Point.prototype.constructor=n.Point,n.Point.add=function(e,t,r){return"undefined"==typeof r&&(r=new n.Point),r.x=e.x+t.x,r.y=e.y+t.y,r},n.Point.subtract=function(e,t,r){return"undefined"==typeof r&&(r=new n.Point),r.x=e.x-t.x,r.y=e.y-t.y,r},n.Point.multiply=function(e,t,r){return"undefined"==typeof r&&(r=new n.Point),r.x=e.x*t.x,r.y=e.y*t.y,r},n.Point.divide=function(e,t,r){return"undefined"==typeof r&&(r=new n.Point),r.x=e.x/t.x,r.y=e.y/t.y,r},n.Point.equals=function(e,t){return e.x===t.x&&e.y===t.y},n.Point.angle=function(e,t){return Math.atan2(e.y-t.y,e.x-t.x)},n.Point.negative=function(e,t){return"undefined"==typeof t&&(t=new n.Point),t.setTo(-e.x,-e.y)},n.Point.multiplyAdd=function(e,t,r,i){return"undefined"==typeof i&&(i=new n.Point),i.setTo(e.x+t.x*r,e.y+t.y*r)},n.Point.interpolate=function(e,t,r,i){return"undefined"==typeof i&&(i=new n.Point),i.setTo(e.x+(t.x-e.x)*r,e.y+(t.y-e.y)*r)},n.Point.perp=function(e,t){return"undefined"==typeof t&&(t=new n.Point),t.setTo(-e.y,e.x)},n.Point.rperp=function(e,t){return"undefined"==typeof t&&(t=new n.Point),t.setTo(e.y,-e.x)},n.Point.distance=function(e,t,r){var i=n.Math.distance(e.x,e.y,t.x,t.y);return r?Math.round(i):i},n.Point.project=function(e,t,r){"undefined"==typeof r&&(r=new n.Point);var i=e.dot(t)/t.getMagnitudeSq();return 0!==i&&r.setTo(i*t.x,i*t.y),r},n.Point.projectUnit=function(e,t,r){"undefined"==typeof r&&(r=new n.Point);var i=e.dot(t);return 0!==i&&r.setTo(i*t.x,i*t.y),r},n.Point.normalRightHand=function(e,t){return"undefined"==typeof t&&(t=new n.Point),t.setTo(-1*e.y,e.x)},n.Point.normalize=function(e,t){"undefined"==typeof t&&(t=new n.Point);var r=e.getMagnitude();return 0!==r&&t.setTo(e.x/r,e.y/r),t},n.Point.rotate=function(e,t,r,i,s,o){s=s||!1,o=o||null,s&&(i=n.Math.degToRad(i)),null===o&&(o=Math.sqrt((t-e.x)*(t-e.x)+(r-e.y)*(r-e.y)));var u=i+Math.atan2(e.y-r,e.x-t);return e.setTo(t+o*Math.cos(u),r+o*Math.sin(u))},n.Point.centroid=function(e,t){if("undefined"==typeof t&&(t=new n.Point),"[object Array]"!==Object.prototype.toString.call(e))throw new Error("Phaser.Point. Parameter 'points' must be an array");var r=e.length;if(1>r)throw new Error("Phaser.Point. Parameter 'points' array must not be empty");if(1===r)return t.copyFrom(e[0]),t;for(var i=0;r>i;i++)n.Point.add(t,e[i],t);return t.divide(r,r),t},n.Point.parse=function(e,t,r){t=t||"x",r=r||"y";var i=new n.Point;return e[t]&&(i.x=parseInt(e[t],10)),e[r]&&(i.y=parseInt(e[r],10)),i},PIXI.Point=n.Point,n.Polygon=function(){this.area=0,this._points=[],arguments.length>0&&this.setTo.apply(this,arguments),this.closed=!0,this.type=n.POLYGON},n.Polygon.prototype={toNumberArray:function(e){"undefined"==typeof e&&(e=[]);for(var t=0;t<this._points.length;t++)"number"==typeof this._points[t]?(e.push(this._points[t]),e.push(this._points[t+1]),t++):(e.push(this._points[t].x),e.push(this._points[t].y));return e},flatten:function(){return this._points=this.toNumberArray(),this},clone:function(e){var t=this._points.slice();return"undefined"==typeof e||null===e?e=new n.Polygon(t):e.setTo(t),e},contains:function(e,t){for(var n=this._points.length,r=!1,i=-1,s=n-1;++i<n;s=i){var o=this._points[i].x,u=this._points[i].y,a=this._points[s].x,f=this._points[s].y;(t>=u&&f>t||t>=f&&u>t)&&(a-o)*(t-u)/(f-u)+o>e&&(r=!r)}return r},setTo:function(e){if(this.area=0,this._points=[],arguments.length>0){Array.isArray(e)||(e=Array.prototype.slice.call(arguments));for(var t=Number.MAX_VALUE,n=0,r=e.length;r>n;n++){if("number"==typeof e[n]){var i=new PIXI.Point(e[n],e[n+1]);n++}else var i=new PIXI.Point(e[n].x,e[n].y);this._points.push(i),i.y<t&&(t=i.y)}this.calculateArea(t)}return this},calculateArea:function(e){for(var t,n,r,i,s=0,o=this._points.length;o>s;s++)t=this._points[s],n=s===o-1?this._points[0]:this._points[s+1],r=(t.y-e+(n.y-e))/2,i=t.x-n.x,this.area+=r*i;return this.area}},n.Polygon.prototype.constructor=n.Polygon,Object.defineProperty(n.Polygon.prototype,"points",{get:function(){return this._points},set:function(e){null!=e?this.setTo(e):this.setTo()}}),PIXI.Polygon=n.Polygon,n.Rectangle=function(e,t,r,i){e=e||0,t=t||0,r=r||0,i=i||0,this.x=e,this.y=t,this.width=r,this.height=i,this.type=n.RECTANGLE},n.Rectangle.prototype={offset:function(e,t){return this.x+=e,this.y+=t,this},offsetPoint:function(e){return this.offset(e.x,e.y)},setTo:function(e,t,n,r){return this.x=e,this.y=t,this.width=n,this.height=r,this},scale:function(e,t){return"undefined"==typeof t&&(t=e),this.width*=e,this.height*=t,this},centerOn:function(e,t){return this.centerX=e,this.centerY=t,this},floor:function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.width=Math.floor(this.width),this.height=Math.floor(this.height)},copyFrom:function(e){return this.setTo(e.x,e.y,e.width,e.height)},copyTo:function(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e},inflate:function(e,t){return n.Rectangle.inflate(this,e,t)},size:function(e){return n.Rectangle.size(this,e)},clone:function(e){return n.Rectangle.clone(this,e)},contains:function(e,t){return n.Rectangle.contains(this,e,t)},containsRect:function(e){return n.Rectangle.containsRect(e,this)},equals:function(e){return n.Rectangle.equals(this,e)},intersection:function(e,t){return n.Rectangle.intersection(this,e,t)},intersects:function(e){return n.Rectangle.intersects(this,e)},intersectsRaw:function(e,t,r,i,s){return n.Rectangle.intersectsRaw(this,e,t,r,i,s)},union:function(e,t){return n.Rectangle.union(this,e,t)},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}},Object.defineProperty(n.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}}),Object.defineProperty(n.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}}),Object.defineProperty(n.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(e){this.height=e<=this.y?0:e-this.y}}),Object.defineProperty(n.Rectangle.prototype,"bottomRight",{get:function(){return new n.Point(this.right,this.bottom)},set:function(e){this.right=e.x,this.bottom=e.y}}),Object.defineProperty(n.Rectangle.prototype,"left",{get:function(){return this.x},set:function(e){this.width=e>=this.right?0:this.right-e,this.x=e}}),Object.defineProperty(n.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(e){this.width=e<=this.x?0:e-this.x}}),Object.defineProperty(n.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}}),Object.defineProperty(n.Rectangle.prototype,"perimeter",{get:function(){return 2*this.width+2*this.height}}),Object.defineProperty(n.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(e){this.x=e-this.halfWidth}}),Object.defineProperty(n.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(e){this.y=e-this.halfHeight}}),Object.defineProperty(n.Rectangle.prototype,"randomX",{get:function(){return this.x+Math.random()*this.width}}),Object.defineProperty(n.Rectangle.prototype,"randomY",{get:function(){return this.y+Math.random()*this.height}}),Object.defineProperty(n.Rectangle.prototype,"top",{get:function(){return this.y},set:function(e){e>=this.bottom?(this.height=0,this.y=e):this.height=this.bottom-e}}),Object.defineProperty(n.Rectangle.prototype,"topLeft",{get:function(){return new n.Point(this.x,this.y)},set:function(e){this.x=e.x,this.y=e.y}}),Object.defineProperty(n.Rectangle.prototype,"topRight",{get:function(){return new n.Point(this.x+this.width,this.y)},set:function(e){this.right=e.x,this.y=e.y}}),Object.defineProperty(n.Rectangle.prototype,"empty",{get:function(){return!this.width||!this.height},set:function(e){e===!0&&this.setTo(0,0,0,0)}}),n.Rectangle.prototype.constructor=n.Rectangle,n.Rectangle.inflate=function(e,t,n){return e.x-=t,e.width+=2*t,e.y-=n,e.height+=2*n,e},n.Rectangle.inflatePoint=function(e,t){return n.Rectangle.inflate(e,t.x,t.y)},n.Rectangle.size=function(e,t){return"undefined"==typeof t||null===t?t=new n.Point(e.width,e.height):t.setTo(e.width,e.height),t},n.Rectangle.clone=function(e,t){return"undefined"==typeof t||null===t?t=new n.Rectangle(e.x,e.y,e.width,e.height):t.setTo(e.x,e.y,e.width,e.height),t},n.Rectangle.contains=function(e,t,n){return e.width<=0||e.height<=0?!1:t>=e.x&&t<e.right&&n>=e.y&&n<e.bottom},n.Rectangle.containsRaw=function(e,t,n,r,i,s){return i>=e&&e+n>i&&s>=t&&t+r>s},n.Rectangle.containsPoint=function(e,t){return n.Rectangle.contains(e,t.x,t.y)},n.Rectangle.containsRect=function(e,t){return e.volume>t.volume?!1:e.x>=t.x&&e.y>=t.y&&e.right<t.right&&e.bottom<t.bottom},n.Rectangle.equals=function(e,t){return e.x==t.x&&e.y==t.y&&e.width==t.width&&e.height==t.height},n.Rectangle.sameDimensions=function(e,t){return e.width===t.width&&e.height===t.height},n.Rectangle.intersection=function(e,t,r){return"undefined"==typeof r&&(r=new n.Rectangle),n.Rectangle.intersects(e,t)&&(r.x=Math.max(e.x,t.x),r.y=Math.max(e.y,t.y),r.width=Math.min(e.right,t.right)-r.x,r.height=Math.min(e.bottom,t.bottom)-r.y),r},n.Rectangle.intersects=function(e,t){return e.width<=0||e.height<=0||t.width<=0||t.height<=0?!1:!(e.right<t.x||e.bottom<t.y||e.x>t.right||e.y>t.bottom)},n.Rectangle.intersectsRaw=function(e,t,n,r,i,s){return"undefined"==typeof s&&(s=0),!(t>e.right+s||n<e.left-s||r>e.bottom+s||i<e.top-s)},n.Rectangle.union=function(e,t,r){return"undefined"==typeof r&&(r=new n.Rectangle),r.setTo(Math.min(e.x,t.x),Math.min(e.y,t.y),Math.max(e.right,t.right)-Math.min(e.left,t.left),Math.max(e.bottom,t.bottom)-Math.min(e.top,t.top))},n.Rectangle.aabb=function(e,t){"undefined"==typeof t&&(t=new n.Rectangle);var r=Number.MIN_VALUE,i=Number.MAX_VALUE,s=Number.MIN_VALUE,o=Number.MAX_VALUE;return e.forEach(function(e){e.x>r&&(r=e.x),e.x<i&&(i=e.x),e.y>s&&(s=e.y),e.y<o&&(o=e.y)}),t.setTo(i,o,r-i,s-o),t},PIXI.Rectangle=n.Rectangle,PIXI.EmptyRectangle=new n.Rectangle(0,0,0,0),n.RoundedRectangle=function(e,t,r,i,s){this.x=e||0,this.y=t||0,this.width=r||0,this.height=i||0,this.radius=s||20,this.type=n.ROUNDEDRECTANGLE},n.RoundedRectangle.prototype.clone=function(){return new n.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},n.RoundedRectangle.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;var n=this.x;if(e>=n&&e<=n+this.width){var r=this.y;if(t>=r&&t<=r+this.height)return!0}return!1},n.RoundedRectangle.prototype.constructor=n.RoundedRectangle,PIXI.RoundedRectangle=n.RoundedRectangle,n.Camera=function(e,t,r,i,s,o){this.game=e,this.world=e.world,this.id=0,this.view=new n.Rectangle(r,i,s,o),this.screenView=new n.Rectangle(r,i,s,o),this.bounds=new n.Rectangle(r,i,s,o),this.deadzone=null,this.visible=!0,this.roundPx=!0,this.atLimit={x:!1,y:!1},this.target=null,this.displayObject=null,this.scale=null,this.totalInView=0,this._targetPosition=new n.Point,this._edge=0,this._position=new n.Point},n.Camera.FOLLOW_LOCKON=0,n.Camera.FOLLOW_PLATFORMER=1,n.Camera.FOLLOW_TOPDOWN=2,n.Camera.FOLLOW_TOPDOWN_TIGHT=3,n.Camera.prototype={preUpdate:function(){this.totalInView=0},follow:function(e,t){"undefined"==typeof t&&(t=n.Camera.FOLLOW_LOCKON),this.target=e;var r;switch(t){case n.Camera.FOLLOW_PLATFORMER:var i=this.width/8,s=this.height/3;this.deadzone=new n.Rectangle((this.width-i)/2,(this.height-s)/2-.25*s,i,s);break;case n.Camera.FOLLOW_TOPDOWN:r=Math.max(this.width,this.height)/4,this.deadzone=new n.Rectangle((this.width-r)/2,(this.height-r)/2,r,r);break;case n.Camera.FOLLOW_TOPDOWN_TIGHT:r=Math.max(this.width,this.height)/8,this.deadzone=new n.Rectangle((this.width-r)/2,(this.height-r)/2,r,r);break;case n.Camera.FOLLOW_LOCKON:this.deadzone=null;break;default:this.deadzone=null}},unfollow:function(){this.target=null},focusOn:function(e){this.setPosition(Math.round(e.x-this.view.halfWidth),Math.round(e.y-this.view.halfHeight))},focusOnXY:function(e,t){this.setPosition(Math.round(e-this.view.halfWidth),Math.round(t-this.view.halfHeight))},update:function(){this.target&&this.updateTarget(),this.bounds&&this.checkBounds(),this.roundPx&&this.view.floor(),this.displayObject.position.x=-this.view.x,this.displayObject.position.y=-this.view.y},updateTarget:function(){this._targetPosition.copyFrom(this.target),this.target.parent&&this._targetPosition.multiply(this.target.parent.worldTransform.a,this.target.parent.worldTransform.d),this.deadzone?(this._edge=this._targetPosition.x-this.view.x,this._edge<this.deadzone.left?this.view.x=this._targetPosition.x-this.deadzone.left:this._edge>this.deadzone.right&&(this.view.x=this._targetPosition.x-this.deadzone.right),this._edge=this._targetPosition.y-this.view.y,this._edge<this.deadzone.top?this.view.y=this._targetPosition.y-this.deadzone.top:this._edge>this.deadzone.bottom&&(this.view.y=this._targetPosition.y-this.deadzone.bottom)):(this.view.x=this._targetPosition.x-this.view.halfWidth,this.view.y=this._targetPosition.y-this.view.halfHeight)},setBoundsToWorld:function(){this.bounds&&this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},checkBounds:function(){this.atLimit.x=!1,this.atLimit.y=!1,this.view.x<=this.bounds.x&&(this.atLimit.x=!0,this.view.x=this.bounds.x),this.view.right>=this.bounds.right&&(this.atLimit.x=!0,this.view.x=this.bounds.right-this.width),this.view.y<=this.bounds.top&&(this.atLimit.y=!0,this.view.y=this.bounds.top),this.view.bottom>=this.bounds.bottom&&(this.atLimit.y=!0,this.view.y=this.bounds.bottom-this.height)},setPosition:function(e,t){this.view.x=e,this.view.y=t,this.bounds&&this.checkBounds()},setSize:function(e,t){this.view.width=e,this.view.height=t},reset:function(){this.target=null,this.view.x=0,this.view.y=0}},n.Camera.prototype.constructor=n.Camera,Object.defineProperty(n.Camera.prototype,"x",{get:function(){return this.view.x},set:function(e){this.view.x=e,this.bounds&&this.checkBounds()}}),Object.defineProperty(n.Camera.prototype,"y",{get:function(){return this.view.y},set:function(e){this.view.y=e,this.bounds&&this.checkBounds()}}),Object.defineProperty(n.Camera.prototype,"position",{get:function(){return this._position.set(this.view.centerX,this.view.centerY),this._position},set:function(e){"undefined"!=typeof e.x&&(this.view.x=e.x),"undefined"!=typeof e.y&&(this.view.y=e.y),this.bounds&&this.checkBounds()}}),Object.defineProperty(n.Camera.prototype,"width",{get:function(){return this.view.width},set:function(e){this.view.width=e}}),Object.defineProperty(n.Camera.prototype,"height",{get:function(){return this.view.height},set:function(e){this.view.height=e}}),n.State=function(){this.game=null,this.key="",this.add=null,this.make=null,this.camera=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.sound=null,this.scale=null,this.stage=null,this.time=null,this.tweens=null,this.world=null,this.particles=null,this.physics=null,this.rnd=null},n.State.prototype={init:function(){},preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},render:function(){},resize:function(){},paused:function(){},pauseUpdate:function(){},shutdown:function(){}},n.State.prototype.constructor=n.State,n.StateManager=function(e,t){this.game=e,this.states={},this._pendingState=null,"undefined"!=typeof t&&null!==t&&(this._pendingState=t),this._clearWorld=!1,this._clearCache=!1,this._created=!1,this._args=[],this.current="",this.onInitCallback=null,this.onPreloadCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onResizeCallback=null,this.onPreRenderCallback=null,this.onLoadUpdateCallback=null,this.onLoadRenderCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null,this.onShutDownCallback=null},n.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this),this.game.onResume.add(this.resume,this),null!==this._pendingState&&"string"!=typeof this._pendingState&&this.add("default",this._pendingState,!0)},add:function(e,t,r){"undefined"==typeof r&&(r=!1);var i;return t instanceof n.State?i=t:"object"==typeof t?(i=t,i.game=this.game):"function"==typeof t&&(i=new t(this.game)),this.states[e]=i,r&&(this.game.isBooted?this.start(e):this._pendingState=e),i},remove:function(e){this.current===e&&(this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onPreRenderCallback=null,this.onRenderCallback=null,this.onResizeCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null),delete this.states[e]},start:function(e,t,n){"undefined"==typeof t&&(t=!0),"undefined"==typeof n&&(n=!1),this.checkState(e)&&(this._pendingState=e,this._clearWorld=t,this._clearCache=n,arguments.length>3&&(this._args=Array.prototype.splice.call(arguments,3)))},restart:function(e,t){"undefined"==typeof e&&(e=!0),"undefined"==typeof t&&(t=!1),this._pendingState=this.current,this._clearWorld=e,this._clearCache=t,arguments.length>2&&(this._args=Array.prototype.splice.call(arguments,2))},dummy:function(){},preUpdate:function(){if(this._pendingState&&this.game.isBooted){if(this.clearCurrentState(),this.setCurrentState(this._pendingState),this.current!==this._pendingState)return;this._pendingState=null,this.onPreloadCallback?(this.game.load.reset(!0),this.onPreloadCallback.call(this.callbackContext,this.game),0===this.game.load.totalQueuedFiles()&&0===this.game.load.totalQueuedPacks()?this.loadComplete():this.game.load.start()):this.loadComplete()}},clearCurrentState:function(){this.current&&(this.onShutDownCallback&&this.onShutDownCallback.call(this.callbackContext,this.game),this.game.tweens.removeAll(),this.game.camera.reset(),this.game.input.reset(!0),this.game.physics.clear(),this.game.time.removeAll(),this.game.scale.reset(this._clearWorld),this.game.debug&&this.game.debug.reset(),this._clearWorld&&(this.game.world.shutdown(),this._clearCache===!0&&this.game.cache.destroy()))},checkState:function(e){if(this.states[e]){var t=!1;return(this.states[e].preload||this.states[e].create||this.states[e].update||this.states[e].render)&&(t=!0),t===!1?(console.warn("Invalid Phaser State object given. Must contain at least a one of the required functions: preload, create, update or render"),!1):!0}return console.warn("Phaser.StateManager - No state found with the key: "+e),!1},link:function(e){this.states[e].game=this.game,this.states[e].add=this.game.add,this.states[e].make=this.game.make,this.states[e].camera=this.game.camera,this.states[e].cache=this.game.cache,this.states[e].input=this.game.input,this.states[e].load=this.game.load,this.states[e].math=this.game.math,this.states[e].sound=this.game.sound,this.states[e].scale=this.game.scale,this.states[e].state=this,this.states[e].stage=this.game.stage,this.states[e].time=this.game.time,this.states[e].tweens=this.game.tweens,this.states[e].world=this.game.world,this.states[e].particles=this.game.particles,this.states[e].rnd=this.game.rnd,this.states[e].physics=this.game.physics,this.states[e].key=e},unlink:function(e){this.states[e]&&(this.states[e].game=null,this.states[e].add=null,this.states[e].make=null,this.states[e].camera=null,this.states[e].cache=null,this.states[e].input=null,this.states[e].load=null,this.states[e].math=null,this.states[e].sound=null,this.states[e].scale=null,this.states[e].state=null,this.states[e].stage=null,this.states[e].time=null,this.states[e].tweens=null,this.states[e].world=null,this.states[e].particles=null,this.states[e].rnd=null,this.states[e].physics=null)},setCurrentState:function(e){this.callbackContext=this.states[e],this.link(e),this.onInitCallback=this.states[e].init||this.dummy,this.onPreloadCallback=this.states[e].preload||null,this.onLoadRenderCallback=this.states[e].loadRender||null,this.onLoadUpdateCallback=this.states[e].loadUpdate||null,this.onCreateCallback=this.states[e].create||null,this.onUpdateCallback=this.states[e].update||null,this.onPreRenderCallback=this.states[e].preRender||null,this.onRenderCallback=this.states[e].render||null,this.onResizeCallback=this.states[e].resize||null,this.onPausedCallback=this.states[e].paused||null,this.onResumedCallback=this.states[e].resumed||null,this.onPauseUpdateCallback=this.states[e].pauseUpdate||null,this.onShutDownCallback=this.states[e].shutdown||this.dummy,""!==this.current&&this.game.physics.reset(),this.current=e,this._created=!1,this.onInitCallback.apply(this.callbackContext,this._args),e===this._pendingState&&(this._args=[]),this.game._kickstart=!0},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){this._created===!1&&this.onCreateCallback?(this._created=!0,this.onCreateCallback.call(this.callbackContext,this.game)):this._created=!0},pause:function(){this._created&&this.onPausedCallback&&this.onPausedCallback.call(this.callbackContext,this.game)},resume:function(){this._created&&this.onResumedCallback&&this.onResumedCallback.call(this.callbackContext,this.game)},update:function(){this._created&&this.onUpdateCallback?this.onUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},pauseUpdate:function(){this._created&&this.onPauseUpdateCallback?this.onPauseUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},preRender:function(e){this.onPreRenderCallback&&this.onPreRenderCallback.call(this.callbackContext,this.game,e)},resize:function(e,t){this.onResizeCallback&&this.onResizeCallback.call(this.callbackContext,e,t)},render:function(){this._created&&this.onRenderCallback?this.game.renderType===n.CANVAS?(this.game.context.save(),this.game.context.setTransform(1,0,0,1,0,0),this.onRenderCallback.call(this.callbackContext,this.game),this.game.context.restore()):this.onRenderCallback.call(this.callbackContext,this.game):this.onLoadRenderCallback&&this.onLoadRenderCallback.call(this.callbackContext,this.game)},destroy:function(){this.clearCurrentState(),this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null,this.game=null,this.states={},this._pendingState=null,this.current=""}},n.StateManager.prototype.constructor=n.StateManager,n.Signal=function(){},n.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!0,validateListener:function(e,t){if("function"!=typeof e)throw new Error("Phaser.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))},_registerListener:function(e,t,r,i){var s,o=this._indexOfListener(e,r);if(-1!==o){if(s=this._bindings[o],s.isOnce()!==t)throw new Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else s=new n.SignalBinding(this,e,t,r,i),this._addBinding(s);return this.memorize&&this._prevParams&&s.execute(this._prevParams),s},_addBinding:function(e){this._bindings||(this._bindings=[]);var t=this._bindings.length;do t--;while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){if(!this._bindings)return-1;"undefined"==typeof t&&(t=null);for(var n,r=this._bindings.length;r--;)if(n=this._bindings[r],n._listener===e&&n.context===t)return r;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,n){return this.validateListener(e,"add"),this._registerListener(e,!1,t,n)},addOnce:function(e,t,n){return this.validateListener(e,"addOnce"),this._registerListener(e,!0,t,n)},remove:function(e,t){this.validateListener(e,"remove");var n=this._indexOfListener(e,t);return-1!==n&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),e},removeAll:function(e){if("undefined"==typeof e&&(e=null),this._bindings){for(var t=this._bindings.length;t--;)e?this._bindings[t].context===e&&(this._bindings[t]._destroy(),this._bindings.splice(t,1)):this._bindings[t]._destroy();e||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var e,t=Array.prototype.slice.call(arguments),n=this._bindings.length;if(this.memorize&&(this._prevParams=t),n){e=this._bindings.slice(),this._shouldPropagate=!0;do n--;while(e[n]&&this._shouldPropagate&&e[n].execute(t)!==!1)}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(n.Signal.prototype,"boundDispatch",{get:function(){var e=this;return this._boundDispatch||(this._boundDispatch=function(){return e.dispatch.apply(e,arguments)})}}),n.Signal.prototype.constructor=n.Signal,n.SignalBinding=function(e,t,n,r,i){this._listener=t,n&&(this._isOnce=!0),null!=r&&(this.context=r),this._signal=e,i&&(this._priority=i)},n.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,callCount:0,active:!0,params:null,execute:function(e){var t,n;return this.active&&this._listener&&(n=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,n),this.callCount++,this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},n.SignalBinding.prototype.constructor=n.SignalBinding,n.Filter=function(e,t,r){this.game=e,this.type=n.WEBGL_FILTER,this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.prevPoint=new n.Point;var i=new Date;if(this.uniforms={resolution:{type:"2f",value:{x:256,y:256}},time:{type:"1f",value:0},mouse:{type:"2f",value:{x:0,y:0}},date:{type:"4fv",value:[i.getFullYear(),i.getMonth(),i.getDate(),60*i.getHours()*60+60*i.getMinutes()+i.getSeconds()]},sampleRate:{type:"1f",value:44100},iChannel0:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel1:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel2:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel3:{type:"sampler2D",value:null,textureData:{repeat:!0}}},t)for(var s in t)this.uniforms[s]=t[s];this.fragmentSrc=r||[]},n.Filter.prototype={init:function(){},setResolution:function(e,t){this.uniforms.resolution.value.x=e,this.uniforms.resolution.value.y=t},update:function(e){if("undefined"!=typeof e){var t=e.x/this.game.width,n=1-e.y/this.game.height;(t!==this.prevPoint.x||n!==this.prevPoint.y)&&(this.uniforms.mouse.value.x=t.toFixed(2),this.uniforms.mouse.value.y=n.toFixed(2),this.prevPoint.set(t,n))}this.uniforms.time.value=this.game.time.totalElapsedSeconds()},destroy:function(){this.game=null}},n.Filter.prototype.constructor=n.Filter,Object.defineProperty(n.Filter.prototype,"width",{get:function(){return this.uniforms.resolution.value.x},set:function(e){this.uniforms.resolution.value.x=e}}),Object.defineProperty(n.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(e){this.uniforms.resolution.value.y=e}}),n.Plugin=function(e,t){"undefined"==typeof t&&(t=null),this.game=e,this.parent=t,this.active=!1,this.visible=!1,this.hasPreUpdate=!1,this.hasUpdate=!1,this.hasPostUpdate=!1,this.hasRender=!1,this.hasPostRender=!1},n.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null,this.parent=null,this.active=!1,this.visible=!1}},n.Plugin.prototype.constructor=n.Plugin,n.PluginManager=function(e){this.game=e,this.plugins=[],this._len=0,this._i=0},n.PluginManager.prototype={add:function(e){var t=Array.prototype.splice.call(arguments,1),n=!1;return"function"==typeof e?e=new e(this.game,this):(e.game=this.game,e.parent=this),"function"==typeof e.preUpdate&&(e.hasPreUpdate=!0,n=!0),"function"==typeof e.update&&(e.hasUpdate=!0,n=!0),"function"==typeof e.postUpdate&&(e.hasPostUpdate=!0,n=!0),"function"==typeof e.render&&(e.hasRender=!0,n=!0),"function"==typeof e.postRender&&(e.hasPostRender=!0,n=!0),n?((e.hasPreUpdate||e.hasUpdate||e.hasPostUpdate)&&(e.active=!0),(e.hasRender||e.hasPostRender)&&(e.visible=!0),this._len=this.plugins.push(e),"function"==typeof e.init&&e.init.apply(e,t),e):null},remove:function(e){for(this._i=this._len;this._i--;)if(this.plugins[this._i]===e)return e.destroy(),this.plugins.splice(this._i,1),void (this._len--)},removeAll:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].destroy();this.plugins.length=0,this._len=0},preUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate&&this.plugins[this._i].preUpdate()},update:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasUpdate&&this.plugins[this._i].update()},postUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate&&this.plugins[this._i].postUpdate()},render:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasRender&&this.plugins[this._i].render()},postRender:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender&&this.plugins[this._i].postRender()},destroy:function(){this.removeAll(),this.game=null}},n.PluginManager.prototype.constructor=n.PluginManager,n.Stage=function(e){this.game=e,PIXI.Stage.call(this,0),this.name="_stage_root",this.disableVisibilityChange=!1,this.exists=!0,this.currentRenderOrderID=0,this._hiddenVar="hidden",this._onChange=null,this._backgroundColor=0,e.config&&this.parseConfig(e.config)},n.Stage.prototype=Object.create(PIXI.Stage.prototype),n.Stage.prototype.constructor=n.Stage,n.Stage.prototype.parseConfig=function(e){e.disableVisibilityChange&&(this.disableVisibilityChange=e.disableVisibilityChange),e.backgroundColor&&(this.backgroundColor=e.backgroundColor)},n.Stage.prototype.boot=function(){n.DOM.getOffset(this.game.canvas,this.offset),n.Canvas.setUserSelect(this.game.canvas,"none"),n.Canvas.setTouchAction(this.game.canvas,"none"),this.checkVisibility()},n.Stage.prototype.preUpdate=function(){this.currentRenderOrderID=0;for(var e=0;e<this.children.length;e++)this.children[e].preUpdate()},n.Stage.prototype.update=function(){for(var e=this.children.length;e--;)this.children[e].update()},n.Stage.prototype.postUpdate=function(){if(this.game.world.camera.target){this.game.world.camera.target.postUpdate(),this.game.world.camera.update();for(var e=this.children.length;e--;)this.children[e]!==this.game.world.camera.target&&this.children[e].postUpdate()}else{this.game.world.camera.update();for(var e=this.children.length;e--;)this.children[e].postUpdate()}},n.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var e=0;e<this.children.length;e++)this.children[e].updateTransform()},n.Stage.prototype.checkVisibility=function(){this._hiddenVar=void 0!==document.webkitHidden?"webkitvisibilitychange":void 0!==document.mozHidden?"mozvisibilitychange":void 0!==document.msHidden?"msvisibilitychange":void 0!==document.hidden?"visibilitychange":null;var e=this;this._onChange=function(t){return e.visibilityChange(t)},this._hiddenVar&&document.addEventListener(this._hiddenVar,this._onChange,!1),window.onblur=this._onChange,window.onfocus=this._onChange,window.onpagehide=this._onChange,window.onpageshow=this._onChange,this.game.device.cocoonJSApp&&(CocoonJS.App.onSuspended.addEventListener(function(){n.Stage.prototype.visibilityChange.call(e,{type:"pause"})}),CocoonJS.App.onActivated.addEventListener(function(){n.Stage.prototype.visibilityChange.call(e,{type:"resume"})}))},n.Stage.prototype.visibilityChange=function(e){return"pagehide"===e.type||"blur"===e.type||"pageshow"===e.type||"focus"===e.type?void ("pagehide"===e.type||"blur"===e.type?this.game.focusLoss(e):("pageshow"===e.type||"focus"===e.type)&&this.game.focusGain(e)):void (this.disableVisibilityChange||(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||"pause"===e.type?this.game.gamePaused(e):this.game.gameResumed(e)))},n.Stage.prototype.setBackgroundColor=function(e){var t=n.Color.valueToColor(e);this._backgroundColor=n.Color.getColor(t.r,t.g,t.b),this.backgroundColorSplit=[t.r/255,t.g/255,t.b/255],this.backgroundColorString=n.Color.RGBtoString(t.r,t.g,t.b,255,"#")},n.Stage.prototype.destroy=function(){this._hiddenVar&&document.removeEventListener(this._hiddenVar,this._onChange,!1),window.onpagehide=null,window.onpageshow=null,window.onblur=null,window.onfocus=null},Object.defineProperty(n.Stage.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(e){this.game.transparent||this.setBackgroundColor(e)}}),Object.defineProperty(n.Stage.prototype,"smoothed",{get:function(){return PIXI.scaleModes.DEFAULT===PIXI.scaleModes.LINEAR},set:function(e){PIXI.scaleModes.DEFAULT=e?PIXI.scaleModes.LINEAR:PIXI.scaleModes.NEAREST}}),n.Group=function(e,t,r,i,s,o){"undefined"==typeof i&&(i=!1),"undefined"==typeof s&&(s=!1),"undefined"==typeof o&&(o=n.Physics.ARCADE),this.game=e,"undefined"==typeof t&&(t=e.world),this.name=r||"group",this.z=0,PIXI.DisplayObjectContainer.call(this),i?(this.game.stage.addChild(this),this.z=this.game.stage.children.length):t&&(t.addChild(this),this.z=t.children.length),this.type=n.GROUP,this.physicsType=n.GROUP,this.alive=!0,this.exists=!0,this.ignoreDestroy=!1,this.classType=n.Sprite,this.scale=new n.Point(1,1),this.cursor=null,this.enableBody=s,this.enableBodyDebug=!1,this.physicsBodyType=o,this.onDestroy=new n.Signal,this.cursorIndex=0,this.fixedToCamera=!1,this.cameraOffset=new n.Point,this._hash=[],this._sortProperty="z"},n.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),n.Group.prototype.constructor=n.Group,n.Group.RETURN_NONE=0,n.Group.RETURN_TOTAL=1,n.Group.RETURN_CHILD=2,n.Group.SORT_ASCENDING=-1,n.Group.SORT_DESCENDING=1,n.Group.prototype.add=function(e,t){return"undefined"==typeof t&&(t=!1),e.parent!==this&&(this.enableBody&&this.game.physics.enable(e,this.physicsBodyType),this.addChild(e),this._hash.push(e),e.z=this.children.length,!t&&e.events&&e.events.onAddedToGroup$dispatch(e,this),null===this.cursor&&(this.cursor=e)),e},n.Group.prototype.addMultiple=function(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)this.add(e[n],t);return e},n.Group.prototype.addAt=function(e,t,n){return"undefined"==typeof n&&(n=!1),e.parent!==this&&(this.enableBody&&this.game.physics.enable(e,this.physicsBodyType),this.addChildAt(e,t),this._hash.push(e),this.updateZ(),!n&&e.events&&e.events.onAddedToGroup$dispatch(e,this),null===this.cursor&&(this.cursor=e)),e},n.Group.prototype.getAt=function(e){return 0>e||e>=this.children.length?-1:this.getChildAt(e)},n.Group.prototype.create=function(e,t,n,r,i){"undefined"==typeof i&&(i=!0);var s=new this.classType(this.game,e,t,n,r);return this.enableBody&&this.game.physics.enable(s,this.physicsBodyType,this.enableBodyDebug),s.exists=i,s.visible=i,s.alive=i,this.addChild(s),this._hash.push(s),s.z=this.children.length,s.events&&s.events.onAddedToGroup$dispatch(s,this),null===this.cursor&&(this.cursor=s),s},n.Group.prototype.createMultiple=function(e,t,n,r){"undefined"==typeof r&&(r=!1);for(var i=0;e>i;i++)this.create(0,0,t,n,r)},n.Group.prototype.updateZ=function(){for(var e=this.children.length;e--;)this.children[e].z=e},n.Group.prototype.resetCursor=function(e){return"undefined"==typeof e&&(e=0),e>this.children.length-1&&(e=0),this.cursor?(this.cursorIndex=e,this.cursor=this.children[this.cursorIndex],this.cursor):void 0},n.Group.prototype.next=function(){return this.cursor?(this.cursorIndex>=this.children.length-1?this.cursorIndex=0:this.cursorIndex++,this.cursor=this.children[this.cursorIndex],this.cursor):void 0},n.Group.prototype.previous=function(){return this.cursor?(0===this.cursorIndex?this.cursorIndex=this.children.length-1:this.cursorIndex--,this.cursor=this.children[this.cursorIndex],this.cursor):void 0},n.Group.prototype.swap=function(e,t){this.swapChildren(e,t),this.updateZ()},n.Group.prototype.bringToTop=function(e){return e.parent===this&&this.getIndex(e)<this.children.length&&(this.remove(e,!1,!0),this.add(e,!0)),e},n.Group.prototype.sendToBack=function(e){return e.parent===this&&this.getIndex(e)>0&&(this.remove(e,!1,!0),this.addAt(e,0,!0)),e},n.Group.prototype.moveUp=function(e){if(e.parent===this&&this.getIndex(e)<this.children.length-1){var t=this.getIndex(e),n=this.getAt(t+1);n&&this.swap(e,n)}return e},n.Group.prototype.moveDown=function(e){if(e.parent===this&&this.getIndex(e)>0){var t=this.getIndex(e),n=this.getAt(t-1);n&&this.swap(e,n)}return e},n.Group.prototype.xy=function(e,t,n){return 0>e||e>this.children.length?-1:(this.getChildAt(e).x=t,void (this.getChildAt(e).y=n))},n.Group.prototype.reverse=function(){this.children.reverse(),this.updateZ()},n.Group.prototype.getIndex=function(e){return this.children.indexOf(e)},n.Group.prototype.replace=function(e,t){var r=this.getIndex(e);return-1!==r?(t.parent&&(t.parent instanceof n.Group?t.parent.remove(t):t.parent.removeChild(t)),this.remove(e),this.addAt(t,r),e):void 0},n.Group.prototype.hasProperty=function(e,t){var n=t.length;return 1===n&&t[0]in e?!0:2===n&&t[0]in e&&t[1]in e[t[0]]?!0:3===n&&t[0]in e&&t[1]in e[t[0]]&&t[2]in e[t[0]][t[1]]?!0:4===n&&t[0]in e&&t[1]in e[t[0]]&&t[2]in e[t[0]][t[1]]&&t[3]in e[t[0]][t[1]][t[2]]?!0:!1},n.Group.prototype.setProperty=function(e,t,n,r,i){if("undefined"==typeof i&&(i=!1),r=r||0,!this.hasProperty(e,t)&&(!i||r>0))return!1;var s=t.length;return 1===s?0===r?e[t[0]]=n:1==r?e[t[0]]+=n:2==r?e[t[0]]-=n:3==r?e[t[0]]*=n:4==r&&(e[t[0]]/=n):2===s?0===r?e[t[0]][t[1]]=n:1==r?e[t[0]][t[1]]+=n:2==r?e[t[0]][t[1]]-=n:3==r?e[t[0]][t[1]]*=n:4==r&&(e[t[0]][t[1]]/=n):3===s?0===r?e[t[0]][t[1]][t[2]]=n:1==r?e[t[0]][t[1]][t[2]]+=n:2==r?e[t[0]][t[1]][t[2]]-=n:3==r?e[t[0]][t[1]][t[2]]*=n:4==r&&(e[t[0]][t[1]][t[2]]/=n):4===s&&(0===r?e[t[0]][t[1]][t[2]][t[3]]=n:1==r?e[t[0]][t[1]][t[2]][t[3]]+=n:2==r?e[t[0]][t[1]][t[2]][t[3]]-=n:3==r?e[t[0]][t[1]][t[2]][t[3]]*=n:4==r&&(e[t[0]][t[1]][t[2]][t[3]]/=n)),!0},n.Group.prototype.checkProperty=function(e,t,r,i){return"undefined"==typeof i&&(i=!1),!n.Utils.getProperty(e,t)&&i?!1:n.Utils.getProperty(e,t)!==r?!1:!0},n.Group.prototype.set=function(e,t,n,r,i,s,o){return"undefined"==typeof o&&(o=!1),t=t.split("."),"undefined"==typeof r&&(r=!1),"undefined"==typeof i&&(i=!1),(r===!1||r&&e.alive)&&(i===!1||i&&e.visible)?this.setProperty(e,t,n,s,o):void 0},n.Group.prototype.setAll=function(e,t,n,r,i,s){"undefined"==typeof n&&(n=!1),"undefined"==typeof r&&(r=!1),"undefined"==typeof s&&(s=!1),e=e.split("."),i=i||0;for(var o=0;o<this.children.length;o++)(!n||n&&this.children[o].alive)&&(!r||r&&this.children[o].visible)&&this.setProperty(this.children[o],e,t,i,s)},n.Group.prototype.setAllChildren=function(e,t,r,i,s,o){"undefined"==typeof r&&(r=!1),"undefined"==typeof i&&(i=!1),"undefined"==typeof o&&(o=!1),s=s||0;for(var u=0;u<this.children.length;u++)(!r||r&&this.children[u].alive)&&(!i||i&&this.children[u].visible)&&(this.children[u]instanceof n.Group?this.children[u].setAllChildren(e,t,r,i,s,o):this.setProperty(this.children[u],e.split("."),t,s,o))},n.Group.prototype.checkAll=function(e,t,n,r,i){"undefined"==typeof n&&(n=!1),"undefined"==typeof r&&(r=!1),"undefined"==typeof i&&(i=!1);for(var s=0;s<this.children.length;s++)if((!n||n&&this.children[s].alive)&&(!r||r&&this.children[s].visible)&&!this.checkProperty(this.children[s],e,t,i))return!1;return!0},n.Group.prototype.addAll=function(e,t,n,r){this.setAll(e,t,n,r,1)},n.Group.prototype.subAll=function(e,t,n,r){this.setAll(e,t,n,r,2)},n.Group.prototype.multiplyAll=function(e,t,n,r){this.setAll(e,t,n,r,3)},n.Group.prototype.divideAll=function(e,t,n,r){this.setAll(e,t,n,r,4)},n.Group.prototype.callAllExists=function(e,t){var n;if(arguments.length>2){n=[];for(var r=2;r<arguments.length;r++)n.push(arguments[r])}for(var r=0;r<this.children.length;r++)this.children[r].exists===t&&this.children[r][e]&&this.children[r][e].apply(this.children[r],n)},n.Group.prototype.callbackFromArray=function(e,t,n){if(1==n){if(e[t[0]])return e[t[0]]}else if(2==n){if(e[t[0]][t[1]])return e[t[0]][t[1]]}else if(3==n){if(e[t[0]][t[1]][t[2]])return e[t[0]][t[1]][t[2]]}else if(4==n){if(e[t[0]][t[1]][t[2]][t[3]])return e[t[0]][t[1]][t[2]][t[3]]}else if(e[t])return e[t];return!1},n.Group.prototype.callAll=function(e,t){if("undefined"!=typeof e){e=e.split(".");var n=e.length;if("undefined"==typeof t||null===t||""===t)t=null;else if("string"==typeof t){t=t.split(".");var r=t.length}var i;if(arguments.length>2){i=[];for(var s=2;s<arguments.length;s++)i.push(arguments[s])}for(var o=null,u=null,s=0;s<this.children.length;s++)o=this.callbackFromArray(this.children[s],e,n),t&&o?(u=this.callbackFromArray(this.children[s],t,r),o&&o.apply(u,i)):o&&o.apply(this.children[s],i)}},n.Group.prototype.preUpdate=function(){if(!this.exists||!this.parent.exists)return this.renderOrderID=-1,!1;for(var e=this.children.length;e--;)this.children[e].preUpdate();return!0},n.Group.prototype.update=function(){for(var e=this.children.length;e--;)this.children[e].update()},n.Group.prototype.postUpdate=function(){this.fixedToCamera&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);for(var e=this.children.length;e--;)this.children[e].postUpdate()},n.Group.prototype.filter=function(e,t){for(var r=-1,i=this.children.length,s=[];++r<i;){var o=this.children[r];(!t||t&&o.exists)&&e(o,r,this.children)&&s.push(o)}return new n.ArraySet(s)},n.Group.prototype.forEach=function(e,t,n){if("undefined"==typeof n&&(n=!1),arguments.length<=3)for(var r=0;r<this.children.length;r++)(!n||n&&this.children[r].exists)&&e.call(t,this.children[r]);else{for(var i=[null],r=3;r<arguments.length;r++)i.push(arguments[r]);for(var r=0;r<this.children.length;r++)(!n||n&&this.children[r].exists)&&(i[0]=this.children[r],e.apply(t,i))}},n.Group.prototype.forEachExists=function(e,t){var r;if(arguments.length>2){r=[null];for(var i=2;i<arguments.length;i++)r.push(arguments[i])}this.iterate("exists",!0,n.Group.RETURN_TOTAL,e,t,r)},n.Group.prototype.forEachAlive=function(e,t){var r;if(arguments.length>2){r=[null];for(var i=2;i<arguments.length;i++)r.push(arguments[i])}this.iterate("alive",!0,n.Group.RETURN_TOTAL,e,t,r)},n.Group.prototype.forEachDead=function(e,t){var r;if(arguments.length>2){r=[null];for(var i=2;i<arguments.length;i++)r.push(arguments[i])}this.iterate("alive",!1,n.Group.RETURN_TOTAL,e,t,r)},n.Group.prototype.sort=function(e,t){this.children.length<2||("undefined"==typeof e&&(e="z"),"undefined"==typeof t&&(t=n.Group.SORT_ASCENDING),this._sortProperty=e,this.children.sort(t===n.Group.SORT_ASCENDING?this.ascendingSortHandler.bind(this):this.descendingSortHandler.bind(this)),this.updateZ())},n.Group.prototype.customSort=function(e,t){this.children.length<2||(this.children.sort(e.bind(t)),this.updateZ())},n.Group.prototype.ascendingSortHandler=function(e,t){return e[this._sortProperty]<t[this._sortProperty]?-1:e[this._sortProperty]>t[this._sortProperty]?1:e.z<t.z?-1:1},n.Group.prototype.descendingSortHandler=function(e,t){return e[this._sortProperty]<t[this._sortProperty]?1:e[this._sortProperty]>t[this._sortProperty]?-1:0},n.Group.prototype.iterate=function(e,t,r,i,s,o){if(r===n.Group.RETURN_TOTAL&&0===this.children.length)return 0;for(var u=0,a=0;a<this.children.length;a++)if(this.children[a][e]===t&&(u++,i&&(o?(o[0]=this.children[a],i.apply(s,o)):i.call(s,this.children[a])),r===n.Group.RETURN_CHILD))return this.children[a];return r===n.Group.RETURN_TOTAL?u:null},n.Group.prototype.getFirstExists=function(e){return"boolean"!=typeof e&&(e=!0),this.iterate("exists",e,n.Group.RETURN_CHILD)},n.Group.prototype.getFirstAlive=function(){return this.iterate("alive",!0,n.Group.RETURN_CHILD)},n.Group.prototype.getFirstDead=function(){return this.iterate("alive",!1,n.Group.RETURN_CHILD)},n.Group.prototype.getTop=function(){return this.children.length>0?this.children[this.children.length-1]:void 0},n.Group.prototype.getBottom=function(){return this.children.length>0?this.children[0]:void 0},n.Group.prototype.countLiving=function(){return this.iterate("alive",!0,n.Group.RETURN_TOTAL)},n.Group.prototype.countDead=function(){return this.iterate("alive",!1,n.Group.RETURN_TOTAL)},n.Group.prototype.getRandom=function(e,t){return 0===this.children.length?null:(e=e||0,t=t||this.children.length,n.ArrayUtils.getRandomItem(this.children,e,t))},n.Group.prototype.remove=function(e,t,n){if("undefined"==typeof t&&(t=!1),"undefined"==typeof n&&(n=!1),0===this.children.length||-1===this.children.indexOf(e))return!1;n||!e.events||e.destroyPhase||e.events.onRemovedFromGroup$dispatch(e,this);var r=this.removeChild(e),i=this._hash.indexOf(r);return-1!==i&&this._hash.splice(i,1),this.updateZ(),this.cursor===e&&this.next(),t&&r&&r.destroy(!0),!0},n.Group.prototype.removeAll=function(e,t){if("undefined"==typeof e&&(e=!1),"undefined"==typeof t&&(t=!1),0!==this.children.length){do{!t&&this.children[0].events&&this.children[0].events.onRemovedFromGroup$dispatch(this.children[0],this);var n=this.removeChild(this.children[0]),r=this._hash.indexOf(n);-1!==r&&this._hash.splice(r,1),e&&n&&n.destroy(!0)}while(this.children.length>0);this._hash=[],this.cursor=null}},n.Group.prototype.removeBetween=function(e,t,n,r){if("undefined"==typeof t&&(t=this.children.length-1),"undefined"==typeof n&&(n=!1),"undefined"==typeof r&&(r=!1),0!==this.children.length){if(e>t||0>e||t>this.children.length)return!1;for(var i=t;i>=e;){!r&&this.children[i].events&&this.children[i].events.onRemovedFromGroup$dispatch(this.children[i],this);var s=this.removeChild(this.children[i]),o=this._hash.indexOf(s);-1!==o&&this._hash.splice(o,1),n&&s&&s.destroy(!0),this.cursor===this.children[i]&&(this.cursor=null),i--}this.updateZ()}},n.Group.prototype.destroy=function(e,t){null===this.game||this.ignoreDestroy||("undefined"==typeof e&&(e=!0),"undefined"==typeof t&&(t=!1),this.onDestroy.dispatch(this,e,t),this.removeAll(e),this.cursor=null,this.filters=null,t||(this.parent&&this.parent.removeChild(this),this.game=null,this.exists=!1))},Object.defineProperty(n.Group.prototype,"total",{get:function(){return this.iterate("exists",!0,n.Group.RETURN_TOTAL)}}),Object.defineProperty(n.Group.prototype,"length",{get:function(){return this.children.length}}),Object.defineProperty(n.Group.prototype,"angle",{get:function(){return n.Math.radToDeg(this.rotation)},set:function(e){this.rotation=n.Math.degToRad(e)}}),n.World=function(e){n.Group.call(this,e,null,"__world",!1),this.bounds=new n.Rectangle(0,0,e.width,e.height),this.camera=null,this._definedSize=!1,this._width=e.width,this._height=e.height},n.World.prototype=Object.create(n.Group.prototype),n.World.prototype.constructor=n.World,n.World.prototype.boot=function(){this.camera=new n.Camera(this.game,0,0,0,this.game.width,this.game.height),this.camera.displayObject=this,this.camera.scale=this.scale,this.game.camera=this.camera,this.game.stage.addChild(this)},n.World.prototype.setBounds=function(e,t,n,r){this._definedSize=!0,this._width=n,this._height=r,this.bounds.setTo(e,t,n,r),this.x=e,this.y=t,this.camera.bounds&&this.camera.bounds.setTo(e,t,Math.max(n,this.game.width),Math.max(r,this.game.height)),this.game.physics.setBoundsToWorld()},n.World.prototype.resize=function(e,t){this._definedSize&&(e<this._width&&(e=this._width),t<this._height&&(t=this._height)),this.bounds.width=e,this.bounds.height=t,this.game.camera.setBoundsToWorld(),this.game.physics.setBoundsToWorld()},n.World.prototype.shutdown=function(){this.destroy(!0,!0)},n.World.prototype.wrap=function(e,t,n,r,i){"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=!1),"undefined"==typeof r&&(r=!0),"undefined"==typeof i&&(i=!0),n?(e.getBounds(),r&&(e.x+e._currentBounds.width<this.bounds.x?e.x=this.bounds.right:e.x>this.bounds.right&&(e.x=this.bounds.left)),i&&(e.y+e._currentBounds.height<this.bounds.top?e.y=this.bounds.bottom:e.y>this.bounds.bottom&&(e.y=this.bounds.top))):(r&&e.x+t<this.bounds.x?e.x=this.bounds.right+t:r&&e.x-t>this.bounds.right&&(e.x=this.bounds.left-t),i&&e.y+t<this.bounds.top?e.y=this.bounds.bottom+t:i&&e.y-t>this.bounds.bottom&&(e.y=this.bounds.top-t))},Object.defineProperty(n.World.prototype,"width",{get:function(){return this.bounds.width},set:function(e){e<this.game.width&&(e=this.game.width),this.bounds.width=e,this._width=e,this._definedSize=!0}}),Object.defineProperty(n.World.prototype,"height",{get:function(){return this.bounds.height},set:function(e){e<this.game.height&&(e=this.game.height),this.bounds.height=e,this._height=e,this._definedSize=!0}}),Object.defineProperty(n.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth}}),Object.defineProperty(n.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight}}),Object.defineProperty(n.World.prototype,"randomX",{get:function(){return this.bounds.x<0?this.game.rnd.integerInRange(this.bounds.x,this.bounds.width-Math.abs(this.bounds.x)):this.game.rnd.integerInRange(this.bounds.x,this.bounds.width)}}),Object.defineProperty(n.World.prototype,"randomY",{get:function(){return this.bounds.y<0?this.game.rnd.integerInRange(this.bounds.y,this.bounds.height-Math.abs(this.bounds.y)):this.game.rnd.integerInRange(this.bounds.y,this.bounds.height)}}),n.FlexGrid=function(e,t,r){this.game=e.game,this.manager=e,this.width=t,this.height=r,this.boundsCustom=new n.Rectangle(0,0,t,r),this.boundsFluid=new n.Rectangle(0,0,t,r),this.boundsFull=new n.Rectangle(0,0,t,r),this.boundsNone=new n.Rectangle(0,0,t,r),this.positionCustom=new n.Point(0,0),this.positionFluid=new n.Point(0,0),this.positionFull=new n.Point(0,0),this.positionNone=new n.Point(0,0),this.scaleCustom=new n.Point(1,1),this.scaleFluid=new n.Point(1,1),this.scaleFluidInversed=new n.Point(1,1),this.scaleFull=new n.Point(1,1),this.scaleNone=new n.Point(1,1),this.customWidth=0,this.customHeight=0,this.customOffsetX=0,this.customOffsetY=0,this.ratioH=t/r,this.ratioV=r/t,this.multiplier=0,this.layers=[]},n.FlexGrid.prototype={setSize:function(e,t){this.width=e,this.height=t,this.ratioH=e/t,this.ratioV=t/e,this.scaleNone=new n.Point(1,1),this.boundsNone.width=this.width,this.boundsNone.height=this.height,this.refresh()},createCustomLayer:function(e,t,r,i){"undefined"==typeof i&&(i=!0),this.customWidth=e,this.customHeight=t,this.boundsCustom.width=e,this.boundsCustom.height=t;var s=new n.FlexLayer(this,this.positionCustom,this.boundsCustom,this.scaleCustom);return i&&this.game.world.add(s),this.layers.push(s),"undefined"!=typeof r&&null!==typeof r&&s.addMultiple(r),s},createFluidLayer:function(e,t){"undefined"==typeof t&&(t=!0);var r=new n.FlexLayer(this,this.positionFluid,this.boundsFluid,this.scaleFluid);return t&&this.game.world.add(r),this.layers.push(r),"undefined"!=typeof e&&null!==typeof e&&r.addMultiple(e),r},createFullLayer:function(e){var t=new n.FlexLayer(this,this.positionFull,this.boundsFull,this.scaleFluid);return this.game.world.add(t),this.layers.push(t),"undefined"!=typeof e&&t.addMultiple(e),t},createFixedLayer:function(e){var t=new n.FlexLayer(this,this.positionNone,this.boundsNone,this.scaleNone);return this.game.world.add(t),this.layers.push(t),"undefined"!=typeof e&&t.addMultiple(e),t},reset:function(){for(var e=this.layers.length;e--;)this.layers[e].persist||(this.layers[e].position=null,this.layers[e].scale=null,this.layers.slice(e,1))},onResize:function(e,t){this.ratioH=e/t,this.ratioV=t/e,this.refresh(e,t)},refresh:function(){this.multiplier=Math.min(this.manager.height/this.height,this.manager.width/this.width),this.boundsFluid.width=Math.round(this.width*this.multiplier),this.boundsFluid.height=Math.round(this.height*this.multiplier),this.scaleFluid.set(this.boundsFluid.width/this.width,this.boundsFluid.height/this.height),this.scaleFluidInversed.set(this.width/this.boundsFluid.width,this.height/this.boundsFluid.height),this.scaleFull.set(this.boundsFull.width/this.width,this.boundsFull.height/this.height),this.boundsFull.width=Math.round(this.manager.width*this.scaleFluidInversed.x),this.boundsFull.height=Math.round(this.manager.height*this.scaleFluidInversed.y),this.boundsFluid.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY),this.boundsNone.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY),this.positionFluid.set(this.boundsFluid.x,this.boundsFluid.y),this.positionNone.set(this.boundsNone.x,this.boundsNone.y)},fitSprite:function(e){this.manager.scaleSprite(e),e.x=this.manager.bounds.centerX,e.y=this.manager.bounds.centerY},debug:function(){this.game.debug.text(this.boundsFluid.width+" x "+this.boundsFluid.height,this.boundsFluid.x+4,this.boundsFluid.y+16),this.game.debug.geom(this.boundsFluid,"rgba(255,0,0,0.9",!1)}},n.FlexGrid.prototype.constructor=n.FlexGrid,n.FlexLayer=function(e,t,r,i){n.Group.call(this,e.game,null,"__flexLayer"+e.game.rnd.uuid(),!1),this.manager=e.manager,this.grid=e,this.persist=!1,this.position=t,this.bounds=r,this.scale=i,this.topLeft=r.topLeft,this.topMiddle=new n.Point(r.halfWidth,0),this.topRight=r.topRight,this.bottomLeft=r.bottomLeft,this.bottomMiddle=new n.Point(r.halfWidth,r.bottom),this.bottomRight=r.bottomRight},n.FlexLayer.prototype=Object.create(n.Group.prototype),n.FlexLayer.prototype.constructor=n.FlexLayer,n.FlexLayer.prototype.resize=function(){},n.FlexLayer.prototype.debug=function(){this.game.debug.text(this.bounds.width+" x "+this.bounds.height,this.bounds.x+4,this.bounds.y+16),this.game.debug.geom(this.bounds,"rgba(0,0,255,0.9",!1),this.game.debug.geom(this.topLeft,"rgba(255,255,255,0.9"),this.game.debug.geom(this.topMiddle,"rgba(255,255,255,0.9"),this.game.debug.geom(this.topRight,"rgba(255,255,255,0.9")},n.ScaleManager=function(e,t,r){this.game=e,this.dom=n.DOM,this.grid=null,this.width=0,this.height=0,this.minWidth=null,this.maxWidth=null,this.minHeight=null,this.maxHeight=null,this.offset=new n.Point,this.forceLandscape=!1,this.forcePortrait=!1,this.incorrectOrientation=!1,this._pageAlignHorizontally=!1,this._pageAlignVertically=!1,this.maxIterations=5,this.onOrientationChange=new n.Signal,this.enterLandscape=new n.Signal,this.enterPortrait=new n.Signal,this.enterIncorrectOrientation=new n.Signal,this.leaveIncorrectOrientation=new n.Signal,this.fullScreenTarget=null,this._createdFullScreenTarget=null,this.onFullScreenInit=new n.Signal,this.onFullScreenChange=new n.Signal,this.onFullScreenError=new n.Signal,this.enterFullScreen=new n.Signal,this.leaveFullScreen=new n.Signal,this.fullScreenFailed=this.onFullScreenError,this.screenOrientation=this.dom.getScreenOrientation(),this.scaleFactor=new n.Point(1,1),this.scaleFactorInversed=new n.Point(1,1),this.margin={left:0,top:0,right:0,bottom:0,x:0,y:0},this.bounds=new n.Rectangle,this.aspectRatio=0,this.sourceAspectRatio=0,this.event=null,this.windowConstraints={right:"layout",bottom:""},this.compatibility={supportsFullScreen:!1,orientationFallback:null,noMargins:!1,scrollTo:null,forceMinimumDocumentHeight:!1,canExpandParent:!0,clickTrampoline:""},this._scaleMode=n.ScaleManager.NO_SCALE,this._fullScreenScaleMode=n.ScaleManager.NO_SCALE,this.parentIsWindow=!1,this.parentNode=null,this.parentScaleFactor=new n.Point(1,1),this.trackParentInterval=2e3,this.onSizeChange=new n.Signal,this.onResize=null,this.onResizeContext=null,this._fullScreenRestore=null,this._gameSize=new n.Rectangle,this._userScaleFactor=new n.Point(1,1),this._userScaleTrim=new n.Point(0,0),this._lastUpdate=0,this._updateThrottle=0,this._updateThrottleReset=100,this._parentBounds=new n.Rectangle,this._tempBounds=new n.Rectangle,this._lastReportedCanvasSize=new n.Rectangle,this._lastReportedGameSize=new n.Rectangle,e.config&&this.parseConfig(e.config),this.setupScale(t,r)},n.ScaleManager.EXACT_FIT=0,n.ScaleManager.NO_SCALE=1,n.ScaleManager.SHOW_ALL=2,n.ScaleManager.RESIZE=3,n.ScaleManager.USER_SCALE=4,n.ScaleManager.prototype={boot:function(){var e=this.compatibility;e.supportsFullScreen=this.game.device.fullscreen&&!this.game.device.cocoonJS,this.game.device.iPad||this.game.device.webApp||this.game.device.desktop||(e.scrollTo=this.game.device.android&&!this.game.device.chrome?new n.Point(0,1):new n.Point(0,0)),this.game.device.desktop?(e.orientationFallback="screen",e.clickTrampoline="when-not-mouse"):(e.orientationFallback="",e.clickTrampoline="");var t=this;this._orientationChange=function(e){return t.orientationChange(e)},this._windowResize=function(e){return t.windowResize(e)},window.addEventListener("orientationchange",this._orientationChange,!1),window.addEventListener("resize",this._windowResize,!1),this.compatibility.supportsFullScreen&&(this._fullScreenChange=function(e){return t.fullScreenChange(e)},this._fullScreenError=function(e){return t.fullScreenError(e)},document.addEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.addEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.addEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.addEventListener("fullscreenchange",this._fullScreenChange,!1),document.addEventListener("webkitfullscreenerror",this._fullScreenError,!1),document.addEventListener("mozfullscreenerror",this._fullScreenError,!1),document.addEventListener("MSFullscreenError",this._fullScreenError,!1),document.addEventListener("fullscreenerror",this._fullScreenError,!1)),this.game.onResume.add(this._gameResumed,this),this.dom.getOffset(this.game.canvas,this.offset),this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height),this.setGameSize(this.game.width,this.game.height),this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback),this.grid=new n.FlexGrid(this,this.width,this.height)},parseConfig:function(e){e.scaleMode&&(this.scaleMode=e.scaleMode),e.fullScreenScaleMode&&(this.fullScreenScaleMode=e.fullScreenScaleMode),e.fullScreenTarget&&(this.fullScreenTarget=e.fullScreenTarget)},setupScale:function(e,t){var r,i=new n.Rectangle;""!==this.game.parent&&("string"==typeof this.game.parent?r=document.getElementById(this.game.parent):this.game.parent&&1===this.game.parent.nodeType&&(r=this.game.parent)),r?(this.parentNode=r,this.parentIsWindow=!1,this.getParentBounds(this._parentBounds),i.width=this._parentBounds.width,i.height=this._parentBounds.height,this.offset.set(this._parentBounds.x,this._parentBounds.y)):(this.parentNode=null,this.parentIsWindow=!0,i.width=this.dom.visualBounds.width,i.height=this.dom.visualBounds.height,this.offset.set(0,0));var s=0,o=0;"number"==typeof e?s=e:(this.parentScaleFactor.x=parseInt(e,10)/100,s=i.width*this.parentScaleFactor.x),"number"==typeof t?o=t:(this.parentScaleFactor.y=parseInt(t,10)/100,o=i.height*this.parentScaleFactor.y),this._gameSize.setTo(0,0,s,o),this.updateDimensions(s,o,!1)},_gameResumed:function(){this.queueUpdate(!0)},setGameSize:function(e,t){this._gameSize.setTo(0,0,e,t),this.currentScaleMode!==n.ScaleManager.RESIZE&&this.updateDimensions(e,t,!0),this.queueUpdate(!0)},setUserScale:function(e,t,n,r){this._userScaleFactor.setTo(e,t),this._userScaleTrim.setTo(0|n,0|r),this.queueUpdate(!0)},setResizeCallback:function(e,t){this.onResize=e,this.onResizeContext=t},signalSizeChange:function(){if(!n.Rectangle.sameDimensions(this,this._lastReportedCanvasSize)||!n.Rectangle.sameDimensions(this.game,this._lastReportedGameSize)){var e=this.width,t=this.height;this._lastReportedCanvasSize.setTo(0,0,e,t),this._lastReportedGameSize.setTo(0,0,this.game.width,this.game.height),this.grid.onResize(e,t),this.onSizeChange.dispatch(this,e,t),this.currentScaleMode===n.ScaleManager.RESIZE&&(this.game.state.resize(e,t),this.game.load.resize(e,t))}},setMinMax:function(e,t,n,r){this.minWidth=e,this.minHeight=t,"undefined"!=typeof n&&(this.maxWidth=n),"undefined"!=typeof r&&(this.maxHeight=r)},preUpdate:function(){if(!(this.game.time.time<this._lastUpdate+this._updateThrottle)){var e=this._updateThrottle;this._updateThrottleReset=e>=400?0:100,this.dom.getOffset(this.game.canvas,this.offset);var t=this._parentBounds.width,r=this._parentBounds.height,i=this.getParentBounds(this._parentBounds),s=i.width!==t||i.height!==r,o=this.updateOrientationState();(s||o)&&(this.onResize&&this.onResize.call(this.onResizeContext,this,i),this.updateLayout(),this.signalSizeChange());var u=2*this._updateThrottle;this._updateThrottle<e&&(u=Math.min(e,this._updateThrottleReset)),this._updateThrottle=n.Math.clamp(u,25,this.trackParentInterval),this._lastUpdate=this.game.time.time}},pauseUpdate:function(){this.preUpdate(),this._updateThrottle=this.trackParentInterval},updateDimensions:function(e,t,n){this.width=e*this.parentScaleFactor.x,this.height=t*this.parentScaleFactor.y,this.game.width=this.width,this.game.height=this.height,this.sourceAspectRatio=this.width/this.height,this.updateScalingAndBounds(),n&&(this.game.renderer.resize(this.width,this.height),this.game.camera.setSize(this.width,this.height),this.game.world.resize(this.width,this.height))},updateScalingAndBounds:function(){this.scaleFactor.x=this.game.width/this.width,this.scaleFactor.y=this.game.height/this.height,this.scaleFactorInversed.x=this.width/this.game.width,this.scaleFactorInversed.y=this.height/this.game.height,this.aspectRatio=this.width/this.height,this.game.canvas&&this.dom.getOffset(this.game.canvas,this.offset),this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height),this.game.input&&this.game.input.scale&&this.game.input.scale.setTo(this.scaleFactor.x,this.scaleFactor.y)},forceOrientation:function(e,t){"undefined"==typeof t&&(t=!1),this.forceLandscape=e,this.forcePortrait=t,this.queueUpdate(!0)},classifyOrientation:function(e){return"portrait-primary"===e||"portrait-secondary"===e?"portrait":"landscape-primary"===e||"landscape-secondary"===e?"landscape":null},updateOrientationState:function(){var e=this.screenOrientation,t=this.incorrectOrientation;this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback),this.incorrectOrientation=this.forceLandscape&&!this.isLandscape||this.forcePortrait&&!this.isPortrait;var n=e!==this.screenOrientation,r=t!==this.incorrectOrientation;return n&&(this.isLandscape?this.enterLandscape.dispatch(this.orientation,!0,!1):this.enterPortrait.dispatch(this.orientation,!1,!0)),r&&(this.incorrectOrientation?this.enterIncorrectOrientation.dispatch():this.leaveIncorrectOrientation.dispatch()),(n||r)&&this.onOrientationChange.dispatch(this,e,t),n||r},orientationChange:function(e){this.event=e,this.queueUpdate(!0)},windowResize:function(e){this.event=e,this.queueUpdate(!0)},scrollTop:function(){var e=this.compatibility.scrollTo;e&&window.scrollTo(e.x,e.y)},refresh:function(){this.scrollTop(),this.queueUpdate(!0)},updateLayout:function(){var e=this.currentScaleMode;if(e===n.ScaleManager.RESIZE)return void this.reflowGame();if(this.scrollTop(),this.compatibility.forceMinimumDocumentHeight&&(document.documentElement.style.minHeight=window.innerHeight+"px"),this.incorrectOrientation?this.setMaximum():e===n.ScaleManager.EXACT_FIT?this.setExactFit():e===n.ScaleManager.SHOW_ALL?!this.isFullScreen&&this.boundingParent&&this.compatibility.canExpandParent?(this.setShowAll(!0),this.resetCanvas(),this.setShowAll()):this.setShowAll():e===n.ScaleManager.NO_SCALE?(this.width=this.game.width,this.height=this.game.height):e===n.ScaleManager.USER_SCALE&&(this.width=this.game.width*this._userScaleFactor.x-this._userScaleTrim.x,this.height=this.game.height*this._userScaleFactor.y-this._userScaleTrim.y),!this.compatibility.canExpandParent&&(e===n.ScaleManager.SHOW_ALL||e===n.ScaleManager.USER_SCALE)){var t=this.getParentBounds(this._tempBounds);this.width=Math.min(this.width,t.width),this.height=Math.min(this.height,t.height)}this.width=0|this.width,this.height=0|this.height,this.reflowCanvas()},getParentBounds:function(e){var t=e||new n.Rectangle,r=this.boundingParent,i=this.dom.visualBounds,s=this.dom.layoutBounds;if(r){var o=r.getBoundingClientRect();t.setTo(o.left,o.top,o.width,o.height);var u=this.windowConstraints;if(u.right){var a="layout"===u.right?s:i;t.right=Math.min(t.right,a.width)}if(u.bottom){var a="layout"===u.bottom?s:i;t.bottom=Math.min(t.bottom,a.height)}}else t.setTo(0,0,i.width,i.height);return t.setTo(Math.round(t.x),Math.round(t.y),Math.round(t.width),Math.round(t.height)),t},alignCanvas:function(e,t){var n=this.getParentBounds(this._tempBounds),r=this.game.canvas,i=this.margin;if(e){i.left=i.right=0;var s=r.getBoundingClientRect();if(this.width<n.width&&!this.incorrectOrientation){var o=s.left-n.x,u=n.width/2-this.width/2;u=Math.max(u,0);var a=u-o;i.left=Math.round(a)}r.style.marginLeft=i.left+"px",0!==i.left&&(i.right=-(n.width-s.width-i.left),r.style.marginRight=i.right+"px")}if(t){i.top=i.bottom=0;var s=r.getBoundingClientRect();if(this.height<n.height&&!this.incorrectOrientation){var o=s.top-n.y,u=n.height/2-this.height/2;u=Math.max(u,0);var a=u-o;i.top=Math.round(a)}r.style.marginTop=i.top+"px",0!==i.top&&(i.bottom=-(n.height-s.height-i.top),r.style.marginBottom=i.bottom+"px")}i.x=i.left,i.y=i.top},reflowGame:function(){this.resetCanvas("","");var e=this.getParentBounds(this._tempBounds);this.updateDimensions(e.width,e.height,!0)},reflowCanvas:function(){this.incorrectOrientation||(this.width=n.Math.clamp(this.width,this.minWidth||0,this.maxWidth||this.width),this.height=n.Math.clamp(this.height,this.minHeight||0,this.maxHeight||this.height)),this.resetCanvas(),this.compatibility.noMargins||(this.isFullScreen&&this._createdFullScreenTarget?this.alignCanvas(!0,!0):this.alignCanvas(this.pageAlignHorizontally,this.pageAlignVertically)),this.updateScalingAndBounds()},resetCanvas:function(e,t){"undefined"==typeof e&&(e=this.width+"px"),"undefined"==typeof t&&(t=this.height+"px");var n=this.game.canvas;this.compatibility.noMargins||(n.style.marginLeft="",n.style.marginTop="",n.style.marginRight="",n.style.marginBottom=""),n.style.width=e,n.style.height=t},queueUpdate:function(e){e&&(this._parentBounds.width=0,this._parentBounds.height=0),this._updateThrottle=this._updateThrottleReset},reset:function(e){e&&this.grid.reset()},setMaximum:function(){this.width=this.dom.visualBounds.width,this.height=this.dom.visualBounds.height},setShowAll:function(e){var t,n=this.getParentBounds(this._tempBounds),r=n.width,i=n.height;t=e?Math.max(i/this.game.height,r/this.game.width):Math.min(i/this.game.height,r/this.game.width),this.width=Math.round(this.game.width*t),this.height=Math.round(this.game.height*t)},setExactFit:function(){var e=this.getParentBounds(this._tempBounds);this.width=e.width,this.height=e.height,this.isFullScreen||(this.maxWidth&&(this.width=Math.min(this.width,this.maxWidth)),this.maxHeight&&(this.height=Math.min(this.height,this.maxHeight)))},createFullScreenTarget:function(){var e=document.createElement("div");return e.style.margin="0",e.style.padding="0",e.style.background="#000",e},startFullScreen:function(e,t){if(this.isFullScreen)return!1;if(!this.compatibility.supportsFullScreen){var r=this;return void setTimeout(function(){r.fullScreenError()},10)}if("when-not-mouse"===this.compatibility.clickTrampoline){var i=this.game.input;if(i.activePointer&&i.activePointer!==i.mousePointer&&(t||t!==!1))return void i.activePointer.addClickTrampoline("startFullScreen",this.startFullScreen,this,[e,!1])}"undefined"!=typeof e&&this.game.renderType===n.CANVAS&&(this.game.stage.smoothed=e);var s=this.fullScreenTarget;s||(this.cleanupCreatedTarget(),this._createdFullScreenTarget=this.createFullScreenTarget(),s=this._createdFullScreenTarget);var o={targetElement:s};if(this.onFullScreenInit.dispatch(this,o),this._createdFullScreenTarget){var u=this.game.canvas,a=u.parentNode;a.insertBefore(s,u),s.appendChild(u)}return this.game.device.fullscreenKeyboard?s[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT):s[this.game.device.requestFullscreen](),!0},stopFullScreen:function(){return this.isFullScreen&&this.compatibility.supportsFullScreen?(document[this.game.device.cancelFullscreen](),!0):!1},cleanupCreatedTarget:function(){var e=this._createdFullScreenTarget;if(e&&e.parentNode){var t=e.parentNode;t.insertBefore(this.game.canvas,e),t.removeChild(e)}this._createdFullScreenTarget=null},prepScreenMode:function(e){var t=!!this._createdFullScreenTarget,r=this._createdFullScreenTarget||this.fullScreenTarget;e?(t||this.fullScreenScaleMode===n.ScaleManager.EXACT_FIT)&&r!==this.game.canvas&&(this._fullScreenRestore={targetWidth:r.style.width,targetHeight:r.style.height},r.style.width="100%",r.style.height="100%"):(this._fullScreenRestore&&(r.style.width=this._fullScreenRestore.targetWidth,r.style.height=this._fullScreenRestore.targetHeight,this._fullScreenRestore=null),this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.resetCanvas())},fullScreenChange:function(e){this.event=e,this.isFullScreen?(this.prepScreenMode(!0),this.updateLayout(),this.queueUpdate(!0),this.enterFullScreen.dispatch(this.width,this.height)):(this.prepScreenMode(!1),this.cleanupCreatedTarget(),this.updateLayout(),this.queueUpdate(!0),this.leaveFullScreen.dispatch(this.width,this.height)),this.onFullScreenChange.dispatch(this)},fullScreenError:function(e){this.event=e,this.cleanupCreatedTarget(),console.warn("Phaser.ScaleManager: requestFullscreen failed or device does not support the Fullscreen API"),this.onFullScreenError.dispatch(this)},scaleSprite:function(e,t,n,r){if("undefined"==typeof t&&(t=this.width),"undefined"==typeof n&&(n=this.height),"undefined"==typeof r&&(r=!1),e.scale.set(1),e.width<=0||e.height<=0||0>=t||0>=n)return e;var i=t,s=e.height*t/e.width,o=e.width*n/e.height,u=n,a=o>t;return a=a?r:!r,a?(e.width=Math.floor(i),e.height=Math.floor(s)):(e.width=Math.floor(o),e.height=Math.floor(u)),e},destroy:function(){this.game.onResume.remove(this._gameResumed,this),window.removeEventListener("orientationchange",this._orientationChange,!1),window.removeEventListener("resize",this._windowResize,!1),this.compatibility.supportsFullScreen&&(document.removeEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.removeEventListener("fullscreenchange",this._fullScreenChange,!1),document.removeEventListener("webkitfullscreenerror",this._fullScreenError,!1),document.removeEventListener("mozfullscreenerror",this._fullScreenError,!1),document.removeEventListener("MSFullscreenError",this._fullScreenError,!1),document.removeEventListener("fullscreenerror",this._fullScreenError,!1))}},n.ScaleManager.prototype.constructor=n.ScaleManager,n.ScaleManager.prototype.checkResize=n.ScaleManager.prototype.windowResize,n.ScaleManager.prototype.checkOrientation=n.ScaleManager.prototype.orientationChange,n.ScaleManager.prototype.setScreenSize=n.ScaleManager.prototype.updateLayout,n.ScaleManager.prototype.setSize=n.ScaleManager.prototype.reflowCanvas,n.ScaleManager.prototype.checkOrientationState=function(){var e=this.updateOrientationState();return e&&this.refresh(),e},Object.defineProperty(n.ScaleManager.prototype,"boundingParent",{get:function(){if(this.parentIsWindow||this.isFullScreen&&!this._createdFullScreenTarget)return null;var e=this.game.canvas&&this.game.canvas.parentNode;return e||null}}),Object.defineProperty(n.ScaleManager.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(e){return e!==this._scaleMode&&(this.isFullScreen||(this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.queueUpdate(!0)),this._scaleMode=e),this._scaleMode}}),Object.defineProperty(n.ScaleManager.prototype,"fullScreenScaleMode",{get:function(){return this._fullScreenScaleMode},set:function(e){return e!==this._fullScreenScaleMode&&(this.isFullScreen?(this.prepScreenMode(!1),this._fullScreenScaleMode=e,this.prepScreenMode(!0),this.queueUpdate(!0)):this._fullScreenScaleMode=e),this._fullScreenScaleMode}}),Object.defineProperty(n.ScaleManager.prototype,"currentScaleMode",{get:function(){return this.isFullScreen?this._fullScreenScaleMode:this._scaleMode}}),Object.defineProperty(n.ScaleManager.prototype,"pageAlignHorizontally",{get:function(){return this._pageAlignHorizontally},set:function(e){e!==this._pageAlignHorizontally&&(this._pageAlignHorizontally=e,this.queueUpdate(!0))}}),Object.defineProperty(n.ScaleManager.prototype,"pageAlignVertically",{get:function(){return this._pageAlignVertically},set:function(e){e!==this._pageAlignVertically&&(this._pageAlignVertically=e,this.queueUpdate(!0))}}),Object.defineProperty(n.ScaleManager.prototype,"isFullScreen",{get:function(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}}),Object.defineProperty(n.ScaleManager.prototype,"isPortrait",{get:function(){return"portrait"===this.classifyOrientation(this.screenOrientation)}}),Object.defineProperty(n.ScaleManager.prototype,"isLandscape",{get:function(){return"landscape"===this.classifyOrientation(this.screenOrientation)}}),Object.defineProperty(n.ScaleManager.prototype,"orientation",{get:function(){return"portrait"===this.classifyOrientation(this.screenOrientation)?0:90}}),Object.defineProperty(n.ScaleManager.prototype,"isGamePortrait",{get:function(){return this.height>this.width}}),Object.defineProperty(n.ScaleManager.prototype,"isGameLandscape",{get:function(){return this.width>this.height}}),n.Game=function(e,t,r,i,s,o,u,a){return this.id=n.GAMES.push(this)-1,this.config=null,this.physicsConfig=a,this.parent="",this.width=800,this.height=600,this.resolution=1,this._width=800,this._height=600,this.transparent=!1,this.antialias=!0,this.preserveDrawingBuffer=!1,this.renderer=null,this.renderType=n.AUTO,this.state=null,this.isBooted=!1,this.isRunning=!1,this.raf=null,this.add=null,this.make=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.net=null,this.scale=null,this.sound=null,this.stage=null,this.time=null,this.tweens=null,this.world=null,this.physics=null,this.plugins=null,this.rnd=null,this.device=n.Device,this.camera=null,this.canvas=null,this.context=null,this.debug=null,this.particles=null,this.lockRender=!1,this.stepping=!1,this.pendingStep=!1,this.stepCount=0,this.onPause=null,this.onResume=null,this.onBlur=null,this.onFocus=null,this._paused=!1,this._codePaused=!1,this.currentUpdateID=0,this.updatesThisFrame=1,this._deltaTime=0,this._lastCount=0,this._spiraling=0,this._kickstart=!0,this.fpsProblemNotifier=new n.Signal,this.forceSingleUpdate=!1,this._nextFpsNotification=0,1===arguments.length&&"object"==typeof arguments[0]?this.parseConfig(arguments[0]):(this.config={enableDebug:!0},"undefined"!=typeof e&&(this._width=e),"undefined"!=typeof t&&(this._height=t),"undefined"!=typeof r&&(this.renderType=r),"undefined"!=typeof i&&(this.parent=i),"undefined"!=typeof o&&(this.transparent=o),"undefined"!=typeof u&&(this.antialias=u),this.rnd=new n.RandomDataGenerator([(Date.now()*Math.random()).toString()]),this.state=new n.StateManager(this,s)),this.device.whenReady(this.boot,this),this},n.Game.prototype={parseConfig:function(e){this.config=e,"undefined"==typeof e.enableDebug&&(this.config.enableDebug=!0),e.width&&(this._width=e.width),e.height&&(this._height=e.height),e.renderer&&(this.renderType=e.renderer),e.parent&&(this.parent=e.parent),e.transparent&&(this.transparent=e.transparent),e.antialias&&(this.antialias=e.antialias),e.resolution&&(this.resolution=e.resolution),e.preserveDrawingBuffer&&(this.preserveDrawingBuffer=e.preserveDrawingBuffer),e.physicsConfig&&(this.physicsConfig=e.physicsConfig);var t=[(Date.now()*Math.random()).toString()];e.seed&&(t=e.seed),this.rnd=new n.RandomDataGenerator(t);var r=null;e.state&&(r=e.state),this.state=new n.StateManager(this,r)},boot:function(){this.isBooted||(this.onPause=new n.Signal,this.onResume=new n.Signal,this.onBlur=new n.Signal,this.onFocus=new n.Signal,this.isBooted=!0,this.math=n.Math,this.scale=new n.ScaleManager(this,this._width,this._height),this.stage=new n.Stage(this),this.setUpRenderer(),this.world=new n.World(this),this.add=new n.GameObjectFactory(this),this.make=new n.GameObjectCreator(this),this.cache=new n.Cache(this),this.load=new n.Loader(this),this.time=new n.Time(this),this.tweens=new n.TweenManager(this),this.input=new n.Input(this),this.sound=new n.SoundManager(this),this.physics=new n.Physics(this,this.physicsConfig),this.particles=new n.Particles(this),this.plugins=new n.PluginManager(this),this.net=new n.Net(this),this.time.boot(),this.stage.boot(),this.world.boot(),this.scale.boot(),this.input.boot(),this.sound.boot(),this.state.boot(),this.config.enableDebug?(this.debug=new n.Utils.Debug(this),this.debug.boot()):this.debug={preUpdate:function(){},update:function(){},reset:function(){}},this.showDebugHeader(),this.isRunning=!0,this.raf=this.config&&this.config.forceSetTimeOut?new n.RequestAnimationFrame(this,this.config.forceSetTimeOut):new n.RequestAnimationFrame(this,!1),this._kickstart=!0,window.focus&&(!window.PhaserGlobal||window.PhaserGlobal&&!window.PhaserGlobal.stopFocus)&&window.focus(),this.raf.start())},showDebugHeader:function(){if(!window.PhaserGlobal||!window.PhaserGlobal.hideBanner){var e=n.VERSION,t="Canvas",r="HTML Audio",i=1;if(this.renderType===n.WEBGL?(t="WebGL",i++):this.renderType==n.HEADLESS&&(t="Headless"),this.device.webAudio&&(r="WebAudio",i++),this.device.chrome){for(var s=["%c %c %c Phaser v"+e+" | Pixi.js "+PIXI.VERSION+" | "+t+" | "+r+"  %c %c %c http://phaser.io %c♥%c♥%c♥","background: #9854d8","background: #6c2ca7","color: #ffffff; background: #450f78;","background: #6c2ca7","background: #9854d8","background: #ffffff"],o=0;3>o;o++)s.push(i>o?"color: #ff2424; background: #fff":"color: #959595; background: #fff");console.log.apply(console,s)}else window.console&&console.log("Phaser v"+e+" | Pixi.js "+PIXI.VERSION+" | "+t+" | "+r+" | http://phaser.io")}},setUpRenderer:function(){if(this.canvas=this.config.canvasID?n.Canvas.create(this.width,this.height,this.config.canvasID):n.Canvas.create(this.width,this.height),this.config.canvasStyle?this.canvas.style=this.config.canvasStyle:this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%",this.device.cocoonJS&&(this.canvas.screencanvas=this.renderType===n.CANVAS?!0:!1),this.renderType===n.HEADLESS||this.renderType===n.CANVAS||this.renderType===n.AUTO&&this.device.webGL===!1){if(!this.device.canvas)throw new Error("Phaser.Game - cannot create Canvas or WebGL context, aborting.");this.renderType===n.AUTO&&(this.renderType=n.CANVAS),this.renderer=new PIXI.CanvasRenderer(this.width,this.height,{view:this.canvas,transparent:this.transparent,resolution:this.resolution,clearBeforeRender:!0}),this.context=this.renderer.context}else this.renderType=n.WEBGL,this.renderer=new PIXI.WebGLRenderer(this.width,this.height,{view:this.canvas,transparent:this.transparent,resolution:this.resolution,antialias:this.antialias,preserveDrawingBuffer:this.preserveDrawingBuffer}),this.context=null;this.renderType!==n.HEADLESS&&(this.stage.smoothed=this.antialias,n.Canvas.addToDOM(this.canvas,this.parent,!1),n.Canvas.setTouchAction(this.canvas))},update:function(e){if(this.time.update(e),this._kickstart)return this.updateLogic(1/this.time.desiredFps),this.stage.updateTransform(),this.updateRender(this.time.slowMotion*this.time.desiredFps),void (this._kickstart=!1);if(this._spiraling>1&&!this.forceSingleUpdate)this.time.time>this._nextFpsNotification&&(this._nextFpsNotification=this.time.time+1e4,this.fpsProblemNotifier.dispatch()),this._deltaTime=0,this._spiraling=0,this.updateRender(this.time.slowMotion*this.time.desiredFps);else{var t=1e3*this.time.slowMotion/this.time.desiredFps;this._deltaTime+=Math.max(Math.min(3*t,this.time.elapsed),0);var n=0;for(this.updatesThisFrame=Math.floor(this._deltaTime/t),this.forceSingleUpdate&&(this.updatesThisFrame=Math.min(1,this.updatesThisFrame));this._deltaTime>=t&&(this._deltaTime-=t,this.currentUpdateID=n,this.updateLogic(1/this.time.desiredFps),this.stage.updateTransform(),n++,!this.forceSingleUpdate||1!==n););n>this._lastCount?this._spiraling++:n<this._lastCount&&(this._spiraling=0),this._lastCount=n,this.updateRender(this._deltaTime/t)}},updateLogic:function(e){this._paused||this.pendingStep?(this.scale.pauseUpdate(),this.state.pauseUpdate(),this.debug.preUpdate()):(this.stepping&&(this.pendingStep=!0),this.scale.preUpdate(),this.debug.preUpdate(),this.world.camera.preUpdate(),this.physics.preUpdate(),this.state.preUpdate(e),this.plugins.preUpdate(e),this.stage.preUpdate(),this.state.update(),this.stage.update(),this.tweens.update(e),this.sound.update(),this.input.update(),this.physics.update(),this.particles.update(),this.plugins.update(),this.stage.postUpdate(),this.plugins.postUpdate())},updateRender:function(e){this.lockRender||(this.state.preRender(e),this.renderer.render(this.stage),this.plugins.render(e),this.state.render(e),this.plugins.postRender(e))},enableStep:function(){this.stepping=!0,this.pendingStep=!1,this.stepCount=0},disableStep:function(){this.stepping=!1,this.pendingStep=!1},step:function(){this.pendingStep=!1,this.stepCount++},destroy:function(){this.raf.stop(),this.state.destroy(),this.sound.destroy(),this.scale.destroy(),this.stage.destroy(),this.input.destroy(),this.physics.destroy(),this.state=null,this.cache=null,this.input=null,this.load=null,this.sound=null,this.stage=null,this.time=null,this.world=null,this.isBooted=!1,this.renderer.destroy(!1),n.Canvas.removeFromDOM(this.canvas),n.GAMES[this.id]=null},gamePaused:function(e){this._paused||(this._paused=!0,this.time.gamePaused(),this.sound.setMute(),this.onPause.dispatch(e))},gameResumed:function(e){this._paused&&!this._codePaused&&(this._paused=!1,this.time.gameResumed(),this.input.reset(),this.sound.unsetMute(),this.onResume.dispatch(e))},focusLoss:function(e){this.onBlur.dispatch(e),this.stage.disableVisibilityChange||this.gamePaused(e)},focusGain:function(e){this.onFocus.dispatch(e),this.stage.disableVisibilityChange||this.gameResumed(e)}},n.Game.prototype.constructor=n.Game,Object.defineProperty(n.Game.prototype,"paused",{get:function(){return this._paused},set:function(e){e===!0?(this._paused===!1&&(this._paused=!0,this.sound.setMute(),this.time.gamePaused(),this.onPause.dispatch(this)),this._codePaused=!0):(this._paused&&(this._paused=!1,this.input.reset(),this.sound.unsetMute(),this.time.gameResumed(),this.onResume.dispatch(this)),this._codePaused=!1)}}),n.Input=function(e){this.game=e,this.hitCanvas=null,this.hitContext=null,this.moveCallbacks=[],this.moveCallback=null,this.moveCallbackContext=this,this.pollRate=0,this.enabled=!0,this.multiInputOverride=n.Input.MOUSE_TOUCH_COMBINE,this.position=null,this.speed=null,this.circle=null,this.scale=null,this.maxPointers=-1,this.currentPointers=0,this.tapRate=200,this.doubleTapRate=300,this.holdRate=2e3,this.justPressedRate=200,this.justReleasedRate=200,this.recordPointerHistory=!1,this.recordRate=100,this.recordLimit=100,this.pointer1=null,this.pointer2=null,this.pointer3=null,this.pointer4=null,this.pointer5=null,this.pointer6=null,this.pointer7=null,this.pointer8=null,this.pointer9=null,this.pointer10=null,this.pointers=[],this.activePointer=null,this.mousePointer=null,this.mouse=null,this.keyboard=null,this.touch=null,this.mspointer=null,this.gamepad=null,this.resetLocked=!1,this.onDown=null,this.onUp=null,this.onTap=null,this.onHold=null,this.minPriorityID=0,this.interactiveItems=new n.ArraySet,this._localPoint=new n.Point,this._pollCounter=0,this._oldPosition=null,this._x=0,this._y=0},n.Input.MOUSE_OVERRIDES_TOUCH=0,n.Input.TOUCH_OVERRIDES_MOUSE=1,n.Input.MOUSE_TOUCH_COMBINE=2,n.Input.MAX_POINTERS=10,n.Input.prototype={boot:function(){this.mousePointer=new n.Pointer(this.game,0),this.addPointer(),this.addPointer(),this.mouse=new n.Mouse(this.game),this.touch=new n.Touch(this.game),this.mspointer=new n.MSPointer(this.game),n.Keyboard&&(this.keyboard=new n.Keyboard(this.game)),n.Gamepad&&(this.gamepad=new n.Gamepad(this.game)),this.onDown=new n.Signal,this.onUp=new n.Signal,this.onTap=new n.Signal,this.onHold=new n.Signal,this.scale=new n.Point(1,1),this.speed=new n.Point,this.position=new n.Point,this._oldPosition=new n.Point,this.circle=new n.Circle(0,0,44),this.activePointer=this.mousePointer,this.currentPointers=0,this.hitCanvas=document.createElement("canvas"),this.hitCanvas.width=1,this.hitCanvas.height=1,this.hitContext=this.hitCanvas.getContext("2d"),this.mouse.start(),this.touch.start(),this.mspointer.start(),this.mousePointer.active=!0,this.keyboard&&this.keyboard.start();var e=this;this._onClickTrampoline=function(t){e.onClickTrampoline(t)},this.game.canvas.addEventListener("click",this._onClickTrampoline,!1)},destroy:function(){this.mouse.stop(),this.touch.stop(),this.mspointer.stop(),this.keyboard&&this.keyboard.stop(),this.gamepad&&this.gamepad.stop(),this.moveCallbacks=[],this.game.canvas.removeEventListener("click",this._onClickTrampoline)},addMoveCallback:function(e,t){return this.moveCallbacks.push({callback:e,context:t})-1},deleteMoveCallback:function(e){this.moveCallbacks[e]&&this.moveCallbacks.splice(e,1)},addPointer:function(){if(this.pointers.length>=n.Input.MAX_POINTERS)return console.warn("Phaser.Input.addPointer: only "+n.Input.MAX_POINTERS+" pointer allowed"),null;var e=this.pointers.length+1,t=new n.Pointer(this.game,e);return this.pointers.push(t),this["pointer"+e]=t,t},update:function(){if(this.keyboard&&this.keyboard.update(),this.pollRate>0&&this._pollCounter<this.pollRate)return void (this._pollCounter++);this.speed.x=this.position.x-this._oldPosition.x,this.speed.y=this.position.y-this._oldPosition.y,this._oldPosition.copyFrom(this.position),this.mousePointer.update(),this.gamepad&&this.gamepad.active&&this.gamepad.update();for(var e=0;e<this.pointers.length;e++)this.pointers[e].update();this._pollCounter=0},reset:function(e){if(this.game.isBooted&&!this.resetLocked){"undefined"==typeof e&&(e=!1),this.mousePointer.reset(),this.keyboard&&this.keyboard.reset(e),this.gamepad&&this.gamepad.reset();for(var t=0;t<this.pointers.length;t++)this.pointers[t].reset();this.currentPointers=0,"none"!==this.game.canvas.style.cursor&&(this.game.canvas.style.cursor="inherit"),e&&(this.onDown.dispose(),this.onUp.dispose(),this.onTap.dispose(),this.onHold.dispose(),this.onDown=new n.Signal,this.onUp=new n.Signal,this.onTap=new n.Signal,this.onHold=new n.Signal,this.moveCallbacks=[]),this._pollCounter=0}},resetSpeed:function(e,t){this._oldPosition.setTo(e,t),this.speed.setTo(0,0)},startPointer:function(e){if(this.maxPointers>=0&&this.countActivePointers(this.maxPointers)>=this.maxPointers)return null;if(!this.pointer1.active)return this.pointer1.start(e);if(!this.pointer2.active)return this.pointer2.start(e);for(var t=2;t<this.pointers.length;t++){var n=this.pointers[t];if(!n.active)return n.start(e)}return null},updatePointer:function(e){if(this.pointer1.active&&this.pointer1.identifier===e.identifier)return this.pointer1.move(e);if(this.pointer2.active&&this.pointer2.identifier===e.identifier)return this.pointer2.move(e);for(var t=2;t<this.pointers.length;t++){var n=this.pointers[t];if(n.active&&n.identifier===e.identifier)return n.move(e)}return null},stopPointer:function(e){if(this.pointer1.active&&this.pointer1.identifier===e.identifier)return this.pointer1.stop(e);if(this.pointer2.active&&this.pointer2.identifier===e.identifier)return this.pointer2.stop(e);for(var t=2;t<this.pointers.length;t++){var n=this.pointers[t];if(n.active&&n.identifier===e.identifier)return n.stop(e)}return null},countActivePointers:function(e){"undefined"==typeof e&&(e=this.pointers.length);for(var t=e,n=0;n<this.pointers.length&&t>0;n++){var r=this.pointers[n];r.active&&t--}return this.currentPointers=e-t,e-t},getPointer:function(e){"undefined"==typeof e&&(e=!1);for(var t=0;t<this.pointers.length;t++){var n=this.pointers[t];if(n.active===e)return n}return null},getPointerFromIdentifier:function(e){for(var t=0;t<this.pointers.length;t++){var n=this.pointers[t];if(n.identifier===e)return n}return null},getPointerFromId:function(e){for(var t=0;t<this.pointers.length;t++){var n=this.pointers[t];if(n.pointerId===e)return n}return null},getLocalPosition:function(e,t,r){"undefined"==typeof r&&(r=new n.Point);var i=e.worldTransform,s=1/(i.a*i.d+i.c*-i.b);return r.setTo(i.d*s*t.x+ -i.c*s*t.y+(i.ty*i.c-i.tx*i.d)*s,i.a*s*t.y+ -i.b*s*t.x+(-i.ty*i.a+i.tx*i.b)*s)},hitTest:function(e,t,r){if(!e.worldVisible)return!1;if(this.getLocalPosition(e,t,this._localPoint),r.copyFrom(this._localPoint),e.hitArea&&e.hitArea.contains)return e.hitArea.contains(this._localPoint.x,this._localPoint.y);if(e instanceof n.TileSprite){var i=e.width,s=e.height,o=-i*e.anchor.x;if(this._localPoint.x>=o&&this._localPoint.x<o+i){var u=-s*e.anchor.y;if(this._localPoint.y>=u&&this._localPoint.y<u+s)return!0}}else if(e instanceof PIXI.Sprite){var i=e.texture.frame.width,s=e.texture.frame.height,o=-i*e.anchor.x;if(this._localPoint.x>=o&&this._localPoint.x<o+i){var u=-s*e.anchor.y;if(this._localPoint.y>=u&&this._localPoint.y<u+s)return!0}}else if(e instanceof n.Graphics)for(var a=0;a<e.graphicsData.length;a++){var f=e.graphicsData[a];if(f.fill&&f.shape&&f.shape.contains(this._localPoint.x,this._localPoint.y))return!0}for(var a=0,l=e.children.length;l>a;a++)if(this.hitTest(e.children[a],t,r))return!0;return!1},onClickTrampoline:function(){this.activePointer.processClickTrampolines()}},n.Input.prototype.constructor=n.Input,Object.defineProperty(n.Input.prototype,"x",{get:function(){return this._x},set:function(e){this._x=Math.floor(e)}}),Object.defineProperty(n.Input.prototype,"y",{get:function(){return this._y},set:function(e){this._y=Math.floor(e)}}),Object.defineProperty(n.Input.prototype,"pollLocked",{get:function(){return this.pollRate>0&&this._pollCounter<this.pollRate}}),Object.defineProperty(n.Input.prototype,"totalInactivePointers",{get:function(){return this.pointers.length-this.countActivePointers()}}),Object.defineProperty(n.Input.prototype,"totalActivePointers",{get:function(){return this.countActivePointers()}}),Object.defineProperty(n.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}}),Object.defineProperty(n.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}}),Object.defineProperty(n.Input.prototype,"disabled",{get:function(){return!this.enabled},set:function(e){this.enabled=!e}}),n.Mouse=function(e){this.game=e,this.callbackContext=this.game,this.mouseDownCallback=null,this.mouseMoveCallback=null,this.mouseUpCallback=null,this.mouseOutCallback=null,this.mouseOverCallback=null,this.mouseWheelCallback=null,this.capture=!1,this.button=-1,this.wheelDelta=0,this.enabled=!0,this.locked=!1,this.stopOnGameOut=!1,this.pointerLock=new n.Signal,this.event=null,this._onMouseDown=null,this._onMouseMove=null,this._onMouseUp=null,this._onMouseOut=null,this._onMouseOver=null,this._onMouseWheel=null,this._wheelEvent=null},n.Mouse.NO_BUTTON=-1,n.Mouse.LEFT_BUTTON=0,n.Mouse.MIDDLE_BUTTON=1,n.Mouse.RIGHT_BUTTON=2,n.Mouse.WHEEL_UP=1,n.Mouse.WHEEL_DOWN=-1,n.Mouse.prototype={start:function(){if((!this.game.device.android||this.game.device.chrome!==!1)&&null===this._onMouseDown){var t=this;this._onMouseDown=function(e){return t.onMouseDown(e)},this._onMouseMove=function(e){return t.onMouseMove(e)},this._onMouseUp=function(e){return t.onMouseUp(e)},this._onMouseUpGlobal=function(e){return t.onMouseUpGlobal(e)},this._onMouseOut=function(e){return t.onMouseOut(e)},this._onMouseOver=function(e){return t.onMouseOver(e)},this._onMouseWheel=function(e){return t.onMouseWheel(e)},this.game.canvas.addEventListener("mousedown",this._onMouseDown,!0),this.game.canvas.addEventListener("mousemove",this._onMouseMove,!0),this.game.canvas.addEventListener("mouseup",this._onMouseUp,!0),this.game.device.cocoonJS||(window.addEventListener("mouseup",this._onMouseUpGlobal,!0),this.game.canvas.addEventListener("mouseover",this._onMouseOver,!0),this.game.canvas.addEventListener("mouseout",this._onMouseOut,!0));var n=this.game.device.wheelEvent;n&&(this.game.canvas.addEventListener(n,this._onMouseWheel,!0),"mousewheel"===n?this._wheelEvent=new e(-1/40,1):"DOMMouseScroll"===n&&(this._wheelEvent=new e(1,1)))}},onMouseDown:function(e){this.event=e,this.capture&&e.preventDefault(),this.button=e.button,this.mouseDownCallback&&this.mouseDownCallback.call(this.callbackContext,e),this.game.input.enabled&&this.enabled&&(e.identifier=0,this.game.input.mousePointer.start(e))},onMouseMove:function(e){this.event=e,this.capture&&e.preventDefault(),this.mouseMoveCallback&&this.mouseMoveCallback.call(this.callbackContext,e),this.game.input.enabled&&this.enabled&&(e.identifier=0,this.game.input.mousePointer.move(e))},onMouseUp:function(e){this.event=e,this.capture&&e.preventDefault(),this.button=n.Mouse.NO_BUTTON,this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,e),this.game.input.enabled&&this.enabled&&(e.identifier=0,this.game.input.mousePointer.stop(e))},onMouseUpGlobal:function(e){this.game.input.mousePointer.withinGame||(this.button=n.Mouse.NO_BUTTON,this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,e),e.identifier=0,this.game.input.mousePointer.stop(e))},onMouseOut:function(e){this.event=e,this.capture&&e.preventDefault(),this.game.input.mousePointer.withinGame=!1,this.mouseOutCallback&&this.mouseOutCallback.call(this.callbackContext,e),this.game.input.enabled&&this.enabled&&this.stopOnGameOut&&(e.identifier=0,this.game.input.mousePointer.stop(e))},onMouseWheel:function(e){this._wheelEvent&&(e=this._wheelEvent.bindEvent(e)),this.event=e,this.capture&&e.preventDefault(),this.wheelDelta=n.Math.clamp(-e.deltaY,-1,1),this.mouseWheelCallback&&this.mouseWheelCallback.call(this.callbackContext,e)},onMouseOver:function(e){this.event=e,this.capture&&e.preventDefault(),this.game.input.mousePointer.withinGame=!0,this.mouseOverCallback&&this.mouseOverCallback.call(this.callbackContext,e),!this.game.input.enabled||!this.enabled},requestPointerLock:function(){if(this.game.device.pointerLock){var e=this.game.canvas;e.requestPointerLock=e.requestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,e.requestPointerLock();var t=this;this._pointerLockChange=function(e){return t.pointerLockChange(e)},document.addEventListener("pointerlockchange",this._pointerLockChange,!0),document.addEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.addEventListener("webkitpointerlockchange",this._pointerLockChange,!0)}},pointerLockChange:function(e){var t=this.game.canvas;document.pointerLockElement===t||document.mozPointerLockElement===t||document.webkitPointerLockElement===t?(this.locked=!0,this.pointerLock.dispatch(!0,e)):(this.locked=!1,this.pointerLock.dispatch(!1,e))},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock(),document.removeEventListener("pointerlockchange",this._pointerLockChange,!0),document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)},stop:function(){this.game.canvas.removeEventListener("mousedown",this._onMouseDown,!0),this.game.canvas.removeEventListener("mousemove",this._onMouseMove,!0),this.game.canvas.removeEventListener("mouseup",this._onMouseUp,!0),this.game.canvas.removeEventListener("mouseover",this._onMouseOver,!0),this.game.canvas.removeEventListener("mouseout",this._onMouseOut,!0);var e=this.game.device.wheelEvent;e&&this.game.canvas.removeEventListener(e,this._onMouseWheel,!0),window.removeEventListener("mouseup",this._onMouseUpGlobal,!0),document.removeEventListener("pointerlockchange",this._pointerLockChange,!0),document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)}},n.Mouse.prototype.constructor=n.Mouse,Object.defineProperty(n.Mouse.prototype,"disabled",{get:function(){return!this.enabled},set:function(e){this.enabled=!e}}),e.prototype={},e.prototype.constructor=e,e.prototype.bindEvent=function(t){if(!e._stubsGenerated&&t){var n=function(e){return function(){var t=this.originalEvent[e];return"function"!=typeof t?t:t.bind(this.originalEvent)}};for(var r in t)r in e.prototype||Object.defineProperty(e.prototype,r,{get:n(r)});e._stubsGenerated=!0}return this.originalEvent=t,this},Object.defineProperties(e.prototype,{type:{value:"wheel"},deltaMode:{get:function(){return this._deltaMode}},deltaY:{get:function(){return this._scaleFactor*(this.originalEvent.wheelDelta||this.originalEvent.detail)||0}},deltaX:{get:function(){return this._scaleFactor*this.originalEvent.wheelDeltaX||0}},deltaZ:{value:0}}),n.MSPointer=function(e){this.game=e,this.callbackContext=this.game,this.pointerDownCallback=null,this.pointerMoveCallback=null,this.pointerUpCallback=null,this.capture=!0,this.button=-1,this.event=null,this.enabled=!0,this._onMSPointerDown=null,this._onMSPointerMove=null,this._onMSPointerUp=null},n.MSPointer.prototype={start:function(){if(null===this._onMSPointerDown){var e=this;this.game.device.mspointer&&(this._onMSPointerDown=function(t){return e.onPointerDown(t)},this._onMSPointerMove=function(t){return e.onPointerMove(t)},this._onMSPointerUp=function(t){return e.onPointerUp(t)},this.game.canvas.addEventListener("MSPointerDown",this._onMSPointerDown,!1),this.game.canvas.addEventListener("MSPointerMove",this._onMSPointerMove,!1),this.game.canvas.addEventListener("MSPointerUp",this._onMSPointerUp,!1),this.game.canvas.addEventListener("pointerDown",this._onMSPointerDown,!1),this.game.canvas.addEventListener("pointerMove",this._onMSPointerMove,!1),this.game.canvas.addEventListener("pointerUp",this._onMSPointerUp,!1),this.game.canvas.style["-ms-content-zooming"]="none",this.game.canvas.style["-ms-touch-action"]="none")}},onPointerDown:function(e){this.event=e,this.capture&&e.preventDefault(),this.button=e.button,this.pointerDownCallback&&this.pointerDownCallback.call(this.callbackContext,e),this.game.input.enabled&&this.enabled&&(e.identifier=e.pointerId,this.game.input.startPointer(e))},onPointerMove:function(e){this.event=e,this.capture&&e.preventDefault(),this.pointerMoveCallback&&this.pointerMoveCallback.call(this.callbackContext,e),this.game.input.enabled&&this.enabled&&(e.identifier=e.pointerId,this.game.input.updatePointer(e))},onPointerUp:function(e){this.event=e,this.capture&&e.preventDefault(),this.button=n.Mouse.NO_BUTTON,this.pointerUpCallback&&this.pointerUpCallback.call(this.callbackContext,e),this.game.input.enabled&&this.enabled&&(e.identifier=e.pointerId,this.game.input.stopPointer(e))},stop:function(){this.game.canvas.removeEventListener("MSPointerDown",this._onMSPointerDown),this.game.canvas.removeEventListener("MSPointerMove",this._onMSPointerMove),this.game.canvas.removeEventListener("MSPointerUp",this._onMSPointerUp),this.game.canvas.removeEventListener("pointerDown",this._onMSPointerDown),this.game.canvas.removeEventListener("pointerMove",this._onMSPointerMove),this.game.canvas.removeEventListener("pointerUp",this._onMSPointerUp)}},n.MSPointer.prototype.constructor=n.MSPointer,Object.defineProperty(n.MSPointer.prototype,"disabled",{get:function(){return!this.enabled},set:function(e){this.enabled=!e}}),n.Pointer=function(e,t){this.game=e,this.id=t,this.type=n.POINTER,this.exists=!0,this.identifier=0,this.pointerId=null,this.target=null,this.button=null,this._holdSent=!1,this._history=[],this._nextDrop=0,this._stateReset=!1,this.withinGame=!1,this.clientX=-1,this.clientY=-1,this.pageX=-1,this.pageY=-1,this.screenX=-1,this.screenY=-1,this.rawMovementX=0,this.rawMovementY=0,this.movementX=0,this.movementY=0,this.x=-1,this.y=-1,this.isMouse=!1,this.isDown=!1,this.isUp=!0,this.timeDown=0,this.timeUp=0,this.previousTapTime=0,this.totalTouches=0,this.msSinceLastClick=Number.MAX_VALUE,this.targetObject=null,this.active=!1,this.dirty=!1,this.position=new n.Point,this.positionDown=new n.Point,this.positionUp=new n.Point,this.circle=new n.Circle(0,0,44),0===t&&(this.isMouse=!0),this._clickTrampolines=null,this._trampolineTargetObject=null},n.Pointer.prototype={start:function(e){return e.pointerId&&(this.pointerId=e.pointerId),this.identifier=e.identifier,this.target=e.target,"undefined"!=typeof e.button&&(this.button=e.button),this._history=[],this.active=!0,this.withinGame=!0,this.isDown=!0,this.isUp=!1,this.dirty=!1,this._clickTrampolines=null,this._trampolineTargetObject=null,this.msSinceLastClick=this.game.time.time-this.timeDown,this.timeDown=this.game.time.time,this._holdSent=!1,this.move(e,!0),this.positionDown.setTo(this.x,this.y),(this.game.input.multiInputOverride===n.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===n.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===n.Input.TOUCH_OVERRIDES_MOUSE&&0===this.game.input.currentPointers)&&(this.game.input.x=this.x,this.game.input.y=this.y,this.game.input.position.setTo(this.x,this.y),this.game.input.onDown.dispatch(this,e),this.game.input.resetSpeed(this.x,this.y)),this._stateReset=!1,this.totalTouches++,this.isMouse||this.game.input.currentPointers++,null!==this.targetObject&&this.targetObject._touchedHandler(this),this},update:function(){this.active&&(this.dirty&&(this.game.input.interactiveItems.total>0&&this.processInteractiveObjects(!1),this.dirty=!1),this._holdSent===!1&&this.duration>=this.game.input.holdRate&&((this.game.input.multiInputOverride==n.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride==n.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride==n.Input.TOUCH_OVERRIDES_MOUSE&&0===this.game.input.currentPointers)&&this.game.input.onHold.dispatch(this),this._holdSent=!0),this.game.input.recordPointerHistory&&this.game.time.time>=this._nextDrop&&(this._nextDrop=this.game.time.time+this.game.input.recordRate,this._history.push({x:this.position.x,y:this.position.y}),this._history.length>this.game.input.recordLimit&&this._history.shift()))},move:function(e,t){if(!this.game.input.pollLocked){if("undefined"==typeof t&&(t=!1),"undefined"!=typeof e.button&&(this.button=e.button),this.clientX=e.clientX,this.clientY=e.clientY,this.pageX=e.pageX,this.pageY=e.pageY,this.screenX=e.screenX,this.screenY=e.screenY,this.isMouse&&this.game.input.mouse.locked&&!t&&(this.rawMovementX=e.movementX||e.mozMovementX||e.webkitMovementX||0,this.rawMovementY=e.movementY||e.mozMovementY||e.webkitMovementY||0,this.movementX+=this.rawMovementX,this.movementY+=this.rawMovementY),this.x=(this.pageX-this.game.scale.offset.x)*this.game.input.scale.x,this.y=(this.pageY-this.game.scale.offset.y)*this.game.input.scale.y,this.position.setTo(this.x,this.y),this.circle.x=this.x,this.circle.y=this.y,(this.game.input.multiInputOverride===n.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===n.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===n.Input.TOUCH_OVERRIDES_MOUSE&&0===this.game.input.currentPointers)&&(this.game.input.activePointer=this,this.game.input.x=this.x,this.game.input.y=this.y,this.game.input.position.setTo(this.game.input.x,this.game.input.y),this.game.input.circle.x=this.game.input.x,this.game.input.circle.y=this.game.input.y),this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY),this.game.paused)return this;for(var r=this.game.input.moveCallbacks.length;r--;)this.game.input.moveCallbacks[r].callback.call(this.game.input.moveCallbacks[r].context,this,this.x,this.y,t);return null!==this.targetObject&&this.targetObject.isDragged===!0?this.targetObject.update(this)===!1&&(this.targetObject=null):this.game.input.interactiveItems.total>0&&this.processInteractiveObjects(t),this}},processInteractiveObjects:function(e){for(var t=Number.MAX_VALUE,n=-1,r=null,i=this.game.input.interactiveItems.first;i;)i.checked=!1,i.validForInput(n,t,!1)&&(i.checked=!0,(e&&i.checkPointerDown(this,!0)||!e&&i.checkPointerOver(this,!0))&&(t=i.sprite.renderOrderID,n=i.priorityID,r=i)),i=this.game.input.interactiveItems.next;for(var i=this.game.input.interactiveItems.first;i;)!i.checked&&i.validForInput(n,t,!0)&&(e&&i.checkPointerDown(this,!1)||!e&&i.checkPointerOver(this,!1))&&(t=i.sprite.renderOrderID,n=i.priorityID,r=i),i=this.game.input.interactiveItems.next;return null===r?this.targetObject&&(this.targetObject._pointerOutHandler(this),this.targetObject=null):null===this.targetObject?(this.targetObject=r,r._pointerOverHandler(this)):this.targetObject===r?r.update(this)===!1&&(this.targetObject=null):(this.targetObject._pointerOutHandler(this),this.targetObject=r,this.targetObject._pointerOverHandler(this)),null!==this.targetObject},leave:function(e){this.withinGame=!1,this.move(e,!1)},stop:function(e){return this._stateReset&&this.withinGame?void e.preventDefault():(this.timeUp=this.game.time.time,(this.game.input.multiInputOverride===n.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===n.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===n.Input.TOUCH_OVERRIDES_MOUSE&&0===this.game.input.currentPointers)&&(this.game.input.onUp.dispatch(this,e),this.duration>=0&&this.duration<=this.game.input.tapRate&&(this.timeUp-this.previousTapTime<this.game.input.doubleTapRate?this.game.input.onTap.dispatch(this,!0):this.game.input.onTap.dispatch(this,!1),this.previousTapTime=this.timeUp)),this.id>0&&(this.active=!1),this.withinGame=!1,this.isDown=!1,this.isUp=!0,this.pointerId=null,this.identifier=null,this.positionUp.setTo(this.x,this.y),this.isMouse===!1&&this.game.input.currentPointers--,this.game.input.interactiveItems.callAll("_releasedHandler",this),this._clickTrampolines&&(this._trampolineTargetObject=this.targetObject),this.targetObject=null,this)},justPressed:function(e){return e=e||this.game.input.justPressedRate,this.isDown===!0&&this.timeDown+e>this.game.time.time},justReleased:function(e){return e=e||this.game.input.justReleasedRate,this.isUp===!0&&this.timeUp+e>this.game.time.time},addClickTrampoline:function(e,t,n,r){if(this.isDown){for(var i=this._clickTrampolines=this._clickTrampolines||[],s=0;s<i.length;s++)if(i[s].name===e){i.splice(s,1);break}i.push({name:e,targetObject:this.targetObject,callback:t,callbackContext:n,callbackArgs:r})}},processClickTrampolines:function(){var e=this._clickTrampolines;if(e){for(var t=0;t<e.length;t++){var n=e[t];n.targetObject===this._trampolineTargetObject&&n.callback.apply(n.callbackContext,n.callbackArgs)}this._clickTrampolines=null,this._trampolineTargetObject=null}},reset:function(){this.isMouse===!1&&(this.active=!1),this.pointerId=null,this.identifier=null,this.dirty=!1,this.isDown=!1,this.isUp=!0,this.totalTouches=0,this._holdSent=!1,this._history.length=0,this._stateReset=!0,this.targetObject&&this.targetObject._releasedHandler(this),this.targetObject=null},resetMovement:function(){this.movementX=0,this.movementY=0}},n.Pointer.prototype.constructor=n.Pointer,Object.defineProperty(n.Pointer.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.time-this.timeDown}}),Object.defineProperty(n.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}}),Object.defineProperty(n.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}}),n.Touch=function(e){this.game=e,this.enabled=!0,this.callbackContext=this.game,this.touchStartCallback=null,this.touchMoveCallback=null,this.touchEndCallback=null,this.touchEnterCallback=null,this.touchLeaveCallback=null,this.touchCancelCallback=null,this.preventDefault=!0,this.event=null,this._onTouchStart=null,this._onTouchMove=null,this._onTouchEnd=null,this._onTouchEnter=null,this._onTouchLeave=null,this._onTouchCancel=null,this._onTouchMove=null},n.Touch.prototype={start:function(){if(null===this._onTouchStart){var e=this;this.game.device.touch&&(this._onTouchStart=function(t){return e.onTouchStart(t)},this._onTouchMove=function(t){return e.onTouchMove(t)},this._onTouchEnd=function(t){return e.onTouchEnd(t)},this._onTouchEnter=function(t){return e.onTouchEnter(t)},this._onTouchLeave=function(t){return e.onTouchLeave(t)},this._onTouchCancel=function(t){return e.onTouchCancel(t)},this.game.canvas.addEventListener("touchstart",this._onTouchStart,!1),this.game.canvas.addEventListener("touchmove",this._onTouchMove,!1),this.game.canvas.addEventListener("touchend",this._onTouchEnd,!1),this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,!1),this.game.device.cocoonJS||(this.game.canvas.addEventListener("touchenter",this._onTouchEnter,!1),this.game.canvas.addEventListener("touchleave",this._onTouchLeave,!1)))}},consumeDocumentTouches:function(){this._documentTouchMove=function(e){e.preventDefault()},document.addEventListener("touchmove",this._documentTouchMove,!1)},onTouchStart:function(e){if(this.event=e,this.touchStartCallback&&this.touchStartCallback.call(this.callbackContext,e),this.game.input.enabled&&this.enabled){this.preventDefault&&e.preventDefault();for(var t=0;t<e.changedTouches.length;t++)this.game.input.startPointer(e.changedTouches[t])}},onTouchCancel:function(e){if(this.event=e,this.touchCancelCallback&&this.touchCancelCallback.call(this.callbackContext,e),this.game.input.enabled&&this.enabled){this.preventDefault&&e.preventDefault();for(var t=0;t<e.changedTouches.length;t++)this.game.input.stopPointer(e.changedTouches[t])}},onTouchEnter:function(e){this.event=e,this.touchEnterCallback&&this.touchEnterCallback.call(this.callbackContext,e),this.game.input.enabled&&this.enabled&&this.preventDefault&&e.preventDefault()},onTouchLeave:function(e){this.event=e,this.touchLeaveCallback&&this.touchLeaveCallback.call(this.callbackContext,e),this.preventDefault&&e.preventDefault()},onTouchMove:function(e){this.event=e,this.touchMoveCallback&&this.touchMoveCallback.call(this.callbackContext,e),this.preventDefault&&e.preventDefault();for(var t=0;t<e.changedTouches.length;t++)this.game.input.updatePointer(e.changedTouches[t])},onTouchEnd:function(e){this.event=e,this.touchEndCallback&&this.touchEndCallback.call(this.callbackContext,e),this.preventDefault&&e.preventDefault();for(var t=0;t<e.changedTouches.length;t++)this.game.input.stopPointer(e.changedTouches[t])},stop:function(){this.game.device.touch&&(this.game.canvas.removeEventListener("touchstart",this._onTouchStart),this.game.canvas.removeEventListener("touchmove",this._onTouchMove),this.game.canvas.removeEventListener("touchend",this._onTouchEnd),this.game.canvas.removeEventListener("touchenter",this._onTouchEnter),this.game.canvas.removeEventListener("touchleave",this._onTouchLeave),this.game.canvas.removeEventListener("touchcancel",this._onTouchCancel))}},n.Touch.prototype.constructor=n.Touch,Object.defineProperty(n.Touch.prototype,"disabled",{get:function(){return!this.enabled},set:function(e){this.enabled=!e}}),n.InputHandler=function(e){this.sprite=e,this.game=e.game,this.enabled=!1,this.checked=!1,this.priorityID=0,this.useHandCursor=!1,this._setHandCursor=!1,this.isDragged=!1,this.allowHorizontalDrag=!0,this.allowVerticalDrag=!0,this.bringToTop=!1,this.snapOffset=null,this.snapOnDrag=!1,this.snapOnRelease=!1,this.snapX=0,this.snapY=0,this.snapOffsetX=0,this.snapOffsetY=0,this.pixelPerfectOver=!1,this.pixelPerfectClick=!1,this.pixelPerfectAlpha=255,this.draggable=!1,this.boundsRect=null,this.boundsSprite=null,this.consumePointerEvent=!1,this.scaleLayer=!1,this.dragOffset=new n.Point,this.dragFromCenter=!1,this.dragStartPoint=new n.Point,this._dragPoint=new n.Point,this._dragPhase=!1,this._wasEnabled=!1,this._tempPoint=new n.Point,this._pointerData=[],this._pointerData.push({id:0,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1})},n.InputHandler.prototype={start:function(e,t){if(e=e||0,"undefined"==typeof t&&(t=!1),this.enabled===!1){this.game.input.interactiveItems.add(this),this.useHandCursor=t,this.priorityID=e;for(var r=0;10>r;r++)this._pointerData[r]={id:r,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1};this.snapOffset=new n.Point,this.enabled=!0,this._wasEnabled=!0}return this.sprite.events.onAddedToGroup.add(this.addedToGroup,this),this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this),this.flagged=!1,this.sprite},addedToGroup:function(){this._dragPhase||this._wasEnabled&&!this.enabled&&this.start()},removedFromGroup:function(){this._dragPhase||(this.enabled?(this._wasEnabled=!0,this.stop()):this._wasEnabled=!1)},reset:function(){this.enabled=!1,this.flagged=!1;for(var e=0;10>e;e++)this._pointerData[e]={id:e,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1}},stop:function(){this.enabled!==!1&&(this.enabled=!1,this.game.input.interactiveItems.remove(this))},destroy:function(){this.sprite&&(this._setHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),this.enabled=!1,this.game.input.interactiveItems.remove(this),this._pointerData.length=0,this.boundsRect=null,this.boundsSprite=null,this.sprite=null)},validForInput:function(e,t,n){return"undefined"==typeof n&&(n=!0),0===this.sprite.scale.x||0===this.sprite.scale.y||this.priorityID<this.game.input.minPriorityID?!1:(n||!this.pixelPerfectClick&&!this.pixelPerfectOver)&&(this.priorityID>e||this.priorityID===e&&this.sprite.renderOrderID<t)?!0:!1},isPixelPerfect:function(){return this.pixelPerfectClick||this.pixelPerfectOver},pointerX:function(e){return e=e||0,this._pointerData[e].x},pointerY:function(e){return e=e||0,this._pointerData[e].y},pointerDown:function(e){return e=e||0,this._pointerData[e].isDown},pointerUp:function(e){return e=e||0,this._pointerData[e].isUp},pointerTimeDown:function(e){return e=e||0,this._pointerData[e].timeDown},pointerTimeUp:function(e){return e=e||0,this._pointerData[e].timeUp},pointerOver:function(e){if(this.enabled){if("undefined"!=typeof e)return this._pointerData[e].isOver;for(var t=0;10>t;t++)if(this._pointerData[t].isOver)return!0}return!1},pointerOut:function(e){if(this.enabled){if("undefined"!=typeof e)return this._pointerData[e].isOut;for(var t=0;10>t;t++)if(this._pointerData[t].isOut)return!0}return!1},pointerTimeOver:function(e){return e=e||0,this._pointerData[e].timeOver},pointerTimeOut:function(e){return e=e||0,this._pointerData[e].timeOut},pointerDragged:function(e){return e=e||0,this._pointerData[e].isDragged},checkPointerDown:function(e,t){return e.isDown&&this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&this.game.input.hitTest(this.sprite,e,this._tempPoint)?("undefined"==typeof t&&(t=!1),!t&&this.pixelPerfectClick?this.checkPixel(this._tempPoint.x,this._tempPoint.y):!0):!1},checkPointerOver:function(e,t){return this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&this.game.input.hitTest(this.sprite,e,this._tempPoint)?("undefined"==typeof t&&(t=!1),!t&&this.pixelPerfectOver?this.checkPixel(this._tempPoint.x,this._tempPoint.y):!0):!1},checkPixel:function(e,t,n){if(this.sprite.texture.baseTexture.source){if(null===e&&null===t){this.game.input.getLocalPosition(this.sprite,n,this._tempPoint);var e=this._tempPoint.x,t=this._tempPoint.y}if(0!==this.sprite.anchor.x&&(e-=-this.sprite.texture.frame.width*this.sprite.anchor.x),0!==this.sprite.anchor.y&&(t-=-this.sprite.texture.frame.height*this.sprite.anchor.y),e+=this.sprite.texture.frame.x,t+=this.sprite.texture.frame.y,this.sprite.texture.trim&&(e-=this.sprite.texture.trim.x,t-=this.sprite.texture.trim.y,e<this.sprite.texture.crop.x||e>this.sprite.texture.crop.right||t<this.sprite.texture.crop.y||t>this.sprite.texture.crop.bottom))return this._dx=e,this._dy=t,!1;this._dx=e,this._dy=t,this.game.input.hitContext.clearRect(0,0,1,1),this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,e,t,1,1,0,0,1,1);var r=this.game.input.hitContext.getImageData(0,0,1,1);if(r.data[3]>=this.pixelPerfectAlpha)return!0}return!1},update:function(e){return null!==this.sprite&&void 0!==this.sprite.parent?this.enabled&&this.sprite.visible&&this.sprite.parent.visible?this.draggable&&this._draggedPointerID===e.id?this.updateDrag(e):this._pointerData[e.id].isOver?this.checkPointerOver(e)?(this._pointerData[e.id].x=e.x-this.sprite.x,this._pointerData[e.id].y=e.y-this.sprite.y,!0):(this._pointerOutHandler(e),!1):void 0:(this._pointerOutHandler(e),!1):void 0},_pointerOverHandler:function(e){null!==this.sprite&&(this._pointerData[e.id].isOver===!1||e.dirty)&&(this._pointerData[e.id].isOver=!0,this._pointerData[e.id].isOut=!1,this._pointerData[e.id].timeOver=this.game.time.time,this._pointerData[e.id].x=e.x-this.sprite.x,this._pointerData[e.id].y=e.y-this.sprite.y,this.useHandCursor&&this._pointerData[e.id].isDragged===!1&&(this.game.canvas.style.cursor="pointer",this._setHandCursor=!0),this.sprite&&this.sprite.events&&this.sprite.events.onInputOver$dispatch(this.sprite,e))},_pointerOutHandler:function(e){null!==this.sprite&&(this._pointerData[e.id].isOver=!1,this._pointerData[e.id].isOut=!0,this._pointerData[e.id].timeOut=this.game.time.time,this.useHandCursor&&this._pointerData[e.id].isDragged===!1&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),this.sprite&&this.sprite.events&&this.sprite.events.onInputOut$dispatch(this.sprite,e))},_touchedHandler:function(e){if(null!==this.sprite){if(this._pointerData[e.id].isDown===!1&&this._pointerData[e.id].isOver===!0){if(this.pixelPerfectClick&&!this.checkPixel(null,null,e))return;this._pointerData[e.id].isDown=!0,this._pointerData[e.id].isUp=!1,this._pointerData[e.id].timeDown=this.game.time.time,this.sprite&&this.sprite.events&&this.sprite.events.onInputDown$dispatch(this.sprite,e),e.dirty=!0,this.draggable&&this.isDragged===!1&&this.startDrag(e),this.bringToTop&&this.sprite.bringToTop()}return this.consumePointerEvent}},_releasedHandler:function(e){null!==this.sprite&&this._pointerData[e.id].isDown&&e.isUp&&(this._pointerData[e.id].isDown=!1,this._pointerData[e.id].isUp=!0,this._pointerData[e.id].timeUp=this.game.time.time,this._pointerData[e.id].downDuration=this._pointerData[e.id].timeUp-this._pointerData[e.id].timeDown,this.checkPointerOver(e)?this.sprite&&this.sprite.events&&this.sprite.events.onInputUp$dispatch(this.sprite,e,!0):(this.sprite&&this.sprite.events&&this.sprite.events.onInputUp$dispatch(this.sprite,e,!1),this.useHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1)),e.dirty=!0,this.draggable&&this.isDragged&&this._draggedPointerID===e.id&&this.stopDrag(e))},updateDrag:function(e){if(e.isUp)return this.stopDrag(e),!1;var t=this.globalToLocalX(e.x)+this._dragPoint.x+this.dragOffset.x,n=this.globalToLocalY(e.y)+this._dragPoint.y+this.dragOffset.y;return this.sprite.fixedToCamera?(this.allowHorizontalDrag&&(this.sprite.cameraOffset.x=t),this.allowVerticalDrag&&(this.sprite.cameraOffset.y=n),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)):(this.allowHorizontalDrag&&(this.sprite.x=t),this.allowVerticalDrag&&(this.sprite.y=n),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)),!0},justOver:function(e,t){return e=e||0,t=t||500,this._pointerData[e].isOver&&this.overDuration(e)<t},justOut:function(e,t){return e=e||0,t=t||500,this._pointerData[e].isOut&&this.game.time.time-this._pointerData[e].timeOut<t},justPressed:function(e,t){return e=e||0,t=t||500,this._pointerData[e].isDown&&this.downDuration(e)<t},justReleased:function(e,t){return e=e||0,t=t||500,this._pointerData[e].isUp&&this.game.time.time-this._pointerData[e].timeUp<t},overDuration:function(e){return e=e||0,this._pointerData[e].isOver?this.game.time.time-this._pointerData[e].timeOver:-1},downDuration:function(e){return e=e||0,this._pointerData[e].isDown?this.game.time.time-this._pointerData[e].timeDown:-1},enableDrag:function(e,t,r,i,s,o){"undefined"==typeof e&&(e=!1),"undefined"==typeof t&&(t=!1),"undefined"==typeof r&&(r=!1),"undefined"==typeof i&&(i=255),"undefined"==typeof s&&(s=null),"undefined"==typeof o&&(o=null),this._dragPoint=new n.Point,this.draggable=!0,this.bringToTop=t,this.dragOffset=new n.Point,this.dragFromCenter=e,this.pixelPerfectClick=r,this.pixelPerfectAlpha=i,s&&(this.boundsRect=s),o&&(this.boundsSprite=o)},disableDrag:function(){if(this._pointerData)for(var e=0;10>e;e++)this._pointerData[e].isDragged=!1;this.draggable=!1,this.isDragged=!1,this._draggedPointerID=-1},startDrag:function(e){var t=this.sprite.x,n=this.sprite.y;if(this.isDragged=!0,this._draggedPointerID=e.id,this._pointerData[e.id].isDragged=!0,this.sprite.fixedToCamera)this.dragFromCenter?(this.sprite.centerOn(e.x,e.y),this._dragPoint.setTo(this.sprite.cameraOffset.x-e.x,this.sprite.cameraOffset.y-e.y)):this._dragPoint.setTo(this.sprite.cameraOffset.x-e.x,this.sprite.cameraOffset.y-e.y);else{if(this.dragFromCenter){var r=this.sprite.getBounds();this.sprite.x=this.globalToLocalX(e.x)+(this.sprite.x-r.centerX),this.sprite.y=this.globalToLocalY(e.y)+(this.sprite.y-r.centerY)}this._dragPoint.setTo(this.sprite.x-this.globalToLocalX(e.x),this.sprite.y-this.globalToLocalY(e.y))}this.updateDrag(e),this.bringToTop&&(this._dragPhase=!0,this.sprite.bringToTop()),this.dragStartPoint.set(t,n),this.sprite.events.onDragStart$dispatch(this.sprite,e,t,n)},globalToLocalX:function(e){return this.scaleLayer&&(e-=this.game.scale.grid.boundsFluid.x,e*=this.game.scale.grid.scaleFluidInversed.x),e},globalToLocalY:function(e){return this.scaleLayer&&(e-=this.game.scale.grid.boundsFluid.y,e*=this.game.scale.grid.scaleFluidInversed.y),e},stopDrag:function(e){this.isDragged=!1,this._draggedPointerID=-1,this._pointerData[e.id].isDragged=!1,this._dragPhase=!1,this.snapOnRelease&&(this.sprite.fixedToCamera?(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY):(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)),this.sprite.events.onDragStop$dispatch(this.sprite,e),this.checkPointerOver(e)===!1&&this._pointerOutHandler(e)},setDragLock:function(e,t){"undefined"==typeof e&&(e=!0),"undefined"==typeof t&&(t=!0),this.allowHorizontalDrag=e,this.allowVerticalDrag=t},enableSnap:function(e,t,n,r,i,s){"undefined"==typeof n&&(n=!0),"undefined"==typeof r&&(r=!1),"undefined"==typeof i&&(i=0),"undefined"==typeof s&&(s=0),this.snapX=e,this.snapY=t,this.snapOffsetX=i,this.snapOffsetY=s,this.snapOnDrag=n,this.snapOnRelease=r},disableSnap:function(){this.snapOnDrag=!1,this.snapOnRelease=!1},checkBoundsRect:function(){this.sprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsRect.left?this.sprite.cameraOffset.x=this.boundsRect.left:this.sprite.cameraOffset.x+this.sprite.width>this.boundsRect.right&&(this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width),this.sprite.cameraOffset.y<this.boundsRect.top?this.sprite.cameraOffset.y=this.boundsRect.top:this.sprite.cameraOffset.y+this.sprite.height>this.boundsRect.bottom&&(this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height)):(this.sprite.left<this.boundsRect.left?this.sprite.x=this.boundsRect.x+this.sprite.offsetX:this.sprite.right>this.boundsRect.right&&(this.sprite.x=this.boundsRect.right-(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsRect.top?this.sprite.y=this.boundsRect.top+this.sprite.offsetY:this.sprite.bottom>this.boundsRect.bottom&&(this.sprite.y=this.boundsRect.bottom-(this.sprite.height-this.sprite.offsetY)))},checkBoundsSprite:function(){this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsSprite.cameraOffset.x?this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x:this.sprite.cameraOffset.x+this.sprite.width>this.boundsSprite.cameraOffset.x+this.boundsSprite.width&&(this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x+this.boundsSprite.width-this.sprite.width),this.sprite.cameraOffset.y<this.boundsSprite.cameraOffset.y?this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y:this.sprite.cameraOffset.y+this.sprite.height>this.boundsSprite.cameraOffset.y+this.boundsSprite.height&&(this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y+this.boundsSprite.height-this.sprite.height)):(this.sprite.left<this.boundsSprite.left?this.sprite.x=this.boundsSprite.left+this.sprite.offsetX:this.sprite.right>this.boundsSprite.right&&(this.sprite.x=this.boundsSprite.right-(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsSprite.top?this.sprite.y=this.boundsSprite.top+this.sprite.offsetY:this.sprite.bottom>this.boundsSprite.bottom&&(this.sprite.y=this.boundsSprite.bottom-(this.sprite.height-this.sprite.offsetY)))}},n.InputHandler.prototype.constructor=n.InputHandler,n.Gamepad=function(e){this.game=e,this._gamepadIndexMap={},this._rawPads=[],this._active=!1,this.enabled=!0,this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||-1!=navigator.userAgent.indexOf("Firefox/")||!!navigator.getGamepads,this._prevRawGamepadTypes=[],this._prevTimestamps=[],this.callbackContext=this,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null,this._ongamepadconnected=null,this._gamepaddisconnected=null,this._gamepads=[new n.SinglePad(e,this),new n.SinglePad(e,this),new n.SinglePad(e,this),new n.SinglePad(e,this)]},n.Gamepad.prototype={addCallbacks:function(e,t){"undefined"!=typeof t&&(this.onConnectCallback="function"==typeof t.onConnect?t.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"==typeof t.onDisconnect?t.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"==typeof t.onDown?t.onDown:this.onDownCallback,this.onUpCallback="function"==typeof t.onUp?t.onUp:this.onUpCallback,this.onAxisCallback="function"==typeof t.onAxis?t.onAxis:this.onAxisCallback,this.onFloatCallback="function"==typeof t.onFloat?t.onFloat:this.onFloatCallback,this.callbackContext=e)},start:function(){if(!this._active){this._active=!0;var e=this;this._onGamepadConnected=function(t){return e.onGamepadConnected(t)},this._onGamepadDisconnected=function(t){return e.onGamepadDisconnected(t)},window.addEventListener("gamepadconnected",this._onGamepadConnected,!1),window.addEventListener("gamepaddisconnected",this._onGamepadDisconnected,!1)}},onGamepadConnected:function(e){var t=e.gamepad;this._rawPads.push(t),this._gamepads[t.index].connect(t)},onGamepadDisconnected:function(e){var t=e.gamepad;for(var n in this._rawPads)this._rawPads[n].index===t.index&&this._rawPads.splice(n,1);this._gamepads[t.index].disconnect()},update:function(){this._pollGamepads(),this.pad1.pollStatus(),this.pad2.pollStatus(),this.pad3.pollStatus(),this.pad4.pollStatus()},_pollGamepads:function(){if(navigator.getGamepads)var e=navigator.getGamepads();else if(navigator.webkitGetGamepads)var e=navigator.webkitGetGamepads();else if(navigator.webkitGamepads)var e=navigator.webkitGamepads();if(e){this._rawPads=[];for(var t=!1,n=0;n<e.length&&(typeof e[n]!==this._prevRawGamepadTypes[n]&&(t=!0,this._prevRawGamepadTypes[n]=typeof e[n]),e[n]&&this._rawPads.push(e[n]),3!==n);n++);if(t){for(var r,i={rawIndices:{},padIndices:{}},s=0;s<this._gamepads.length;s++)if(r=this._gamepads[s],r.connected)for(var o=0;o<this._rawPads.length;o++)this._rawPads[o].index===r.index&&(i.rawIndices[r.index]=!0,i.padIndices[s]=!0);for(var u=0;u<this._gamepads.length;u++)if(r=this._gamepads[u],!i.padIndices[u]){this._rawPads.length<1&&r.disconnect();for(var a=0;a<this._rawPads.length&&!i.padIndices[u];a++){var f=this._rawPads[a];if(f){if(i.rawIndices[f.index]){r.disconnect();continue}r.connect(f),i.rawIndices[f.index]=!0,i.padIndices[u]=!0}else r.disconnect()}}}}},setDeadZones:function(e){for(var t=0;t<this._gamepads.length;t++)this._gamepads[t].deadZone=e},stop:function(){this._active=!1,window.removeEventListener("gamepadconnected",this._onGamepadConnected),window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnected)},reset:function(){this.update();for(var e=0;e<this._gamepads.length;e++)this._gamepads[e].reset()},justPressed:function(e,t){for(var n=0;n<this._gamepads.length;n++)if(this._gamepads[n].justPressed(e,t)===!0)return!0;return!1},justReleased:function(e,t){for(var n=0;n<this._gamepads.length;n++)if(this._gamepads[n].justReleased(e,t)===!0)return!0;return!1},isDown:function(e){for(var t=0;t<this._gamepads.length;t++)if(this._gamepads[t].isDown(e)===!0)return!0;return!1},destroy:function(){this.stop();for(var e=0;e<this._gamepads.length;e++)this._gamepads[e].destroy()}},n.Gamepad.prototype.constructor=n.Gamepad,Object.defineProperty(n.Gamepad.prototype,"disabled",{get:function(){return!this.enabled},set:function(e){this.enabled=!e}}),Object.defineProperty(n.Gamepad.prototype,"active",{get:function(){return this._active}}),Object.defineProperty(n.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}}),Object.defineProperty(n.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}}),Object.defineProperty(n.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}}),Object.defineProperty(n.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}}),Object.defineProperty(n.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}}),Object.defineProperty(n.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}}),n.Gamepad.BUTTON_0=0,n.Gamepad.BUTTON_1=1,n.Gamepad.BUTTON_2=2,n.Gamepad.BUTTON_3=3,n.Gamepad.BUTTON_4=4,n.Gamepad.BUTTON_5=5,n.Gamepad.BUTTON_6=6,n.Gamepad.BUTTON_7=7,n.Gamepad.BUTTON_8=8,n.Gamepad.BUTTON_9=9,n.Gamepad.BUTTON_10=10,n.Gamepad.BUTTON_11=11,n.Gamepad.BUTTON_12=12,n.Gamepad.BUTTON_13=13,n.Gamepad.BUTTON_14=14,n.Gamepad.BUTTON_15=15,n.Gamepad.AXIS_0=0,n.Gamepad.AXIS_1=1,n.Gamepad.AXIS_2=2,n.Gamepad.AXIS_3=3,n.Gamepad.AXIS_4=4,n.Gamepad.AXIS_5=5,n.Gamepad.AXIS_6=6,n.Gamepad.AXIS_7=7,n.Gamepad.AXIS_8=8,n.Gamepad.AXIS_9=9,n.Gamepad.XBOX360_A=0,n.Gamepad.XBOX360_B=1,n.Gamepad.XBOX360_X=2,n.Gamepad.XBOX360_Y=3,n.Gamepad.XBOX360_LEFT_BUMPER=4,n.Gamepad.XBOX360_RIGHT_BUMPER=5,n.Gamepad.XBOX360_LEFT_TRIGGER=6,n.Gamepad.XBOX360_RIGHT_TRIGGER=7,n.Gamepad.XBOX360_BACK=8,n.Gamepad.XBOX360_START=9,n.Gamepad.XBOX360_STICK_LEFT_BUTTON=10,n.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11,n.Gamepad.XBOX360_DPAD_LEFT=14,n.Gamepad.XBOX360_DPAD_RIGHT=15,n.Gamepad.XBOX360_DPAD_UP=12,n.Gamepad.XBOX360_DPAD_DOWN=13,n.Gamepad.XBOX360_STICK_LEFT_X=0,n.Gamepad.XBOX360_STICK_LEFT_Y=1,n.Gamepad.XBOX360_STICK_RIGHT_X=2,n.Gamepad.XBOX360_STICK_RIGHT_Y=3,n.Gamepad.PS3XC_X=0,n.Gamepad.PS3XC_CIRCLE=1,n.Gamepad.PS3XC_SQUARE=2,n.Gamepad.PS3XC_TRIANGLE=3,n.Gamepad.PS3XC_L1=4,n.Gamepad.PS3XC_R1=5,n.Gamepad.PS3XC_L2=6,n.Gamepad.PS3XC_R2=7,n.Gamepad.PS3XC_SELECT=8,n.Gamepad.PS3XC_START=9,n.Gamepad.PS3XC_STICK_LEFT_BUTTON=10,n.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11,n.Gamepad.PS3XC_DPAD_UP=12,n.Gamepad.PS3XC_DPAD_DOWN=13,n.Gamepad.PS3XC_DPAD_LEFT=14,n.Gamepad.PS3XC_DPAD_RIGHT=15,n.Gamepad.PS3XC_STICK_LEFT_X=0,n.Gamepad.PS3XC_STICK_LEFT_Y=1,n.Gamepad.PS3XC_STICK_RIGHT_X=2,n.Gamepad.PS3XC_STICK_RIGHT_Y=3,n.SinglePad=function(e,t){this.game=e,this.index=null,this.connected=!1,this.callbackContext=this,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null,this.deadZone=.26,this._padParent=t,this._rawPad=null,this._prevTimestamp=null,this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0},n.SinglePad.prototype={addCallbacks:function(e,t){"undefined"!=typeof t&&(this.onConnectCallback="function"==typeof t.onConnect?t.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"==typeof t.onDisconnect?t.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"==typeof t.onDown?t.onDown:this.onDownCallback,this.onUpCallback="function"==typeof t.onUp?t.onUp:this.onUpCallback,this.onAxisCallback="function"==typeof t.onAxis?t.onAxis:this.onAxisCallback,this.onFloatCallback="function"==typeof t.onFloat?t.onFloat:this.onFloatCallback)},getButton:function(e){return this._buttons[e]?this._buttons[e]:null},pollStatus:function(){if(this.connected&&this.game.input.enabled&&this.game.input.gamepad.enabled&&(!this._rawPad.timestamp||this._rawPad.timestamp!==this._prevTimestamp)){for(var e=0;e<this._buttonsLen;e++){var t=isNaN(this._rawPad.buttons[e])?this._rawPad.buttons[e].value:this._rawPad.buttons[e];t!==this._buttons[e].value&&(1===t?this.processButtonDown(e,t):0===t?this.processButtonUp(e,t):this.processButtonFloat(e,t))}for(var n=0;n<this._axesLen;n++){var r=this._rawPad.axes[n];r>0&&r>this.deadZone||0>r&&r<-this.deadZone?this.processAxisChange(n,r):this.processAxisChange(n,0)}this._prevTimestamp=this._rawPad.timestamp}},connect:function(e){var t=!this.connected;this.connected=!0,this.index=e.index,this._rawPad=e,this._buttons=[],this._buttonsLen=e.buttons.length,this._axes=[],this._axesLen=e.axes.length;for(var r=0;r<this._axesLen;r++)this._axes[r]=e.axes[r];for(var i in e.buttons)i=parseInt(i,10),this._buttons[i]=new n.GamepadButton(this,i);t&&this._padParent.onConnectCallback&&this._padParent.onConnectCallback.call(this._padParent.callbackContext,this.index),t&&this.onConnectCallback&&this.onConnectCallback.call(this.callbackContext)},disconnect:function(){var e=this.connected,t=this.index;this.connected=!1,this.index=null,this._rawPad=void 0;for(var n=0;n<this._buttonsLen;n++)this._buttons[n].destroy();this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0,e&&this._padParent.onDisconnectCallback&&this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,t),e&&this.onDisconnectCallback&&this.onDisconnectCallback.call(this.callbackContext)},destroy:function(){this._rawPad=void 0;for(var e=0;e<this._buttonsLen;e++)this._buttons[e].destroy();this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null},processAxisChange:function(e,t){this._axes[e]!==t&&(this._axes[e]=t,this._padParent.onAxisCallback&&this._padParent.onAxisCallback.call(this._padParent.callbackContext,this,e,t),this.onAxisCallback&&this.onAxisCallback.call(this.callbackContext,this,e,t))},processButtonDown:function(e,t){this._padParent.onDownCallback&&this._padParent.onDownCallback.call(this._padParent.callbackContext,e,t,this.index),this.onDownCallback&&this.onDownCallback.call(this.callbackContext,e,t),this._buttons[e]&&this._buttons[e].processButtonDown(t)},processButtonUp:function(e,t){this._padParent.onUpCallback&&this._padParent.onUpCallback.call(this._padParent.callbackContext,e,t,this.index),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,e,t),this._buttons[e]&&this._buttons[e].processButtonUp(t)},processButtonFloat:function(e,t){this._padParent.onFloatCallback&&this._padParent.onFloatCallback.call(this._padParent.callbackContext,e,t,this.index),this.onFloatCallback&&this.onFloatCallback.call(this.callbackContext,e,t),this._buttons[e]&&this._buttons[e].processButtonFloat(t)},axis:function(e){return this._axes[e]?this._axes[e]:!1},isDown:function(e){return this._buttons[e]?this._buttons[e].isDown:!1},isUp:function(e){return this._buttons[e]?this._buttons[e].isUp:!1},justReleased:function(e,t){return this._buttons[e]?this._buttons[e].justReleased(t):void 0},justPressed:function(e,t){return this._buttons[e]?this._buttons[e].justPressed(t):void 0},buttonValue:function(e){return this._buttons[e]?this._buttons[e].value:null},reset:function(){for(var e=0;e<this._axes.length;e++)this._axes[e]=0}},n.SinglePad.prototype.constructor=n.SinglePad,n.GamepadButton=function(e,t){this.pad=e,this.game=e.game,this.isDown=!1,this.isUp=!0,this.timeDown=0,this.duration=0,this.timeUp=0,this.repeats=0,this.value=0,this.buttonCode=t,this.onDown=new n.Signal,this.onUp=new n.Signal,this.onFloat=new n.Signal},n.GamepadButton.prototype={processButtonDown:function(e){this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.time,this.duration=0,this.repeats=0,this.value=e,this.onDown.dispatch(this,e)},processButtonUp:function(e){this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.value=e,this.onUp.dispatch(this,e)},processButtonFloat:function(e){this.value=e,this.onFloat.dispatch(this,e)},justPressed:function(e){return e=e||250,this.isDown===!0&&this.timeDown+e>this.game.time.time},justReleased:function(e){return e=e||250,this.isUp===!0&&this.timeUp+e>this.game.time.time},reset:function(){this.isDown=!1,this.isUp=!0,this.timeDown=this.game.time.time,this.duration=0,this.repeats=0},destroy:function(){this.onDown.dispose(),this.onUp.dispose(),this.onFloat.dispose(),this.pad=null,this.game=null}},n.GamepadButton.prototype.constructor=n.GamepadButton,n.Key=function(e,t){this.game=e,this._enabled=!0,this.event=null,this.isDown=!1,this.isUp=!0,this.altKey=!1,this.ctrlKey=!1,this.shiftKey=!1,this.timeDown=0,this.duration=0,this.timeUp=-2500,this.repeats=0,this.keyCode=t,this.onDown=new n.Signal,this.onHoldCallback=null,this.onHoldContext=null,this.onUp=new n.Signal,this._justDown=!1,this._justUp=!1},n.Key.prototype={update:function(){this._enabled&&this.isDown&&(this.duration=this.game.time.time-this.timeDown,this.repeats++,this.onHoldCallback&&this.onHoldCallback.call(this.onHoldContext,this))},processKeyDown:function(e){this._enabled&&(this.event=e,this.isDown||(this.altKey=e.altKey,this.ctrlKey=e.ctrlKey,this.shiftKey=e.shiftKey,this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.time,this.duration=0,this.repeats=0,this._justDown=!0,this.onDown.dispatch(this)))},processKeyUp:function(e){this._enabled&&(this.event=e,this.isUp||(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.duration=this.game.time.time-this.timeDown,this._justUp=!0,this.onUp.dispatch(this)))},reset:function(e){"undefined"==typeof e&&(e=!0),this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.duration=0,this._enabled=!0,this._justDown=!1,this._justUp=!1,e&&(this.onDown.removeAll(),this.onUp.removeAll(),this.onHoldCallback=null,this.onHoldContext=null)},downDuration:function(e){return"undefined"==typeof e&&(e=50),this.isDown&&this.duration<e},upDuration:function(e){return"undefined"==typeof e&&(e=50),!this.isDown&&this.game.time.time-this.timeUp<e}},Object.defineProperty(n.Key.prototype,"justDown",{get:function(){var e=this._justDown;return this._justDown=!1,e}}),Object.defineProperty(n.Key.prototype,"justUp",{get:function(){var e=this._justUp;return this._justUp=!1,e}}),Object.defineProperty(n.Key.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e=!!e,e!==this._enabled&&(e||this.reset(!1),this._enabled=e)}}),n.Key.prototype.constructor=n.Key,n.Keyboard=function(e){this.game=e,this.enabled=!0,this.event=null,this.pressEvent=null,this.callbackContext=this,this.onDownCallback=null,this.onPressCallback=null,this.onUpCallback=null,this._keys=[],this._capture=[],this._onKeyDown=null,this._onKeyPress=null,this._onKeyUp=null,this._i=0,this._k=0},n.Keyboard.prototype={addCallbacks:function(e,t,n,r){this.callbackContext=e,"undefined"!=typeof t&&(this.onDownCallback=t),"undefined"!=typeof n&&(this.onUpCallback=n),"undefined"!=typeof r&&(this.onPressCallback=r)},addKey:function(e){return this._keys[e]||(this._keys[e]=new n.Key(this.game,e),this.addKeyCapture(e)),this._keys[e]},removeKey:function(e){this._keys[e]&&(this._keys[e]=null,this.removeKeyCapture(e))},createCursorKeys:function(){return{up:this.addKey(n.Keyboard.UP),down:this.addKey(n.Keyboard.DOWN),left:this.addKey(n.Keyboard.LEFT),right:this.addKey(n.Keyboard.RIGHT)}},start:function(){if(!this.game.device.cocoonJS&&null===this._onKeyDown){var e=this;this._onKeyDown=function(t){return e.processKeyDown(t)},this._onKeyUp=function(t){return e.processKeyUp(t)},this._onKeyPress=function(t){return e.processKeyPress(t)},window.addEventListener("keydown",this._onKeyDown,!1),window.addEventListener("keyup",this._onKeyUp,!1),window.addEventListener("keypress",this._onKeyPress,!1)}},stop:function(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),window.removeEventListener("keypress",this._onKeyPress),this._onKeyDown=null,this._onKeyUp=null,this._onKeyPress=null},destroy:function(){this.stop(),this.clearCaptures(),this._keys.length=0,this._i=0},addKeyCapture:function(e){if("object"==typeof e)for(var t in e)this._capture[e[t]]=!0;else this._capture[e]=!0},removeKeyCapture:function(e){delete this._capture[e]},clearCaptures:function(){this._capture={}},update:function(){for(this._i=this._keys.length;this._i--;)this._keys[this._i]&&this._keys[this._i].update()},processKeyDown:function(e){this.event=e,this.game.input.enabled&&this.enabled&&(this._capture[e.keyCode]&&e.preventDefault(),this._keys[e.keyCode]||(this._keys[e.keyCode]=new n.Key(this.game,e.keyCode)),this._keys[e.keyCode].processKeyDown(e),this._k=e.keyCode,this.onDownCallback&&this.onDownCallback.call(this.callbackContext,e))},processKeyPress:function(e){this.pressEvent=e,this.game.input.enabled&&this.enabled&&this.onPressCallback&&this.onPressCallback.call(this.callbackContext,String.fromCharCode(e.charCode),e)},processKeyUp:function(e){this.event=e,this.game.input.enabled&&this.enabled&&(this._capture[e.keyCode]&&e.preventDefault(),this._keys[e.keyCode]||(this._keys[e.keyCode]=new n.Key(this.game,e.keyCode)),this._keys[e.keyCode].processKeyUp(e),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,e))},reset:function(e){"undefined"==typeof e&&(e=!0),this.event=null;for(var t=this._keys.length;t--;)this._keys[t]&&this._keys[t].reset(e)},downDuration:function(e,t){return this._keys[e]?this._keys[e].downDuration(t):null},upDuration:function(e,t){return this._keys[e]?this._keys[e].upDuration(t):null},isDown:function(e){return this._keys[e]?this._keys[e].isDown:null}},Object.defineProperty(n.Keyboard.prototype,"disabled",{get:function(){return!this.enabled},set:function(e){this.enabled=!e}}),Object.defineProperty(n.Keyboard.prototype,"lastChar",{get:function(){return 32===this.event.charCode?"":String.fromCharCode(this.pressEvent.charCode)}}),Object.defineProperty(n.Keyboard.prototype,"lastKey",{get:function(){return this._keys[this._k]}}),n.Keyboard.prototype.constructor=n.Keyboard,n.Keyboard.A="A".charCodeAt(0),n.Keyboard.B="B".charCodeAt(0),n.Keyboard.C="C".charCodeAt(0),n.Keyboard.D="D".charCodeAt(0),n.Keyboard.E="E".charCodeAt(0),n.Keyboard.F="F".charCodeAt(0),n.Keyboard.G="G".charCodeAt(0),n.Keyboard.H="H".charCodeAt(0),n.Keyboard.I="I".charCodeAt(0),n.Keyboard.J="J".charCodeAt(0),n.Keyboard.K="K".charCodeAt(0),n.Keyboard.L="L".charCodeAt(0),n.Keyboard.M="M".charCodeAt(0),n.Keyboard.N="N".charCodeAt(0),n.Keyboard.O="O".charCodeAt(0),n.Keyboard.P="P".charCodeAt(0),n.Keyboard.Q="Q".charCodeAt(0),n.Keyboard.R="R".charCodeAt(0),n.Keyboard.S="S".charCodeAt(0),n.Keyboard.T="T".charCodeAt(0),n.Keyboard.U="U".charCodeAt(0),n.Keyboard.V="V".charCodeAt(0),n.Keyboard.W="W".charCodeAt(0),n.Keyboard.X="X".charCodeAt(0),n.Keyboard.Y="Y".charCodeAt(0),n.Keyboard.Z="Z".charCodeAt(0),n.Keyboard.ZERO="0".charCodeAt(0),n.Keyboard.ONE="1".charCodeAt(0),n.Keyboard.TWO="2".charCodeAt(0),n.Keyboard.THREE="3".charCodeAt(0),n.Keyboard.FOUR="4".charCodeAt(0),n.Keyboard.FIVE="5".charCodeAt(0),n.Keyboard.SIX="6".charCodeAt(0),n.Keyboard.SEVEN="7".charCodeAt(0),n.Keyboard.EIGHT="8".charCodeAt(0),n.Keyboard.NINE="9".charCodeAt(0),n.Keyboard.NUMPAD_0=96,n.Keyboard.NUMPAD_1=97,n.Keyboard.NUMPAD_2=98,n.Keyboard.NUMPAD_3=99,n.Keyboard.NUMPAD_4=100,n.Keyboard.NUMPAD_5=101,n.Keyboard.NUMPAD_6=102,n.Keyboard.NUMPAD_7=103,n.Keyboard.NUMPAD_8=104,n.Keyboard.NUMPAD_9=105,n.Keyboard.NUMPAD_MULTIPLY=106,n.Keyboard.NUMPAD_ADD=107,n.Keyboard.NUMPAD_ENTER=108,n.Keyboard.NUMPAD_SUBTRACT=109,n.Keyboard.NUMPAD_DECIMAL=110,n.Keyboard.NUMPAD_DIVIDE=111,n.Keyboard.F1=112,n.Keyboard.F2=113,n.Keyboard.F3=114,n.Keyboard.F4=115,n.Keyboard.F5=116,n.Keyboard.F6=117,n.Keyboard.F7=118,n.Keyboard.F8=119,n.Keyboard.F9=120,n.Keyboard.F10=121,n.Keyboard.F11=122,n.Keyboard.F12=123,n.Keyboard.F13=124,n.Keyboard.F14=125,n.Keyboard.F15=126,n.Keyboard.COLON=186,n.Keyboard.EQUALS=187,n.Keyboard.UNDERSCORE=189,n.Keyboard.QUESTION_MARK=191,n.Keyboard.TILDE=192,n.Keyboard.OPEN_BRACKET=219,n.Keyboard.BACKWARD_SLASH=220,n.Keyboard.CLOSED_BRACKET=221,n.Keyboard.QUOTES=222,n.Keyboard.BACKSPACE=8,n.Keyboard.TAB=9,n.Keyboard.CLEAR=12,n.Keyboard.ENTER=13,n.Keyboard.SHIFT=16,n.Keyboard.CONTROL=17,n.Keyboard.ALT=18,n.Keyboard.CAPS_LOCK=20,n.Keyboard.ESC=27,n.Keyboard.SPACEBAR=32,n.Keyboard.PAGE_UP=33,n.Keyboard.PAGE_DOWN=34,n.Keyboard.END=35,n.Keyboard.HOME=36,n.Keyboard.LEFT=37,n.Keyboard.UP=38,n.Keyboard.RIGHT=39,n.Keyboard.DOWN=40,n.Keyboard.INSERT=45,n.Keyboard.DELETE=46,n.Keyboard.HELP=47,n.Keyboard.NUM_LOCK=144,n.Keyboard.PLUS=43,n.Keyboard.MINUS=45,n.Component=function(){},n.Component.Angle=function(){},n.Component.Angle.prototype={angle:{get:function(){return n.Math.wrapAngle(n.Math.radToDeg(this.rotation))},set:function(e){this.rotation=n.Math.degToRad(n.Math.wrapAngle(e))}}},n.Component.Animation=function(){},n.Component.Animation.prototype={play:function(e,t,n,r){return this.animations?this.animations.play(e,t,n,r):void 0}},n.Component.AutoCull=function(){},n.Component.AutoCull.prototype={autoCull:!1,inCamera:{get:function(){return this.autoCull||this.checkWorldBounds||(this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y),this.game.world.camera.view.intersects(this._bounds)}}},n.Component.Bounds=function(){},n.Component.Bounds.prototype={offsetX:{get:function(){return this.anchor.x*this.width}},offsetY:{get:function(){return this.anchor.y*this.height}},left:{get:function(){return this.x-this.offsetX}},right:{get:function(){return this.x+this.width-this.offsetX}},top:{get:function(){return this.y-this.offsetY}},bottom:{get:function(){return this.y+this.height-this.offsetY}}},n.Component.BringToTop=function(){},n.Component.BringToTop.prototype.bringToTop=function(){return this.parent&&this.parent.bringToTop(this),this},n.Component.BringToTop.prototype.sendToBack=function(){return this.parent&&this.parent.sendToBack(this),this},n.Component.BringToTop.prototype.moveUp=function(){return this.parent&&this.parent.moveUp(this),this},n.Component.BringToTop.prototype.moveDown=function(){return this.parent&&this.parent.moveDown(this),this},n.Component.Core=function(){},n.Component.Core.install=function(e){n.Utils.mixinPrototype(this,n.Component.Core.prototype),this.components={};for(var t=0;t<e.length;t++){var r=e[t],i=!1;"Destroy"===r&&(i=!0),n.Utils.mixinPrototype(this,n.Component[r].prototype,i),this.components[r]=!0}},n.Component.Core.init=function(e,t,r,i,s){this.game=e,this.key=i,this.position.set(t,r),this.world=new n.Point(t,r),this.previousPosition=new n.Point(t,r),this.events=new n.Events(this),this._bounds=new n.Rectangle,this.components.PhysicsBody&&(this.body=this.body),this.components.Animation&&(this.animations=new n.AnimationManager(this)),this.components.LoadTexture&&null!==i&&this.loadTexture(i,s),this.components.FixedToCamera&&(this.cameraOffset=new n.Point(t,r))},n.Component.Core.preUpdate=function(){if(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,!this.exists||!this.parent.exists)return this.renderOrderID=-1,!1;this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this.renderOrderID=this.game.stage.currentRenderOrderID++),this.animations&&this.animations.update(),this.body&&this.body.preUpdate();for(var e=0;e<this.children.length;e++)this.children[e].preUpdate();return!0},n.Component.Core.prototype={game:null,name:"",components:{},z:0,events:void 0,animations:void 0,key:"",world:null,debug:!1,previousPosition:null,previousRotation:0,renderOrderID:0,fresh:!0,_bounds:null,_exists:!0,exists:{get:function(){return this._exists},set:function(e){e?(this._exists=!0,this.body&&this.body.type===n.Physics.P2JS&&this.body.addToWorld(),this.visible=!0):(this._exists=!1,this.body&&this.body.type===n.Physics.P2JS&&this.body.removeFromWorld(),this.visible=!1)}},update:function(){},postUpdate:function(){this.key instanceof n.BitmapData&&this.key.render(),this.components.PhysicsBody&&n.Component.PhysicsBody.postUpdate.call(this),this.components.FixedToCamera&&n.Component.FixedToCamera.postUpdate.call(this);for(var e=0;e<this.children.length;e++)this.children[e].postUpdate()}},n.Component.Crop=function(){},n.Component.Crop.prototype={cropRect:null,_crop:null,crop:function(e,t){"undefined"==typeof t&&(t=!1),e?(t&&null!==this.cropRect?this.cropRect.setTo(e.x,e.y,e.width,e.height):this.cropRect=t&&null===this.cropRect?new n.Rectangle(e.x,e.y,e.width,e.height):e,this.updateCrop()):(this._crop=null,this.cropRect=null,this.resetFrame())},updateCrop:function(){if(this.cropRect){this._crop=n.Rectangle.clone(this.cropRect,this._crop),this._crop.x+=this._frame.x,this._crop.y+=this._frame.y;var e=Math.max(this._frame.x,this._crop.x),t=Math.max(this._frame.y,this._crop.y),r=Math.min(this._frame.right,this._crop.right)-e,i=Math.min(this._frame.bottom,this._crop.bottom)-t;this.texture.crop.x=e,this.texture.crop.y=t,this.texture.crop.width=r,this.texture.crop.height=i,this.texture.frame.width=Math.min(r,this.cropRect.width),this.texture.frame.height=Math.min(i,this.cropRect.height),this.texture.width=this.texture.frame.width,this.texture.height=this.texture.frame.height,this.texture._updateUvs()}}},n.Component.Delta=function(){},n.Component.Delta.prototype={deltaX:{get:function(){return this.world.x-this.previousPosition.x}},deltaY:{get:function(){return this.world.y-this.previousPosition.y}},deltaZ:{get:function(){return this.rotation-this.previousRotation}}},n.Component.Destroy=function(){},n.Component.Destroy.prototype={destroyPhase:!1,destroy:function(e){if(null!==this.game&&!this.destroyPhase){"undefined"==typeof e&&(e=!0),this.destroyPhase=!0,this.events&&this.events.onDestroy$dispatch(this),this.parent&&(this.parent instanceof n.Group?this.parent.remove(this):this.parent.removeChild(this)),this.input&&this.input.destroy(),this.animations&&this.animations.destroy(),this.body&&this.body.destroy(),this.events&&this.events.destroy();var t=this.children.length;if(e)for(;t--;)this.children[t].destroy(e);else for(;t--;)this.removeChild(this.children[t]);this._crop&&(this._crop=null),this._frame&&(this._frame=null),this.alive=!1,this.exists=!1,this.visible=!1,this.filters=null,this.mask=null,this.game=null,this.renderable=!1,this.transformCallback=null,this.transformCallbackContext=null,this.hitArea=null,this.parent=null,this.stage=null,this.worldTransform=null,this.filterArea=null,this._bounds=null,this._currentBounds=null,this._mask=null,this._destroyCachedSprite(),this.destroyPhase=!1}}},n.Events=function(e){this.parent=e},n.Events.prototype={destroy:function(){this._parent=null,this._onDestroy&&this._onDestroy.dispose(),this._onAddedToGroup&&this._onAddedToGroup.dispose(),this._onRemovedFromGroup&&this._onRemovedFromGroup.dispose(),this._onRemovedFromWorld&&this._onRemovedFromWorld.dispose(),this._onKilled&&this._onKilled.dispose(),this._onRevived&&this._onRevived.dispose(),this._onEnterBounds&&this._onEnterBounds.dispose(),this._onOutOfBounds&&this._onOutOfBounds.dispose(),this._onInputOver&&this._onInputOver.dispose(),this._onInputOut&&this._onInputOut.dispose(),this._onInputDown&&this._onInputDown.dispose(),this._onInputUp&&this._onInputUp.dispose(),this._onDragStart&&this._onDragStart.dispose(),this._onDragStop&&this._onDragStop.dispose(),this._onAnimationStart&&this._onAnimationStart.dispose(),this._onAnimationComplete&&this._onAnimationComplete.dispose(),this._onAnimationLoop&&this._onAnimationLoop.dispose()},onAddedToGroup:null,onRemovedFromGroup:null,onRemovedFromWorld:null,onDestroy:null,onKilled:null,onRevived:null,onOutOfBounds:null,onEnterBounds:null,onInputOver:null,onInputOut:null,onInputDown:null,onInputUp:null,onDragStart:null,onDragStop:null,onAnimationStart:null,onAnimationComplete:null,onAnimationLoop:null},n.Events.prototype.constructor=n.Events;for(var i in n.Events.prototype)n.Events.prototype.hasOwnProperty(i)&&0===i.indexOf("on")&&null===n.Events.prototype[i]&&!function(e,t){"use strict";Object.defineProperty(n.Events.prototype,e,{get:function(){return this[t]||(this[t]=new n.Signal)}}),n.Events.prototype[e+"$dispatch"]=function(){return this[t]?this[t].dispatch.apply(this[t],arguments):null}}(i,"_"+i);n.Component.FixedToCamera=function(){},n.Component.FixedToCamera.postUpdate=function(){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)},n.Component.FixedToCamera.prototype={_fixedToCamera:!1,fixedToCamera:{get:function(){return this._fixedToCamera},set:function(e){e?(this._fixedToCamera=!0,this.cameraOffset.set(this.x,this.y)):this._fixedToCamera=!1}},cameraOffset:new n.Point},n.Component.Health=function(){},n.Component.Health.prototype={health:1,damage:function(e){return this.alive&&(this.health-=e,this.health<=0&&this.kill()),this}},n.Component.InCamera=function(){},n.Component.InCamera.prototype={inCamera:{get:function(){return this.game.world.camera.view.intersects(this._bounds)}}},n.Component.InputEnabled=function(){},n.Component.InputEnabled.prototype={input:null,inputEnabled:{get:function(){return this.input&&this.input.enabled},set:function(e){e?null===this.input?(this.input=new n.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}},n.Component.InWorld=function(){},n.Component.InWorld.preUpdate=function(){if((this.autoCull||this.checkWorldBounds)&&(this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y,this.autoCull&&(this.game.world.camera.view.intersects(this._bounds)?(this.renderable=!0,this.game.world.camera.totalInView++):this.renderable=!1),this.checkWorldBounds))if(this._outOfBoundsFired&&this.game.world.bounds.intersects(this._bounds))this._outOfBoundsFired=!1,this.events.onEnterBounds$dispatch(this);else if(!this._outOfBoundsFired&&!this.game.world.bounds.intersects(this._bounds)&&(this._outOfBoundsFired=!0,this.events.onOutOfBounds$dispatch(this),this.outOfBoundsKill))return this.kill(),!1;return!0},n.Component.InWorld.prototype={checkWorldBounds:!1,outOfBoundsKill:!1,_outOfBoundsFired:!1,inWorld:{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}},n.Component.LifeSpan=function(){},n.Component.LifeSpan.preUpdate=function(){return this.lifespan>0&&(this.lifespan-=this.game.time.physicsElapsedMS,this.lifespan<=0)?(this.kill(),!1):!0},n.Component.LifeSpan.prototype={alive:!0,lifespan:0,revive:function(e){return"undefined"==typeof e&&(e=1),this.alive=!0,this.exists=!0,this.visible=!0,"number"==typeof this.health&&(this.health=e),this.events&&this.events.onRevived$dispatch(this),this},kill:function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.events&&this.events.onKilled$dispatch(this),this}},n.Component.LoadTexture=function(){},n.Component.LoadTexture.prototype={_frame:null,loadTexture:function(e,t,r){t=t||0,(r||"undefined"==typeof r)&&this.animations&&this.animations.stop(),this.key=e;var i=!0,s=!this.texture.baseTexture.scaleMode,o=!1;n.RenderTexture&&e instanceof n.RenderTexture?(this.key=e.key,this.setTexture(e),o=!0):n.BitmapData&&e instanceof n.BitmapData?(this.setTexture(e.texture),this.game.cache.getFrameData(e.key,n.Cache.BITMAPDATA)&&(i=!this.animations.loadFrameData(this.game.cache.getFrameData(e.key,n.Cache.BITMAPDATA),t))):e instanceof PIXI.Texture?this.setTexture(e):null===e||"undefined"==typeof e?(this.key="__default",this.setTexture(PIXI.TextureCache[this.key])):"string"!=typeof e||this.game.cache.checkImageKey(e)?(this.setTexture(new PIXI.Texture(PIXI.BaseTextureCache[e])),i=!this.animations.loadFrameData(this.game.cache.getFrameData(e),t)):(console.warn("Texture with key '"+e+"' not found."),this.key="__missing",this.setTexture(PIXI.TextureCache[this.key])),o||this.texture.baseTexture.dirty(),i&&(this._frame=n.Rectangle.clone(this.texture.frame)),s||(this.texture.baseTexture.scaleMode=1)},setFrame:function(e){this._frame=e,this.texture.frame.x=e.x,this.texture.frame.y=e.y,this.texture.frame.width=e.width,this.texture.frame.height=e.height,this.texture.crop.x=e.x,this.texture.crop.y=e.y,this.texture.crop.width=e.width,this.texture.crop.height=e.height,e.trimmed?(this.texture.trim?(this.texture.trim.x=e.spriteSourceSizeX,this.texture.trim.y=e.spriteSourceSizeY,this.texture.trim.width=e.sourceSizeW,this.texture.trim.height=e.sourceSizeH):this.texture.trim={x:e.spriteSourceSizeX,y:e.spriteSourceSizeY,width:e.sourceSizeW,height:e.sourceSizeH},this.texture.width=e.sourceSizeW,this.texture.height=e.sourceSizeH,this.texture.frame.width=e.sourceSizeW,this.texture.frame.height=e.sourceSizeH):!e.trimmed&&this.texture.trim&&(this.texture.trim=null),this.cropRect&&this.updateCrop(),16777215!==this.tint&&(this.cachedTint=-1),this.texture._updateUvs()},resetFrame:function(){this._frame&&this.setFrame(this._frame)},frame:{get:function(){return this.animations.frame},set:function(e){this.animations.frame=e}},frameName:{get:function(){return this.animations.frameName},set:function(e){this.animations.frameName=e}}},n.Component.Overlap=function(){},n.Component.Overlap.prototype={overlap:function(e){return n.Rectangle.intersects(this.getBounds(),e.getBounds())}},n.Component.PhysicsBody=function(){},n.Component.PhysicsBody.preUpdate=function(){return this.fresh&&this.exists?(this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.body&&this.body.preUpdate(),this.fresh=!1,!1):(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this._exists&&this.parent.exists?!0:(this.renderOrderID=-1,!1))},n.Component.PhysicsBody.postUpdate=function(){this.exists&&this.body&&this.body.postUpdate()},n.Component.PhysicsBody.prototype={body:null,x:{get:function(){return this.position.x},set:function(e){this.position.x=e,this.body&&!this.body.dirty&&(this.body._reset=!0)}},y:{get:function(){return this.position.y},set:function(e){this.position.y=e,this.body&&!this.body.dirty&&(this.body._reset=!0)}}},n.Component.Reset=function(){},n.Component.Reset.prototype.reset=function(e,t,n){return"undefined"==typeof n&&(n=1),this.world.set(e,t),this.position.set(e,t),this.fresh=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this.components.InWorld&&(this._outOfBoundsFired=!1),this.components.LifeSpan&&(this.alive=!0,this.health=n),this.components.PhysicsBody&&this.body&&this.body.reset(e,t,!1,!1),this},n.Component.ScaleMinMax=function(){},n.Component.ScaleMinMax.prototype={transformCallback:this.checkTransform,transformCallbackContext:this,scaleMin:null,scaleMax:null,checkTransform:function(e){this.scaleMin&&(e.a<this.scaleMin.x&&(e.a=this.scaleMin.x),e.d<this.scaleMin.y&&(e.d=this.scaleMin.y)),this.scaleMax&&(e.a>this.scaleMax.x&&(e.a=this.scaleMax.x),e.d>this.scaleMax.y&&(e.d=this.scaleMax.y))},setScaleMinMax:function(e,t,r,i){"undefined"==typeof t?t=r=i=e:"undefined"==typeof r&&(r=i=t,t=e),null===e?this.scaleMin=null:this.scaleMin?this.scaleMin.set(e,t):this.scaleMin=new n.Point(e,t),null===r?this.scaleMax=null:this.scaleMax?this.scaleMax.set(r,i):this.scaleMax=new n.Point(r,i)}},n.Component.Smoothed=function(){},n.Component.Smoothed.prototype={smoothed:{get:function(){return!this.texture.baseTexture.scaleMode},set:function(e){e?this.texture&&(this.texture.baseTexture.scaleMode=0):this.texture&&(this.texture.baseTexture.scaleMode=1)}}},n.GameObjectFactory=function(e){this.game=e,this.world=this.game.world},n.GameObjectFactory.prototype={existing:function(e){return this.world.add(e)},image:function(e,t,r,i,s){return"undefined"==typeof s&&(s=this.world),s.add(new n.Image(this.game,e,t,r,i))},sprite:function(e,t,n,r,i){return"undefined"==typeof i&&(i=this.world),i.create(e,t,n,r)},tween:function(e){return this.game.tweens.create(e)},group:function(e,t,r,i,s){return new n.Group(this.game,e,t,r,i,s)},physicsGroup:function(e,t,r,i){return new n.Group(this.game,t,r,i,!0,e)},spriteBatch:function(e,t,r){return"undefined"==typeof e&&(e=null),"undefined"==typeof t&&(t="group"),"undefined"==typeof r&&(r=!1),new n.SpriteBatch(this.game,e,t,r)},audio:function(e,t,n,r){return this.game.sound.add(e,t,n,r)},sound:function(e,t,n,r){return this.game.sound.add(e,t,n,r)},audioSprite:function(e){return this.game.sound.addSprite(e)},tileSprite:function(e,t,r,i,s,o,u){return"undefined"==typeof u&&(u=this.world),u.add(new n.TileSprite(this.game,e,t,r,i,s,o))},rope:function(e,t,r,i,s,o){return"undefined"==typeof o&&(o=this.world),o.add(new n.Rope(this.game,e,t,r,i,s))},text:function(e,t,r,i,s){return"undefined"==typeof s&&(s=this.world),s.add(new n.Text(this.game,e,t,r,i))},button:function(e,t,r,i,s,o,u,a,f,l){return"undefined"==typeof l&&(l=this.world),l.add(new n.Button(this.game,e,t,r,i,s,o,u,a,f))},graphics:function(e,t,r){return"undefined"==typeof r&&(r=this.world),r.add(new n.Graphics(this.game,e,t))},emitter:function(e,t,r){return this.game.particles.add(new n.Particles.Arcade.Emitter(this.game,e,t,r))},retroFont:function(e,t,r,i,s,o,u,a,f){return new n.RetroFont(this.game,e,t,r,i,s,o,u,a,f)},bitmapText:function(e,t,r,i,s,o){return"undefined"==typeof o&&(o=this.world),o.add(new n.BitmapText(this.game,e,t,r,i,s))},tilemap:function(e,t,r,i,s){return new n.Tilemap(this.game,e,t,r,i,s)},renderTexture:function(e,t,r,i){("undefined"==typeof r||""===r)&&(r=this.game.rnd.uuid()),"undefined"==typeof i&&(i=!1);var s=new n.RenderTexture(this.game,e,t,r);return i&&this.game.cache.addRenderTexture(r,s),s},bitmapData:function(e,t,r,i){"undefined"==typeof i&&(i=!1),("undefined"==typeof r||""===r)&&(r=this.game.rnd.uuid());var s=new n.BitmapData(this.game,r,e,t);return i&&this.game.cache.addBitmapData(r,s),s},filter:function(e){var t=Array.prototype.splice.call(arguments,1),e=new n.Filter[e](this.game);return e.init.apply(e,t),e},plugin:function(e){return this.game.plugins.add(e)}},n.GameObjectFactory.prototype.constructor=n.GameObjectFactory,n.GameObjectCreator=function(e){this.game=e,this.world=this.game.world},n.GameObjectCreator.prototype={image:function(e,t,r,i){return new n.Image(this.game,e,t,r,i)},sprite:function(e,t,r,i){return new n.Sprite(this.game,e,t,r,i)},tween:function(e){return new n.Tween(e,this.game,this.game.tweens)},group:function(e,t,r,i,s){return new n.Group(this.game,null,t,r,i,s)},spriteBatch:function(e,t,r){return"undefined"==typeof t&&(t="group"),"undefined"==typeof r&&(r=!1),new n.SpriteBatch(this.game,e,t,r)},audio:function(e,t,n,r){return this.game.sound.add(e,t,n,r)},audioSprite:function(e){return this.game.sound.addSprite(e)},sound:function(e,t,n,r){return this.game.sound.add(e,t,n,r)},tileSprite:function(e,t,r,i,s,o){return new n.TileSprite(this.game,e,t,r,i,s,o)},rope:function(e,t,r,i,s){return new n.Rope(this.game,e,t,r,i,s)},text:function(e,t,r,i){return new n.Text(this.game,e,t,r,i)},button:function(e,t,r,i,s,o,u,a,f){return new n.Button(this.game,e,t,r,i,s,o,u,a,f)},graphics:function(e,t){return new n.Graphics(this.game,e,t)},emitter:function(e,t,r){return new n.Particles.Arcade.Emitter(this.game,e,t,r)},retroFont:function(e,t,r,i,s,o,u,a,f){return new n.RetroFont(this.game,e,t,r,i,s,o,u,a,f)},bitmapText:function(e,t,r,i,s){return new n.BitmapText(this.game,e,t,r,i,s)},tilemap:function(e,t,r,i,s){return new n.Tilemap(this.game,e,t,r,i,s)},renderTexture:function(e,t,r,i){("undefined"==typeof r||""===r)&&(r=this.game.rnd.uuid()),"undefined"==typeof i&&(i=!1);var s=new n.RenderTexture(this.game,e,t,r);return i&&this.game.cache.addRenderTexture(r,s),s},bitmapData:function(e,t,r,i){"undefined"==typeof i&&(i=!1),("undefined"==typeof r||""===r)&&(r=this.game.rnd.uuid());var s=new n.BitmapData(this.game,r,e,t);return i&&this.game.cache.addBitmapData(r,s),s},filter:function(e){var t=Array.prototype.splice.call(arguments,1),e=new n.Filter[e](this.game);return e.init.apply(e,t),e}},n.GameObjectCreator.prototype.constructor=n.GameObjectCreator,n.Sprite=function(e,t,r,i,s){t=t||0,r=r||0,i=i||null,s=s||null,this.type=n.SPRITE,this.physicsType=n.SPRITE,PIXI.Sprite.call(this,PIXI.TextureCache.__default),n.Component.Core.init.call(this,e,t,r,i,s)},n.Sprite.prototype=Object.create(PIXI.Sprite.prototype),n.Sprite.prototype.constructor=n.Sprite,n.Component.Core.install.call(n.Sprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]),n.Sprite.prototype.preUpdatePhysics=n.Component.PhysicsBody.preUpdate,n.Sprite.prototype.preUpdateLifeSpan=n.Component.LifeSpan.preUpdate,n.Sprite.prototype.preUpdateInWorld=n.Component.InWorld.preUpdate,n.Sprite.prototype.preUpdateCore=n.Component.Core.preUpdate,n.Sprite.prototype.preUpdate=function(){return this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()?this.preUpdateCore():!1},n.Image=function(e,t,r,i,s){t=t||0,r=r||0,i=i||null,s=s||null,this.type=n.IMAGE,PIXI.Sprite.call(this,PIXI.TextureCache.__default),n.Component.Core.init.call(this,e,t,r,i,s)},n.Image.prototype=Object.create(PIXI.Sprite.prototype),n.Image.prototype.constructor=n.Image,n.Component.Core.install.call(n.Image.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Destroy","FixedToCamera","InputEnabled","LifeSpan","LoadTexture","Overlap","Reset","Smoothed"]),n.Image.prototype.preUpdateInWorld=n.Component.InWorld.preUpdate,n.Image.prototype.preUpdateCore=n.Component.Core.preUpdate,n.Image.prototype.preUpdate=function(){return this.preUpdateInWorld()?this.preUpdateCore():!1},n.TileSprite=function(e,t,r,i,s,o,u){t=t||0,r=r||0,i=i||256,s=s||256,o=o||null,u=u||null,this.type=n.TILESPRITE,this._scroll=new n.Point,PIXI.TilingSprite.call(this,PIXI.TextureCache.__default,i,s),n.Component.Core.init.call(this,e,t,r,o,u)},n.TileSprite.prototype=Object.create(PIXI.TilingSprite.prototype),n.TileSprite.prototype.constructor=n.TileSprite,n.Component.Core.install.call(n.TileSprite.prototype,["Angle","Animation","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LoadTexture","Overlap","PhysicsBody","Reset","Smoothed"]),n.TileSprite.prototype.preUpdatePhysics=n.Component.PhysicsBody.preUpdate,n.TileSprite.prototype.preUpdateLifeSpan=n.Component.LifeSpan.preUpdate,n.TileSprite.prototype.preUpdateInWorld=n.Component.InWorld.preUpdate,n.TileSprite.prototype.preUpdateCore=n.Component.Core.preUpdate,n.TileSprite.prototype.preUpdate=function(){return 0!==this._scroll.x&&(this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed),0!==this._scroll.y&&(this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed),this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()?this.preUpdateCore():!1},n.TileSprite.prototype.autoScroll=function(e,t){this._scroll.set(e,t)},n.TileSprite.prototype.stopScroll=function(){this._scroll.set(0,0)},n.TileSprite.prototype.destroy=function(e){n.Component.Destroy.prototype.destroy.call(this,e),PIXI.TilingSprite.prototype.destroy.call(this)},n.TileSprite.prototype.reset=function(e,t){return n.Component.Reset.prototype.reset.call(this,e,t),this.tilePosition.x=0,this.tilePosition.y=0,this},n.Rope=function(e,t,r,i,s,o){this.points=[],this.points=o,this._hasUpdateAnimation=!1,this._updateAnimationCallback=null,t=t||0,r=r||0,i=i||null,s=s||null,this.type=n.ROPE,this._scroll=new n.Point,PIXI.Rope.call(this,i,this.points),n.Component.Core.init.call(this,e,t,r,i,s)},n.Rope.prototype=Object.create(PIXI.Rope.prototype),n.Rope.prototype.constructor=n.Rope,n.Component.Core.install.call(n.Rope.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]),n.Rope.prototype.preUpdatePhysics=n.Component.PhysicsBody.preUpdate,n.Rope.prototype.preUpdateLifeSpan=n.Component.LifeSpan.preUpdate,n.Rope.prototype.preUpdateInWorld=n.Component.InWorld.preUpdate,n.Rope.prototype.preUpdateCore=n.Component.Core.preUpdate,n.Rope.prototype.preUpdate=function(){return 0!==this._scroll.x&&(this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed),0!==this._scroll.y&&(this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed),this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()?this.preUpdateCore():!1},n.Rope.prototype.update=function(){this._hasUpdateAnimation&&this.updateAnimation.call(this)},n.Rope.prototype.reset=function(e,t){return n.Component.Reset.prototype.reset.call(this,e,t),this.tilePosition.x=0,this.tilePosition.y=0,this},Object.defineProperty(n.Rope.prototype,"updateAnimation",{get:function(){return this._updateAnimation},set:function(e){e&&"function"==typeof e?(this._hasUpdateAnimation=!0,this._updateAnimation=e):(this._hasUpdateAnimation=!1,this._updateAnimation=null)}}),Object.defineProperty(n.Rope.prototype,"segments",{get:function(){for(var e,t,r,i,s,o,u,a,f=[],l=0;l<this.points.length;l++)e=4*l,t=this.verticies[e],r=this.verticies[e+1],i=this.verticies[e+4],s=this.verticies[e+3],o=n.Math.difference(t,i),u=n.Math.difference(r,s),t+=this.world.x,r+=this.world.y,a=new n.Rectangle(t,r,o,u),f.push(a);return f}}),n.Button=function(e,t,r,i,s,o,u,a,f,l){t=t||0,r=r||0,i=i||null,s=s||null,o=o||this,n.Image.call(this,e,t,r,i,a),this.type=n.BUTTON,this.physicsType=n.SPRITE,this._onOverFrame=null,this._onOutFrame=null,this._onDownFrame=null,this._onUpFrame=null,this.onOverSound=null,this.onOutSound=null,this.onDownSound=null,this.onUpSound=null,this.onOverSoundMarker="",this.onOutSoundMarker="",this.onDownSoundMarker="",this.onUpSoundMarker="",this.onInputOver=new n.Signal,this.onInputOut=new n.Signal,this.onInputDown=new n.Signal,this.onInputUp=new n.Signal,this.onOverMouseOnly=!1,this.freezeFrames=!1,this.forceOut=!1,this.inputEnabled=!0,this.input.start(0,!0),this.setFrames(u,a,f,l),null!==s&&this.onInputUp.add(s,o),this.events.onInputOver.add(this.onInputOverHandler,this),this.events.onInputOut.add(this.onInputOutHandler,this),this.events.onInputDown.add(this.onInputDownHandler,this),this.events.onInputUp.add(this.onInputUpHandler,this),this.events.onRemovedFromWorld.add(this.removedFromWorld,this)},n.Button.prototype=Object.create(n.Image.prototype),n.Button.prototype.constructor=n.Button;var s="Over",o="Out",u="Down",a="Up";n.Button.prototype.clearFrames=function(){this.setFrames(null,null,null,null)},n.Button.prototype.removedFromWorld=function(){this.inputEnabled=!1},n.Button.prototype.setStateFrame=function(e,t,n){var r="_on"+e+"Frame";null!=t?(this[r]=t,n&&this.changeStateFrame(e)):this[r]=null},n.Button.prototype.changeStateFrame=function(e){if(this.freezeFrames)return!1;var t="_on"+e+"Frame",n=this[t];return"string"==typeof n?(this.frameName=n,!0):"number"==typeof n?(this.frame=n,!0):!1},n.Button.prototype.setFrames=function(e,t,n,r){this.setStateFrame(s,e,this.input.pointerOver()),this.setStateFrame(o,t,!this.input.pointerOver()),this.setStateFrame(u,n,this.input.pointerDown()),this.setStateFrame(a,r,this.input.pointerUp())},n.Button.prototype.setStateSound=function(e,t,r){var i="on"+e+"Sound",s="on"+e+"SoundMarker";t instanceof n.Sound||t instanceof n.AudioSprite?(this[i]=t,this[s]="string"==typeof r?r:""):(this[i]=null,this[s]="")},n.Button.prototype.playStateSound=function(e){var t="on"+e+"Sound",n=this[t];if(n){var r="on"+e+"SoundMarker",i=this[r];return n.play(i),!0}return!1},n.Button.prototype.setSounds=function(e,t,n,r,i,f,l,c){this.setStateSound(s,e,t),this.setStateSound(o,i,f),this.setStateSound(u,n,r),this.setStateSound(a,l,c)},n.Button.prototype.setOverSound=function(e,t){this.setStateSound(s,e,t)},n.Button.prototype.setOutSound=function(e,t){this.setStateSound(o,e,t)},n.Button.prototype.setDownSound=function(e,t){this.setStateSound(u,e,t)},n.Button.prototype.setUpSound=function(e,t){this.setStateSound(a,e,t)},n.Button.prototype.onInputOverHandler=function(e,t){t.justReleased()||(this.changeStateFrame(s),(!this.onOverMouseOnly||t.isMouse)&&(this.playStateSound(s),this.onInputOver&&this.onInputOver.dispatch(this,t)))},n.Button.prototype.onInputOutHandler=function(e,t){this.changeStateFrame(o),this.playStateSound(o),this.onInputOut&&this.onInputOut.dispatch(this,t)},n.Button.prototype.onInputDownHandler=function(e,t){this.changeStateFrame(u),this.playStateSound(u),this.onInputDown&&this.onInputDown.dispatch(this,t)},n.Button.prototype.onInputUpHandler=function(e,t,n){if(this.playStateSound(a),this.onInputUp&&this.onInputUp.dispatch(this,t,n),!this.freezeFrames)if(this.forceOut)this.changeStateFrame(o);else{var r=this.changeStateFrame(a);r||this.changeStateFrame(n?s:o)}},n.SpriteBatch=function(e,t,r,i){("undefined"==typeof t||null===t)&&(t=e.world),PIXI.SpriteBatch.call(this),n.Group.call(this,e,t,r,i),this.type=n.SPRITEBATCH},n.SpriteBatch.prototype=n.Utils.extend(!0,n.SpriteBatch.prototype,n.Group.prototype,PIXI.SpriteBatch.prototype),n.SpriteBatch.prototype.constructor=n.SpriteBatch,n.Particle=function(e,t,r,i,s){n.Sprite.call(this,e,t,r,i,s),this.autoScale=!1,this.scaleData=null,this._s=0,this.autoAlpha=!1,this.alphaData=null,this._a=0},n.Particle.prototype=Object.create(n.Sprite.prototype),n.Particle.prototype.constructor=n.Particle,n.Particle.prototype.update=function(){this.autoScale&&(this._s--,this._s?this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y):this.autoScale=!1),this.autoAlpha&&(this._a--,this._a?this.alpha=this.alphaData[this._a].v:this.autoAlpha=!1)},n.Particle.prototype.onEmit=function(){},n.Particle.prototype.setAlphaData=function(e){this.alphaData=e,this._a=e.length-1,this.alpha=this.alphaData[this._a].v,this.autoAlpha=!0},n.Particle.prototype.setScaleData=function(e){this.scaleData=e,this._s=e.length-1,this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y),this.autoScale=!0},n.Particle.prototype.reset=function(e,t,r){return n.Component.Reset.prototype.reset.call(this,e,t,r),this.alpha=1,this.scale.set(1),this.autoScale=!1,this.autoAlpha=!1,this},n.BitmapData=function(e,t,r,i){"undefined"==typeof r&&(r=256),"undefined"==typeof i&&(i=256),this.game=e,this.key=t,this.width=r,this.height=i,this.canvas=n.Canvas.create(r,i,"",!0),this.context=this.canvas.getContext("2d",{alpha:!0}),this.ctx=this.context,this.imageData=this.context.getImageData(0,0,r,i),this.data=this.imageData.data,this.pixels=null,this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data,this.baseTexture=new PIXI.BaseTexture(this.canvas),this.texture=new PIXI.Texture(this.baseTexture),this.textureFrame=new n.Frame(0,0,0,r,i,"bitmapData",e.rnd.uuid()),this.texture.frame=this.textureFrame,this.type=n.BITMAPDATA,this.disableTextureUpload=!1,this.dirty=!1,this.cls=this.clear,this._image=null,this._pos=new n.Point,this._size=new n.Point,this._scale=new n.Point,this._rotate=0,this._alpha={prev:1,current:1},this._anchor=new n.Point,this._tempR=0,this._tempG=0,this._tempB=0,this._circle=new n.Circle},n.BitmapData.prototype={add:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)e[t].loadTexture&&e[t].loadTexture(this);else e.loadTexture(this);return this},load:function(e){return"string"==typeof e&&(e=this.game.cache.getImage(e)),e?(this.resize(e.width,e.height),this.cls(),this.draw(e),this.update(),this):void 0},clear:function(){return this.context.clearRect(0,0,this.width,this.height),this.dirty=!0,this},fill:function(e,t,n,r){return"undefined"==typeof r&&(r=1),this.context.fillStyle="rgba("+e+","+t+","+n+","+r+")",this.context.fillRect(0,0,this.width,this.height),this.dirty=!0,this},resize:function(e,t){return(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.canvas.width=e,this.canvas.height=t,this.baseTexture.width=e,this.baseTexture.height=t,this.textureFrame.width=e,this.textureFrame.height=t,this.texture.width=e,this.texture.height=t,this.texture.crop.width=e,this.texture.crop.height=t,this.update(),this.dirty=!0),this},update:function(e,t,n,r){return"undefined"==typeof e&&(e=0),"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=this.width),"undefined"==typeof r&&(r=this.height),this.imageData=this.context.getImageData(e,t,n,r),this.data=this.imageData.data,this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data,this},processPixelRGB:function(e,t,r,i,s,o){"undefined"==typeof r&&(r=0),"undefined"==typeof i&&(i=0),"undefined"==typeof s&&(s=this.width),"undefined"==typeof o&&(o=this.height);for(var u=r+s,a=i+o,f=n.Color.createColor(),l={r:0,g:0,b:0,a:0},c=!1,h=i;a>h;h++)for(var p=r;u>p;p++)n.Color.unpackPixel(this.getPixel32(p,h),f),l=e.call(t,f,p,h),l!==!1&&null!==l&&void 0!==l&&(this.setPixel32(p,h,l.r,l.g,l.b,l.a,!1),c=!0);return c&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},processPixel:function(e,t,n,r,i,s){"undefined"==typeof n&&(n=0),"undefined"==typeof r&&(r=0),"undefined"==typeof i&&(i=this.width),"undefined"==typeof s&&(s=this.height);for(var o=n+i,u=r+s,a=0,f=0,l=!1,c=r;u>c;c++)for(var h=n;o>h;h++)a=this.getPixel32(h,c),f=e.call(t,a,h,c),f!==a&&(this.pixels[c*this.width+h]=f,l=!0);return l&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},replaceRGB:function(e,t,r,i,s,o,u,a,f){var l=0,c=0,h=this.width,p=this.height,d=n.Color.packPixel(e,t,r,i);void 0!==f&&f instanceof n.Rectangle&&(l=f.x,c=f.y,h=f.width,p=f.height);for(var v=0;p>v;v++)for(var m=0;h>m;m++)this.getPixel32(l+m,c+v)===d&&this.setPixel32(l+m,c+v,s,o,u,a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this},setHSL:function(e,t,r,i){if(("undefined"==typeof e||null===e)&&(e=!1),("undefined"==typeof t||null===t)&&(t=!1),("undefined"==typeof r||null===r)&&(r=!1),e||t||r){"undefined"==typeof i&&(i=new n.Rectangle(0,0,this.width,this.height));for(var s=n.Color.createColor(),o=i.y;o<i.bottom;o++)for(var u=i.x;u<i.right;u++)n.Color.unpackPixel(this.getPixel32(u,o),s,!0),e&&(s.h=e),t&&(s.s=t),r&&(s.l=r),n.Color.HSLtoRGB(s.h,s.s,s.l,s),this.setPixel32(u,o,s.r,s.g,s.b,s.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},shiftHSL:function(e,t,r,i){if(("undefined"==typeof e||null===e)&&(e=!1),("undefined"==typeof t||null===t)&&(t=!1),("undefined"==typeof r||null===r)&&(r=!1),e||t||r){"undefined"==typeof i&&(i=new n.Rectangle(0,0,this.width,this.height));for(var s=n.Color.createColor(),o=i.y;o<i.bottom;o++)for(var u=i.x;u<i.right;u++)n.Color.unpackPixel(this.getPixel32(u,o),s,!0),e&&(s.h=this.game.math.wrap(s.h+e,0,1)),t&&(s.s=this.game.math.limitValue(s.s+t,0,1)),r&&(s.l=this.game.math.limitValue(s.l+r,0,1)),n.Color.HSLtoRGB(s.h,s.s,s.l,s),this.setPixel32(u,o,s.r,s.g,s.b,s.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},setPixel32:function(e,t,r,i,s,o,u){return"undefined"==typeof u&&(u=!0),e>=0&&e<=this.width&&t>=0&&t<=this.height&&(this.pixels[t*this.width+e]=n.Device.LITTLE_ENDIAN?o<<24|s<<16|i<<8|r:r<<24|i<<16|s<<8|o,u&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0)),this},setPixel:function(e,t,n,r,i,s){return this.setPixel32(e,t,n,r,i,255,s)},getPixel:function(e,t,r){r||(r=n.Color.createColor());var i=~~(e+t*this.width);return i*=4,r.r=this.data[i],r.g=this.data[++i],r.b=this.data[++i],r.a=this.data[++i],r},getPixel32:function(e,t){return e>=0&&e<=this.width&&t>=0&&t<=this.height?this.pixels[t*this.width+e]:void 0},getPixelRGB:function(e,t,r,i,s){return n.Color.unpackPixel(this.getPixel32(e,t),r,i,s)},getPixels:function(e){return this.context.getImageData(e.x,e.y,e.width,e.height)},getFirstPixel:function(e){"undefined"==typeof e&&(e=0);var t=n.Color.createColor(),r=0,i=0,s=1,o=!1;1===e?(s=-1,i=this.height):3===e&&(s=-1,r=this.width);do n.Color.unpackPixel(this.getPixel32(r,i),t),0===e||1===e?(r++,r===this.width&&(r=0,i+=s,(i>=this.height||0>=i)&&(o=!0))):(2===e||3===e)&&(i++,i===this.height&&(i=0,r+=s,(r>=this.width||0>=r)&&(o=!0)));while(0===t.a&&!o);return t.x=r,t.y=i,t},getBounds:function(e){return"undefined"==typeof e&&(e=new n.Rectangle),e.x=this.getFirstPixel(2).x,e.x===this.width?e.setTo(0,0,0,0):(e.y=this.getFirstPixel(0).y,e.width=this.getFirstPixel(3).x-e.x+1,e.height=this.getFirstPixel(1).y-e.y+1,e)},addToWorld:function(e,t,n,r,i,s){i=i||1,s=s||1;var o=this.game.add.image(e,t,this);return o.anchor.set(n,r),o.scale.set(i,s),o},copy:function(e,t,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){if(("undefined"==typeof e||null===e)&&(e=this),this._image=e,e instanceof n.Sprite||e instanceof n.Image||e instanceof n.Text)this._pos.set(e.texture.crop.x,e.texture.crop.y),this._size.set(e.texture.crop.width,e.texture.crop.height),this._scale.set(e.scale.x,e.scale.y),this._anchor.set(e.anchor.x,e.anchor.y),this._rotate=e.rotation,this._alpha.current=e.alpha,this._image=e.texture.baseTexture.source,("undefined"==typeof o||null===o)&&(o=e.x),("undefined"==typeof u||null===u)&&(u=e.y),e.texture.trim&&(o+=e.texture.trim.x-e.anchor.x*e.texture.trim.width,u+=e.texture.trim.y-e.anchor.y*e.texture.trim.height),16777215!==e.tint&&(e.cachedTint!==e.tint&&(e.cachedTint=e.tint,e.tintedTexture=PIXI.CanvasTinter.getTintedTexture(e,e.tint)),this._image=e.tintedTexture);else{if(this._pos.set(0),this._scale.set(1),this._anchor.set(0),this._rotate=0,this._alpha.current=1,e instanceof n.BitmapData)this._image=e.canvas;else if("string"==typeof e){if(e=this.game.cache.getImage(e),null===e)return;this._image=e}this._size.set(this._image.width,this._image.height)}return("undefined"==typeof t||null===t)&&(t=0),("undefined"==typeof r||null===r)&&(r=0),i&&(this._size.x=i),s&&(this._size.y=s),("undefined"==typeof o||null===o)&&(o=t),("undefined"==typeof u||null===u)&&(u=r),("undefined"==typeof a||null===a)&&(a=this._size.x),("undefined"==typeof f||null===f)&&(f=this._size.y),"number"==typeof l&&(this._rotate=l),"number"==typeof c&&(this._anchor.x=c),"number"==typeof h&&(this._anchor.y=h),"number"==typeof p&&(this._scale.x=p),"number"==typeof d&&(this._scale.y=d),"number"==typeof v&&(this._alpha.current=v),"undefined"==typeof m&&(m=null),"undefined"==typeof g&&(g=!1),this._alpha.current<=0||0===this._scale.x||0===this._scale.y||0===this._size.x||0===this._size.y?void 0:(this._alpha.prev=this.context.globalAlpha,this.context.save(),this.context.globalAlpha=this._alpha.current,m&&(this.context.globalCompositeOperation=m),g&&(o|=0,u|=0),this.context.translate(o,u),this.context.scale(this._scale.x,this._scale.y),this.context.rotate(this._rotate),this.context.drawImage(this._image,this._pos.x+t,this._pos.y+r,this._size.x,this._size.y,-a*this._anchor.x,-f*this._anchor.y,a,f),this.context.restore(),this.context.globalAlpha=this._alpha.prev,this.dirty=!0,this)},copyRect:function(e,t,n,r,i,s,o){return this.copy(e,t.x,t.y,t.width,t.height,n,r,t.width,t.height,0,0,0,1,1,i,s,o)},draw:function(e,t,n,r,i,s,o){return this.copy(e,null,null,null,null,t,n,r,i,null,null,null,null,null,null,s,o)},drawGroup:function(e,t,n){return e.total>0&&e.forEachExists(this.copy,this,null,null,null,null,null,null,null,null,null,null,null,null,null,null,t,n),this},shadow:function(e,t,n,r){"undefined"==typeof e||null===e?this.context.shadowColor="rgba(0,0,0,0)":(this.context.shadowColor=e,this.context.shadowBlur=t||5,this.context.shadowOffsetX=n||10,this.context.shadowOffsetY=r||10)},alphaMask:function(e,t,n,r){return"undefined"==typeof r||null===r?this.draw(t).blendSourceAtop():this.draw(t,r.x,r.y,r.width,r.height).blendSourceAtop(),"undefined"==typeof n||null===n?this.draw(e).blendReset():this.draw(e,n.x,n.y,n.width,n.height).blendReset(),this},extract:function(e,t,n,r,i,s,o,u,a){return"undefined"==typeof i&&(i=255),"undefined"==typeof s&&(s=!1),"undefined"==typeof o&&(o=t),"undefined"==typeof u&&(u=n),"undefined"==typeof a&&(a=r),s&&e.resize(this.width,this.height),this.processPixelRGB(function(s,f,l){return s.r===t&&s.g===n&&s.b===r&&e.setPixel32(f,l,o,u,a,i,!1),!1},this),e.context.putImageData(e.imageData,0,0),e.dirty=!0,e},rect:function(e,t,n,r,i){return"undefined"!=typeof i&&(this.context.fillStyle=i),this.context.fillRect(e,t,n,r),this},text:function(e,t,n,r,i,s){"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=0),"undefined"==typeof r&&(r="14px Courier"),"undefined"==typeof i&&(i="rgb(255,255,255)"),"undefined"==typeof s&&(s=!0);var o=this.context.font;this.context.font=r,s&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(e,t+1,n+1)),this.context.fillStyle=i,this.context.fillText(e,t,n),this.context.font=o},circle:function(e,t,n,r){return"undefined"!=typeof r&&(this.context.fillStyle=r),this.context.beginPath(),this.context.arc(e,t,n,0,2*Math.PI,!1),this.context.closePath(),this.context.fill(),this},textureLine:function(e,t,r){if("undefined"==typeof r&&(r="repeat-x"),"string"!=typeof t||(t=this.game.cache.getImage(t))){var i=e.length;return"no-repeat"===r&&i>t.width&&(i=t.width),this.context.fillStyle=this.context.createPattern(t,r),this._circle=new n.Circle(e.start.x,e.start.y,t.height),this._circle.circumferencePoint(e.angle-1.5707963267948966,!1,this._pos),this.context.save(),this.context.translate(this._pos.x,this._pos.y),this.context.rotate(e.angle),this.context.fillRect(0,0,i,t.height),this.context.restore(),this.dirty=!0,this}},render:function(){return!this.disableTextureUpload&&this.dirty&&(this.baseTexture.dirty(),this.dirty=!1),this},blendReset:function(){return this.context.globalCompositeOperation="source-over",this},blendSourceOver:function(){return this.context.globalCompositeOperation="source-over",this},blendSourceIn:function(){return this.context.globalCompositeOperation="source-in",this},blendSourceOut:function(){return this.context.globalCompositeOperation="source-out",this},blendSourceAtop:function(){return this.context.globalCompositeOperation="source-atop",this},blendDestinationOver:function(){return this.context.globalCompositeOperation="destination-over",this},blendDestinationIn:function(){return this.context.globalCompositeOperation="destination-in",this},blendDestinationOut:function(){return this.context.globalCompositeOperation="destination-out",this},blendDestinationAtop:function(){return this.context.globalCompositeOperation="destination-atop",this},blendXor:function(){return this.context.globalCompositeOperation="xor",this},blendAdd:function(){return this.context.globalCompositeOperation="lighter",this},blendMultiply:function(){return this.context.globalCompositeOperation="multiply",this},blendScreen:function(){return this.context.globalCompositeOperation="screen",this},blendOverlay:function(){return this.context.globalCompositeOperation="overlay",this},blendDarken:function(){return this.context.globalCompositeOperation="darken",this},blendLighten:function(){return this.context.globalCompositeOperation="lighten",this},blendColorDodge:function(){return this.context.globalCompositeOperation="color-dodge",this},blendColorBurn:function(){return this.context.globalCompositeOperation="color-burn",this},blendHardLight:function(){return this.context.globalCompositeOperation="hard-light",this},blendSoftLight:function(){return this.context.globalCompositeOperation="soft-light",this},blendDifference:function(){return this.context.globalCompositeOperation="difference",this},blendExclusion:function(){return this.context.globalCompositeOperation="exclusion",this},blendHue:function(){return this.context.globalCompositeOperation="hue",this},blendSaturation:function(){return this.context.globalCompositeOperation="saturation",this},blendColor:function(){return this.context.globalCompositeOperation="color",this},blendLuminosity:function(){return this.context.globalCompositeOperation="luminosity",this}},Object.defineProperty(n.BitmapData.prototype,"smoothed",{get:function(){n.Canvas.getSmoothingEnabled(this.context)},set:function(e){n.Canvas.setSmoothingEnabled(this.context,e)}}),n.BitmapData.getTransform=function(e,t,n,r,i,s){return"number"!=typeof e&&(e=0),"number"!=typeof t&&(t=0),"number"!=typeof n&&(n=1),"number"!=typeof r&&(r=1),"number"!=typeof i&&(i=0),"number"!=typeof s&&(s=0),{sx:n,sy:r,scaleX:n,scaleY:r,skewX:i,skewY:s,translateX:e,translateY:t,tx:e,ty:t}},n.BitmapData.prototype.constructor=n.BitmapData,n.Graphics=function(e,t,r){t=t||0,r=r||0,this.type=n.GRAPHICS,this.physicsType=n.SPRITE,PIXI.Graphics.call(this),n.Component.Core.init.call(this,e,t,r,"",null)},n.Graphics.prototype=Object.create(PIXI.Graphics.prototype),n.Graphics.prototype.constructor=n.Graphics,n.Component.Core.install.call(n.Graphics.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]),n.Graphics.prototype.preUpdatePhysics=n.Component.PhysicsBody.preUpdate,n.Graphics.prototype.preUpdateLifeSpan=n.Component.LifeSpan.preUpdate,n.Graphics.prototype.preUpdateInWorld=n.Component.InWorld.preUpdate,n.Graphics.prototype.preUpdateCore=n.Component.Core.preUpdate,n.Graphics.prototype.preUpdate=function(){return this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()?this.preUpdateCore():!1},n.Graphics.prototype.destroy=function(e){this.clear(),n.Component.Destroy.prototype.destroy.call(this,e)},n.Graphics.prototype.drawTriangle=function(e,t){"undefined"==typeof t&&(t=!1);var r=new n.Polygon(e);if(t){var i=new n.Point(this.game.camera.x-e[0].x,this.game.camera.y-e[0].y),s=new n.Point(e[1].x-e[0].x,e[1].y-e[0].y),o=new n.Point(e[1].x-e[2].x,e[1].y-e[2].y),u=o.cross(s);i.dot(u)>0&&this.drawPolygon(r)}else this.drawPolygon(r)},n.Graphics.prototype.drawTriangles=function(e,t,r){"undefined"==typeof r&&(r=!1);var i,s=new n.Point,o=new n.Point,u=new n.Point,a=[];if(t)if(e[0]instanceof n.Point)for(i=0;i<t.length/3;i++)a.push(e[t[3*i]]),a.push(e[t[3*i+1]]),a.push(e[t[3*i+2]]),3===a.length&&(this.drawTriangle(a,r),a=[]);else for(i=0;i<t.length;i++)s.x=e[2*t[i]],s.y=e[2*t[i]+1],a.push(s.copyTo({})),3===a.length&&(this.drawTriangle(a,r),a=[]);else if(e[0]instanceof n.Point)for(i=0;i<e.length/3;i++)this.drawTriangle([e[3*i],e[3*i+1],e[3*i+2]],r);else for(i=0;i<e.length/6;i++)s.x=e[6*i+0],s.y=e[6*i+1],o.x=e[6*i+2],o.y=e[6*i+3],u.x=e[6*i+4],u.y=e[6*i+5],this.drawTriangle([s,o,u],r)},n.RenderTexture=function(e,t,r,i,s,o){"undefined"==typeof i&&(i=""),"undefined"==typeof s&&(s=n.scaleModes.DEFAULT),"undefined"==typeof o&&(o=1),this.game=e,this.key=i,this.type=n.RENDERTEXTURE,this.matrix=new PIXI.Matrix,PIXI.RenderTexture.call(this,t,r,this.game.renderer,s,o),this.render=n.RenderTexture.prototype.render},n.RenderTexture.prototype=Object.create(PIXI.RenderTexture.prototype),n.RenderTexture.prototype.constructor=n.RenderTexture,n.RenderTexture.prototype.renderXY=function(e,t,n,r){this.matrix.tx=t,this.matrix.ty=n,this.renderer.type===PIXI.WEBGL_RENDERER?this.renderWebGL(e,this.matrix,r):this.renderCanvas(e,this.matrix,r)},n.RenderTexture.prototype.render=function(e,t,n){this.matrix.tx=t.x,this.matrix.ty=t.y,this.renderer.type===PIXI.WEBGL_RENDERER?this.renderWebGL(e,this.matrix,n):this.renderCanvas(e,this.matrix,n)},n.Text=function(e,t,r,i,s){t=t||0,r=r||0,i=i||" ",s=s||{},i=0===i.length?" ":i.toString(),this.type=n.TEXT,this.physicsType=n.SPRITE,this.padding=new n.Point,this._text=i,this._fontComponents=null,this._lineSpacing=0,this._charCount=0,this.colors=[],this.setStyle(s),PIXI.Text.call(this,i,this.style),n.Component.Core.init.call(this,e,t,r,"",null)," "!==i&&this.updateText()},n.Text.prototype=Object.create(PIXI.Text.prototype),n.Text.prototype.constructor=n.Text,n.Component.Core.install.call(n.Text.prototype,["Angle","AutoCull","Bounds","BringToTop","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","Overlap","PhysicsBody","Reset","Smoothed"]),n.Text.prototype.preUpdatePhysics=n.Component.PhysicsBody.preUpdate,n.Text.prototype.preUpdateLifeSpan=n.Component.LifeSpan.preUpdate,n.Text.prototype.preUpdateInWorld=n.Component.InWorld.preUpdate,n.Text.prototype.preUpdateCore=n.Component.Core.preUpdate,n.Text.prototype.preUpdate=function(){return this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()?this.preUpdateCore():!1},n.Text.prototype.update=function(){},n.Text.prototype.destroy=function(e){this.texture.destroy(!0),this.canvas&&this.canvas.parentNode?this.canvas.parentNode.removeChild(this.canvas):(this.canvas=null,this.context=null),n.Component.Destroy.prototype.destroy.call(this,e)},n.Text.prototype.setShadow=function(e,t,n,r){"undefined"==typeof e&&(e=0),"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n="rgba(0, 0, 0, 1)"),"undefined"==typeof r&&(r=0),this.style.shadowOffsetX=e,this.style.shadowOffsetY=t,this.style.shadowColor=n,this.style.shadowBlur=r,this.dirty=!0},n.Text.prototype.setStyle=function(e){e=e||{},e.font=e.font||"bold 20pt Arial",e.backgroundColor=e.backgroundColor||null,e.fill=e.fill||"black",e.align=e.align||"left",e.stroke=e.stroke||"black",e.strokeThickness=e.strokeThickness||0,e.wordWrap=e.wordWrap||!1,e.wordWrapWidth=e.wordWrapWidth||100,e.shadowOffsetX=e.shadowOffsetX||0,e.shadowOffsetY=e.shadowOffsetY||0,e.shadowColor=e.shadowColor||"rgba(0,0,0,0)",e.shadowBlur=e.shadowBlur||0;var t=this.fontToComponents(e.font);e.fontStyle&&(t.fontStyle=e.fontStyle),e.fontVariant&&(t.fontVariant=e.fontVariant),e.fontWeight&&(t.fontWeight=e.fontWeight),e.fontSize&&("number"==typeof e.fontSize&&(e.fontSize=e.fontSize+"px"),t.fontSize=e.fontSize),this._fontComponents=t,e.font=this.componentsToFont(this._fontComponents),this.style=e,this.dirty=!0},n.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this.resolution,this.context.font=this.style.font;var e=this.text;this.style.wordWrap&&(e=this.runWordWrap(this.text));for(var t=e.split(/(?:\r\n|\r|\n)/),n=[],r=0,i=this.determineFontProperties(this.style.font),s=0;s<t.length;s++){var o=this.context.measureText(t[s]).width+this.padding.x;n[s]=o,r=Math.max(r,o)}var u=r+this.style.strokeThickness;this.canvas.width=u*this.resolution;var a=i.fontSize+this.style.strokeThickness+this.padding.y,f=a*t.length,l=this._lineSpacing;if(0>l&&Math.abs(l)>a&&(l=-a),0!==l){var c=l*(t.length-1);f+=c}this.canvas.height=f*this.resolution,this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.style.backgroundColor&&(this.context.fillStyle=this.style.backgroundColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)),this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.textBaseline="alphabetic",this.context.shadowOffsetX=this.style.shadowOffsetX,this.context.shadowOffsetY=this.style.shadowOffsetY,this.context.shadowColor=this.style.shadowColor,this.context.shadowBlur=this.style.shadowBlur,this.context.lineWidth=this.style.strokeThickness,this.context.lineCap="round",this.context.lineJoin="round";var h,p;for(this._charCount=0,s=0;s<t.length;s++)h=this.style.strokeThickness/2,p=this.style.strokeThickness/2+s*a+i.ascent,s>0&&(p+=l*s),"right"===this.style.align?h+=r-n[s]:"center"===this.style.align&&(h+=(r-n[s])/2),this.colors.length>0?this.updateLine(t[s],h,p):(this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(t[s],h,p),this.style.fill&&this.context.fillText(t[s],h,p));this.updateTexture()},n.Text.prototype.updateLine=function(e,t,n){for(var r=0;r<e.length;r++){var i=e[r];this.colors[this._charCount]&&(this.context.fillStyle=this.colors[this._charCount],this.context.strokeStyle=this.colors[this._charCount]),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(i,t,n),this.style.fill&&this.context.fillText(i,t,n),t+=this.context.measureText(i).width,this._charCount++}},n.Text.prototype.clearColors=function(){this.colors=[],this.dirty=!0},n.Text.prototype.addColor=function(e,t){this.colors[t]=e,this.dirty=!0},n.Text.prototype.runWordWrap=function(e){for(var t="",n=e.split("\n"),r=0;r<n.length;r++){for(var i=this.style.wordWrapWidth,s=n[r].split(" "),o=0;o<s.length;o++){var u=this.context.measureText(s[o]).width,a=u+this.context.measureText(" ").width;a>i?(o>0&&(t+="\n"),t+=s[o]+" ",i=this.style.wordWrapWidth-u):(i-=a,t+=s[o]+" ")}r<n.length-1&&(t+="\n")}return t},n.Text.prototype.updateFont=function(e){var t=this.componentsToFont(e);this.style.font!==t&&(this.style.font=t,this.dirty=!0,this.parent&&this.updateTransform())},n.Text.prototype.fontToComponents=function(e){var t=e.match(/^\s*(?:\b(normal|italic|oblique|inherit)?\b)\s*(?:\b(normal|small-caps|inherit)?\b)\s*(?:\b(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit)?\b)\s*(?:\b(xx-small|x-small|small|medium|large|x-large|xx-large|larger|smaller|0|\d*(?:[.]\d*)?(?:%|[a-z]{2,5}))?\b)\s*(.*)\s*$/);return t?{font:e,fontStyle:t[1]||"normal",fontVariant:t[2]||"normal",fontWeight:t[3]||"normal",fontSize:t[4]||"medium",fontFamily:t[5]}:(console.warn("Phaser.Text - unparsable CSS font: "+e),{font:e})},n.Text.prototype.componentsToFont=function(e){var t,n=[];return t=e.fontStyle,t&&"normal"!==t&&n.push(t),t=e.fontVariant,t&&"normal"!==t&&n.push(t),t=e.fontWeight,t&&"normal"!==t&&n.push(t),t=e.fontSize,t&&"medium"!==t&&n.push(t),t=e.fontFamily,t&&n.push(t),n.length||n.push(e.font),n.join(" ")},Object.defineProperty(n.Text.prototype,"text",{get:function(){return this._text},set:function(e){e!==this._text&&(this._text=e.toString()||" ",this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(n.Text.prototype,"cssFont",{get:function(){return this.componentsToFont(this._fontComponents)},set:function(e){e=e||"bold 20pt Arial",this._fontComponents=this.fontToComponents(e),this.updateFont(this._fontComponents)}}),Object.defineProperty(n.Text.prototype,"font",{get:function(){return this._fontComponents.fontFamily},set:function(e){e=e||"Arial",e=e.trim(),/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(e)||/['",]/.exec(e)||(e="'"+e+"'"),this._fontComponents.fontFamily=e,this.updateFont(this._fontComponents)}}),Object.defineProperty(n.Text.prototype,"fontSize",{get:function(){var e=this._fontComponents.fontSize;return e&&/(?:^0$|px$)/.exec(e)?parseInt(e,10):e},set:function(e){e=e||"0","number"==typeof e&&(e+="px"),this._fontComponents.fontSize=e,this.updateFont(this._fontComponents)}}),Object.defineProperty(n.Text.prototype,"fontWeight",{get:function(){return this._fontComponents.fontWeight||"normal"},set:function(e){e=e||"normal",this._fontComponents.fontWeight=e,this.updateFont(this._fontComponents)}}),Object.defineProperty(n.Text.prototype,"fontStyle",{get:function(){return this._fontComponents.fontStyle||"normal"},set:function(e){e=e||"normal",this._fontComponents.fontStyle=e,this.updateFont(this._fontComponents)}}),Object.defineProperty(n.Text.prototype,"fontVariant",{get:function(){return this._fontComponents.fontVariant||"normal"},set:function(e){e=e||"normal",this._fontComponents.fontVariant=e,this.updateFont(this._fontComponents)}}),Object.defineProperty(n.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(e){e!==this.style.fill&&(this.style.fill=e,this.dirty=!0)}}),Object.defineProperty(n.Text.prototype,"align",{get:function(){return this.style.align},set:function(e){e!==this.style.align&&(this.style.align=e,this.dirty=!0)}}),Object.defineProperty(n.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(e){e!==this.style.stroke&&(this.style.stroke=e,this.dirty=!0)}}),Object.defineProperty(n.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(e){e!==this.style.strokeThickness&&(this.style.strokeThickness=e,this.dirty=!0)}}),Object.defineProperty(n.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(e){e!==this.style.wordWrap&&(this.style.wordWrap=e,this.dirty=!0)}}),Object.defineProperty(n.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(e){e!==this.style.wordWrapWidth&&(this.style.wordWrapWidth=e,this.dirty=!0)}}),Object.defineProperty(n.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(e){e!==this._lineSpacing&&(this._lineSpacing=parseFloat(e),this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(n.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(e){e!==this.style.shadowOffsetX&&(this.style.shadowOffsetX=e,this.dirty=!0)}}),Object.defineProperty(n.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(e){e!==this.style.shadowOffsetY&&(this.style.shadowOffsetY=e,this.dirty=!0)}}),Object.defineProperty(n.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(e){e!==this.style.shadowColor&&(this.style.shadowColor=e,this.dirty=!0)}}),Object.defineProperty(n.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(e){e!==this.style.shadowBlur&&(this.style.shadowBlur=e,this.dirty=!0)}}),n.BitmapText=function(e,t,r,i,s,o){t=t||0,r=r||0,i=i||"",s=s||"",o=o||32,this.type=n.BITMAPTEXT,this.physicsType=n.SPRITE,this._text=s,this._font=i,this._fontSize=o,this._align="left",this._tint=16777215,this._tw=0,this._th=0,PIXI.BitmapText.call(this,s),n.Component.Core.init.call(this,e,t,r,"",null)},n.BitmapText.prototype=Object.create(PIXI.BitmapText.prototype),n.BitmapText.prototype.constructor=n.BitmapText,n.Component.Core.install.call(n.BitmapText.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]),n.BitmapText.prototype.preUpdatePhysics=n.Component.PhysicsBody.preUpdate,n.BitmapText.prototype.preUpdateLifeSpan=n.Component.LifeSpan.preUpdate,n.BitmapText.prototype.preUpdateInWorld=n.Component.InWorld.preUpdate,n.BitmapText.prototype.preUpdateCore=n.Component.Core.preUpdate,n.BitmapText.prototype.preUpdate=function(){return this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld()?this.preUpdateCore():!1},n.BitmapText.prototype.postUpdate=function(){n.Component.PhysicsBody.postUpdate.call(this),n.Component.FixedToCamera.postUpdate.call(this),!this.body||this.textWidth===this._tw&&this.textHeight===this._th||(this.body.setSize(this.textWidth,this.textHeight),this._tw=this.textWidth,this._th=this.textHeight)},n.BitmapText.prototype.setStyle=function(){this.style={align:this._align},this.fontName=this._font,this.fontSize=this._fontSize,this.dirty=!0},Object.defineProperty(n.BitmapText.prototype,"align",{get:function(){return this._align},set:function(e){e!==this._align&&(this._align=e,this.setStyle())}}),Object.defineProperty(n.BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(e){e!==this._tint&&(this._tint=e,this.dirty=!0)}}),Object.defineProperty(n.BitmapText.prototype,"font",{get:function(){return this._font},set:function(e){e!==this._font&&(this._font=e.trim(),this.fontName=this._font,this.style.font=this._fontSize+"px '"+this._font+"'",this.dirty=!0)}}),Object.defineProperty(n.BitmapText.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){e=parseInt(e,10),e!==this._fontSize&&(this._fontSize=e,this.style.font=this._fontSize+"px '"+this._font+"'",this.dirty=!0)}}),Object.defineProperty(n.BitmapText.prototype,"text",{get:function(){return this._text},set:function(e){e!==this._text&&(this._text=e.toString()||" ",this.dirty=!0)}}),n.RetroFont=function(e,t,r,i,s,o,u,a,f,l){if(!e.cache.checkImageKey(t))return!1;("undefined"==typeof o||null===o)&&(o=e.cache.getImage(t).width/r),this.characterWidth=r,this.characterHeight=i,this.characterSpacingX=u||0,this.characterSpacingY=a||0,this.characterPerRow=o,this.offsetX=f||0,this.offsetY=l||0,this.align="left",this.multiLine=!1,this.autoUpperCase=!0,this.customSpacingX=0,this.customSpacingY=0,this.fixedWidth=0,this.fontSet=e.cache.getImage(t),this._text="",this.grabData=[],this.frameData=new n.FrameData;for(var c=this.offsetX,h=this.offsetY,p=0,d=0;d<s.length;d++){var v=e.rnd.uuid(),m=this.frameData.addFrame(new n.Frame(d,c,h,this.characterWidth,this.characterHeight,"",v));this.grabData[s.charCodeAt(d)]=m.index,PIXI.TextureCache[v]=new PIXI.Texture(PIXI.BaseTextureCache[t],{x:c,y:h,width:this.characterWidth,height:this.characterHeight}),p++,p==this.characterPerRow?(p=0,c=this.offsetX,h+=this.characterHeight+this.characterSpacingY):c+=this.characterWidth+this.characterSpacingX}e.cache.updateFrameData(t,this.frameData),this.stamp=new n.Image(e,0,0,t,0),n.RenderTexture.call(this,e,100,100,"",n.scaleModes.NEAREST),this.type=n.RETROFONT},n.RetroFont.prototype=Object.create(n.RenderTexture.prototype),n.RetroFont.prototype.constructor=n.RetroFont,n.RetroFont.ALIGN_LEFT="left",n.RetroFont.ALIGN_RIGHT="right",n.RetroFont.ALIGN_CENTER="center",n.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",n.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ",n.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ",n.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789",n.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789",n.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ",n.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39",n.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ",n.RetroFont.TEXT_SET9="ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!",n.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ",n.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789",n.RetroFont.prototype.setFixedWidth=function(e,t){"undefined"==typeof t&&(t="left"),this.fixedWidth=e,this.align=t},n.RetroFont.prototype.setText=function(e,t,n,r,i,s){this.multiLine=t||!1,this.customSpacingX=n||0,this.customSpacingY=r||0,this.align=i||"left",this.autoUpperCase=s?!1:!0,e.length>0&&(this.text=e)},n.RetroFont.prototype.buildRetroFontText=function(){var e=0,t=0;if(this.clear(),this.multiLine){var r=this._text.split("\n");this.fixedWidth>0?this.resize(this.fixedWidth,r.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0):this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),r.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0);for(var i=0;i<r.length;i++){switch(this.align){case n.RetroFont.ALIGN_LEFT:e=0;break;case n.RetroFont.ALIGN_RIGHT:e=this.width-r[i].length*(this.characterWidth+this.customSpacingX);break;case n.RetroFont.ALIGN_CENTER:e=this.width/2-r[i].length*(this.characterWidth+this.customSpacingX)/2,e+=this.customSpacingX/2}0>e&&(e=0),this.pasteLine(r[i],e,t,this.customSpacingX),t+=this.characterHeight+this.customSpacingY}}else{switch(this.fixedWidth>0?this.resize(this.fixedWidth,this.characterHeight,!0):this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,!0),this.align){case n.RetroFont.ALIGN_LEFT:e=0;break;case n.RetroFont.ALIGN_RIGHT:e=this.width-this._text.length*(this.characterWidth+this.customSpacingX);break;case n.RetroFont.ALIGN_CENTER:e=this.width/2-this._text.length*(this.characterWidth+this.customSpacingX)/2,e+=this.customSpacingX/2}this.textureBuffer.clear(),this.pasteLine(this._text,e,0,this.customSpacingX)}},n.RetroFont.prototype.pasteLine=function(e,t,r,i){for(var s=new n.Point,o=0;o<e.length;o++)if(" "==e.charAt(o))t+=this.characterWidth+i;else if(this.grabData[e.charCodeAt(o)]>=0&&(this.stamp.frame=this.grabData[e.charCodeAt(o)],s.set(t,r),this.render(this.stamp,s,!1),t+=this.characterWidth+i,t>this.width))break},n.RetroFont.prototype.getLongestLine=function(){var e=0;if(this._text.length>0)for(var t=this._text.split("\n"),n=0;n<t.length;n++)t[n].length>e&&(e=t[n].length);return e},n.RetroFont.prototype.removeUnsupportedCharacters=function(e){for(var t="",n=0;n<this._text.length;n++){var r=this._text[n],i=r.charCodeAt(0);(this.grabData[i]>=0||!e&&"\n"===r)&&(t=t.concat(r))}return t},n.RetroFont.prototype.updateOffset=function(e,t){if(this.offsetX!==e||this.offsetY!==t){for(var n=e-this.offsetX,r=t-this.offsetY,i=this.game.cache.getFrameData(this.stamp.key).getFrames(),s=i.length;s--;)i[s].x+=n,i[s].y+=r,PIXI.TextureCache[i[s].uuid].frame.x=i[s].x,PIXI.TextureCache[i[s].uuid].frame.y=i[s].y;this.buildRetroFontText()}},Object.defineProperty(n.RetroFont.prototype,"text",{get:function(){return this._text},set:function(e){var t;t=this.autoUpperCase?e.toUpperCase():e,t!==this._text&&(this._text=t,this.removeUnsupportedCharacters(this.multiLine),this.buildRetroFontText())}}),Object.defineProperty(n.RetroFont.prototype,"smoothed",{get:function(){return this.stamp.smoothed},set:function(e){this.stamp.smoothed=e,this.buildRetroFontText()}}),n.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!1,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.epiphany=!1,this.firefox=!1,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},n.Device=new n.Device,n.Device.onInitialized=new n.Signal,n.Device.whenReady=function(e,t,n){var r=this._readyCheck;if(this.deviceReadyAt||!r)e.call(t,this);else if(r._monitor||n)r._queue=r._queue||[],r._queue.push([e,t]);else{r._monitor=r.bind(this),r._queue=r._queue||[],r._queue.push([e,t]);var i="undefined"!=typeof window.cordova,s=navigator.isCocoonJS;"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(r._monitor,0):i&&!s?document.addEventListener("deviceready",r._monitor,!1):(document.addEventListener("DOMContentLoaded",r._monitor,!1),window.addEventListener("load",r._monitor,!1))}},n.Device._readyCheck=function(){var e=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",e._monitor),document.removeEventListener("DOMContentLoaded",e._monitor),window.removeEventListener("load",e._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(var t;t=e._queue.shift();){var n=t[0],r=t[1];n.call(r,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}}else window.setTimeout(e._monitor,20)},n.Device._initialize=function(){function e(){var e=navigator.userAgent;/Playstation Vita/.test(e)?l.vita=!0:/Kindle/.test(e)||/\bKF[A-Z][A-Z]+/.test(e)||/Silk.*Mobile Safari/.test(e)?l.kindle=!0:/Android/.test(e)?l.android=!0:/CrOS/.test(e)?l.chromeOS=!0:/iP[ao]d|iPhone/i.test(e)?l.iOS=!0:/Linux/.test(e)?l.linux=!0:/Mac OS/.test(e)?l.macOS=!0:/Windows/.test(e)&&(l.windows=!0,/Windows Phone/i.test(e)&&(l.windowsPhone=!0));var t=/Silk/.test(e);(l.windows||l.macOS||l.linux&&!t||l.chromeOS)&&(l.desktop=!0),(l.windowsPhone||/Windows NT/i.test(e)&&/Touch/i.test(e))&&(l.desktop=!1)}function t(){l.canvas=!!window.CanvasRenderingContext2D||l.cocoonJS;try{l.localStorage=!!localStorage.getItem}catch(e){l.localStorage=!1}l.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),l.fileSystem=!!window.requestFileSystem,l.webGL=function(){try{var e=document.createElement("canvas");return e.screencanvas=!1,!!window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch(t){return!1}}(),l.webGL=!!l.webGL,l.worker=!!window.Worker,l.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,l.quirksMode="CSS1Compat"===document.compatMode?!1:!0,l.getUserMedia=!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),!l.iOS&&(l.ie||l.firefox||l.chrome)&&(l.canvasBitBltShift=!0),(l.safari||l.mobileSafari)&&(l.canvasBitBltShift=!1)}function n(){("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)&&(l.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(l.mspointer=!0),l.cocoonJS||("onwheel"in window||l.ie&&"WheelEvent"in window?l.wheelEvent="wheel":"onmousewheel"in window?l.wheelEvent="mousewheel":l.firefox&&"MouseScrollEvent"in window&&(l.wheelEvent="DOMMouseScroll"))}function r(){for(var e=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],t=document.createElement("div"),n=0;n<e.length;n++)if(t[e[n]]){l.fullscreen=!0,l.requestFullscreen=e[n];break}var r=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(l.fullscreen)for(var n=0;n<r.length;n++)if(document[r[n]]){l.cancelFullscreen=r[n];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(l.fullscreenKeyboard=!0)}function i(){var e=navigator.userAgent;if(/Arora/.test(e)?l.arora=!0:/Chrome/.test(e)?l.chrome=!0:/Epiphany/.test(e)?l.epiphany=!0:/Firefox/.test(e)?l.firefox=!0:/AppleWebKit/.test(e)&&l.iOS?l.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(e)?(l.ie=!0,l.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(e)?l.midori=!0:/Opera/.test(e)?l.opera=!0:/Safari/.test(e)?l.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(e)&&(l.ie=!0,l.trident=!0,l.tridentVersion=parseInt(RegExp.$1,10),l.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(e)&&(l.silk=!0),navigator.standalone&&(l.webApp=!0),"undefined"!=typeof window.cordova&&(l.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(l.node=!0),l.node)try{l.nodeWebkit="undefined"!=typeof require("nw.gui")}catch(t){l.nodeWebkit=!1}if(navigator.isCocoonJS&&(l.cocoonJS=!0),l.cocoonJS)try{l.cocoonJSApp="undefined"!=typeof CocoonJS}catch(t){l.cocoonJSApp=!1}"undefined"!=typeof window.ejecta&&(l.ejecta=!0),/Crosswalk/.test(e)&&(l.crosswalk=!0)}function s(){l.audioData=!!window.Audio,l.webAudio=!!window.AudioContext||!!window.webkitAudioContext;var e=document.createElement("audio"),t=!1;try{(t=!!e.canPlayType)&&(e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(l.ogg=!0),(e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||e.canPlayType("audio/opus;").replace(/^no$/,""))&&(l.opus=!0),e.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(l.mp3=!0),e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(l.wav=!0),(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/aac;").replace(/^no$/,""))&&(l.m4a=!0),e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(l.webm=!0))}catch(n){}}function o(){l.pixelRatio=window.devicePixelRatio||1,l.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),l.iPhone4=2==l.pixelRatio&&l.iPhone,l.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),l.typedArray="undefined"!=typeof Int8Array?!0:!1,"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint32Array&&(l.littleEndian=u(),l.LITTLE_ENDIAN=l.littleEndian),l.support32bit="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof Int32Array&&null!==l.littleEndian&&a(),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(l.vibration=!0)}function u(){var e=new ArrayBuffer(4),t=new Uint8Array(e),n=new Uint32Array(e);return t[0]=161,t[1]=178,t[2]=195,t[3]=212,3569595041==n[0]?!0:2712847316==n[0]?!1:null}function a(){if("undefined"==typeof Uint8ClampedArray)return!1;var e=document.createElement("canvas"),t=e.getContext("2d");if(!t)return!1;var n=t.createImageData(1,1);return n.data instanceof Uint8ClampedArray}function f(){var e,t=document.createElement("p"),n={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(t,null);for(var r in n)void 0!==t.style[r]&&(t.style[r]="translate3d(1px,1px,1px)",e=window.getComputedStyle(t).getPropertyValue(n[r]));document.body.removeChild(t),l.css3D=void 0!==e&&e.length>0&&"none"!==e}var l=this;e(),s(),i(),f(),o(),t(),r(),n()},n.Device.canPlayAudio=function(e){return"mp3"==e&&this.mp3?!0:"ogg"==e&&(this.ogg||this.opus)?!0:"m4a"==e&&this.m4a?!0:"opus"==e&&this.opus?!0:"wav"==e&&this.wav?!0:"webm"==e&&this.webm?!0:!1},n.Device.isConsoleOpen=function(){return window.console&&window.console.firebug?!0:window.console&&(console.profile(),console.profileEnd(),console.clear&&console.clear(),console.profiles)?console.profiles.length>0:!1},n.Device.isAndroidStockBrowser=function(){var e=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return e&&e[1]<537},n.DOM={getOffset:function(e,t){t=t||new n.Point;var r=e.getBoundingClientRect(),i=n.DOM.scrollY,s=n.DOM.scrollX,o=document.documentElement.clientTop,u=document.documentElement.clientLeft;return t.x=r.left+s-u,t.y=r.top+i-o,t},getBounds:function(e,t){return"undefined"==typeof t&&(t=0),e=e&&!e.nodeType?e[0]:e,e&&1===e.nodeType?this.calibrate(e.getBoundingClientRect(),t):!1},calibrate:function(e,t){t=+t||0;var n={width:0,height:0,left:0,right:0,top:0,bottom:0};return n.width=(n.right=e.right+t)-(n.left=e.left-t),n.height=(n.bottom=e.bottom+t)-(n.top=e.top-t),n},getAspectRatio:function(e){e=null==e?this.visualBounds:1===e.nodeType?this.getBounds(e):e;var t=e.width,n=e.height;return"function"==typeof t&&(t=t.call(e)),"function"==typeof n&&(n=n.call(e)),t/n},inLayoutViewport:function(e,t){var n=this.getBounds(e,t);return!!n&&n.bottom>=0&&n.right>=0&&n.top<=this.layoutBounds.width&&n.left<=this.layoutBounds.height},getScreenOrientation:function(e){var t=window.screen,n=t.orientation||t.mozOrientation||t.msOrientation;if(n&&"string"==typeof n.type)return n.type;if("string"==typeof n)return n;var r="portrait-primary",i="landscape-primary";if("screen"===e)return t.height>t.width?r:i;if("viewport"===e)return this.visualBounds.height>this.visualBounds.width?r:i;if("window.orientation"===e&&"number"==typeof window.orientation)return 0===window.orientation||180===window.orientation?r:i;if(window.matchMedia){if(window.matchMedia("(orientation: portrait)").matches)return r;if(window.matchMedia("(orientation: landscape)").matches)return i}return this.visualBounds.height>this.visualBounds.width?r:i},visualBounds:new n.Rectangle,layoutBounds:new n.Rectangle,documentBounds:new n.Rectangle},n.Device.whenReady(function(e){var t=window&&"pageXOffset"in window?function(){return window.pageXOffset}:function(){return document.documentElement.scrollLeft},r=window&&"pageYOffset"in window?function(){return window.pageYOffset}:function(){return document.documentElement.scrollTop};Object.defineProperty(n.DOM,"scrollX",{get:t}),Object.defineProperty(n.DOM,"scrollY",{get:r}),Object.defineProperty(n.DOM.visualBounds,"x",{get:t}),Object.defineProperty(n.DOM.visualBounds,"y",{get:r}),Object.defineProperty(n.DOM.layoutBounds,"x",{value:0}),Object.defineProperty(n.DOM.layoutBounds,"y",{value:0});var i=e.desktop&&document.documentElement.clientWidth<=window.innerWidth&&document.documentElement.clientHeight<=window.innerHeight;if(i){var s=function(){return Math.max(window.innerWidth,document.documentElement.clientWidth)},o=function(){return Math.max(window.innerHeight,document.documentElement.clientHeight)};Object.defineProperty(n.DOM.visualBounds,"width",{get:s}),Object.defineProperty(n.DOM.visualBounds,"height",{get:o}),Object.defineProperty(n.DOM.layoutBounds,"width",{get:s}),Object.defineProperty(n.DOM.layoutBounds,"height",{get:o})}else Object.defineProperty(n.DOM.visualBounds,"width",{get:function(){return window.innerWidth}}),Object.defineProperty(n.DOM.visualBounds,"height",{get:function(){return window.innerHeight}}),Object.defineProperty(n.DOM.layoutBounds,"width",{get:function(){var e=document.documentElement.clientWidth,t=window.innerWidth;return t>e?t:e}}),Object.defineProperty(n.DOM.layoutBounds,"height",{get:function(){var e=document.documentElement.clientHeight,t=window.innerHeight;return t>e?t:e}});Object.defineProperty(n.DOM.documentBounds,"x",{value:0}),Object.defineProperty(n.DOM.documentBounds,"y",{value:0}),Object.defineProperty(n.DOM.documentBounds,"width",{get:function(){var e=document.documentElement;return Math.max(e.clientWidth,e.offsetWidth,e.scrollWidth)}}),Object.defineProperty(n.DOM.documentBounds,"height",{get:function(){var e=document.documentElement;return Math.max(e.clientHeight,e.offsetHeight,e.scrollHeight)}})},null,!0),n.Canvas={create:function(e,t,n){e=e||256,t=t||256;var r=document.createElement("canvas");return"string"==typeof n&&""!==n&&(r.id=n),r.width=e,r.height=t,r.style.display="block",r},setBackgroundColor:function(e,t){return t=t||"rgb(0,0,0)",e.style.backgroundColor=t,e},setTouchAction:function(e,t){return t=t||"none",e.style.msTouchAction=t,e.style["ms-touch-action"]=t,e.style["touch-action"]=t,e},setUserSelect:function(e,t){return t=t||"none",e.style["-webkit-touch-callout"]=t,e.style["-webkit-user-select"]=t,e.style["-khtml-user-select"]=t,e.style["-moz-user-select"]=t,e.style["-ms-user-select"]=t,e.style["user-select"]=t,e.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)",e},addToDOM:function(e,t,n){var r;return"undefined"==typeof n&&(n=!0),t&&("string"==typeof t?r=document.getElementById(t):"object"==typeof t&&1===t.nodeType&&(r=t)),r||(r=document.body),n&&r.style&&(r.style.overflow="hidden"),r.appendChild(e),e},removeFromDOM:function(e){e.parentNode&&e.parentNode.removeChild(e)},setTransform:function(e,t,n,r,i,s,o){return e.setTransform(r,s,o,i,t,n),e},setSmoothingEnabled:function(e,t){return e.imageSmoothingEnabled=t,e.mozImageSmoothingEnabled=t,e.oImageSmoothingEnabled=t,e.webkitImageSmoothingEnabled=t,e.msImageSmoothingEnabled=t,e},getSmoothingEnabled:function(e){return e.imageSmoothingEnabled||e.mozImageSmoothingEnabled||e.oImageSmoothingEnabled||e.webkitImageSmoothingEnabled||e.msImageSmoothingEnabled},setImageRenderingCrisp:function(e){return e.style["image-rendering"]="optimizeSpeed",e.style["image-rendering"]="crisp-edges",e.style["image-rendering"]="-moz-crisp-edges",e.style["image-rendering"]="-webkit-optimize-contrast",e.style["image-rendering"]="optimize-contrast",e.style["image-rendering"]="pixelated",e.style.msInterpolationMode="nearest-neighbor",e},setImageRenderingBicubic:function(e){return e.style["image-rendering"]="auto",e.style.msInterpolationMode="bicubic",e}},n.Canvas.getOffset=n.DOM.getOffset,n.Canvas.getAspectRatio=n.DOM.getAspectRatio,n.RequestAnimationFrame=function(e,t){"undefined"==typeof t&&(t=!1),this.game=e,this.isRunning=!1,this.forceSetTimeOut=t;for(var n=["ms","moz","webkit","o"],r=0;r<n.length&&!window.requestAnimationFrame;r++)window.requestAnimationFrame=window[n[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n[r]+"CancelAnimationFrame"];this._isSetTimeOut=!1,this._onLoop=null,this._timeOutID=null},n.RequestAnimationFrame.prototype={start:function(){this.isRunning=!0;var e=this;!window.requestAnimationFrame||this.forceSetTimeOut?(this._isSetTimeOut=!0,this._onLoop=function(){return e.updateSetTimeout()},this._timeOutID=window.setTimeout(this._onLoop,0)):(this._isSetTimeOut=!1,this._onLoop=function(t){return e.updateRAF(t)},this._timeOutID=window.requestAnimationFrame(this._onLoop))},updateRAF:function(e){this.game.update(Math.floor(e)),this._timeOutID=window.requestAnimationFrame(this._onLoop)},updateSetTimeout:function(){this.game.update(Date.now()),this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall)},stop:function(){this._isSetTimeOut?clearTimeout(this._timeOutID):window.cancelAnimationFrame(this._timeOutID),this.isRunning=!1},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return this._isSetTimeOut===!1}},n.RequestAnimationFrame.prototype.constructor=n.RequestAnimationFrame,n.Math={PI2:2*Math.PI,fuzzyEqual:function(e,t,n){return"undefined"==typeof n&&(n=1e-4),Math.abs(e-t)<n},fuzzyLessThan:function(e,t,n){return"undefined"==typeof n&&(n=1e-4),t+n>e},fuzzyGreaterThan:function(e,t,n){return"undefined"==typeof n&&(n=1e-4),e>t-n},fuzzyCeil:function(e,t){return"undefined"==typeof t&&(t=1e-4),Math.ceil(e-t)},fuzzyFloor:function(e,t){return"undefined"==typeof t&&(t=1e-4),Math.floor(e+t)},average:function(){for(var e=0,t=0;t<arguments.length;t++)e+=+arguments[t];return e/arguments.length},truncate:function(e){return Math.trunc(e)},shear:function(e){return e%1},snapTo:function(e,t,n){return"undefined"==typeof n&&(n=0),0===t?e:(e-=n,e=t*Math.round(e/t),n+e)},snapToFloor:function(e,t,n){return"undefined"==typeof n&&(n=0),0===t?e:(e-=n,e=t*Math.floor(e/t),n+e)},snapToCeil:function(e,t,n){return"undefined"==typeof n&&(n=0),0===t?e:(e-=n,e=t*Math.ceil(e/t),n+e)},snapToInArray:function(e,t,r){return"undefined"==typeof r&&(r=!0),r&&t.sort(),n.ArrayUtils.findClosest(e,t)},roundTo:function(e,t,n){"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=10);var r=Math.pow(n,-t);return Math.round(e*r)/r},floorTo:function(e,t,n){"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=10);var r=Math.pow(n,-t);return Math.floor(e*r)/r},ceilTo:function(e,t,n){"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=10);var r=Math.pow(n,-t);return Math.ceil(e*r)/r},interpolateFloat:function(e,t,n){return(t-e)*n+e},angleBetween:function(e,t,n,r){return Math.atan2(r-t,n-e)},angleBetweenY:function(e,t,n,r){return Math.atan2(n-e,r-t)},angleBetweenPoints:function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},angleBetweenPointsY:function(e,t){return Math.atan2(t.x-e.x,t.y-e.y)},reverseAngle:function(e){return this.normalizeAngle(e+Math.PI,!0)},normalizeAngle:function(e){return e%=2*Math.PI,e>=0?e:e+2*Math.PI},normalizeLatitude:function(e){return n.Math.clamp(e,-90,90)},normalizeLongitude:function(e){return n.Math.wrap(e,-180,180)},chanceRoll:function(e){return n.Utils.chanceRoll(e)},numberArray:function(e,t){return n.ArrayUtils.numberArray(e,t)},numberArrayStep:function(e,t,r){return n.ArrayUtils.numberArrayStep(e,t,r)},maxAdd:function(e,t,n){return Math.min(e+t,n)},minSub:function(e,t,n){return Math.max(e-t,n)},wrap:function(e,t,n){var r=n-t;if(0>=r)return 0;var i=(e-t)%r;return 0>i&&(i+=r),i+t},wrapValue:function(e,t,n){var r;return e=Math.abs(e),t=Math.abs(t),n=Math.abs(n),r=(e+t)%n},limitValue:function(e,t,r){return n.Math.clamp(e,t,r)},randomSign:function(){return n.Utils.randomChoice(-1,1)},isOdd:function(e){return 1&e},isEven:function(e){return!(1&e)},min:function(){if(1===arguments.length&&"object"==typeof arguments[0])var e=arguments[0];else var e=arguments;for(var t=1,n=0,r=e.length;r>t;t++)e[t]<e[n]&&(n=t);return e[n]},max:function(){if(1===arguments.length&&"object"==typeof arguments[0])var e=arguments[0];else var e=arguments;for(var t=1,n=0,r=e.length;r>t;t++)e[t]>e[n]&&(n=t);return e[n]},minProperty:function(e){if(2===arguments.length&&"object"==typeof arguments[1])var t=arguments[1];else var t=arguments.slice(1);for(var n=1,r=0,i=t.length;i>n;n++)t[n][e]<t[r][e]&&(r=n);return t[r][e]},maxProperty:function(e){if(2===arguments.length&&"object"==typeof arguments[1])var t=arguments[1];else var t=arguments.slice(1);for(var n=1,r=0,i=t.length;i>n;n++)t[n][e]>t[r][e]&&(r=n);return t[r][e]},wrapAngle:function(e,t){return t?this.wrap(e,-Math.PI,Math.PI):this.wrap(e,-180,180)},angleLimit:function(e,t,n){var r=e;return e>n?r=n:t>e&&(r=t),r},linearInterpolation:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r);return 0>t?this.linear(e[0],e[1],r):t>1?this.linear(e[n],e[n-1],n-r):this.linear(e[i],e[i+1>n?n:i+1],r-i)},bezierInterpolation:function(e,t){for(var n=0,r=e.length-1,i=0;r>=i;i++)n+=Math.pow(1-t,r-i)*Math.pow(t,i)*e[i]*this.bernstein(r,i);return n},catmullRomInterpolation:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r);return e[0]===e[n]?(0>t&&(i=Math.floor(r=n*(1+t))),this.catmullRom(e[(i-1+n)%n],e[i],e[(i+1)%n],e[(i+2)%n],r-i)):0>t?e[0]-(this.catmullRom(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[n]-(this.catmullRom(e[n],e[n],e[n-1],e[n-1],r-n)-e[n]):this.catmullRom(e[i?i-1:0],e[i],e[i+1>n?n:i+1],e[i+2>n?n:i+2],r-i)},linear:function(e,t,n){return(t-e)*n+e},bernstein:function(e,t){return this.factorial(e)/this.factorial(t)/this.factorial(e-t)},factorial:function(e){if(0===e)return 1;for(var t=e;--e;)t*=e;return t},catmullRom:function(e,t,n,r,i){var s=.5*(n-e),o=.5*(r-t),u=i*i,a=i*u;return(2*t-2*n+s+o)*a+(-3*t+3*n-2*s-o)*u+s*i+t},difference:function(e,t){return Math.abs(e-t)},getRandom:function(e,t,r){return n.ArrayUtils.getRandomItem(e,t,r)},removeRandom:function(e,t,r){return n.ArrayUtils.removeRandomItem(e,t,r)},floor:function(e){return Math.trunc(e)},ceil:function(e){return n.Math.roundAwayFromZero(e)},roundAwayFromZero:function(e){return e>0?Math.ceil(e):Math.floor(e)},sinCosGenerator:function(e,t,n,r){"undefined"==typeof t&&(t=1),"undefined"==typeof n&&(n=1),"undefined"==typeof r&&(r=1);for(var i=t,s=n,o=r*Math.PI/e,u=[],a=[],f=0;e>f;f++)s-=i*o,i+=s*o,u[f]=s,a[f]=i;return{sin:a,cos:u,length:e}},shift:function(e){var t=e.shift();return e.push(t),t},shuffleArray:function(e){return n.ArrayUtils.shuffle(e)},distance:function(e,t,n,r){var i=e-n,s=t-r;return Math.sqrt(i*i+s*s)},distancePow:function(e,t,n,r,i){return"undefined"==typeof i&&(i=2),Math.sqrt(Math.pow(n-e,i)+Math.pow(r-t,i))},distanceRounded:function(e,t,r,i){return Math.round(n.Math.distance(e,t,r,i))},clamp:function(e,t,n){return t>e?t:e>n?n:e},clampBottom:function(e,t){return t>e?t:e},within:function(e,t,n){return Math.abs(e-t)<=n},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},smoothstep:function(e,t,n){return e=Math.max(0,Math.min(1,(e-t)/(n-t))),e*e*(3-2*e)},smootherstep:function(e,t,n){return e=Math.max(0,Math.min(1,(e-t)/(n-t))),e*e*e*(e*(6*e-15)+10)},sign:function(e){return 0>e?-1:e>0?1:0},percent:function(e,t,n){return"undefined"==typeof n&&(n=0),e>t||n>t?1:n>e||n>e?0:(e-n)/t}};var f=Math.PI/180,l=180/Math.PI;n.Math.degToRad=function(e){return e*f},n.Math.radToDeg=function(e){return e*l},n.RandomDataGenerator=function(e){"undefined"==typeof e&&(e=[]),this.c=1,this.s0=0,this.s1=0,this.s2=0,this.sow(e)},n.RandomDataGenerator.prototype={rnd:function(){var e=2091639*this.s0+2.3283064365386963e-10*this.c;return this.c=0|e,this.s0=this.s1,this.s1=this.s2,this.s2=e-this.c,this.s2},sow:function(e){if(this.s0=this.hash(" "),this.s1=this.hash(this.s0),this.s2=this.hash(this.s1),this.c=1,e)for(var t=0;t<e.length&&null!=e[t];t++){var n=e[t];this.s0-=this.hash(n),this.s0+=~~(this.s0<0),this.s1-=this.hash(n),this.s1+=~~(this.s1<0),this.s2-=this.hash(n),this.s2+=~~(this.s2<0)}},hash:function(e){var t,n,r;for(r=4022871197,e=e.toString(),n=0;n<e.length;n++)r+=e.charCodeAt(n),t=.02519603282416938*r,r=t>>>0,t-=r,t*=r,r=t>>>0,t-=r,r+=4294967296*t;return 2.3283064365386963e-10*(r>>>0)},integer:function(){return 4294967296*this.rnd.apply(this)},frac:function(){return this.rnd.apply(this)+1.1102230246251565e-16*(2097152*this.rnd.apply(this)|0)},real:function(){return this.integer()+this.frac()},integerInRange:function(e,t){return Math.floor(this.realInRange(0,t-e+1)+e)},between:function(e,t){return this.integerInRange(e,t)},realInRange:function(e,t){return this.frac()*(t-e)+e},normal:function(){return 1-2*this.frac()},uuid:function(){var e="",t="";for(t=e="";e++<36;t+=~e%5|3*e&4?(15^e?8^this.frac()*(20^e?16:4):4).toString(16):"-");return t},pick:function(e){return e[this.integerInRange(0,e.length-1)]},weightedPick:function(e){return e[~~(Math.pow(this.frac(),2)*(e.length-1))]},timestamp:function(e,t){return this.realInRange(e||9466848e5,t||1577862e6)},angle:function(){return this.integerInRange(-180,180)}},n.RandomDataGenerator.prototype.constructor=n.RandomDataGenerator,n.QuadTree=function(e,t,n,r,i,s,o){this.maxObjects=10,this.maxLevels=4,this.level=0,this.bounds={},this.objects=[],this.nodes=[],this._empty=[],this.reset(e,t,n,r,i,s,o)},n.QuadTree.prototype={reset:function(e,t,n,r,i,s,o){this.maxObjects=i||10,this.maxLevels=s||4,this.level=o||0,this.bounds={x:Math.round(e),y:Math.round(t),width:n,height:r,subWidth:Math.floor(n/2),subHeight:Math.floor(r/2),right:Math.round(e)+Math.floor(n/2),bottom:Math.round(t)+Math.floor(r/2)},this.objects.length=0,this.nodes.length=0},populate:function(e){e.forEach(this.populateHandler,this,!0)},populateHandler:function(e){e.body&&e.exists&&this.insert(e.body)},split:function(){this.nodes[0]=new n.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[1]=new n.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[2]=new n.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[3]=new n.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1)},insert:function(e){var t,n=0;if(null!=this.nodes[0]&&(t=this.getIndex(e),-1!==t))return void this.nodes[t].insert(e);if(this.objects.push(e),this.objects.length>this.maxObjects&&this.level<this.maxLevels)for(null==this.nodes[0]&&this.split();n<this.objects.length;)t=this.getIndex(this.objects[n]),-1!==t?this.nodes[t].insert(this.objects.splice(n,1)[0]):n++},getIndex:function(e){var t=-1;return e.x<this.bounds.right&&e.right<this.bounds.right?e.y<this.bounds.bottom&&e.bottom<this.bounds.bottom?t=1:e.y>this.bounds.bottom&&(t=2):e.x>this.bounds.right&&(e.y<this.bounds.bottom&&e.bottom<this.bounds.bottom?t=0:e.y>this.bounds.bottom&&(t=3)),t},retrieve:function(e){if(e instanceof n.Rectangle)var t=this.objects,r=this.getIndex(e);else{if(!e.body)return this._empty;var t=this.objects,r=this.getIndex(e.body)}return this.nodes[0]&&(-1!==r?t=t.concat(this.nodes[r].retrieve(e)):(t=t.concat(this.nodes[0].retrieve(e)),t=t.concat(this.nodes[1].retrieve(e)),t=t.concat(this.nodes[2].retrieve(e)),t=t.concat(this.nodes[3].retrieve(e)))),t},clear:function(){this.objects.length=0;for(var e=this.nodes.length;e--;)this.nodes[e].clear(),this.nodes.splice(e,1);this.nodes.length=0}},n.QuadTree.prototype.constructor=n.QuadTree,n.Net=function(e){this.game=e},n.Net.prototype={getHostName:function(){return window.location&&window.location.hostname?window.location.hostname:null},checkDomainName:function(e){return-1!==window.location.hostname.indexOf(e)},updateQueryString:function(e,t,n,r){"undefined"==typeof n&&(n=!1),("undefined"==typeof r||""===r)&&(r=window.location.href);var i="",s=new RegExp("([?|&])"+e+"=.*?(&|#|$)(.*)","gi");if(s.test(r))i="undefined"!=typeof t&&null!==t?r.replace(s,"$1"+e+"="+t+"$2$3"):r.replace(s,"$1$3").replace(/(&|\?)$/,"");else if("undefined"!=typeof t&&null!==t){var o=-1!==r.indexOf("?")?"&":"?",u=r.split("#");r=u[0]+o+e+"="+t,u[1]&&(r+="#"+u[1]),i=r}else i=r;return n?void (window.location.href=i):i},getQueryString:function(e){"undefined"==typeof e&&(e="");var t={},n=location.search.substring(1).split("&");for(var r in n){var i=n[r].split("=");if(i.length>1){if(e&&e==this.decodeURI(i[0]))return this.decodeURI(i[1]);t[this.decodeURI(i[0])]=this.decodeURI(i[1])}}return t},decodeURI:function(e){return decodeURIComponent(e.replace(/\+/g," "))}},n.Net.prototype.constructor=n.Net,n.TweenManager=function(e){this.game=e,this._tweens=[],this._add=[],this.easeMap={Power0:n.Easing.Power0,Power1:n.Easing.Power1,Power2:n.Easing.Power2,Power3:n.Easing.Power3,Power4:n.Easing.Power4,Linear:n.Easing.Linear.None,Quad:n.Easing.Quadratic.Out,Cubic:n.Easing.Cubic.Out,Quart:n.Easing.Quartic.Out,Quint:n.Easing.Quintic.Out,Sine:n.Easing.Sinusoidal.Out,Expo:n.Easing.Exponential.Out,Circ:n.Easing.Circular.Out,Elastic:n.Easing.Elastic.Out,Back:n.Easing.Back.Out,Bounce:n.Easing.Bounce.Out,"Quad.easeIn":n.Easing.Quadratic.In,"Cubic.easeIn":n.Easing.Cubic.In,"Quart.easeIn":n.Easing.Quartic.In,"Quint.easeIn":n.Easing.Quintic.In,"Sine.easeIn":n.Easing.Sinusoidal.In,"Expo.easeIn":n.Easing.Exponential.In,"Circ.easeIn":n.Easing.Circular.In,"Elastic.easeIn":n.Easing.Elastic.In,"Back.easeIn":n.Easing.Back.In,"Bounce.easeIn":n.Easing.Bounce.In,"Quad.easeOut":n.Easing.Quadratic.Out,"Cubic.easeOut":n.Easing.Cubic.Out,"Quart.easeOut":n.Easing.Quartic.Out,"Quint.easeOut":n.Easing.Quintic.Out,"Sine.easeOut":n.Easing.Sinusoidal.Out,"Expo.easeOut":n.Easing.Exponential.Out,"Circ.easeOut":n.Easing.Circular.Out,"Elastic.easeOut":n.Easing.Elastic.Out,"Back.easeOut":n.Easing.Back.Out,"Bounce.easeOut":n.Easing.Bounce.Out,"Quad.easeInOut":n.Easing.Quadratic.InOut,"Cubic.easeInOut":n.Easing.Cubic.InOut,"Quart.easeInOut":n.Easing.Quartic.InOut,"Quint.easeInOut":n.Easing.Quintic.InOut,"Sine.easeInOut":n.Easing.Sinusoidal.InOut,"Expo.easeInOut":n.Easing.Exponential.InOut,"Circ.easeInOut":n.Easing.Circular.InOut,"Elastic.easeInOut":n.Easing.Elastic.InOut,"Back.easeInOut":n.Easing.Back.InOut,"Bounce.easeInOut":n.Easing.Bounce.InOut},this.game.onPause.add(this._pauseAll,this),this.game.onResume.add(this._resumeAll,this)},n.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var e=0;e<this._tweens.length;e++)this._tweens[e].pendingDelete=!0;this._add=[]},removeFrom:function(e,t){"undefined"==typeof t&&(t=!0);var r,i;if(Array.isArray(e))for(r=0,i=e.length;i>r;r++)this.removeFrom(e[r]);else if(e.type===n.GROUP&&t)for(var r=0,i=e.children.length;i>r;r++)this.removeFrom(e.children[r]);else{for(r=0,i=this._tweens.length;i>r;r++)e===this._tweens[r].target&&this.remove(this._tweens[r]);for(r=0,i=this._add.length;i>r;r++)e===this._add[r].target&&this.remove(this._add[r])}},add:function(e){e._manager=this,this._add.push(e)},create:function(e){return new n.Tween(e,this.game,this)},remove:function(e){var t=this._tweens.indexOf(e);-1!==t?this._tweens[t].pendingDelete=!0:(t=this._add.indexOf(e),-1!==t&&(this._add[t].pendingDelete=!0))},update:function(){var e=this._add.length,t=this._tweens.length;if(0===t&&0===e)return!1;for(var n=0;t>n;)this._tweens[n].update(this.game.time.time)?n++:(this._tweens.splice(n,1),t--);return e>0&&(this._tweens=this._tweens.concat(this._add),this._add.length=0),!0},isTweening:function(e){return this._tweens.some(function(t){return t.target===e})},_pauseAll:function(){for(var e=this._tweens.length-1;e>=0;e--)this._tweens[e]._pause()},_resumeAll:function(){for(var e=this._tweens.length-1;e>=0;e--)this._tweens[e]._resume()},pauseAll:function(){for(var e=this._tweens.length-1;e>=0;e--)this._tweens[e].pause()},resumeAll:function(){for(var e=this._tweens.length-1;e>=0;e--)this._tweens[e].resume(!0)}},n.TweenManager.prototype.constructor=n.TweenManager,n.Tween=function(e,t,r){this.game=t,this.target=e,this.manager=r,this.timeline=[],this.reverse=!1,this.timeScale=1,this.repeatCounter=0,this.pendingDelete=!1,this.onStart=new n.Signal,this.onLoop=new n.Signal,this.onRepeat=new n.Signal,this.onChildComplete=new n.Signal,this.onComplete=new n.Signal,this.isRunning=!1,this.current=0,this.properties={},this.chainedTween=null,this.isPaused=!1,this._onUpdateCallback=null,this._onUpdateCallbackContext=null,this._pausedTime=0,this._codePaused=!1},n.Tween.prototype={to:function(e,t,r,i,s,o,u){return"undefined"==typeof t&&(t=1e3),"undefined"==typeof r&&(r=n.Easing.Default),"undefined"==typeof i&&(i=!1),"undefined"==typeof s&&(s=0),"undefined"==typeof o&&(o=0),"undefined"==typeof u&&(u=!1),"string"==typeof r&&this.manager.easeMap[r]&&(r=this.manager.easeMap[r]),this.isRunning?(console.warn("Phaser.Tween.to cannot be called after Tween.start"),this):(this.timeline.push((new n.TweenData(this)).to(e,t,r,s,o,u)),i&&this.start(),this)},from:function(e,t,r,i,s,o,u){return"undefined"==typeof t&&(t=1e3),"undefined"==typeof r&&(r=n.Easing.Default),"undefined"==typeof i&&(i=!1),"undefined"==typeof s&&(s=0),"undefined"==typeof o&&(o=0),"undefined"==typeof u&&(u=!1),"string"==typeof r&&this.manager.easeMap[r]&&(r=this.manager.easeMap[r]),this.isRunning?(console.warn("Phaser.Tween.from cannot be called after Tween.start"),this):(this.timeline.push((new n.TweenData(this)).from(e,t,r,s,o,u)),i&&this.start(),this)},start:function(e){if("undefined"==typeof e&&(e=0),null===this.game||null===this.target||0===this.timeline.length||this.isRunning)return this;for(var t=0;t<this.timeline.length;t++)for(var n in this.timeline[t].vEnd)this.properties[n]=this.target[n]||0,Array.isArray(this.properties[n])||(this.properties[n]*=1);for(var t=0;t<this.timeline.length;t++)this.timeline[t].loadValues();return this.manager.add(this),this.isRunning=!0,(0>e||e>this.timeline.length-1)&&(e=0),this.current=e,this.timeline[this.current].start(),this.onStart.dispatch(this.target,this),this},stop:function(e){return"undefined"==typeof e&&(e=!1),this.isRunning=!1,this._onUpdateCallback=null,this._onUpdateCallbackContext=null,e&&(this.onComplete.dispatch(this.target,this),this.chainedTween&&this.chainedTween.start()),this.manager.remove(this),this},updateTweenData:function(e,t,n){if(0===this.timeline.length)return this;if("undefined"==typeof n&&(n=0),-1===n)for(var r=0;r<this.timeline.length;r++)this.timeline[r][e]=t;else this.timeline[n][e]=t;return this},delay:function(e,t){return this.updateTweenData("delay",e,t)},repeat:function(e,t,n){return"undefined"==typeof t&&(t=0),this.updateTweenData("repeatCounter",e,n),this.updateTweenData("repeatDelay",t,n)},repeatDelay:function(e,t){return this.updateTweenData("repeatDelay",e,t)},yoyo:function(e,t,n){return"undefined"==typeof t&&(t=0),this.updateTweenData("yoyo",e,n),this.updateTweenData("yoyoDelay",t,n)},yoyoDelay:function(e,t){return this.updateTweenData("yoyoDelay",e,t)},easing:function(e,t){return"string"==typeof e&&this.manager.easeMap[e]&&(e=this.manager.easeMap[e]),this.updateTweenData("easingFunction",e,t)},interpolation:function(e,t,r){return"undefined"==typeof t&&(t=n.Math),this.updateTweenData("interpolationFunction",e,r),this.updateTweenData("interpolationContext",t,r)},repeatAll:function(e){return"undefined"==typeof e&&(e=0),this.repeatCounter=e,this},chain:function(){for(var e=arguments.length;e--;)e>0?arguments[e-1].chainedTween=arguments[e]:this.chainedTween=arguments[e];return this},loop:function(e){return"undefined"==typeof e&&(e=!0),e?this.repeatAll(-1):this.repeatCounter=0,this},onUpdateCallback:function(e,t){return this._onUpdateCallback=e,this._onUpdateCallbackContext=t,this},pause:function(){this.isPaused=!0,this._codePaused=!0,this._pausedTime=this.game.time.time},_pause:function(){this._codePaused||(this.isPaused=!0,this._pausedTime=this.game.time.time)},resume:function(){if(this.isPaused){this.isPaused=!1,this._codePaused=!1;for(var e=0;e<this.timeline.length;e++)this.timeline[e].isRunning||(this.timeline[e].startTime+=this.game.time.time-this._pausedTime)}},_resume:function(){this._codePaused||this.resume()},update:function(e){if(this.pendingDelete)return!1;if(this.isPaused)return!0;var t=this.timeline[this.current].update(e);if(t===n.TweenData.PENDING)return!0;if(t===n.TweenData.RUNNING)return null!==this._onUpdateCallback&&this._onUpdateCallback.call(this._onUpdateCallbackContext,this,this.timeline[this.current].value,this.timeline[this.current]),this.isRunning;if(t===n.TweenData.LOOPED)return this.onLoop.dispatch(this.target,this),!0;if(t===n.TweenData.COMPLETE){var r=!1;return this.reverse?(this.current--,this.current<0&&(this.current=this.timeline.length-1,r=!0)):(this.current++,this.current===this.timeline.length&&(this.current=0,r=!0)),r?-1===this.repeatCounter?(this.timeline[this.current].start(),this.onRepeat.dispatch(this.target,this),!0):this.repeatCounter>0?(this.repeatCounter--,this.timeline[this.current].start(),this.onRepeat.dispatch(this.target,this),!0):(this.isRunning=!1,this.onComplete.dispatch(this.target,this),this.chainedTween&&this.chainedTween.start(),!1):(this.onChildComplete.dispatch(this.target,this),this.timeline[this.current].start(),!0)}},generateData:function(e,t){if(null===this.game||null===this.target)return null;"undefined"==typeof t&&(t=[]);for(var n=0;n<this.timeline.length;n++)for(var r in this.timeline[n].vEnd)this.properties[r]=this.target[r]||0,Array.isArray(this.properties[r])||(this.properties[r]*=1);for(var n=0;n<this.timeline.length;n++)this.timeline[n].loadValues();for(var n=0;n<this.timeline.length;n++)t=t.concat(this.timeline[n].generateData(e));return t}},Object.defineProperty(n.Tween.prototype,"totalDuration",{get:function(){for(var e=0,t=0;t<this.timeline.length;t++)e+=this.timeline[t].duration;return e}}),n.Tween.prototype.constructor=n.Tween,n.TweenData=function(e){this.parent=e,this.game=e.game,this.vStart={},this.vStartCache={},this.vEnd={},this.vEndCache={},this.duration=1e3,this.percent=0,this.value=0,this.repeatCounter=0,this.repeatDelay=0,this.interpolate=!1,this.yoyo=!1,this.yoyoDelay=0,this.inReverse=!1,this.delay=0,this.dt=0,this.startTime=null,this.easingFunction=n.Easing.Default,this.interpolationFunction=n.Math.linearInterpolation,this.interpolationContext=n.Math,this.isRunning=!1,this.isFrom=!1},n.TweenData.PENDING=0,n.TweenData.RUNNING=1,n.TweenData.LOOPED=2,n.TweenData.COMPLETE=3,n.TweenData.prototype={to:function(e,t,n,r,i,s){return this.vEnd=e,this.duration=t,this.easingFunction=n,this.delay=r,this.repeatCounter=i,this.yoyo=s,this.isFrom=!1,this},from:function(e,t,n,r,i,s){return this.vEnd=e,this.duration=t,this.easingFunction=n,this.delay=r,this.repeatCounter=i,this.yoyo=s,this.isFrom=!0,this},start:function(){if(this.startTime=this.game.time.time+this.delay,this.dt=this.parent.reverse?this.duration:0,this.isRunning=this.delay>0?!1:!0,this.isFrom)for(var e in this.vStartCache)this.vStart[e]=this.vEndCache[e],this.vEnd[e]=this.vStartCache[e],this.parent.target[e]=this.vStart[e];return this.value=0,this.yoyoCounter=0,this},loadValues:function(){for(var e in this.parent.properties){if(this.vStart[e]=this.parent.properties[e],Array.isArray(this.vEnd[e])){if(0===this.vEnd[e].length)continue;this.vEnd[e]=[this.vStart[e]].concat(this.vEnd[e])}"undefined"!=typeof this.vEnd[e]?("string"==typeof this.vEnd[e]&&(this.vEnd[e]=this.vStart[e]+parseFloat(this.vEnd[e],10)),this.parent.properties[e]=this.vEnd[e]):this.vEnd[e]=this.vStart[e],this.vStartCache[e]=this.vStart[e],this.vEndCache[e]=this.vEnd[e]}return this},update:function(){if(this.isRunning){if(this.game.time.time<this.startTime)return n.TweenData.RUNNING}else{if(!(this.game.time.time>=this.startTime))return n.TweenData.PENDING;this.isRunning=!0}this.parent.reverse?(this.dt-=this.game.time.physicsElapsedMS*this.parent.timeScale,this.dt=Math.max(this.dt,0)):(this.dt+=this.game.time.physicsElapsedMS*this.parent.timeScale,this.dt=Math.min(this.dt,this.duration)),this.percent=this.dt/this.duration,this.value=this.easingFunction(this.percent);for(var e in this.vEnd){var t=this.vStart[e],r=this.vEnd[e];this.parent.target[e]=Array.isArray(r)?this.interpolationFunction.call(this.interpolationContext,r,this.value):t+(r-t)*this.value}return!this.parent.reverse&&1===this.percent||this.parent.reverse&&0===this.percent?this.repeat():n.TweenData.RUNNING},generateData:function(e){this.dt=this.parent.reverse?this.duration:0;var t=[],n=!1,r=1/e*1e3;do{this.parent.reverse?(this.dt-=r,this.dt=Math.max(this.dt,0)):(this.dt+=r,this.dt=Math.min(this.dt,this.duration)),this.percent=this.dt/this.duration,this.value=this.easingFunction(this.percent);var i={};for(var s in this.vEnd){var o=this.vStart[s],u=this.vEnd[s];i[s]=Array.isArray(u)?this.interpolationFunction(u,this.value):o+(u-o)*this.value}t.push(i),(!this.parent.reverse&&1===this.percent||this.parent.reverse&&0===this.percent)&&(n=!0)}while(!n);if(this.yoyo){var a=t.slice();a.reverse(),t=t.concat(a)}return t},repeat:function(){if(this.yoyo){if(this.inReverse&&0===this.repeatCounter)return n.TweenData.COMPLETE;this.inReverse=!this.inReverse}else if(0===this.repeatCounter)return n.TweenData.COMPLETE;if(this.inReverse)for(var e in this.vStartCache)this.vStart[e]=this.vEndCache[e],this.vEnd[e]=this.vStartCache[e];else{for(var e in this.vStartCache)this.vStart[e]=this.vStartCache[e],this.vEnd[e]=this.vEndCache[e];this.repeatCounter>0&&this.repeatCounter--}return this.startTime=this.game.time.time,this.yoyo&&this.inReverse?this.startTime+=this.yoyoDelay:this.inReverse||(this.startTime+=this.repeatDelay),this.dt=this.parent.reverse?this.duration:0,n.TweenData.LOOPED}},n.TweenData.prototype.constructor=n.TweenData,n.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-0.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-0.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 0===e?0:1===e?1:1-Math.cos(e*Math.PI/2)},Out:function(e){return 0===e?0:1===e?1:Math.sin(e*Math.PI/2)},InOut:function(e){return 0===e?0:1===e?1:.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-0.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){var t,n=.1,r=.4;return 0===e?0:1===e?1:(!n||1>n?(n=1,t=r/4):t=r*Math.asin(1/n)/(2*Math.PI),-(n*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/r)))},Out:function(e){var t,n=.1,r=.4;return 0===e?0:1===e?1:(!n||1>n?(n=1,t=r/4):t=r*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*e)*Math.sin(2*(e-t)*Math.PI/r)+1)},InOut:function(e){var t,n=.1,r=.4;return 0===e?0:1===e?1:(!n||1>n?(n=1,t=r/4):t=r*Math.asin(1/n)/(2*Math.PI),(e*=2)<1?-0.5*n*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/r):n*Math.pow(2,-10*(e-=1))*Math.sin(2*(e-t)*Math.PI/r)*.5+1)}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?.5*e*e*((t+1)*e-t):.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-n.Easing.Bounce.Out(1-e)},Out:function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return.5>e?.5*n.Easing.Bounce.In(2*e):.5*n.Easing.Bounce.Out(2*e-1)+.5}}},n.Easing.Default=n.Easing.Linear.None,n.Easing.Power0=n.Easing.Linear.None,n.Easing.Power1=n.Easing.Quadratic.Out,n.Easing.Power2=n.Easing.Cubic.Out,n.Easing.Power3=n.Easing.Quartic.Out,n.Easing.Power4=n.Easing.Quintic.Out,n.Time=function(e){this.game=e,this.time=0,this.prevTime=0,this.now=0,this.elapsed=0,this.elapsedMS=0,this.physicsElapsed=0,this.physicsElapsedMS=0,this.desiredFps=60,this.suggestedFps=null,this.slowMotion=1,this.advancedTiming=!1,this.frames=0,this.fps=0,this.fpsMin=1e3,this.fpsMax=0,this.msMin=1e3,this.msMax=0,this.pauseDuration=0,this.timeToCall=0,this.timeExpected=0,this.events=new n.Timer(this.game,!1),this._frameCount=0,this._elapsedAccumulator=0,this._started=0,this._timeLastSecond=0,this._pauseStarted=0,this._justResumed=!1,this._timers=[]},n.Time.prototype={boot:function(){this._started=Date.now(),this.time=Date.now(),this.events.start()},add:function(e){return this._timers.push(e),e},create:function(e){"undefined"==typeof e&&(e=!0);var t=new n.Timer(this.game,e);return this._timers.push(t),t},removeAll:function(){for(var e=0;e<this._timers.length;e++)this._timers[e].destroy();this._timers=[],this.events.removeAll()},update:function(e){var t=this.time;if(this.time=Date.now(),this.elapsedMS=this.time-t,this.prevTime=this.now,this.now=e,this.elapsed=this.now-this.prevTime,this.timeToCall=Math.floor(Math.max(0,1e3/this.desiredFps-(this.timeCallExpected-e))),this.timeCallExpected=e+this.timeToCall,this._frameCount++,this._elapsedAccumulator+=this.elapsed,this._frameCount>=2*this.desiredFps&&(this.suggestedFps=5*Math.floor(200/(this._elapsedAccumulator/this._frameCount)),this._frameCount=0,this._elapsedAccumulator=0),this.physicsElapsed=1/this.desiredFps,this.physicsElapsedMS=1e3*this.physicsElapsed,this.advancedTiming&&(this.msMin=Math.min(this.msMin,this.elapsed),this.msMax=Math.max(this.msMax,this.elapsed),this.frames++,this.now>this._timeLastSecond+1e3&&(this.fps=Math.round(1e3*this.frames/(this.now-this._timeLastSecond)),this.fpsMin=Math.min(this.fpsMin,this.fps),this.fpsMax=Math.max(this.fpsMax,this.fps),this._timeLastSecond=this.now,this.frames=0)),!this.game.paused){this.events.update(this.time);for(var n=0,r=this._timers.length;r>n;)this._timers[n].update(this.time)?n++:(this._timers.splice(n,1),r--)}},gamePaused:function(){this._pauseStarted=Date.now(),this.events.pause();for(var e=this._timers.length;e--;)this._timers[e]._pause()},gameResumed:function(){this.time=Date.now(),this.pauseDuration=this.time-this._pauseStarted,this.events.resume();for(var e=this._timers.length;e--;)this._timers[e]._resume()},totalElapsedSeconds:function(){return.001*(this.time-this._started)},elapsedSince:function(e){return this.time-e},elapsedSecondsSince:function(e){return.001*(this.time-e)},reset:function(){this._started=this.time,this.removeAll()}},n.Time.prototype.constructor=n.Time,n.Timer=function(e,t){"undefined"==typeof t&&(t=!0),this.game=e,this.running=!1,this.autoDestroy=t,this.expired=!1,this.elapsed=0,this.events=[],this.onComplete=new n.Signal,this.nextTick=0,this.timeCap=1e3,this.paused=!1,this._codePaused=!1,this._started=0,this._pauseStarted=0,this._pauseTotal=0,this._now=Date.now(),this._len=0,this._marked=0,this._i=0,this._diff=0,this._newTick=0},n.Timer.MINUTE=6e4,n.Timer.SECOND=1e3,n.Timer.HALF=500,n.Timer.QUARTER=250,n.Timer.prototype={create:function(e,t,r,i,s,o){e=Math.round(e);var u=e;u+=0===this._now?this.game.time.time:this._now;var a=new n.TimerEvent(this,e,u,r,t,i,s,o);return this.events.push(a),this.order(),this.expired=!1,a},add:function(e,t,n){return this.create(e,!1,0,t,n,Array.prototype.splice.call(arguments,3))},repeat:function(e,t,n,r){return this.create(e,!1,t,n,r,Array.prototype.splice.call(arguments,4))},loop:function(e,t,n){return this.create(e,!0,0,t,n,Array.prototype.splice.call(arguments,3))},start:function(e){if(!this.running){this._started=this.game.time.time+(e||0),this.running=!0;for(var t=0;t<this.events.length;t++)this.events[t].tick=this.events[t].delay+this._started}},stop:function(e){this.running=!1,"undefined"==typeof e&&(e=!0),e&&(this.events.length=0)},remove:function(e){for(var t=0;t<this.events.length;t++)if(this.events[t]===e)return this.events[t].pendingDelete=!0,!0;return!1},order:function(){this.events.length>0&&(this.events.sort(this.sortHandler),this.nextTick=this.events[0].tick)},sortHandler:function(e,t){return e.tick<t.tick?-1:e.tick>t.tick?1:0},clearPendingEvents:function(){for(this._i=this.events.length;this._i--;)this.events[this._i].pendingDelete&&this.events.splice(this._i,1);this._len=this.events.length,this._i=0},update:function(e){if(this.paused)return!0;if(this.elapsed=e-this._now,this._now=e,this.elapsed>this.timeCap&&this.adjustEvents(e-this.elapsed),this._marked=0,this.clearPendingEvents(),this.running&&this._now>=this.nextTick&&this._len>0){for(;this._i<this._len&&this.running&&this._now>=this.events[this._i].tick&&!this.events[this._i].pendingDelete;)this._newTick=this._now+this.events[this._i].delay-(this._now-this.events[this._i].tick),this._newTick<0&&(this._newTick=this._now+this.events[this._i].delay),this.events[this._i].loop===!0?(this.events[this._i].tick=this._newTick,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)):this.events[this._i].repeatCount>0?(this.events[this._i].repeatCount--,this.events[this._i].tick=this._newTick,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)):(this._marked++,this.events[this._i].pendingDelete=!0,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)),this._i++;this.events.length>this._marked?this.order():(this.expired=!0,this.onComplete.dispatch(this))}return this.expired&&this.autoDestroy?!1:!0},pause:function(){this.running&&(this._codePaused=!0,this.paused||(this._pauseStarted=this.game.time.time,this.paused=!0))},_pause:function(){!this.paused&&this.running&&(this._pauseStarted=this.game.time.time,this.paused=!0)},adjustEvents:function(e){for(var t=0;t<this.events.length;t++)if(!this.events[t].pendingDelete){var n=this.events[t].tick-e;0>n&&(n=0),this.events[t].tick=this._now+n}var r=this.nextTick-e;this.nextTick=0>r?this._now:this._now+r},resume:function(){if(this.paused){var e=this.game.time.time;this._pauseTotal+=e-this._now,this._now=e,this.adjustEvents(this._pauseStarted),this.paused=!1,this._codePaused=!1}},_resume:function(){this._codePaused||this.resume()},removeAll:function(){this.onComplete.removeAll(),this.events.length=0,this._len=0,this._i=0},destroy:function(){this.onComplete.removeAll(),this.running=!1,this.events=[],this._len=0,this._i=0}},Object.defineProperty(n.Timer.prototype,"next",{get:function(){return this.nextTick}}),Object.defineProperty(n.Timer.prototype,"duration",{get:function(){return this.running&&this.nextTick>this._now?this.nextTick-this._now:0}}),Object.defineProperty(n.Timer.prototype,"length",{get:function(){return this.events.length}}),Object.defineProperty(n.Timer.prototype,"ms",{get:function(){return this.running?this._now-this._started-this._pauseTotal:0}}),Object.defineProperty(n.Timer.prototype,"seconds",{get:function(){return this.running?.001*this.ms:0}}),n.Timer.prototype.constructor=n.Timer,n.TimerEvent=function(e,t,n,r,i,s,o,u){this.timer=e,this.delay=t,this.tick=n,this.repeatCount=r-1,this.loop=i,this.callback=s,this.callbackContext=o,this.args=u,this.pendingDelete=!1},n.TimerEvent.prototype.constructor=n.TimerEvent,n.AnimationManager=function(e){this.sprite=e,this.game=e.game,this.currentFrame=null,this.currentAnim=null,this.updateIfVisible=!0,this.isLoaded=!1,this._frameData=null,this._anims={},this._outputFrames=[]},n.AnimationManager.prototype={loadFrameData:function(e,t){if("undefined"==typeof e)return!1;if(this.isLoaded)for(var n in this._anims)this._anims[n].updateFrameData(e);return this._frameData=e,"undefined"==typeof t||null===t?this.frame=0:"string"==typeof t?this.frameName=t:this.frame=t,this.isLoaded=!0,!0},copyFrameData:function(e,t){if(this._frameData=e.clone(),this.isLoaded)for(var n in this._anims)this._anims[n].updateFrameData(this._frameData);return"undefined"==typeof t||null===t?this.frame=0:"string"==typeof t?this.frameName=t:this.frame=t,this.isLoaded=!0,!0},add:function(e,t,r,i,s){return t=t||[],r=r||60,"undefined"==typeof i&&(i=!1),"undefined"==typeof s&&(s=t&&"number"==typeof t[0]?!0:!1),this._outputFrames.length=0,this._frameData.getFrameIndexes(t,s,this._outputFrames),this._anims[e]=new n.Animation(this.game,this.sprite,e,this._frameData,this._outputFrames,r,i),this.currentAnim=this._anims[e],this.currentFrame=this.currentAnim.currentFrame,this.sprite.__tilePattern&&(this.sprite.__tilePattern=!1,this.tilingTexture=!1),this._anims[e]},validateFrames:function(e,t){"undefined"==typeof t&&(t=!0);for(var n=0;n<e.length;n++)if(t===!0){if(e[n]>this._frameData.total)return!1}else if(this._frameData.checkFrameName(e[n])===!1)return!1;return!0},play:function(e,t,n,r){return this._anims[e]?this.currentAnim===this._anims[e]?this.currentAnim.isPlaying===!1?(this.currentAnim.paused=!1,this.currentAnim.play(t,n,r)):this.currentAnim:(this.currentAnim&&this.currentAnim.isPlaying&&this.currentAnim.stop(),this.currentAnim=this._anims[e],this.currentAnim.paused=!1,this.currentFrame=this.currentAnim.currentFrame,this.currentAnim.play(t,n,r)):void 0},stop:function(e,t){"undefined"==typeof t&&(t=!1),"string"==typeof e?this._anims[e]&&(this.currentAnim=this._anims[e],this.currentAnim.stop(t)):this.currentAnim&&this.currentAnim.stop(t)},update:function(){return this.updateIfVisible&&!this.sprite.visible?!1:this.currentAnim&&this.currentAnim.update()?(this.currentFrame=this.currentAnim.currentFrame,!0):!1},next:function(e){this.currentAnim&&(this.currentAnim.next(e),this.currentFrame=this.currentAnim.currentFrame)},previous:function(e){this.currentAnim&&(this.currentAnim.previous(e),this.currentFrame=this.currentAnim.currentFrame)},getAnimation:function(e){return"string"==typeof e&&this._anims[e]?this._anims[e]:null},refreshFrame:function(){this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid]),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1)},destroy:function(){var e=null;for(var e in this._anims)this._anims.hasOwnProperty(e)&&this._anims[e].destroy();this._anims={},this._outputFrames=[],this._frameData=null,this.currentAnim=null,this.currentFrame=null,this.sprite=null,this.game=null}},n.AnimationManager.prototype.constructor=n.AnimationManager,Object.defineProperty(n.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}}),Object.defineProperty(n.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}}),Object.defineProperty(n.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(e){this.currentAnim.paused=e}}),Object.defineProperty(n.AnimationManager.prototype,"name",{get:function(){return this.currentAnim?this.currentAnim.name:void 0}}),Object.defineProperty(n.AnimationManager.prototype,"frame",{get:function(){return this.currentFrame?this.currentFrame.index:void 0},set:function(e){"number"==typeof e&&this._frameData&&null!==this._frameData.getFrame(e)&&(this.currentFrame=this._frameData.getFrame(e),this.currentFrame&&(this.sprite.setFrame(this.currentFrame),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1)))}}),Object.defineProperty(n.AnimationManager.prototype,"frameName",{get:function(){return this.currentFrame?this.currentFrame.name:void 0},set:function(e){"string"==typeof e&&null!==this._frameData.getFrameByName(e)?(this.currentFrame=this._frameData.getFrameByName(e),this.currentFrame&&(this._frameIndex=this.currentFrame.index,this.sprite.setFrame(this.currentFrame),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1))):console.warn("Cannot set frameName: "+e)}}),n.Animation=function(e,t,r,i,s,o,u){"undefined"==typeof u&&(u=!1),this.game=e,this._parent=t,this._frameData=i,this.name=r,this._frames=[],this._frames=this._frames.concat(s),this.delay=1e3/o,this.loop=u,this.loopCount=0,this.killOnComplete=!1,this.isFinished=!1,this.isPlaying=!1,this.isPaused=!1,this._pauseStartTime=0,this._frameIndex=0,this._frameDiff=0,this._frameSkip=1,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.onStart=new n.Signal,this.onUpdate=null,this.onComplete=new n.Signal,this.onLoop=new n.Signal,this.game.onPause.add(this.onPause,this),this.game.onResume.add(this.onResume,this)},n.Animation.prototype={play:function(e,t,n){return"number"==typeof e&&(this.delay=1e3/e),"boolean"==typeof t&&(this.loop=t),"undefined"!=typeof n&&(this.killOnComplete=n),this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=0,this.updateCurrentFrame(!1),this._parent.events.onAnimationStart$dispatch(this._parent,this),this.onStart.dispatch(this._parent,this),this._parent.animations.currentAnim=this,this._parent.animations.currentFrame=this.currentFrame,this},restart:function(){this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=0,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this._parent.setFrame(this.currentFrame),this._parent.animations.currentAnim=this,this._parent.animations.currentFrame=this.currentFrame,this.onStart.dispatch(this._parent,this)},setFrame:function(e,t){var n;if("undefined"==typeof t&&(t=!1),"string"==typeof e)for(var r=0;r<this._frames.length;r++)this._frameData.getFrame(this._frames[r]).name===e&&(n=r);else if("number"==typeof e)if(t)n=e;else for(var r=0;r<this._frames.length;r++)this._frames[r]===n&&(n=r);n&&(this._frameIndex=n-1,this._timeNextFrame=this.game.time.time,this.update())},stop:function(e,t){"undefined"==typeof e&&(e=!1),"undefined"==typeof t&&(t=!1),this.isPlaying=!1,this.isFinished=!0,this.paused=!1,e&&(this.currentFrame=this._frameData.getFrame(this._frames[0]),this._parent.setFrame(this.currentFrame)),t&&(this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this))},onPause:function(){this.isPlaying&&(this._frameDiff=this._timeNextFrame-this.game.time.time)},onResume:function(){this.isPlaying&&(this._timeNextFrame=this.game.time.time+this._frameDiff)},update:function(){return this.isPaused?!1:this.isPlaying&&this.game.time.time>=this._timeNextFrame?(this._frameSkip=1,this._frameDiff=this.game.time.time-this._timeNextFrame,this._timeLastFrame=this.game.time.time,this._frameDiff>this.delay&&(this._frameSkip=Math.floor(this._frameDiff/this.delay),this._frameDiff-=this._frameSkip*this.delay),this._timeNextFrame=this.game.time.time+(this.delay-this._frameDiff),this._frameIndex+=this._frameSkip,this._frameIndex>=this._frames.length?this.loop?(this._frameIndex%=this._frames.length,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.loopCount++,this._parent.events.onAnimationLoop$dispatch(this._parent,this),this.onLoop.dispatch(this._parent,this),this.updateCurrentFrame(!0)):(this.complete(),!1):this.updateCurrentFrame(!0)):!1},updateCurrentFrame:function(e){return this._frameData?(this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(this._parent.setFrame(this.currentFrame),this._parent.__tilePattern&&(this._parent.__tilePattern=!1,this._parent.tilingTexture=!1)),this.onUpdate&&e?(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData):!0):!1},next:function(e){"undefined"==typeof e&&(e=1);var t=this._frameIndex+e;t>=this._frames.length&&(this.loop?t%=this._frames.length:t=this._frames.length-1),t!==this._frameIndex&&(this._frameIndex=t,this.updateCurrentFrame(!0))},previous:function(e){"undefined"==typeof e&&(e=1);var t=this._frameIndex-e;0>t&&(this.loop?t=this._frames.length+t:t++),t!==this._frameIndex&&(this._frameIndex=t,this.updateCurrentFrame(!0))},updateFrameData:function(e){this._frameData=e,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):null},destroy:function(){this._frameData&&(this.game.onPause.remove(this.onPause,this),this.game.onResume.remove(this.onResume,this),this.game=null,this._parent=null,this._frames=null,this._frameData=null,this.currentFrame=null,this.isPlaying=!1,this.onStart.dispose(),this.onLoop.dispose(),this.onComplete.dispose(),this.onUpdate&&this.onUpdate.dispose())},complete:function(){this._frameIndex=this._frames.length-1,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.isPlaying=!1,this.isFinished=!0,this.paused=!1,this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this),this.killOnComplete&&this._parent.kill()}},n.Animation.prototype.constructor=n.Animation,Object.defineProperty(n.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(e){this.isPaused=e,e?this._pauseStartTime=this.game.time.time:this.isPlaying&&(this._timeNextFrame=this.game.time.time+this.delay)}}),Object.defineProperty(n.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}}),Object.defineProperty(n.Animation.prototype,"frame",{get:function(){return null!==this.currentFrame?this.currentFrame.index:this._frameIndex},set:function(e){this.currentFrame=this._frameData.getFrame(this._frames[e]),null!==this.currentFrame&&(this._frameIndex=e,this._parent.setFrame(this.currentFrame),this.onUpdate&&this.onUpdate.dispatch(this,this.currentFrame))}}),Object.defineProperty(n.Animation.prototype,"speed",{get:function(){return Math.round(1e3/this.delay)},set:function(e){e>=1&&(this.delay=1e3/e)}}),Object.defineProperty(n.Animation.prototype,"enableUpdate",{get:function(){return null!==this.onUpdate},set:function(e){e&&null===this.onUpdate?this.onUpdate=new n.Signal:e||null===this.onUpdate||(this.onUpdate.dispose(),this.onUpdate=null)}}),n.Animation.generateFrameNames=function(e,t,r,i,s){"undefined"==typeof i&&(i="");var o=[],u="";if(r>t)for(var a=t;r>=a;a++)u="number"==typeof s?n.Utils.pad(a.toString(),s,"0",1):a.toString(),u=e+u+i,o.push(u);else for(var a=t;a>=r;a--)u="number"==typeof s?n.Utils.pad(a.toString(),s,"0",1):a.toString(),u=e+u+i,o.push(u);return o},n.Frame=function(e,t,r,i,s,o,u){this.index=e,this.x=t,this.y=r,this.width=i,this.height=s,this.name=o,this.uuid=u,this.centerX=Math.floor(i/2),this.centerY=Math.floor(s/2),this.distance=n.Math.distance(0,0,i,s),this.rotated=!1,this.rotationDirection="cw",this.trimmed=!1,this.sourceSizeW=i,this.sourceSizeH=s,this.spriteSourceSizeX=0,this.spriteSourceSizeY=0,this.spriteSourceSizeW=0,this.spriteSourceSizeH=0,this.right=this.x+this.width,this.bottom=this.y+this.height},n.Frame.prototype={setTrim:function(e,t,n,r,i,s,o){this.trimmed=e,e&&(this.sourceSizeW=t,this.sourceSizeH=n,this.centerX=Math.floor(t/2),this.centerY=Math.floor(n/2),this.spriteSourceSizeX=r,this.spriteSourceSizeY=i,this.spriteSourceSizeW=s,this.spriteSourceSizeH=o)},clone:function(){var e=new n.Frame(this.index,this.x,this.y,this.width,this.height,this.name,this.uuid);for(var t in this)this.hasOwnProperty(t)&&(e[t]=this[t]);return e},getRect:function(e){return"undefined"==typeof e?e=new n.Rectangle(this.x,this.y,this.width,this.height):e.setTo(this.x,this.y,this.width,this.height),e}},n.Frame.prototype.constructor=n.Frame,n.FrameData=function(){this._frames=[],this._frameNames=[]},n.FrameData.prototype={addFrame:function(e){return e.index=this._frames.length,this._frames.push(e),""!==e.name&&(this._frameNames[e.name]=e.index),e},getFrame:function(e){return e>=this._frames.length&&(e=0),this._frames[e]},getFrameByName:function(e){return"number"==typeof this._frameNames[e]?this._frames[this._frameNames[e]]:null},checkFrameName:function(e){return null==this._frameNames[e]?!1:!0},clone:function(){for(var e=new n.FrameData,t=0;t<this._frames.length;t++)e._frames.push(this._frames[t].clone());for(var r in this._frameNames)this._frameNames.hasOwnProperty(r)&&e._frameNames.push(this._frameNames[r]);return e},getFrameRange:function(e,t,n){"undefined"==typeof n&&(n=[]);for(var r=e;t>=r;r++)n.push(this._frames[r]);return n},getFrames:function(e,t,n){if("undefined"==typeof t&&(t=!0),"undefined"==typeof n&&(n=[]),"undefined"==typeof e||0===e.length)for(var r=0;r<this._frames.length;r++)n.push(this._frames[r]);else for(var r=0,i=e.length;i>r;r++)n.push(t?this.getFrame(e[r]):this.getFrameByName(e[r]));return n},getFrameIndexes:function(e,t,n){if("undefined"==typeof t&&(t=!0),"undefined"==typeof n&&(n=[]),"undefined"==typeof e||0===e.length)for(var r=0,i=this._frames.length;i>r;r++)n.push(this._frames[r].index);else for(var r=0,i=e.length;i>r;r++)t?n.push(e[r]):this.getFrameByName(e[r])&&n.push(this.getFrameByName(e[r]).index);return n}},n.FrameData.prototype.constructor=n.FrameData,Object.defineProperty(n.FrameData.prototype,"total",{get:function(){return this._frames.length}}),n.AnimationParser={spriteSheet:function(e,t,r,i,s,o,u){var a=e.cache.getImage(t);if(null==a)return null;var f=a.width,l=a.height;0>=r&&(r=Math.floor(-f/Math.min(-1,r))),0>=i&&(i=Math.floor(-l/Math.min(-1,i)));var c=Math.floor((f-o)/(r+u)),h=Math.floor((l-o)/(i+u)),p=c*h;if(-1!==s&&(p=s),0===f||0===l||r>f||i>l||0===p)return console.warn("Phaser.AnimationParser.spriteSheet: '"+t+"'s width/height zero or width/height < given frameWidth/frameHeight"),null;for(var d=new n.FrameData,v=o,m=o,g=0;p>g;g++){var y=e.rnd.uuid();d.addFrame(new n.Frame(g,v,m,r,i,"",y)),PIXI.TextureCache[y]=new PIXI.Texture(PIXI.BaseTextureCache[t],{x:v,y:m,width:r,height:i}),v+=r+u,v+r>f&&(v=o,m+=i+u)}return d},JSONData:function(e,t,r){if(!t.frames)return console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array"),void console.log(t);for(var i,s=new n.FrameData,o=t.frames,u=0;u<o.length;u++){var a=e.rnd.uuid();i=s.addFrame(new n.Frame(u,o[u].frame.x,o[u].frame.y,o[u].frame.w,o[u].frame.h,o[u].filename,a)),PIXI.TextureCache[a]=new PIXI.Texture(PIXI.BaseTextureCache[r],{x:o[u].frame.x,y:o[u].frame.y,width:o[u].frame.w,height:o[u].frame.h}),o[u].trimmed&&i.setTrim(o[u].trimmed,o[u].sourceSize.w,o[u].sourceSize.h,o[u].spriteSourceSize.x,o[u].spriteSourceSize.y,o[u].spriteSourceSize.w,o[u].spriteSourceSize.h)}return s},JSONDataHash:function(e,t,r){if(!t.frames)return console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object"),void console.log(t);var i,s=new n.FrameData,o=t.frames,u=0;for(var a in o){var f=e.rnd.uuid();i=s.addFrame(new n.Frame(u,o[a].frame.x,o[a].frame.y,o[a].frame.w,o[a].frame.h,a,f)),PIXI.TextureCache[f]=new PIXI.Texture(PIXI.BaseTextureCache[r],{x:o[a].frame.x,y:o[a].frame.y,width:o[a].frame.w,height:o[a].frame.h}),o[a].trimmed&&i.setTrim(o[a].trimmed,o[a].sourceSize.w,o[a].sourceSize.h,o[a].spriteSourceSize.x,o[a].spriteSourceSize.y,o[a].spriteSourceSize.w,o[a].spriteSourceSize.h),u++}return s},XMLData:function(e,t,r){if(!t.getElementsByTagName("TextureAtlas"))return void console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag");for(var i,s,o,u,a,f,l,c,h,p,d,v,m=new n.FrameData,g=t.getElementsByTagName("SubTexture"),y=0;y<g.length;y++)s=e.rnd.uuid(),u=g[y].attributes,o=u.name.value,a=parseInt(u.x.value,10),f=parseInt(u.y.value,10),l=parseInt(u.width.value,10),c=parseInt(u.height.value,10),h=null,p=null,u.frameX&&(h=Math.abs(parseInt(u.frameX.value,10)),p=Math.abs(parseInt(u.frameY.value,10)),d=parseInt(u.frameWidth.value,10),v=parseInt(u.frameHeight.value,10)),i=m.addFrame(new n.Frame(y,a,f,l,c,o,s)),PIXI.TextureCache[s]=new PIXI.Texture(PIXI.BaseTextureCache[r],{x:a,y:f,width:l,height:c}),(null!==h||null!==p)&&i.setTrim(!0,l,c,h,p,d,v);return m}},n.Cache=function(e){this.game=e,this.autoResolveURL=!1,this._canvases={},this._images={},this._textures={},this._sounds={},this._text={},this._json={},this._xml={},this._physics={},this._tilemaps={},this._binary={},this._bitmapDatas={},this._bitmapFont={},this._urlMap={},this._urlResolver=new Image,this._urlTemp=null,this.addDefaultImage(),this.addMissingImage(),this.onSoundUnlock=new n.Signal,this._cacheMap=[],this._cacheMap[n.Cache.CANVAS]=this._canvases,this._cacheMap[n.Cache.IMAGE]=this._images,this._cacheMap[n.Cache.TEXTURE]=this._textures,this._cacheMap[n.Cache.SOUND]=this._sounds,this._cacheMap[n.Cache.TEXT]=this._text,this._cacheMap[n.Cache.PHYSICS]=this._physics,this._cacheMap[n.Cache.TILEMAP]=this._tilemaps,this._cacheMap[n.Cache.BINARY]=this._binary,this._cacheMap[n.Cache.BITMAPDATA]=this._bitmapDatas,this._cacheMap[n.Cache.BITMAPFONT]=this._bitmapFont,this._cacheMap[n.Cache.JSON]=this._json,this._cacheMap[n.Cache.XML]=this._xml},n.Cache.CANVAS=1,n.Cache.IMAGE=2,n.Cache.TEXTURE=3,n.Cache.SOUND=4,n.Cache.TEXT=5,n.Cache.PHYSICS=6,n.Cache.TILEMAP=7,n.Cache.BINARY=8,n.Cache.BITMAPDATA=9,n.Cache.BITMAPFONT=10,n.Cache.JSON=11,n.Cache.XML=12,n.Cache.prototype={addCanvas:function(e,t,n){this._canvases[e]={canvas:t,context:n}},addBinary:function(e,t){this._binary[e]=t},addBitmapData:function(e,t,r){return t.key=e,"undefined"==typeof r&&(r=new n.FrameData,r.addFrame(t.textureFrame)),this._bitmapDatas[e]={data:t,frameData:r},t},addRenderTexture:function(e,t){var r=new n.Frame(0,0,0,t.width,t.height,"","");this._textures[e]={texture:t,frame:r}},addSpriteSheet:function(e,t,r,i,s,o,u,a){this._images[e]={url:t,data:r,frameWidth:i,frameHeight:s,margin:u,spacing:a},PIXI.BaseTextureCache[e]=new PIXI.BaseTexture(r),PIXI.TextureCache[e]=new PIXI.Texture(PIXI.BaseTextureCache[e]),this._images[e].frameData=n.AnimationParser.spriteSheet(this.game,e,i,s,o,u,a),this._resolveURL(t,this._images[e])},addTilemap:function(e,t,n,r){this._tilemaps[e]={url:t,data:n,format:r},this._resolveURL(t,this._tilemaps[e])},addTextureAtlas:function(e,t,r,i,s){this._images[e]={url:t,data:r},PIXI.BaseTextureCache[e]=new PIXI.BaseTexture(r),PIXI.TextureCache[e]=new PIXI.Texture(PIXI.BaseTextureCache[e]),s==n.Loader.TEXTURE_ATLAS_JSON_ARRAY?this._images[e].frameData=n.AnimationParser.JSONData(this.game,i,e):s==n.Loader.TEXTURE_ATLAS_JSON_HASH?this._images[e].frameData=n.AnimationParser.JSONDataHash(this.game,i,e):s==n.Loader.TEXTURE_ATLAS_XML_STARLING&&(this._images[e].frameData=n.AnimationParser.XMLData(this.game,i,e)),this._resolveURL(t,this._images[e])},addBitmapFont:function(e,t,r,i,s,o){this._images[e]={url:t,data:r},PIXI.BaseTextureCache[e]=new PIXI.BaseTexture(r),PIXI.TextureCache[e]=new PIXI.Texture(PIXI.BaseTextureCache[e]),n.LoaderParser.bitmapFont(this.game,i,e,s,o),this._bitmapFont[e]=PIXI.BitmapText.fonts[e],this._resolveURL(t,this._bitmapFont[e])},addPhysicsData:function(e,t,n,r){this._physics[e]={url:t,data:n,format:r},this._resolveURL(t,this._physics[e])},addDefaultImage:function(){var e=new Image;e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==",this._images.__default={url:null,data:e},this._images.__default.frame=new n.Frame(0,0,0,32,32,"",""),this._images.__default.frameData=new n.FrameData,this._images.__default.frameData.addFrame(new n.Frame(0,0,0,32,32,null,this.game.rnd.uuid())),PIXI.BaseTextureCache.__default=new PIXI.BaseTexture(e),PIXI.TextureCache.__default=new PIXI.Texture(PIXI.BaseTextureCache.__default)},addMissingImage:function(){var e=new Image;e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==",this._images.__missing={url:null,data:e},this._images.__missing.frame=new n.Frame(0,0,0,32,32,"",""),this._images.__missing.frameData=new n.FrameData,this._images.__missing.frameData.addFrame(new n.Frame(0,0,0,32,32,null,this.game.rnd.uuid())),PIXI.BaseTextureCache.__missing=new PIXI.BaseTexture(e),PIXI.TextureCache.__missing=new PIXI.Texture(PIXI.BaseTextureCache.__missing)},addText:function(e,t,n){this._text[e]={url:t,data:n},this._resolveURL(t,this._text[e])},addJSON:function(e,t,n){this._json[e]={url:t,data:n},this._resolveURL(t,this._json[e])},addXML:function(e,t,n){this._xml[e]={url:t,data:n},this._resolveURL(t,this._xml[e])},addImage:function(e,t,r){this.checkImageKey(e)&&this.removeImage(e),this._images[e]={url:t,data:r},this._images[e].frame=new n.Frame(0,0,0,r.width,r.height,e,this.game.rnd.uuid()),this._images[e].frameData=new n.FrameData,this._images[e].frameData.addFrame(new n.Frame(0,0,0,r.width,r.height,t,this.game.rnd.uuid())),PIXI.BaseTextureCache[e]=new PIXI.BaseTexture(r),PIXI.TextureCache[e]=new PIXI.Texture(PIXI.BaseTextureCache[e]),this._resolveURL(t,this._images[e])},addSound:function(e,t,n,r,i){r=r||!0,i=i||!1;var s=!1;i&&(s=!0),this._sounds[e]={url:t,data:n,isDecoding:!1,decoded:s,webAudio:r,audioTag:i,locked:this.game.sound.touchLocked},this._resolveURL(t,this._sounds[e])},reloadSound:function(e){var t=this;this._sounds[e]&&(this._sounds[e].data.src=this._sounds[e].url,this._sounds[e].data.addEventListener("canplaythrough",function(){return t.reloadSoundComplete(e)},!1),this._sounds[e].data.load())},reloadSoundComplete:function(e){this._sounds[e]&&(this._sounds[e].locked=!1,this.onSoundUnlock.dispatch(e))},updateSound:function(e,t,n){this._sounds[e]&&(this._sounds[e][t]=n)},decodedSound:function(e,t){this._sounds[e].data=t,this._sounds[e].decoded=!0,this._sounds[e].isDecoding=!1},getCanvas:function(e){return this._canvases[e]?this._canvases[e].canvas:(console.warn('Phaser.Cache.getCanvas: Invalid key: "'+e+'"'),null)},getBitmapData:function(e){return this._bitmapDatas[e]?this._bitmapDatas[e].data:(console.warn('Phaser.Cache.getBitmapData: Invalid key: "'+e+'"'),null)},getBitmapFont:function(e){return this._bitmapFont[e]?this._bitmapFont[e]:(console.warn('Phaser.Cache.getBitmapFont: Invalid key: "'+e+'"'),null)},getPhysicsData:function(e,t,n){if("undefined"==typeof t||null===t){if(this._physics[e])return this._physics[e].data;console.warn('Phaser.Cache.getPhysicsData: Invalid key: "'+e+'"')}else if(this._physics[e]&&this._physics[e].data[t]){var r=this._physics[e].data[t];if(!r||!n)return r;for(var i in r)if(i=r[i],i.fixtureKey===n)return i;console.warn('Phaser.Cache.getPhysicsData: Could not find given fixtureKey: "'+n+" in "+e+'"')}else console.warn('Phaser.Cache.getPhysicsData: Invalid key/object: "'+e+" / "+t+'"');return null},checkKey:function(e,t){return this._cacheMap[e][t]?!0:!1},checkCanvasKey:function(e){return this.checkKey(n.Cache.CANVAS,e)},checkImageKey:function(e){return this.checkKey(n.Cache.IMAGE,e)},checkTextureKey:function(e){return this.checkKey(n.Cache.TEXTURE,e)},checkSoundKey:function(e){return this.checkKey(n.Cache.SOUND,e)},checkTextKey:function(e){return this.checkKey(n.Cache.TEXT,e)},checkPhysicsKey:function(e){return this.checkKey(n.Cache.PHYSICS,e)},checkTilemapKey:function(e){return this.checkKey(n.Cache.TILEMAP,e)},checkBinaryKey:function(e){return this.checkKey(n.Cache.BINARY,e)},checkBitmapDataKey:function(e){return this.checkKey(n.Cache.BITMAPDATA,e)},checkBitmapFontKey:function(e){return this.checkKey(n.Cache.BITMAPFONT,e)},checkJSONKey:function(e){return this.checkKey(n.Cache.JSON,e)},checkXMLKey:function(e){return this.checkKey(n.Cache.XML,e)},checkURL:function(e){return this._urlMap[this._resolveURL(e)]?!0:!1},getImage:function(e){return this._images[e]?this._images[e].data:(console.warn('Phaser.Cache.getImage: Invalid key: "'+e+'"'),null)},getTilemapData:function(e){return this._tilemaps[e]?this._tilemaps[e]:(console.warn('Phaser.Cache.getTilemapData: Invalid key: "'+e+'"'),null)},getFrameData:function(e,t){return"undefined"==typeof t&&(t=n.Cache.IMAGE),this._cacheMap[t][e]?this._cacheMap[t][e].frameData:null},updateFrameData:function(e,t){this._images[e]&&(this._images[e].frameData=t)},getFrameByIndex:function(e,t){return this._images[e]?this._images[e].frameData.getFrame(t):null},getFrameByName:function(e,t){return this._images[e]?this._images[e].frameData.getFrameByName(t):null},getFrame:function(e){return this._images[e]?this._images[e].frame:null},getTextureFrame:function(e){return this._textures[e]?this._textures[e].frame:null},getRenderTexture:function(e){return this._textures[e]?this._textures[e]:(console.warn('Phaser.Cache.getTexture: Invalid key: "'+e+'"'),null)},getTexture:function(e){return this._textures[e]?this._textures[e]:void console.warn('Phaser.Cache.getTexture: Invalid key: "'+e+'"')},getSound:function(e){return this._sounds[e]?this._sounds[e]:(console.warn('Phaser.Cache.getSound: Invalid key: "'+e+'"'),null)},getSoundData:function(e){return this._sounds[e]?this._sounds[e].data:(console.warn('Phaser.Cache.getSoundData: Invalid key: "'+e+'"'),null)},isSoundDecoded:function(e){return this._sounds[e]?this._sounds[e].decoded:void 0},isSoundReady:function(e){return this._sounds[e]&&this._sounds[e].decoded&&this.game.sound.touchLocked===!1},getFrameCount:function(e){return this._images[e]?this._images[e].frameData.total:0},getText:function(e){return this._text[e]?this._text[e].data:(console.warn('Phaser.Cache.getText: Invalid key: "'+e+'"'),null)},getJSON:function(e){return this._json[e]?this._json[e].data:(console.warn('Phaser.Cache.getJSON: Invalid key: "'+e+'"'),null)},getXML:function(e){return this._xml[e]?this._xml[e].data:(console.warn('Phaser.Cache.getXML: Invalid key: "'+e+'"'),null)},getBinary:function(e){return this._binary[e]?this._binary[e]:(console.warn('Phaser.Cache.getBinary: Invalid key: "'+e+'"'),null)},getURL:function(e){var e=this._resolveURL(e);return e?this._urlMap[e]:(console.warn('Phaser.Cache.getUrl: Invalid url: "'+e+'" or Cache.autoResolveURL was false'),null)},getUrl:function(e){return this.getURL(e)},getKeys:function(e){var t=null;switch(e){case n.Cache.CANVAS:t=this._canvases;break;case n.Cache.IMAGE:t=this._images;break;case n.Cache.TEXTURE:t=this._textures;break;case n.Cache.SOUND:t=this._sounds;break;case n.Cache.TEXT:t=this._text;break;case n.Cache.PHYSICS:t=this._physics;break;case n.Cache.TILEMAP:t=this._tilemaps;break;case n.Cache.BINARY:t=this._binary;break;case n.Cache.BITMAPDATA:t=this._bitmapDatas;break;case n.Cache.BITMAPFONT:t=this._bitmapFont;break;case n.Cache.JSON:t=this._json;break;case n.Cache.XML:t=this._xml}if(t){var r=[];for(var i in t)"__default"!==i&&"__missing"!==i&&r.push(i);return r}},removeCanvas:function(e){delete this._canvases[e]},removeImage:function(e,t){"undefined"==typeof t&&(t=!0),delete this._images[e],t&&PIXI.BaseTextureCache[e].destroy()},removeSound:function(e){delete this._sounds[e]},removeText:function(e){delete this._text[e]},removeJSON:function(e){delete this._json[e]},removeXML:function(e){delete this._xml[e]},removePhysics:function(e){delete this._physics[e]},removeTilemap:function(e){delete this._tilemaps[e]},removeBinary:function(e){delete this._binary[e]},removeBitmapData:function(e){delete this._bitmapDatas[e]},removeBitmapFont:function(e){delete this._bitmapFont[e]},_resolveURL:function(e,t){return this.autoResolveURL?(this._urlResolver.src=this.game.load.baseURL+e,this._urlTemp=this._urlResolver.src,this._urlResolver.src="",t&&(this._urlMap[this._urlTemp]=t),this._urlTemp):null},destroy:function(){for(var e in this._images)"__default"!==e&&"__missing"!==e&&delete this._images[e];for(var t=[this._canvases,this._sounds,this._text,this._json,this._xml,this._textures,this._physics,this._tilemaps,this._binary,this._bitmapDatas,this._bitmapFont],n=0;n<t.length;n++)for(var e in t[n])delete t[n][e];this._urlMap=null,this._urlResolver=null,this._urlTemp=null}},n.Cache.prototype.constructor=n.Cache,n.Loader=function(e){this.game=e,this.resetLocked=!1,this.isLoading=!1,this.hasLoaded=!1,this.preloadSprite=null,this.crossOrigin=!1,this.baseURL="",this.onLoadStart=new n.Signal,this.onLoadComplete=new n.Signal,this.onPackComplete=new n.Signal,this.onFileStart=new n.Signal,this.onFileComplete=new n.Signal,this.onFileError=new n.Signal,this.useXDomainRequest=!1,this._warnedAboutXDomainRequest=!1,this.enableParallel=!0,this.maxParallelDownloads=4,this._withSyncPointDepth=0,this._fileList=[],this._flightQueue=[],this._processingHead=0,this._fileLoadStarted=!1,this._totalPackCount=0,this._totalFileCount=0,this._loadedPackCount=0,this._loadedFileCount=0},n.Loader.TEXTURE_ATLAS_JSON_ARRAY=0,n.Loader.TEXTURE_ATLAS_JSON_HASH=1,n.Loader.TEXTURE_ATLAS_XML_STARLING=2,n.Loader.PHYSICS_LIME_CORONA_JSON=3,n.Loader.PHYSICS_PHASER_JSON=4,n.Loader.prototype={setPreloadSprite:function(e,t){t=t||0,this.preloadSprite={sprite:e,direction:t,width:e.width,height:e.height,rect:null},this.preloadSprite.rect=0===t?new n.Rectangle(0,0,1,e.height):new n.Rectangle(0,0,e.width,1),e.crop(this.preloadSprite.rect),e.visible=!0},resize:function(){this.preloadSprite&&this.preloadSprite.height!==this.preloadSprite.sprite.height&&(this.preloadSprite.rect.height=this.preloadSprite.sprite.height)},checkKeyExists:function(e,t){return this.getAssetIndex(e,t)>-1},getAssetIndex:function(e,t){for(var n=-1,r=0;r<this._fileList.length;r++){var i=this._fileList[r];if(i.type===e&&i.key===t&&(n=r,!i.loaded&&!i.loading))break}return n},getAsset:function(e,t){var n=this.getAssetIndex(e,t);return n>-1?{index:n,file:this._fileList[n]}:!1},reset:function(e,t){"undefined"==typeof t&&(t=!1),this.resetLocked||(e&&(this.preloadSprite=null),this.isLoading=!1,this._processingHead=0,this._fileList.length=0,this._flightQueue.length=0,this._fileLoadStarted=!1,this._totalFileCount=0,this._totalPackCount=0,this._loadedPackCount=0,this._loadedFileCount=0,t&&(this.onLoadStart.removeAll(),this.onLoadComplete.removeAll(),this.onPackComplete.removeAll(),this.onFileStart.removeAll(),this.onFileComplete.removeAll(),this.onFileError.removeAll()))},addToFileList:function(e,t,n,r,i){var s={type:e,key:t,url:n,syncPoint:this._withSyncPointDepth>0,data:null,loading:!1,loaded:!1,error:!1};if(r)for(var o in r)s[o]=r[o];var u=this.getAssetIndex(e,t);if(i&&u>-1){var a=this._fileList[u];a.loading||a.loaded?(this._fileList.push(s),this._totalFileCount++):this._fileList[u]=s}else-1===u&&(this._fileList.push(s),this._totalFileCount++)},replaceInFileList:function(e,t,n,r){return this.addToFileList(e,t,n,r,!0)},pack:function(e,t,n,r){if("undefined"==typeof t&&(t=null),"undefined"==typeof n&&(n=null),"undefined"==typeof r&&(r=null),!t&&!n)return console.warn("Phaser.Loader.pack - Both url and data are null. One must be set."),this;var i={type:"packfile",key:e,url:t,syncPoint:!0,data:null,loading:!1,loaded:!1,error:!1,callbackContext:r};n&&("string"==typeof n&&(n=JSON.parse(n)),i.data=n||{},i.loaded=!0);for(var s=0;s<this._fileList.length+1;s++){var o=this._fileList[s];if(!o||!o.loaded&&!o.loading&&"packfile"!==o.type){this._fileList.splice(s,1,i),this._totalPackCount++;break}}return this},image:function(e,t,n){return"undefined"==typeof n&&(n=!1),this.addToFileList("image",e,t,void 0,n),this},text:function(e,t,n){return"undefined"==typeof n&&(n=!1),this.addToFileList("text",e,t,void 0,n),this},json:function(e,t,n){return"undefined"==typeof n&&(n=!1),this.addToFileList("json",e,t,void 0,n),this},xml:function(e,t,n){return"undefined"==typeof n&&(n=!1),this.addToFileList("xml",e,t,void 0,n),this},script:function(e,t,n,r){return"undefined"==typeof n&&(n=!1),n!==!1&&"undefined"==typeof r&&(r=n),this.addToFileList("script",e,t,{syncPoint:!0,callback:n,callbackContext:r}),this},binary:function(e,t,n,r){return"undefined"==typeof n&&(n=!1),n!==!1&&"undefined"==typeof r&&(r=n),this.addToFileList("binary",e,t,{callback:n,callbackContext:r}),this},spritesheet:function(e,t,n,r,i,s,o){return"undefined"==typeof i&&(i=-1),"undefined"==typeof s&&(s=0),"undefined"==typeof o&&(o=0),this.addToFileList("spritesheet",e,t,{frameWidth:n,frameHeight:r,frameMax:i,margin:s,spacing:o}),this},audio:function(e,t,n){return"undefined"==typeof n&&(n=!0),"string"==typeof t&&(t=[t]),this.addToFileList("audio",e,t,{buffer:null,autoDecode:n}),this},audiosprite:function(e,t,n,r,i){return"undefined"==typeof n&&(n=null),"undefined"==typeof r&&(r=null),"undefined"==typeof i&&(i=!0),this.audio(e,t,i),n?this.json(e+"-audioatlas",n):r?("string"==typeof r&&(r=JSON.parse(r)),this.game.cache.addJSON(e+"-audioatlas","",r)):console.warn("Phaser.Loader.audiosprite - You must specify either a jsonURL or provide a jsonData object"),this},tilemap:function(e,t,r,i){if("undefined"==typeof t&&(t=null),"undefined"==typeof r&&(r=null),"undefined"==typeof i&&(i=n.Tilemap.CSV),!t&&!r)return console.warn("Phaser.Loader.tilemap - Both url and data are null. One must be set."),this;if(r){switch(i){case n.Tilemap.CSV:break;case n.Tilemap.TILED_JSON:"string"==typeof r&&(r=JSON.parse(r))}this.game.cache.addTilemap(e,null,r,i)}else this.addToFileList("tilemap",e,t,{format:i});return this},physics:function(e,t,r,i){return"undefined"==typeof t&&(t=null),"undefined"==typeof r&&(r=null),"undefined"==typeof i&&(i=n.Physics.LIME_CORONA_JSON),t||r?(r?("string"==typeof r&&(r=JSON.parse(r)),this.game.cache.addPhysicsData(e,null,r,i)):this.addToFileList("physics",e,t,{format:i}),this):(console.warn("Phaser.Loader.physics - Both url and data are null. One must be set."),this)},bitmapFont:function(e,t,n,r,i,s){if("undefined"==typeof n&&(n=null),"undefined"==typeof r&&(r=null),"undefined"==typeof i&&(i=0),"undefined"==typeof s&&(s=0),n)this.addToFileList("bitmapfont",e,t,{xmlURL:n,xSpacing:i,ySpacing:s});else if("string"==typeof r){var o=this.parseXml(r);if(!o)throw new Error("Phaser.Loader. Invalid Bitmap Font XML given");this.addToFileList("bitmapfont",e,t,{xmlURL:null,xmlData:o,xSpacing:i,ySpacing:s})}return this},atlasJSONArray:function(e,t,r,i){return this.atlas(e,t,r,i,n.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(e,t,r,i){return this.atlas(e,t,r,i,n.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(e,t,r,i){return this.atlas(e,t,r,i,n.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(e,t,r,i,s){if("undefined"==typeof r&&(r=null),"undefined"==typeof i&&(i=null),"undefined"==typeof s&&(s=n.Loader.TEXTURE_ATLAS_JSON_ARRAY),r)this.addToFileList("textureatlas",e,t,{atlasURL:r,format:s});else{switch(s){case n.Loader.TEXTURE_ATLAS_JSON_ARRAY:"string"==typeof i&&(i=JSON.parse(i));break;case n.Loader.TEXTURE_ATLAS_XML_STARLING:if("string"==typeof i){var o=this.parseXml(i);if(!o)throw new Error("Phaser.Loader. Invalid Texture Atlas XML given");i=o}}this.addToFileList("textureatlas",e,t,{atlasURL:null,atlasData:i,format:s})}return this},withSyncPoint:function(e,t){this._withSyncPointDepth++;try{e.call(t||this,this)}finally{this._withSyncPointDepth--}return this},addSyncPoint:function(e,t){var n=this.getAsset(e,t);return n&&(n.file.syncPoint=!0),this},removeFile:function(e,t){var n=this.getAsset(e,t);n&&(n.loaded||n.loading||this._fileList.splice(n.index,1))},removeAll:function(){this._fileList.length=0,this._flightQueue.length=0},start:function(){this.isLoading||(this.hasLoaded=!1,this.isLoading=!0,this.updateProgress(),this.processLoadQueue())},processLoadQueue:function(){if(!this.isLoading)return console.warn("Phaser.Loader - active loading canceled / reset"),void this.finishedLoading(!0);for(var e=0;e<this._flightQueue.length;e++){var t=this._flightQueue[e];(t.loaded||t.error)&&(this._flightQueue.splice(e,1),e--,t.loading=!1,t.requestUrl=null,t.requestObject=null,t.error&&this.onFileError.dispatch(t.key,t),"packfile"!==t.type?(this._loadedFileCount++,this.onFileComplete.dispatch(this.progress,t.key,!t.error,this._loadedFileCount,this._totalFileCount)):"packfile"===t.type&&t.error&&(this._loadedPackCount++,this.onPackComplete.dispatch(t.key,!t.error,this._loadedPackCount,this._totalPackCount)))}for(var r=!1,i=this.enableParallel?n.Math.clamp(this.maxParallelDownloads,1,12):1,e=this._processingHead;e<this._fileList.length;e++){var t=this._fileList[e];if("packfile"===t.type&&!t.error&&t.loaded&&e===this._processingHead&&(this.processPack(t),this._loadedPackCount++,this.onPackComplete.dispatch(t.key,!t.error,this._loadedPackCount,this._totalPackCount)),t.loaded||t.error?e===this._processingHead&&(this._processingHead=e+1):!t.loading&&this._flightQueue.length<i&&("packfile"!==t.type||t.data?r||(this._fileLoadStarted||(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),this._flightQueue.push(t),t.loading=!0,this.onFileStart.dispatch(this.progress,t.key,t.url),this.loadFile(t)):(this._flightQueue.push(t),t.loading=!0,this.loadFile(t))),!t.loaded&&t.syncPoint&&(r=!0),this._flightQueue.length>=i||r&&this._loadedPackCount===this._totalPackCount)break}if(this.updateProgress(),this._processingHead>=this._fileList.length)this.finishedLoading();else if(!this._flightQueue.length){console.warn("Phaser.Loader - aborting: processing queue empty, loading may have stalled");var s=this;setTimeout(function(){s.finishedLoading(!0)},2e3)}},finishedLoading:function(e){this.hasLoaded||(this.hasLoaded=!0,this.isLoading=!1,e||this._fileLoadStarted||(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),this.onLoadComplete.dispatch(),this.reset(),this.game.state.loadComplete())},asyncComplete:function(e,t){"undefined"==typeof t&&(t=""),e.loaded=!0,e.error=!!t,t&&(e.errorMessage=t,console.warn("Phaser.Loader - "+e.type+"["+e.key+"]: "+t)),this.processLoadQueue()},processPack:function(e){var t=e.data[e.key];if(!t)return void console.warn("Phaser.Loader - "+e.key+": pack has data, but not for pack key");for(var r=0;r<t.length;r++){var i=t[r];switch(i.type){case"image":this.image(i.key,i.url,i.overwrite);break;case"text":this.text(i.key,i.url,i.overwrite);break;case"json":this.json(i.key,i.url,i.overwrite);break;case"xml":this.xml(i.key,i.url,i.overwrite);break;case"script":this.script(i.key,i.url,i.callback,e.callbackContext||this);break;case"binary":this.binary(i.key,i.url,i.callback,e.callbackContext||this);break;case"spritesheet":this.spritesheet(i.key,i.url,i.frameWidth,i.frameHeight,i.frameMax,i.margin,i.spacing);break;case"audio":this.audio(i.key,i.urls,i.autoDecode);break;case"audiosprite":this.audio(i.key,i.urls,i.jsonURL);break;case"tilemap":this.tilemap(i.key,i.url,i.data,n.Tilemap[i.format]);break;case"physics":this.physics(i.key,i.url,i.data,n.Loader[i.format]);break;case"bitmapFont":this.bitmapFont(i.key,i.textureURL,i.xmlURL,i.xmlData,i.xSpacing,i.ySpacing);break;case"atlasJSONArray":this.atlasJSONArray(i.key,i.textureURL,i.atlasURL,i.atlasData);break;case"atlasJSONHash":this.atlasJSONHash(i.key,i.textureURL,i.atlasURL,i.atlasData);break;case"atlasXML":this.atlasXML(i.key,i.textureURL,i.atlasURL,i.atlasData);break;case"atlas":this.atlas(i.key,i.textureURL,i.atlasURL,i.atlasData,n.Loader[i.format])}}},transformUrl:function(e){return this.baseURL+e},loadFile:function(e){switch(e.type){case"packfile":this.xhrLoad(e,this.transformUrl(e.url,e),"text",this.fileComplete);break;case"image":case"spritesheet":case"textureatlas":case"bitmapfont":this.loadImageTag(e);break;case"audio":e.url=this.getAudioURL(e.url),e.url?this.game.sound.usingWebAudio?this.xhrLoad(e,this.transformUrl(e.url,e),"arraybuffer",this.fileComplete):this.game.sound.usingAudioTag&&this.loadAudioTag(e):this.fileError(e,null,"no supported audio URL specified");break;case"json":this.xhrLoad(e,this.transformUrl(e.url,e),"text",this.jsonLoadComplete);break;case"xml":this.xhrLoad(e,this.transformUrl(e.url,e),"text",this.xmlLoadComplete);break;case"tilemap":e.format===n.Tilemap.TILED_JSON?this.xhrLoad(e,this.transformUrl(e.url,e),"text",this.jsonLoadComplete):e.format===n.Tilemap.CSV?this.xhrLoad(e,this.transformUrl(e.url,e),"text",this.csvLoadComplete):this.asyncComplete(e,"invalid Tilemap format: "+e.format);break;case"text":case"script":case"physics":this.xhrLoad(e,this.transformUrl(e.url,e),"text",this.fileComplete);break;case"binary":this.xhrLoad(e,this.transformUrl(e.url,e),"arraybuffer",this.fileComplete)}},loadImageTag:function(e){var t=this;e.data=new Image,e.data.name=e.key,this.crossOrigin&&(e.data.crossOrigin=this.crossOrigin),e.data.onload=function(){e.data.onload&&(e.data.onload=null,e.data.onerror=null,t.fileComplete(e))},e.data.onerror=function(){e.data.onload&&(e.data.onload=null,e.data.onerror=null,t.fileError(e))},e.data.src=this.transformUrl(e.url,e),e.data.complete&&e.data.width&&e.data.height&&(e.data.onload=null,e.data.onerror=null,this.fileComplete(e))},loadAudioTag:function(e){var t=this;if(this.game.sound.touchLocked)e.data=new Audio,e.data.name=e.key,e.data.preload="auto",e.data.src=this.transformUrl(e.url,e),this.fileComplete(e);else{e.data=new Audio,e.data.name=e.key;var r=function(){e.data.removeEventListener("canplaythrough",r,!1),e.data.onerror=null,n.GAMES[t.game.id].load.fileComplete(e)};e.data.onerror=function(){e.data.removeEventListener("canplaythrough",r,!1),e.data.onerror=null,t.fileError(e)},e.data.preload="auto",e.data.src=this.transformUrl(e.url,e),e.data.addEventListener("canplaythrough",r,!1),e.data.load()}},xhrLoad:function(e,t,n,r,i){if(this.useXDomainRequest&&window.XDomainRequest)return void this.xhrLoadWithXDR(e,t,n,r,i);var s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType=n,i=i||this.fileError;var o=this;s.onload=function(){try{return r.call(o,e,s)}catch(t){o.hasLoaded?window.console&&console.error(t):o.asyncComplete(e,t.message||"Exception")}},s.onerror=function(){try{return i.call(o,e,s)}catch(t){o.hasLoaded?window.console&&console.error(t):o.asyncComplete(e,t.message||"Exception")}},e.requestObject=s,e.requestUrl=t,s.send()},xhrLoadWithXDR:function(e,t,n,r,i){this._warnedAboutXDomainRequest||this.game.device.ie&&!(this.game.device.ieVersion>=10)||(this._warnedAboutXDomainRequest=!0,console.warn("Phaser.Loader - using XDomainRequest outside of IE 9"));var s=new window.XDomainRequest;s.open("GET",t,!0),s.responseType=n,s.timeout=3e3,i=i||this.fileError;var o=this;s.onerror=function(){try{return i.call(o,e,s)}catch(t){o.asyncComplete(e,t.message||"Exception")}},s.ontimeout=function(){try{return i.call(o,e,s)}catch(t){o.asyncComplete(e,t.message||"Exception")}},s.onprogress=function(){},s.onload=function(){try{return r.call(o,e,s)}catch(t){o.asyncComplete(e,t.message||"Exception")}},e.requestObject=s,e.requestUrl=t,setTimeout(function(){s.send()},0)},getAudioURL:function(e){for(var t=0;t<e.length;t++){var n,r=e[t];if(r.uri)r=r.uri,n=r.type;else{if(0===r.indexOf("blob:")||0===r.indexOf("data:"))return r;r.indexOf("?")>=0&&(r=r.substr(0,r.indexOf("?")));var i=r.substr((Math.max(0,r.lastIndexOf("."))||1/0)+1);n=i.toLowerCase()}if(this.game.device.canPlayAudio(n))return e[t]}return null},fileError:function(e,t,n){var r=e.requestUrl||this.transformUrl(e.url,e),i="error loading asset from URL "+r;!n&&t&&(n=t.status),n&&(i=i+" ("+n+")"),this.asyncComplete(e,i)},fileComplete:function(e,t){var r=!0;switch(e.type){case"packfile":var i=JSON.parse(t.responseText);e.data=i||{};break;case"image":this.game.cache.addImage(e.key,e.url,e.data);break;case"spritesheet":this.game.cache.addSpriteSheet(e.key,e.url,e.data,e.frameWidth,e.frameHeight,e.frameMax,e.margin,e.spacing);break;case"textureatlas":if(null==e.atlasURL)this.game.cache.addTextureAtlas(e.key,e.url,e.data,e.atlasData,e.format);else if(r=!1,e.format==n.Loader.TEXTURE_ATLAS_JSON_ARRAY||e.format==n.Loader.TEXTURE_ATLAS_JSON_HASH)this.xhrLoad(e,this.transformUrl(e.atlasURL,e),"text",this.jsonLoadComplete);else{if(e.format!=n.Loader.TEXTURE_ATLAS_XML_STARLING)throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+e.format);this.xhrLoad(e,this.transformUrl(e.atlasURL,e),"text",this.xmlLoadComplete)}break;case"bitmapfont":e.xmlURL?(r=!1,this.xhrLoad(e,this.transformUrl(e.xmlURL,e),"text",this.xmlLoadComplete)):this.game.cache.addBitmapFont(e.key,e.url,e.data,e.xmlData,e.xSpacing,e.ySpacing);break;case"audio":this.game.sound.usingWebAudio?(e.data=t.response,this.game.cache.addSound(e.key,e.url,e.data,!0,!1),e.autoDecode&&this.game.sound.decode(e.key)):this.game.cache.addSound(e.key,e.url,e.data,!1,!0);break;case"text":e.data=t.responseText,this.game.cache.addText(e.key,e.url,e.data);break;case"physics":var i=JSON.parse(t.responseText);this.game.cache.addPhysicsData(e.key,e.url,i,e.format);break;case"script":e.data=document.createElement("script"),e.data.language="javascript",e.data.type="text/javascript",e.data.defer=!1,e.data.text=t.responseText,document.head.appendChild(e.data),e.callback&&(e.data=e.callback.call(e.callbackContext,e.key,t.responseText));break;case"binary":e.data=e.callback?e.callback.call(e.callbackContext,e.key,t.response):t.response,this.game.cache.addBinary(e.key,e.data)}r&&this.asyncComplete(e)},jsonLoadComplete:function(e,t){var n=JSON.parse(t.responseText);"tilemap"===e.type?this.game.cache.addTilemap(e.key,e.url,n,e.format):"json"===e.type?this.game.cache.addJSON(e.key,e.url,n):this.game.cache.addTextureAtlas(e.key,e.url,e.data,n,e.format),this.asyncComplete(e)},csvLoadComplete:function(e,t){var n=t.responseText;this.game.cache.addTilemap(e.key,e.url,n,e.format),this.asyncComplete(e)},xmlLoadComplete:function(e,t){var n=t.responseText,r=this.parseXml(n);if(!r){var i=t.responseType||t.contentType;return console.warn("Phaser.Loader - "+e.key+": invalid XML ("+i+")"),void this.asyncComplete(e,"invalid XML")}"bitmapfont"===e.type?this.game.cache.addBitmapFont(e.key,e.url,e.data,r,e.xSpacing,e.ySpacing):"textureatlas"===e.type?this.game.cache.addTextureAtlas(e.key,e.url,e.data,r,e.format):"xml"===e.type&&this.game.cache.addXML(e.key,e.url,r),this.asyncComplete(e)},parseXml:function(e){var t;try{if(window.DOMParser){var n=new DOMParser;t=n.parseFromString(e,"text/xml")}else t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)}catch(r){t=null}return t&&t.documentElement&&!t.getElementsByTagName("parsererror").length?t:null},updateProgress:function(){this.preloadSprite&&(0===this.preloadSprite.direction?this.preloadSprite.rect.width=Math.floor(this.preloadSprite.width/100*this.progress):this.preloadSprite.rect.height=Math.floor(this.preloadSprite.height/100*this.progress),this.preloadSprite.sprite?this.preloadSprite.sprite.updateCrop():this.preloadSprite=null)},totalLoadedFiles:function(){return this._loadedFileCount},totalQueuedFiles:function(){return this._totalFileCount-this._loadedFileCount},totalLoadedPacks:function(){return this._totalPackCount},totalQueuedPacks:function(){return this._totalPackCount-this._loadedPackCount}},Object.defineProperty(n.Loader.prototype,"progressFloat",{get:function(){var e=this._loadedFileCount/this._totalFileCount*100;return n.Math.clamp(e||0,0,100)}}),Object.defineProperty(n.Loader.prototype,"progress",{get:function(){return Math.round(this.progressFloat)}}),n.Loader.prototype.constructor=n.Loader,n.LoaderParser={bitmapFont:function(e,t,n,r,i){var s={},o=t.getElementsByTagName("info")[0],u=t.getElementsByTagName("common")[0];s.font=o.getAttribute("face"),s.size=parseInt(o.getAttribute("size"),10),s.lineHeight=parseInt(u.getAttribute("lineHeight"),10)+i,s.chars={};for(var a=t.getElementsByTagName("char"),f=0;f<a.length;f++){var l=parseInt(a[f].getAttribute("id"),10),c=new PIXI.Rectangle(parseInt(a[f].getAttribute("x"),10),parseInt(a[f].getAttribute("y"),10),parseInt(a[f].getAttribute("width"),10),parseInt(a[f].getAttribute("height"),10));s.chars[l]={xOffset:parseInt(a[f].getAttribute("xoffset"),10),yOffset:parseInt(a[f].getAttribute("yoffset"),10),xAdvance:parseInt(a[f].getAttribute("xadvance"),10)+r,kerning:{},texture:PIXI.TextureCache[n]=new PIXI.Texture(PIXI.BaseTextureCache[n],c)}}var h=t.getElementsByTagName("kerning");for(f=0;f<h.length;f++){var p=parseInt(h[f].getAttribute("first"),10),d=parseInt(h[f].getAttribute("second"),10),v=parseInt(h[f].getAttribute("amount"),10);s.chars[d].kerning[p]=v}PIXI.BitmapText.fonts[n]=s}},n.AudioSprite=function(e,t){this.game=e,this.key=t,this.config=this.game.cache.getJSON(t+"-audioatlas"),this.autoplayKey=null,this.autoplay=!1,this.sounds={};for(var n in this.config.spritemap){var r=this.config.spritemap[n],i=this.game.add.sound(this.key);i.addMarker(n,r.start,r.end-r.start,null,r.loop),this.sounds[n]=i}this.config.autoplay&&(this.autoplayKey=this.config.autoplay,this.play(this.autoplayKey),this.autoplay=this.sounds[this.autoplayKey])},n.AudioSprite.prototype={play:function(e,t){return"undefined"==typeof t&&(t=1),this.sounds[e].play(e,null,t)},stop:function(e){if(e)this.sounds[e].stop();else for(var t in this.sounds)this.sounds[t].stop()},get:function(e){return this.sounds[e]}},n.AudioSprite.prototype.constructor=n.AudioSprite,n.Sound=function(e,t,r,i,s){"undefined"==typeof r&&(r=1),"undefined"==typeof i&&(i=!1),"undefined"==typeof s&&(s=e.sound.connectToMaster),this.game=e,this.name=t,this.key=t,this.loop=i,this.volume=r,this.markers={},this.context=null,this.autoplay=!1,this.totalDuration=0,this.startTime=0,this.currentTime=0,this.duration=0,this.durationMS=0,this.position=0,this.stopTime=0,this.paused=!1,this.pausedPosition=0,this.pausedTime=0,this.isPlaying=!1,this.currentMarker="",this.fadeTween=null,this.pendingPlayback=!1,this.override=!1,this.allowMultiple=!1,this.usingWebAudio=this.game.sound.usingWebAudio,this.usingAudioTag=this.game.sound.usingAudioTag,this.externalNode=null,this.masterGainNode=null,this.gainNode=null,this._sound=null,this.usingWebAudio?(this.context=this.game.sound.context,this.masterGainNode=this.game.sound.masterGain,this.gainNode="undefined"==typeof this.context.createGain?this.context.createGainNode():this.context.createGain(),this.gainNode.gain.value=r*this.game.sound.volume,s&&this.gainNode.connect(this.masterGainNode)):this.usingAudioTag&&(this.game.cache.getSound(t)&&this.game.cache.isSoundReady(t)?(this._sound=this.game.cache.getSoundData(t),this.totalDuration=0,this._sound.duration&&(this.totalDuration=this._sound.duration)):this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this)),this.onDecoded=new n.Signal,this.onPlay=new n.Signal,this.onPause=new n.Signal,this.onResume=new n.Signal,this.onLoop=new n.Signal,this.onStop=new n.Signal,this.onMute=new n.Signal,this.onMarkerComplete=new n.Signal,this.onFadeComplete=new n.Signal,this._volume=r,this._buffer=null,this._muted=!1,this._tempMarker=0,this._tempPosition=0,this._tempVolume=0,this._muteVolume=0,this._tempLoop=0,this._paused=!1,this._onDecodedEventDispatched=!1},n.Sound.prototype={soundHasUnlocked:function(e){e===this.key&&(this._sound=this.game.cache.getSoundData(this.key),this.totalDuration=this._sound.duration)},addMarker:function(e,t,n,r,i){"undefined"==typeof r&&(r=1),"undefined"==typeof i&&(i=!1),this.markers[e]={name:e,start:t,stop:t+n,volume:r,duration:n,durationMS:1e3*n,loop:i}},removeMarker:function(e){delete this.markers[e]},onEndedHandler:function(){this.isPlaying=!1,this.stop()},update:function(){this.isDecoded&&!this._onDecodedEventDispatched&&(this.onDecoded.dispatch(this),this._onDecodedEventDispatched=!0),this.pendingPlayback&&this.game.cache.isSoundReady(this.key)&&(this.pendingPlayback=!1,this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop)),this.isPlaying&&(this.currentTime=this.game.time.time-this.startTime,this.currentTime>=this.durationMS&&(this.usingWebAudio?this.loop?(this.onLoop.dispatch(this),""===this.currentMarker?(this.currentTime=0,this.startTime=this.game.time.time):(this.onMarkerComplete.dispatch(this.currentMarker,this),this.play(this.currentMarker,0,this.volume,!0,!0))):""!==this.currentMarker&&this.stop():this.loop?(this.onLoop.dispatch(this),this.play(this.currentMarker,0,this.volume,!0,!0)):this.stop()))},loopFull:function(e){this.play(null,0,e,!0)},play:function(e,t,n,r,i){if(("undefined"==typeof e||e===!1||null===e)&&(e=""),"undefined"==typeof i&&(i=!0),this.isPlaying&&!this.allowMultiple&&!i&&!this.override)return this;if(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||i))if(this.usingWebAudio)if("undefined"==typeof this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(s){}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);if(""===e&&Object.keys(this.markers).length>0)return this;if(""!==e){if(this.currentMarker=e,!this.markers[e])return this;this.position=this.markers[e].start,this.volume=this.markers[e].volume,this.loop=this.markers[e].loop,this.duration=this.markers[e].duration,this.durationMS=this.markers[e].durationMS,"undefined"!=typeof n&&(this.volume=n),"undefined"!=typeof r&&(this.loop=r),this._tempMarker=e,this._tempPosition=this.position,this._tempVolume=this.volume,this._tempLoop=this.loop}else t=t||0,"undefined"==typeof n&&(n=this._volume),"undefined"==typeof r&&(r=this.loop),this.position=t,this.volume=n,this.loop=r,this.duration=0,this.durationMS=0,this._tempMarker=e,this._tempPosition=t,this._tempVolume=n,this._tempLoop=r;return this.usingWebAudio?this.game.cache.isSoundDecoded(this.key)?(null===this._buffer&&(this._buffer=this.game.cache.getSoundData(this.key)),this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this._sound.connect(this.externalNode?this.externalNode:this.gainNode),this.loop&&""===e&&(this._sound.loop=!0),this.loop||""!==e||(this._sound.onended=this.onEndedHandler.bind(this)),this.totalDuration=this._sound.buffer.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=Math.ceil(1e3*this.totalDuration)),"undefined"==typeof this._sound.start?this._sound.noteGrainOn(0,this.position,this.duration):this.loop&&""===e?this._sound.start(0):this._sound.start(0,this.position,this.duration),this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):(this.pendingPlayback=!0,this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).isDecoding===!1&&this.game.sound.decode(this.key,this)):this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked?(this.game.cache.reloadSound(this.key),this.pendingPlayback=!0):this._sound&&(this.game.device.cocoonJS||4===this._sound.readyState)?(this._sound.play(),this.totalDuration=this._sound.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=1e3*this.totalDuration),this._sound.currentTime=this.position,this._sound.muted=this._muted,this._sound.volume=this._muted?0:this._volume,this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):this.pendingPlayback=!0,this},restart:function(e,t,n,r){e=e||"",t=t||0,n=n||1,"undefined"==typeof r&&(r=!1),this.play(e,t,n,r,!0)},pause:function(){this.isPlaying&&this._sound&&(this.paused=!0,this.pausedPosition=this.currentTime,this.pausedTime=this.game.time.time,this.onPause.dispatch(this),this.stop())},resume:function(){if(this.paused&&this._sound){if(this.usingWebAudio){var e=this.position+this.pausedPosition/1e3;this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this._sound.connect(this.externalNode?this.externalNode:this.gainNode),this.loop&&(this._sound.loop=!0),this.loop||""!==this.currentMarker||(this._sound.onended=this.onEndedHandler.bind(this));var t=this.duration-this.pausedPosition/1e3;"undefined"==typeof this._sound.start?this._sound.noteGrainOn(0,e,t):this._sound.start(0,e,t)}else this._sound.play();this.isPlaying=!0,this.paused=!1,this.startTime+=this.game.time.time-this.pausedTime,this.onResume.dispatch(this)}},stop:function(){if(this.isPlaying&&this._sound)if(this.usingWebAudio)if("undefined"==typeof this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(e){}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);this.pendingPlayback=!1,this.isPlaying=!1;var t=this.currentMarker;""!==this.currentMarker&&this.onMarkerComplete.dispatch(this.currentMarker,this),this.currentMarker="",null!==this.fadeTween&&this.fadeTween.stop(),this.paused||this.onStop.dispatch(this,t)},fadeIn:function(e,t,n){"undefined"==typeof t&&(t=!1),"undefined"==typeof n&&(n=this.currentMarker),this.paused||(this.play(n,0,0,t),this.fadeTo(e,1))},fadeOut:function(e){this.fadeTo(e,0)},fadeTo:function(e,t){if(this.isPlaying&&!this.paused&&t!==this.volume){if("undefined"==typeof e&&(e=1e3),"undefined"==typeof t)return void console.warn("Phaser.Sound.fadeTo: No Volume Specified.");this.fadeTween=this.game.add.tween(this).to({volume:t},e,n.Easing.Linear.None,!0),this.fadeTween.onComplete.add(this.fadeComplete,this)}},fadeComplete:function(){this.onFadeComplete.dispatch(this,this.volume),0===this.volume&&this.stop()},destroy:function(e){"undefined"==typeof e&&(e=!0),this.stop(),e?this.game.sound.remove(this):(this.markers={},this.context=null,this._buffer=null,this.externalNode=null,this.onDecoded.dispose(),this.onPlay.dispose(),this.onPause.dispose(),this.onResume.dispose(),this.onLoop.dispose(),this.onStop.dispose(),this.onMute.dispose(),this.onMarkerComplete.dispose())}},n.Sound.prototype.constructor=n.Sound,Object.defineProperty(n.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}}),Object.defineProperty(n.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}}),Object.defineProperty(n.Sound.prototype,"mute",{get:function(){return this._muted||this.game.sound.mute},set:function(e){e=e||null,e?(this._muted=!0,this.usingWebAudio?(this._muteVolume=this.gainNode.gain.value,this.gainNode.gain.value=0):this.usingAudioTag&&this._sound&&(this._muteVolume=this._sound.volume,this._sound.volume=0)):(this._muted=!1,this.usingWebAudio?this.gainNode.gain.value=this._muteVolume:this.usingAudioTag&&this._sound&&(this._sound.volume=this._muteVolume)),this.onMute.dispatch(this)}}),Object.defineProperty(n.Sound.prototype,"volume",{get:function(){return this._volume},set:function(e){this.usingWebAudio?(this._volume=e,this.gainNode.gain.value=e):this.usingAudioTag&&this._sound&&e>=0&&1>=e&&(this._volume=e,this._sound.volume=e)}}),n.SoundManager=function(e){this.game=e,this.onSoundDecode=new n.Signal,this._codeMuted=!1,this._muted=!1,this._unlockSource=null,this._volume=1,this._sounds=[],this._watchList=new n.ArraySet,this._watching=!1,this._watchCallback=null,this._watchContext=null,this.context=null,this.usingWebAudio=!0,this.usingAudioTag=!1,this.noAudio=!1,this.connectToMaster=!0,this.touchLocked=!1,this.channels=32},n.SoundManager.prototype={boot:function(){if(this.game.device.iOS&&this.game.device.webAudio===!1&&(this.channels=1),!this.game.device.cocoonJS&&this.game.device.iOS||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock?(this.game.input.touch.callbackContext=this,this.game.input.touch.touchStartCallback=this.unlock,this.game.input.mouse.callbackContext=this,this.game.input.mouse.mouseDownCallback=this.unlock,this.touchLocked=!0):this.touchLocked=!1,window.PhaserGlobal){if(window.PhaserGlobal.disableAudio===!0)return this.usingWebAudio=!1,void (this.noAudio=!0);if(window.PhaserGlobal.disableWebAudio===!0)return this.usingWebAudio=!1,this.usingAudioTag=!0,void (this.noAudio=!1)}if(window.PhaserGlobal&&window.PhaserGlobal.audioContext)this.context=window.PhaserGlobal.audioContext;else if(window.AudioContext)try{this.context=new window.AudioContext}catch(e){this.context=null,this.usingWebAudio=!1,this.noAudio=!0}else if(window.webkitAudioContext)try{this.context=new window.webkitAudioContext}catch(e){this.context=null,this.usingWebAudio=!1,this.noAudio=!0}window.Audio&&null===this.context&&(this.usingWebAudio=!1,this.usingAudioTag=!0,this.noAudio=!1),null!==this.context&&(this.masterGain="undefined"==typeof this.context.createGain?this.context.createGainNode():this.context.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this.context.destination))},unlock:function(){if(this.touchLocked!==!1)if(this.game.device.webAudio===!1||window.PhaserGlobal&&window.PhaserGlobal.disableWebAudio===!0)this.touchLocked=!1,this._unlockSource=null,this.game.input.touch.callbackContext=null,this.game.input.touch.touchStartCallback=null,this.game.input.mouse.callbackContext=null,this.game.input.mouse.mouseDownCallback=null;else{var e=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource(),this._unlockSource.buffer=e,this._unlockSource.connect(this.context.destination),"undefined"==typeof this._unlockSource.start?this._unlockSource.noteOn(0):this._unlockSource.start(0)}},stopAll:function(){for(var e=0;e<this._sounds.length;e++)this._sounds[e]&&this._sounds[e].stop()},pauseAll:function(){for(var e=0;e<this._sounds.length;e++)this._sounds[e]&&this._sounds[e].pause()},resumeAll:function(){for(var e=0;e<this._sounds.length;e++)this._sounds[e]&&this._sounds[e].resume()},decode:function(e,t){t=t||null;var n=this.game.cache.getSoundData(e);if(n&&this.game.cache.isSoundDecoded(e)===!1){this.game.cache.updateSound(e,"isDecoding",!0);var r=this;this.context.decodeAudioData(n,function(n){n&&(r.game.cache.decodedSound(e,n),r.onSoundDecode.dispatch(e,t))})}},setDecodedCallback:function(e,t,r){"string"==typeof e&&(e=[e]),this._watchList.reset();for(var i=0;i<e.length;i++)e[i]instanceof n.Sound?this.game.cache.isSoundDecoded(e[i].key)||this._watchList.add(e[i].key):this.game.cache.isSoundDecoded(e[i])||this._watchList.add(e[i]);0===this._watchList.total?(this._watching=!1,t.call(r)):(this._watching=!0,this._watchCallback=t,this._watchContext=r)},update:function(){this.touchLocked&&this.game.device.webAudio&&null!==this._unlockSource&&(this._unlockSource.playbackState===this._unlockSource.PLAYING_STATE||this._unlockSource.playbackState===this._unlockSource.FINISHED_STATE)&&(this.touchLocked=!1,this._unlockSource=null,this.game.input.touch.callbackContext=null,this.game.input.touch.touchStartCallback=null);for(var e=0;e<this._sounds.length;e++)this._sounds[e].update();if(this._watching){for(var t=this._watchList.first;t;)this.game.cache.isSoundDecoded(t)&&this._watchList.remove(t),t=this._watchList.next;0===this._watchList.total&&(this._watching=!1,this._watchCallback.call(this._watchContext))}},add:function(e,t,r,i){"undefined"==typeof t&&(t=1),"undefined"==typeof r&&(r=!1),"undefined"==typeof i&&(i=this.connectToMaster);var s=new n.Sound(this.game,e,t,r,i);return this._sounds.push(s),s},addSprite:function(e){var t=new n.AudioSprite(this.game,e);return t},remove:function(e){for(var t=this._sounds.length;t--;)if(this._sounds[t]===e)return this._sounds[t].destroy(!1),this._sounds.splice(t,1),!0;return!1},removeByKey:function(e){for(var t=this._sounds.length,n=0;t--;)this._sounds[t].key===e&&(this._sounds[t].destroy(!1),this._sounds.splice(t,1),n++);return n},play:function(e,t,n){var r=this.add(e,t,n);return r.play(),r},setMute:function(){if(!this._muted){this._muted=!0,this.usingWebAudio&&(this._muteVolume=this.masterGain.gain.value,this.masterGain.gain.value=0);for(var e=0;e<this._sounds.length;e++)this._sounds[e].usingAudioTag&&(this._sounds[e].mute=!0)}},unsetMute:function(){if(this._muted&&!this._codeMuted){this._muted=!1,this.usingWebAudio&&(this.masterGain.gain.value=this._muteVolume);for(var e=0;e<this._sounds.length;e++)this._sounds[e].usingAudioTag&&(this._sounds[e].mute=!1)}},destroy:function(){this.stopAll();for(var e=0;e<this._sounds.length;e++)this._sounds[e]&&this._sounds[e].destroy();this._sounds=[],this.onSoundDecode.dispose(),this.context&&window.PhaserGlobal&&(window.PhaserGlobal.audioContext=this.context)}},n.SoundManager.prototype.constructor=n.SoundManager,Object.defineProperty(n.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(e){if(e=e||null){if(this._muted)return;this._codeMuted=!0,this.setMute()}else{if(!this._muted)return;this._codeMuted=!1,this.unsetMute()}}}),Object.defineProperty(n.SoundManager.prototype,"volume",{get:function(){return this.usingWebAudio?this.masterGain.gain.value:this._volume},set:function(e){if(this._volume=e,this.usingWebAudio)this.masterGain.gain.value=e;else for(var t=0;t<this._sounds.length;t++)this._sounds[t].usingAudioTag&&(this._sounds[t].volume=this._sounds[t].volume*e)}}),n.Utils.Debug=function(e){this.game=e,this.sprite=null,this.bmd=null,this.canvas=null,this.context=null,this.font="14px Courier",this.columnWidth=100,this.lineHeight=16,this.renderShadow=!0,this.currentX=0,this.currentY=0,this.currentAlpha=1,this.dirty=!1},n.Utils.Debug.prototype={boot:function(){this.game.renderType===n.CANVAS?this.context=this.game.context:(this.bmd=this.game.make.bitmapData(this.game.width,this.game.height),this.sprite=this.game.make.image(0,0,this.bmd),this.game.stage.addChild(this.sprite),this.canvas=n.Canvas.create(this.game.width,this.game.height,"",!0),this.context=this.canvas.getContext("2d"))},preUpdate:function(){this.dirty&&this.sprite&&(this.bmd.clear(),this.bmd.draw(this.canvas,0,0),this.context.clearRect(0,0,this.game.width,this.game.height),this.dirty=!1)},reset:function(){this.context&&this.context.clearRect(0,0,this.game.width,this.game.height),this.sprite&&this.bmd.clear()},start:function(e,t,n,r){"number"!=typeof e&&(e=0),"number"!=typeof t&&(t=0),n=n||"rgb(255,255,255)","undefined"==typeof r&&(r=0),this.currentX=e,this.currentY=t,this.currentColor=n,this.currentAlpha=this.context.globalAlpha,this.columnWidth=r,this.dirty=!0,this.context.save(),this.context.setTransform(1,0,0,1,0,0),this.context.strokeStyle=n,this.context.fillStyle=n,this.context.font=this.font,this.context.globalAlpha=1},stop:function(){this.context.restore(),this.context.globalAlpha=this.currentAlpha},line:function(){for(var e=this.currentX,t=0;t<arguments.length;t++)this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(arguments[t],e+1,this.currentY+1),this.context.fillStyle=this.currentColor),this.context.fillText(arguments[t],e,this.currentY),e+=this.columnWidth;this.currentY+=this.lineHeight},soundInfo:function(e,t,n,r){this.start(t,n,r),this.line("Sound: "+e.key+" Locked: "+e.game.sound.touchLocked),this.line("Is Ready?: "+this.game.cache.isSoundReady(e.key)+" Pending Playback: "+e.pendingPlayback),this.line("Decoded: "+e.isDecoded+" Decoding: "+e.isDecoding),this.line("Total Duration: "+e.totalDuration+" Playing: "+e.isPlaying),this.line("Time: "+e.currentTime),this.line("Volume: "+e.volume+" Muted: "+e.mute),this.line("WebAudio: "+e.usingWebAudio+" Audio: "+e.usingAudioTag),""!==e.currentMarker&&(this.line("Marker: "+e.currentMarker+" Duration: "+e.duration+" (ms: "+e.durationMS+")"),this.line("Start: "+e.markers[e.currentMarker].start+" Stop: "+e.markers[e.currentMarker].stop),this.line("Position: "+e.position)),this.stop()},cameraInfo:function(e,t,n,r){this.start(t,n,r),this.line("Camera ("+e.width+" x "+e.height+")"),this.line("X: "+e.x+" Y: "+e.y),e.bounds&&this.line("Bounds x: "+e.bounds.x+" Y: "+e.bounds.y+" w: "+e.bounds.width+" h: "+e.bounds.height),this.line("View x: "+e.view.x+" Y: "+e.view.y+" w: "+e.view.width+" h: "+e.view.height),this.line("Total in view: "+e.totalInView),this.stop()},timer:function(e,t,n,r){this.start(t,n,r),this.line("Timer (running: "+e.running+" expired: "+e.expired+")"),this.line("Next Tick: "+e.next+" Duration: "+e.duration),this.line("Paused: "+e.paused+" Length: "+e.length),this.stop()},pointer:function(e,t,n,r,i){null!=e&&("undefined"==typeof t&&(t=!1),n=n||"rgba(0,255,0,0.5)",r=r||"rgba(255,0,0,0.5)",(t!==!0||e.isUp!==!0)&&(this.start(e.x,e.y-100,i),this.context.beginPath(),this.context.arc(e.x,e.y,e.circle.radius,0,2*Math.PI),this.context.fillStyle=e.active?n:r,this.context.fill(),this.context.closePath(),this.context.beginPath(),this.context.moveTo(e.positionDown.x,e.positionDown.y),this.context.lineTo(e.position.x,e.position.y),this.context.lineWidth=2,this.context.stroke(),this.context.closePath(),this.line("ID: "+e.id+" Active: "+e.active),this.line("World X: "+e.worldX+" World Y: "+e.worldY),this.line("Screen X: "+e.x+" Screen Y: "+e.y),this.line("Duration: "+e.duration+" ms"),this.line("is Down: "+e.isDown+" is Up: "+e.isUp),this.stop()))},spriteInputInfo:function(e,t,n,r){this.start(t,n,r),this.line("Sprite Input: ("+e.width+" x "+e.height+")"),this.line("x: "+e.input.pointerX().toFixed(1)+" y: "+e.input.pointerY().toFixed(1)),this.line("over: "+e.input.pointerOver()+" duration: "+e.input.overDuration().toFixed(0)),this.line("down: "+e.input.pointerDown()+" duration: "+e.input.downDuration().toFixed(0)),this.line("just over: "+e.input.justOver()+" just out: "+e.input.justOut()),this.stop()},key:function(e,t,n,r){this.start(t,n,r,150),this.line("Key:",e.keyCode,"isDown:",e.isDown),this.line("justDown:",e.justDown,"justUp:",e.justUp),this.line("Time Down:",e.timeDown.toFixed(0),"duration:",e.duration.toFixed(0)),this.stop()},inputInfo:function(e,t,n){this.start(e,t,n),this.line("Input"),this.line("X: "+this.game.input.x+" Y: "+this.game.input.y),this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY),this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1)),this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+this.game.input.activePointer.screenY),this.stop()},spriteBounds:function(e,t,n){var r=e.getBounds();r.x+=this.game.camera.x,r.y+=this.game.camera.y,this.rectangle(r,t,n)},ropeSegments:function(e,t,n){var r=e.segments;r.forEach(function(e){this.rectangle(e,t,n)},this)},spriteInfo:function(e,t,n,r){this.start(t,n,r),this.line("Sprite:  ("+e.width+" x "+e.height+") anchor: "+e.anchor.x+" x "+e.anchor.y),this.line("x: "+e.x.toFixed(1)+" y: "+e.y.toFixed(1)),this.line("angle: "+e.angle.toFixed(1)+" rotation: "+e.rotation.toFixed(1)),this.line("visible: "+e.visible+" in camera: "+e.inCamera),this.line("bounds x: "+e._bounds.x.toFixed(1)+" y: "+e._bounds.y.toFixed(1)+" w: "+e._bounds.width.toFixed(1)+" h: "+e._bounds.height.toFixed(1)),this.stop()},spriteCoords:function(e,t,n,r){this.start(t,n,r,100),e.name&&this.line(e.name),this.line("x:",e.x.toFixed(2),"y:",e.y.toFixed(2)),this.line("pos x:",e.position.x.toFixed(2),"pos y:",e.position.y.toFixed(2)),this.line("world x:",e.world.x.toFixed(2),"world y:",e.world.y.toFixed(2)),this.stop()},lineInfo:function(e,t,n,r){this.start(t,n,r,80),this.line("start.x:",e.start.x.toFixed(2),"start.y:",e.start.y.toFixed(2)),this.line("end.x:",e.end.x.toFixed(2),"end.y:",e.end.y.toFixed(2)),this.line("length:",e.length.toFixed(2),"angle:",e.angle),this.stop()},pixel:function(e,t,n,r){r=r||2,this.start(),this.context.fillStyle=n,this.context.fillRect(e,t,r,r),this.stop()},geom:function(e,t,r,i){"undefined"==typeof r&&(r=!0),"undefined"==typeof i&&(i=0),t=t||"rgba(0,255,0,0.4)",this.start(),this.context.fillStyle=t,this.context.strokeStyle=t,e instanceof n.Rectangle||1===i?r?this.context.fillRect(e.x-this.game.camera.x,e.y-this.game.camera.y,e.width,e.height):this.context.strokeRect(e.x-this.game.camera.x,e.y-this.game.camera.y,e.width,e.height):e instanceof n.Circle||2===i?(this.context.beginPath(),this.context.arc(e.x-this.game.camera.x,e.y-this.game.camera.y,e.radius,0,2*Math.PI,!1),this.context.closePath(),r?this.context.fill():this.context.stroke()):e instanceof n.Point||3===i?this.context.fillRect(e.x-this.game.camera.x,e.y-this.game.camera.y,4,4):(e instanceof n.Line||4===i)&&(this.context.lineWidth=1,this.context.beginPath(),this.context.moveTo(e.start.x+.5-this.game.camera.x,e.start.y+.5-this.game.camera.y),this.context.lineTo(e.end.x+.5-this.game.camera.x,e.end.y+.5-this.game.camera.y),this.context.closePath(),this.context.stroke()),this.stop()},rectangle:function(e,t,n){"undefined"==typeof n&&(n=!0),t=t||"rgba(0, 255, 0, 0.4)",this.start(),n?(this.context.fillStyle=t,this.context.fillRect(e.x-this.game.camera.x,e.y-this.game.camera.y,e.width,e.height)):(this.context.strokeStyle=t,this.context.strokeRect(e.x-this.game.camera.x,e.y-this.game.camera.y,e.width,e.height)),this.stop()},text:function(e,t,n,r,i){r=r||"rgb(255,255,255)",i=i||"16px Courier",this.start(),this.context.font=i,this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(e,t+1,n+1)),this.context.fillStyle=r,this.context.fillText(e,t,n),this.stop()},quadTree:function(e,t){t=t||"rgba(255,0,0,0.3)",this.start();var n=e.bounds;if(0===e.nodes.length){this.context.strokeStyle=t,this.context.strokeRect(n.x,n.y,n.width,n.height),this.text("size: "+e.objects.length,n.x+4,n.y+16,"rgb(0,200,0)","12px Courier"),this.context.strokeStyle="rgb(0,255,0)";for(var r=0;r<e.objects.length;r++)this.context.strokeRect(e.objects[r].x,e.objects[r].y,e.objects[r].width,e.objects[r].height)}else for(var r=0;r<e.nodes.length;r++)this.quadTree(e.nodes[r]);this.stop()},body:function(e,t,r){e.body&&(this.start(),e.body.type===n.Physics.ARCADE?n.Physics.Arcade.Body.render(this.context,e.body,t,r):e.body.type===n.Physics.NINJA?n.Physics.Ninja.Body.render(this.context,e.body,t,r):e.body.type===n.Physics.BOX2D&&n.Physics.Box2D.renderBody(this.context,e.body,t),this.stop())},bodyInfo:function(e,t,r,i){e.body&&(this.start(t,r,i,210),e.body.type===n.Physics.ARCADE?n.Physics.Arcade.Body.renderBodyInfo(this,e.body):e.body.type===n.Physics.BOX2D&&this.game.physics.box2d.renderBodyInfo(this,e.body),this.stop())},box2dWorld:function(){this.start(),this.context.translate(-this.game.camera.view.x,-this.game.camera.view.y,0),this.game.physics.box2d.renderDebugDraw(this.context),this.stop()},box2dBody:function(e,t){this.start(),n.Physics.Box2D.renderBody(this.context,e,t),this.stop()}},n.Utils.Debug.prototype.constructor=n.Utils.Debug,n.ArraySet=function(e){this.position=0,this.list=e||[]},n.ArraySet.prototype={add:function(e){return this.exists(e)||this.list.push(e),e},getIndex:function(e){return this.list.indexOf(e)},getByKey:function(e,t){for(var n=this.list.length;n--;)if(this.list[n][e]===t)return this.list[n];return null},exists:function(e){return this.list.indexOf(e)>-1},reset:function(){this.list.length=0},remove:function(e){var t=this.list.indexOf(e);return t>-1?(this.list.splice(t,1),e):void 0},setAll:function(e,t){for(var n=this.list.length;n--;)this.list[n]&&(this.list[n][e]=t)},callAll:function(e){for(var t=Array.prototype.splice.call(arguments,1),n=this.list.length;n--;)this.list[n]&&this.list[n][e]&&this.list[n][e].apply(this.list[n],t)},removeAll:function(e){"undefined"==typeof e&&(e=!1);for(var t=this.list.length;t--;)if(this.list[t]){var n=this.remove(this.list[t]);e&&n.destroy()}this.position=0,this.list=[]}},Object.defineProperty(n.ArraySet.prototype,"total",{get:function(){return this.list.length}}),Object.defineProperty(n.ArraySet.prototype,"first",{get:function(){return this.position=0,this.list.length>0?this.list[0]:null}}),Object.defineProperty(n.ArraySet.prototype,"next",{get:function(){return this.position<this.list.length?(this.position++,this.list[this.position]):null}}),n.ArraySet.prototype.constructor=n.ArraySet,n.ArrayList=n.ArraySet,n.ArrayUtils={getRandomItem:function(e,t,n){if(null==e)return null;"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=e.length);var r=t+Math.floor(Math.random()*n);return void 0===e[r]?null:e[r]},removeRandomItem:function(e,t,n){if(null==e)return null;"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=e.length);var r=t+Math.floor(Math.random()*n);if(r<e.length){var i=e.splice(r,1);return void 0===i[0]?null:i[0]}return null},shuffle:function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[n],e[n]=r}return e},transposeMatrix:function(e){for(var t=e.length,n=e[0].length,r=new Array(n),i=0;n>i;i++){r[i]=new Array(t);for(var s=t-1;s>-1;s--)r[i][s]=e[s][i]}return r},rotateMatrix:function(e,t){if("string"!=typeof t&&(t=(t%360+360)%360),90===t||-270===t||"rotateLeft"===t)e=n.ArrayUtils.transposeMatrix(e),e=e.reverse();else if(-90===t||270===t||"rotateRight"===t)e=e.reverse(),e=n.ArrayUtils.transposeMatrix(e);else if(180===Math.abs(t)||"rotate180"===t){for(var r=0;r<e.length;r++)e[r].reverse();e=e.reverse()}return e},findClosest:function(e,t){if(!t.length)return 0/0;if(1===t.length||e<t[0])return t[0];for(var n=1;t[n]<e;)n++;var r=t[n-1],i=n<t.length?t[n]:Number.POSITIVE_INFINITY;return e-r>=i-e?i:r},rotate:function(e){var t=e.shift();return e.push(t),t},numberArray:function(e,t){for(var n=[],r=e;t>=r;r++)n.push(r);return n},numberArrayStep:function(e,t,r){e=+e||0;var i=typeof t;"number"!==i&&"string"!==i||!r||r[t]!==e||(t=r=null),r=null==r?1:+r||0,null===t?(t=e,e=0):t=+t||0;for(var s=-1,o=Math.max(n.Math.roundAwayFromZero((t-e)/(r||1)),0),u=new Array(o);++s<o;)u[s]=e,e+=r;return u}},n.Color={packPixel:function(e,t,r,i){return n.Device.LITTLE_ENDIAN?(i<<24|r<<16|t<<8|e)>>>0:(e<<24|t<<16|r<<8|i)>>>0},unpackPixel:function(e,t,r,i){return("undefined"==typeof t||null===t)&&(t=n.Color.createColor()),("undefined"==typeof r||null===r)&&(r=!1),("undefined"==typeof i||null===i)&&(i=!1),n.Device.LITTLE_ENDIAN?(t.a=(4278190080&e)>>>24,t.b=(16711680&e)>>>16,t.g=(65280&e)>>>8,t.r=255&e):(t.r=(4278190080&e)>>>24,t.g=(16711680&e)>>>16,t.b=(65280&e)>>>8,t.a=255&e),t.color=e,t.rgba="rgba("+t.r+","+t.g+","+t.b+","+t.a/255+")",r&&n.Color.RGBtoHSL(t.r,t.g,t.b,t),i&&n.Color.RGBtoHSV(t.r,t.g,t.b,t),t},fromRGBA:function(e,t){return t||(t=n.Color.createColor()),t.r=(4278190080&e)>>>24,t.g=(16711680&e)>>>16,t.b=(65280&e)>>>8,t.a=255&e,t.rgba="rgba("+t.r+","+t.g+","+t.b+","+t.a+")",t},toRGBA:function(e,t,n,r){return e<<24|t<<16|n<<8|r},RGBtoHSL:function(e,t,r,i){i||(i=n.Color.createColor(e,t,r,1)),e/=255,t/=255,r/=255;var s=Math.min(e,t,r),o=Math.max(e,t,r);if(i.h=0,i.s=0,i.l=(o+s)/2,o!==s){var u=o-s;i.s=i.l>.5?u/(2-o-s):u/(o+s),o===e?i.h=(t-r)/u+(r>t?6:0):o===t?i.h=(r-e)/u+2:o===r&&(i.h=(e-t)/u+4),i.h/=6}return i},HSLtoRGB:function(e,t,r,i){if(i?(i.r=r,i.g=r,i.b=r):i=n.Color.createColor(r,r,r),0!==t){var s=.5>r?r*(1+t):r+t-r*t,o=2*r-s;i.r=n.Color.hueToColor(o,s,e+1/3),i.g=n.Color.hueToColor(o,s,e),i.b=n.Color.hueToColor(o,s,e-1/3)}return i.r=Math.floor(255*i.r|0),i.g=Math.floor(255*i.g|0),i.b=Math.floor(255*i.b|0),n.Color.updateColor(i),i},RGBtoHSV:function(e,t,r,i){i||(i=n.Color.createColor(e,t,r,255)),e/=255,t/=255,r/=255;var s=Math.min(e,t,r),o=Math.max(e,t,r),u=o-s;return i.h=0,i.s=0===o?0:u/o,i.v=o,o!==s&&(o===e?i.h=(t-r)/u+(r>t?6:0):o===t?i.h=(r-e)/u+2:o===r&&(i.h=(e-t)/u+4),i.h/=6),i},HSVtoRGB:function(e,t,r,i){"undefined"==typeof i&&(i=n.Color.createColor(0,0,0,1,e,t,0,r));var s,o,u,a=Math.floor(6*e),f=6*e-a,l=r*(1-t),c=r*(1-f*t),h=r*(1-(1-f)*t);switch(a%6){case 0:s=r,o=h,u=l;break;case 1:s=c,o=r,u=l;break;case 2:s=l,o=r,u=h;break;case 3:s=l,o=c,u=r;break;case 4:s=h,o=l,u=r;break;case 5:s=r,o=l,u=c}return i.r=Math.floor(255*s),i.g=Math.floor(255*o),i.b=Math.floor(255*u),n.Color.updateColor(i),i},hueToColor:function(e,t,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?e+6*(t-e)*n:.5>n?t:2/3>n?e+(t-e)*(2/3-n)*6:e},createColor:function(e,t,r,i,s,o,u,a){var f={r:e||0,g:t||0,b:r||0,a:i||1,h:s||0,s:o||0,l:u||0,v:a||0,color:0,color32:0,rgba:""};return f.color=n.Color.getColor(f.r,f.g,f.b),f.color32=n.Color.getColor32(f.a,f.r,f.g,f.b),n.Color.updateColor(f)},updateColor:function(e){return e.rgba="rgba("+e.r.toString()+","+e.g.toString()+","+e.b.toString()+","+e.a.toString()+")",e},getColor32:function(e,t,n,r){return e<<24|t<<16|n<<8|r},getColor:function(e,t,n){return e<<16|t<<8|n},RGBtoString:function(e,t,r,i,s){return"undefined"==typeof i&&(i=255),"undefined"==typeof s&&(s="#"),"#"===s?"#"+((1<<24)+(e<<16)+(t<<8)+r).toString(16).slice(1):"0x"+n.Color.componentToHex(i)+n.Color.componentToHex(e)+n.Color.componentToHex(t)+n.Color.componentToHex(r)},hexToRGB:function(e){var t=n.Color.hexToColor(e);return t?n.Color.getColor32(t.a,t.r,t.g,t.b):void 0},hexToColor:function(e,t){e=e.replace(/^(?:#|0x)?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,n,r){return t+t+n+n+r+r});var r=/^(?:#|0x)?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(r){var i=parseInt(r[1],16),s=parseInt(r[2],16),o=parseInt(r[3],16);t?(t.r=i,t.g=s,t.b=o):t=n.Color.createColor(i,s,o)}return t},webToColor:function(e,t){t||(t=n.Color.createColor());var r=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(e);return r&&(t.r=parseInt(r[1],10),t.g=parseInt(r[2],10),t.b=parseInt(r[3],10),t.a=void 0!==r[4]?parseFloat(r[4]):1),t},valueToColor:function(e,t){if(t||(t=n.Color.createColor()),"string"==typeof e)return 0===e.indexOf("rgb")?n.Color.webToColor(e,t):(t.a=1,n.Color.hexToColor(e,t));if("number"==typeof e){var r=n.Color.getRGB(e);return t.r=r.r,t.g=r.g,t.b=r.b,t.a=r.a/255,t}return t},componentToHex:function(e){var t=e.toString(16);return 1==t.length?"0"+t:t},HSVColorWheel:function(e,t){"undefined"==typeof e&&(e=1),"undefined"==typeof t&&(t=1);for(var r=[],i=0;359>=i;i++)r.push(n.Color.HSVtoRGB(i/359,e,t));return r},HSLColorWheel:function(e,t){"undefined"==typeof e&&(e=.5),"undefined"==typeof t&&(t=.5);for(var r=[],i=0;359>=i;i++)r.push(n.Color.HSLtoRGB(i/359,e,t));return r},interpolateColor:function(e,t,r,i,s){"undefined"==typeof s&&(s=255);var o=n.Color.getRGB(e),u=n.Color.getRGB(t),a=(u.red-o.red)*i/r+o.red,f=(u.green-o.green)*i/r+o.green,l=(u.blue-o.blue)*i/r+o.blue;return n.Color.getColor32(s,a,f,l)},interpolateColorWithRGB:function(e,t,r,i,s,o){var u=n.Color.getRGB(e),a=(t-u.red)*o/s+u.red,f=(r-u.green)*o/s+u.green,l=(i-u.blue)*o/s+u.blue;return n.Color.getColor(a,f,l)},interpolateRGB:function(e,t,r,i,s,o,u,a){var f=(i-e)*a/u+e,l=(s-t)*a/u+t,c=(o-r)*a/u+r;return n.Color.getColor(f,l,c)},getRandomColor:function(e,t,r){if("undefined"==typeof e&&(e=0),"undefined"==typeof t&&(t=255),"undefined"==typeof r&&(r=255),t>255||e>t)return n.Color.getColor(255,255,255);var i=e+Math.round(Math.random()*(t-e)),s=e+Math.round(Math.random()*(t-e)),o=e+Math.round(Math.random()*(t-e));return n.Color.getColor32(r,i,s,o)},getRGB:function(e){return e>16777215?{alpha:e>>>24,red:e>>16&255,green:e>>8&255,blue:255&e,a:e>>>24,r:e>>16&255,g:e>>8&255,b:255&e}:{alpha:255,red:e>>16&255,green:e>>8&255,blue:255&e,a:255,r:e>>16&255,g:e>>8&255,b:255&e}},getWebRGB:function(e){if("object"==typeof e)return"rgba("+e.r.toString()+","+e.g.toString()+","+e.b.toString()+","+(e.a/255).toString()+")";var t=n.Color.getRGB(e);return"rgba("+t.r.toString()+","+t.g.toString()+","+t.b.toString()+","+(t.a/255).toString()+")"},getAlpha:function(e){return e>>>24},getAlphaFloat:function(e){return(e>>>24)/255},getRed:function(e){return e>>16&255},getGreen:function(e){return e>>8&255},getBlue:function(e){return 255&e}},n.LinkedList=function(){this.next=null,this.prev=null,this.first=null,this.last=null,this.total=0},n.LinkedList.prototype={add:function(e){return 0===this.total&&null===this.first&&null===this.last?(this.first=e,this.last=e,this.next=e,e.prev=this,this.total++,e):(this.last.next=e,e.prev=this.last,this.last=e,this.total++,e)},reset:function(){this.first=null,this.last=null,this.next=null,this.prev=null,this.total=0},remove:function(e){return 1===this.total?(this.reset(),void (e.next=e.prev=null)):(e===this.first?this.first=this.first.next:e===this.last&&(this.last=this.last.prev),e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e.next=e.prev=null,null===this.first&&(this.last=null),void (this.total--))},callAll:function(e){if(this.first&&this.last){var t=this.first;do t&&t[e]&&t[e].call(t),t=t.next;while(t!=this.last.next)}}},n.LinkedList.prototype.constructor=n.LinkedList,n.Physics=function(e,t){t=t||{},this.game=e,this.config=t,this.arcade=null,this.p2=null,this.ninja=null,this.box2d=null,this.chipmunk=null,this.parseConfig()},n.Physics.ARCADE=0,n.Physics.P2JS=1,n.Physics.NINJA=2,n.Physics.BOX2D=3,n.Physics.CHIPMUNK=4,n.Physics.prototype={parseConfig:function(){this.config.hasOwnProperty("arcade")&&this.config.arcade!==!0||!n.Physics.hasOwnProperty("Arcade")||(this.arcade=new n.Physics.Arcade(this.game),this.game.time.deltaCap=.2),this.config.hasOwnProperty("ninja")&&this.config.ninja===!0&&n.Physics.hasOwnProperty("Ninja")&&(this.ninja=new n.Physics.Ninja(this.game)),this.config.hasOwnProperty("p2")&&this.config.p2===!0&&n.Physics.hasOwnProperty("P2")&&(this.p2=new n.Physics.P2(this.game,this.config)),this.config.hasOwnProperty("box2d")&&this.config.box2d===!0&&n.Physics.hasOwnProperty("BOX2D")&&(this.box2d=new n.Physics.BOX2D(this.game,this.config))},startSystem:function(e){e===n.Physics.ARCADE?this.arcade=new n.Physics.Arcade(this.game):e===n.Physics.P2JS?null===this.p2?this.p2=new n.Physics.P2(this.game,this.config):this.p2.reset():e===n.Physics.NINJA?this.ninja=new n.Physics.Ninja(this.game):e===n.Physics.BOX2D&&(null===this.box2d?this.box2d=new n.Physics.Box2D(this.game,this.config):this.box2d.reset())},enable:function(e,t,r){"undefined"==typeof t&&(t=n.Physics.ARCADE),"undefined"==typeof r&&(r=!1),t===n.Physics.ARCADE?this.arcade.enable(e):t===n.Physics.P2JS&&this.p2?this.p2.enable(e,r):t===n.Physics.NINJA&&this.ninja?this.ninja.enableAABB(e):t===n.Physics.BOX2D&&this.box2d&&this.box2d.enable(e)},preUpdate:function(){this.p2&&this.p2.preUpdate(),this.box2d&&this.box2d.preUpdate()},update:function(){this.p2&&this.p2.update(),this.box2d&&this.box2d.update()},setBoundsToWorld:function(){this.arcade&&this.arcade.setBoundsToWorld(),this.ninja&&this.ninja.setBoundsToWorld(),this.p2&&this.p2.setBoundsToWorld(),this.box2d&&this.box2d.setBoundsToWorld()},clear:function(){this.p2&&this.p2.clear(),this.box2d&&this.box2d.clear()},reset:function(){this.p2&&this.p2.reset(),this.box2d&&this.box2d.reset()},destroy:function(){this.p2&&this.p2.destroy(),this.box2d&&this.box2d.destroy(),this.arcade=null,this.ninja=null,this.p2=null,this.box2d=null}},n.Physics.prototype.constructor=n.Physics,n.Physics.Arcade=function(e){this.game=e,this.gravity=new n.Point,this.bounds=new n.Rectangle(0,0,e.world.width,e.world.height),this.checkCollision={up:!0,down:!0,left:!0,right:!0},this.maxObjects=10,this.maxLevels=4,this.OVERLAP_BIAS=4,this.forceX=!1,this.sortDirection=n.Physics.Arcade.LEFT_RIGHT,this.skipQuadTree=!0,this.isPaused=!1,this.quadTree=new n.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this._total=0,this.setBoundsToWorld()},n.Physics.Arcade.prototype.constructor=n.Physics.Arcade,n.Physics.Arcade.SORT_NONE=0,n.Physics.Arcade.LEFT_RIGHT=1,n.Physics.Arcade.RIGHT_LEFT=2,n.Physics.Arcade.TOP_BOTTOM=3,n.Physics.Arcade.BOTTOM_TOP=4,n.Physics.Arcade.prototype={setBounds:function(e,t,n,r){this.bounds.setTo(e,t,n,r)},setBoundsToWorld:function(){this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},enable:function(e,t){"undefined"==typeof t&&(t=!0);var r=1;if(Array.isArray(e))for(r=e.length;r--;)e[r]instanceof n.Group?this.enable(e[r].children,t):(this.enableBody(e[r]),t&&e[r].hasOwnProperty("children")&&e[r].children.length>0&&this.enable(e[r],!0));else e instanceof n.Group?this.enable(e.children,t):(this.enableBody(e),t&&e.hasOwnProperty("children")&&e.children.length>0&&this.enable(e.children,!0))},enableBody:function(e){e.hasOwnProperty("body")&&null===e.body&&(e.body=new n.Physics.Arcade.Body(e))},updateMotion:function(e){var t=this.computeVelocity(0,e,e.angularVelocity,e.angularAcceleration,e.angularDrag,e.maxAngular)-e.angularVelocity;e.angularVelocity+=t,e.rotation+=e.angularVelocity*this.game.time.physicsElapsed,e.velocity.x=this.computeVelocity(1,e,e.velocity.x,e.acceleration.x,e.drag.x,e.maxVelocity.x),e.velocity.y=this.computeVelocity(2,e,e.velocity.y,e.acceleration.y,e.drag.y,e.maxVelocity.y)},computeVelocity:function(e,t,n,r,i,s){return"undefined"==typeof s&&(s=1e4),1===e&&t.allowGravity?n+=(this.gravity.x+t.gravity.x)*this.game.time.physicsElapsed:2===e&&t.allowGravity&&(n+=(this.gravity.y+t.gravity.y)*this.game.time.physicsElapsed),r?n+=r*this.game.time.physicsElapsed:i&&(i*=this.game.time.physicsElapsed,n-i>0?n-=i:0>n+i?n+=i:n=0),n>s?n=s:-s>n&&(n=-s),n},overlap:function(e,t,n,r,i){if(n=n||null,r=r||null,i=i||n,this._total=0,!Array.isArray(e)&&Array.isArray(t))for(var s=0;s<t.length;s++)this.collideHandler(e,t[s],n,r,i,!0);else if(Array.isArray(e)&&!Array.isArray(t))for(var s=0;s<e.length;s++)this.collideHandler(e[s],t,n,r,i,!0);else if(Array.isArray(e)&&Array.isArray(t))for(var s=0;s<e.length;s++)for(var o=0;o<t.length;o++)this.collideHandler(e[s],t[o],n,r,i,!0);else this.collideHandler(e,t,n,r,i,!0);return this._total>0},collide:function(e,t,n,r,i){if(n=n||null,r=r||null,i=i||n,this._total=0,!Array.isArray(e)&&Array.isArray(t))for(var s=0;s<t.length;s++)this.collideHandler(e,t[s],n,r,i,!1);else if(Array.isArray(e)&&!Array.isArray(t))for(var s=0;s<e.length;s++)this.collideHandler(e[s],t,n,r,i,!1);else if(Array.isArray(e)&&Array.isArray(t))for(var s=0;s<e.length;s++)for(var o=0;o<t.length;o++)this.collideHandler(e[s],t[o],n,r,i,!1);else this.collideHandler(e,t,n,r,i,!1);return this._total>0},sort:function(e){this.sortDirection===n.Physics.Arcade.LEFT_RIGHT?e._hash.sort(function(e,t){return e.body&&t.body?e.body.x-t.body.x:-1}):this.sortDirection===n.Physics.Arcade.RIGHT_LEFT?e._hash.sort(function(e,t){return e.body&&t.body?t.body.x-e.body.x:-1}):this.sortDirection===n.Physics.Arcade.TOP_BOTTOM?e._hash.sort(function(e,t){return e.body&&t.body?e.body.y-t.body.y:-1}):this.sortDirection===n.Physics.Arcade.BOTTOM_TOP&&e._hash.sort(function(e,t){return e.body&&t.body?t.body.y-e.body.y:-1})},collideHandler:function(e,t,r,i,s,o){return"undefined"==typeof t&&e.physicsType===n.GROUP?(this.sort(e),void this.collideGroupVsSelf(e,r,i,s,o)):void (e&&t&&e.exists&&t.exists&&(this.sortDirection!==n.Physics.Arcade.SORT_NONE&&(e.physicsType===n.GROUP&&this.sort(e),t.physicsType===n.GROUP&&this.sort(t)),e.physicsType===n.SPRITE?t.physicsType===n.SPRITE?this.collideSpriteVsSprite(e,t,r,i,s,o):t.physicsType===n.GROUP?this.collideSpriteVsGroup(e,t,r,i,s,o):t.physicsType===n.TILEMAPLAYER&&this.collideSpriteVsTilemapLayer(e,t,r,i,s):e.physicsType===n.GROUP?t.physicsType===n.SPRITE?this.collideSpriteVsGroup(t,e,r,i,s,o):t.physicsType===n.GROUP?this.collideGroupVsGroup(e,t,r,i,s,o):t.physicsType===n.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(e,t,r,i,s,o):e.physicsType===n.TILEMAPLAYER&&(t.physicsType===n.SPRITE?this.collideSpriteVsTilemapLayer(t,e,r,i,s,o):t.physicsType===n.GROUP&&this.collideGroupVsTilemapLayer(t,e,r,i,s,o))))},collideSpriteVsSprite:function(e,t,n,r,i,s){return e.body&&t.body?(this.separate(e.body,t.body,r,i,s)&&(n&&n.call(i,e,t),this._total++),!0):!1},collideSpriteVsGroup:function(e,t,r,i,s,o){if(0!==t.length&&e.body)if(this.skipQuadTree||e.body.skipQuadTree){for(var u=0;u<t._hash.length;u++)if(t._hash[u]&&t._hash[u].exists&&t._hash[u].body){if(this.sortDirection===n.Physics.Arcade.LEFT_RIGHT){if(e.body.right<t._hash[u].body.x)break;if(t._hash[u].body.right<e.body.x)continue}else if(this.sortDirection===n.Physics.Arcade.RIGHT_LEFT){if(e.body.x>t._hash[u].body.right)break;if(t._hash[u].body.x>e.body.right)continue}else if(this.sortDirection===n.Physics.Arcade.TOP_BOTTOM){if(e.body.bottom<t._hash[u].body.y)break;if(t._hash[u].body.bottom<e.body.y)continue}else if(this.sortDirection===n.Physics.Arcade.BOTTOM_TOP){if(e.body.y>t._hash[u].body.bottom)break;if(t._hash[u].body.y>e.body.bottom)continue}this.collideSpriteVsSprite(e,t._hash[u],r,i,s,o)}}else{this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(t);for(var a=this.quadTree.retrieve(e),u=0;u<a.length;u++)this.separate(e.body,a[u],i,s,o)&&(r&&r.call(s,e,a[u].sprite),this._total++)}},collideGroupVsSelf:function(e,t,r,i,s){if(0!==e.length)for(var o=0;o<e._hash.length;o++)if(e._hash[o]&&e._hash[o].exists&&e._hash[o].body)for(var u=e._hash[o],a=o+1;a<e._hash.length;a++)if(e._hash[a]&&e._hash[a].exists&&e._hash[a].body){var f=e._hash[a];if(this.sortDirection===n.Physics.Arcade.LEFT_RIGHT){if(u.body.right<f.body.x)break;if(f.body.right<u.body.x)continue}else if(this.sortDirection===n.Physics.Arcade.RIGHT_LEFT){if(u.body.x>f.body.right)continue;if(f.body.x>u.body.right)break}else if(this.sortDirection===n.Physics.Arcade.TOP_BOTTOM){if(u.body.bottom<f.body.y)continue;if(f.body.bottom<u.body.y)break}else if(this.sortDirection===n.Physics.Arcade.BOTTOM_TOP){if(u.body.y>f.body.bottom)continue;if(f.body.y>u.body.bottom)break}this.collideSpriteVsSprite(u,f,t,r,i,s)}},collideGroupVsGroup:function(e,t,r,i,s,o){if(0!==e.length&&0!==t.length)for(var u=0;u<e.children.length;u++)e.children[u].exists&&(e.children[u].physicsType===n.GROUP?this.collideGroupVsGroup(e.children[u],t,r,i,s,o):this.collideSpriteVsGroup(e.children[u],t,r,i,s,o))},separate:function(e,t,n,r,i){if(!e.enable||!t.enable||!this.intersects(e,t))return!1;if(n&&n.call(r,e.sprite,t.sprite)===!1)return!1;var s=!1;return s=this.forceX||Math.abs(this.gravity.y+e.gravity.y)<Math.abs(this.gravity.x+e.gravity.x)?this.separateX(e,t,i)||this.separateY(e,t,i):this.separateY(e,t,i)||this.separateX(e,t,i),i?!0:s},intersects:function(e,t){return e.right<=t.position.x?!1:e.bottom<=t.position.y?!1:e.position.x>=t.right?!1:e.position.y>=t.bottom?!1:!0},separateX:function(e,t,n){if(e.immovable&&t.immovable)return!1;var r=0;if(this.intersects(e,t)){var i=e.deltaAbsX()+t.deltaAbsX()+this.OVERLAP_BIAS;if(0===e.deltaX()&&0===t.deltaX()?(e.embedded=!0,t.embedded=!0):e.deltaX()>t.deltaX()?(r=e.right-t.x,r>i||e.checkCollision.right===!1||t.checkCollision.left===!1?r=0:(e.touching.none=!1,e.touching.right=!0,t.touching.none=!1,t.touching.left=!0)):e.deltaX()<t.deltaX()&&(r=e.x-t.width-t.x,-r>i||e.checkCollision.left===!1||t.checkCollision.right===!1?r=0:(e.touching.none=!1,e.touching.left=!0,t.touching.none=!1,t.touching.right=!0)),e.overlapX=r,t.overlapX=r,0!==r){if(n||e.customSeparateX||t.customSeparateX)return!0;var s=e.velocity.x,o=t.velocity.x;if(e.immovable||t.immovable)e.immovable?t.immovable||(t.x+=r,t.velocity.x=s-o*t.bounce.x,e.moves&&(t.y+=(e.y-e.prev.y)*e.friction.y)):(e.x=e.x-r,e.velocity.x=o-s*e.bounce.x,t.moves&&(e.y+=(t.y-t.prev.y)*t.friction.y));else{r*=.5,e.x=e.x-r,t.x+=r;var u=Math.sqrt(o*o*t.mass/e.mass)*(o>0?1:-1),a=Math.sqrt(s*s*e.mass/t.mass)*(s>0?1:-1),f=.5*(u+a);u-=f,a-=f,e.velocity.x=f+u*e.bounce.x,t.velocity.x=f+a*t.bounce.x}return!0}}return!1},separateY:function(e,t,n){if(e.immovable&&t.immovable)return!1;var r=0;if(this.intersects(e,t)){var i=e.deltaAbsY()+t.deltaAbsY()+this.OVERLAP_BIAS;if(0===e.deltaY()&&0===t.deltaY()?(e.embedded=!0,t.embedded=!0):e.deltaY()>t.deltaY()?(r=e.bottom-t.y,r>i||e.checkCollision.down===!1||t.checkCollision.up===!1?r=0:(e.touching.none=!1,e.touching.down=!0,t.touching.none=!1,t.touching.up=!0)):e.deltaY()<t.deltaY()&&(r=e.y-t.bottom,-r>i||e.checkCollision.up===!1||t.checkCollision.down===!1?r=0:(e.touching.none=!1,e.touching.up=!0,t.touching.none=!1,t.touching.down=!0)),e.overlapY=r,t.overlapY=r,0!==r){if(n||e.customSeparateY||t.customSeparateY)return!0;var s=e.velocity.y,o=t.velocity.y;if(e.immovable||t.immovable)e.immovable?t.immovable||(t.y+=r,t.velocity.y=s-o*t.bounce.y,e.moves&&(t.x+=(e.x-e.prev.x)*e.friction.x)):(e.y=e.y-r,e.velocity.y=o-s*e.bounce.y,t.moves&&(e.x+=(t.x-t.prev.x)*t.friction.x));else{r*=.5,e.y=e.y-r,t.y+=r;var u=Math.sqrt(o*o*t.mass/e.mass)*(o>0?1:-1),a=Math.sqrt(s*s*e.mass/t.mass)*(s>0?1:-1),f=.5*(u+a);u-=f,a-=f,e.velocity.y=f+u*e.bounce.y,t.velocity.y=f+a*t.bounce.y}return!0}}return!1},getObjectsUnderPointer:function(e,t,n,r){return 0!==t.length&&e.exists?this.getObjectsAtLocation(e.x,e.y,t,n,r,e):void 0},getObjectsAtLocation:function(e,t,r,i,s,o){this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(r);for(var u=new n.Rectangle(e,t,1,1),a=[],f=this.quadTree.retrieve(u),l=0;l<f.length;l++)f[l].hitTest(e,t)&&(i&&i.call(s,o,f[l].sprite),a.push(f[l].sprite));return a},moveToObject:function(e,t,n,r){"undefined"==typeof n&&(n=60),"undefined"==typeof r&&(r=0);var i=Math.atan2(t.y-e.y,t.x-e.x);return r>0&&(n=this.distanceBetween(e,t)/(r/1e3)),e.body.velocity.x=Math.cos(i)*n,e.body.velocity.y=Math.sin(i)*n,i},moveToPointer:function(e,t,n,r){"undefined"==typeof t&&(t=60),n=n||this.game.input.activePointer,"undefined"==typeof r&&(r=0);var i=this.angleToPointer(e,n);return r>0&&(t=this.distanceToPointer(e,n)/(r/1e3)),e.body.velocity.x=Math.cos(i)*t,e.body.velocity.y=Math.sin(i)*t,i},moveToXY:function(e,t,n,r,i){"undefined"==typeof r&&(r=60),"undefined"==typeof i&&(i=0);var s=Math.atan2(n-e.y,t-e.x);return i>0&&(r=this.distanceToXY(e,t,n)/(i/1e3)),e.body.velocity.x=Math.cos(s)*r,e.body.velocity.y=Math.sin(s)*r,s},velocityFromAngle:function(e,t,r){return"undefined"==typeof t&&(t=60),r=r||new n.Point,r.setTo(Math.cos(this.game.math.degToRad(e))*t,Math.sin(this.game.math.degToRad(e))*t)},velocityFromRotation:function(e,t,r){return"undefined"==typeof t&&(t=60),r=r||new n.Point,r.setTo(Math.cos(e)*t,Math.sin(e)*t)},accelerationFromRotation:function(e,t,r){return"undefined"==typeof t&&(t=60),r=r||new n.Point,r.setTo(Math.cos(e)*t,Math.sin(e)*t)},accelerateToObject:function(e,t,n,r,i){"undefined"==typeof n&&(n=60),"undefined"==typeof r&&(r=1e3),"undefined"==typeof i&&(i=1e3);var s=this.angleBetween(e,t);return e.body.acceleration.setTo(Math.cos(s)*n,Math.sin(s)*n),e.body.maxVelocity.setTo(r,i),s},accelerateToPointer:function(e,t,n,r,i){"undefined"==typeof n&&(n=60),"undefined"==typeof t&&(t=this.game.input.activePointer),"undefined"==typeof r&&(r=1e3),"undefined"==typeof i&&(i=1e3);var s=this.angleToPointer(e,t);return e.body.acceleration.setTo(Math.cos(s)*n,Math.sin(s)*n),e.body.maxVelocity.setTo(r,i),s},accelerateToXY:function(e,t,n,r,i,s){"undefined"==typeof r&&(r=60),"undefined"==typeof i&&(i=1e3),"undefined"==typeof s&&(s=1e3);var o=this.angleToXY(e,t,n);return e.body.acceleration.setTo(Math.cos(o)*r,Math.sin(o)*r),e.body.maxVelocity.setTo(i,s),o},distanceBetween:function(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)},distanceToXY:function(e,t,n){var r=e.x-t,i=e.y-n;return Math.sqrt(r*r+i*i)},distanceToPointer:function(e,t){t=t||this.game.input.activePointer;var n=e.x-t.worldX,r=e.y-t.worldY;return Math.sqrt(n*n+r*r)},angleBetween:function(e,t){var n=t.x-e.x,r=t.y-e.y;return Math.atan2(r,n)},angleToXY:function(e,t,n){var r=t-e.x,i=n-e.y;return Math.atan2(i,r)},angleToPointer:function(e,t){t=t||this.game.input.activePointer;var n=t.worldX-e.x,r=t.worldY-e.y;return Math.atan2(r,n)}},n.Physics.Arcade.Body=function(e){this.sprite=e,this.game=e.game,this.type=n.Physics.ARCADE,this.enable=!0,this.offset=new n.Point,this.position=new n.Point(e.x,e.y),this.prev=new n.Point(this.position.x,this.position.y),this.allowRotation=!0,this.rotation=e.rotation,this.preRotation=e.rotation,this.width=e.width,this.height=e.height,this.sourceWidth=e.width,this.sourceHeight=e.height,e.texture&&(this.sourceWidth=e.texture.frame.width,this.sourceHeight=e.texture.frame.height),this.halfWidth=Math.abs(e.width/2),this.halfHeight=Math.abs(e.height/2),this.center=new n.Point(e.x+this.halfWidth,e.y+this.halfHeight),this.velocity=new n.Point,this.newVelocity=new n.Point(0,0),this.deltaMax=new n.Point(0,0),this.acceleration=new n.Point,this.drag=new n.Point,this.allowGravity=!0,this.gravity=new n.Point(0,0),this.bounce=new n.Point,this.maxVelocity=new n.Point(1e4,1e4),this.friction=new n.Point(1,0),this.angularVelocity=0,this.angularAcceleration=0,this.angularDrag=0,this.maxAngular=1e3,this.mass=1,this.angle=0,this.speed=0,this.facing=n.NONE,this.immovable=!1,this.moves=!0,this.customSeparateX=!1,this.customSeparateY=!1,this.overlapX=0,this.overlapY=0,this.embedded=!1,this.collideWorldBounds=!1,this.checkCollision={none:!1,any:!0,up:!0,down:!0,left:!0,right:!0},this.touching={none:!0,up:!1,down:!1,left:!1,right:!1},this.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1},this.blocked={up:!1,down:!1,left:!1,right:!1},this.tilePadding=new n.Point,this.dirty=!1,this.skipQuadTree=!1,this._reset=!0,this._sx=e.scale.x,this._sy=e.scale.y,this._dx=0,this._dy=0},n.Physics.Arcade.Body.prototype={updateBounds:function(){var e=Math.abs(this.sprite.scale.x),t=Math.abs(this.sprite.scale.y);(e!==this._sx||t!==this._sy)&&(this.width=this.sourceWidth*e,this.height=this.sourceHeight*t,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this._sx=e,this._sy=t,this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this._reset=!0)},preUpdate:function(){this.enable&&!this.game.physics.arcade.isPaused&&(this.dirty=!0,this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=this.touching.down,this.wasTouching.left=this.touching.left,this.wasTouching.right=this.touching.right,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.left=!1,this.touching.right=!1,this.blocked.up=!1,this.blocked.down=!1,this.blocked.left=!1,this.blocked.right=!1,this.embedded=!1,this.updateBounds(),this.position.x=this.sprite.world.x-this.sprite.anchor.x*this.width+this.offset.x,this.position.y=this.sprite.world.y-this.sprite.anchor.y*this.height+this.offset.y,this.rotation=this.sprite.angle,this.preRotation=this.rotation,(this._reset||this.sprite.fresh)&&(this.prev.x=this.position.x,this.prev.y=this.position.y),this.moves&&(this.game.physics.arcade.updateMotion(this),this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed),this.position.x+=this.newVelocity.x,this.position.y+=this.newVelocity.y,(this.position.x!==this.prev.x||this.position.y!==this.prev.y)&&(this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y),this.angle=Math.atan2(this.velocity.y,this.velocity.x)),this.collideWorldBounds&&this.checkWorldBounds()),this._dx=this.deltaX(),this._dy=this.deltaY(),this._reset=!1)},postUpdate:function(){this.enable&&this.dirty&&(this.dirty=!1,this.deltaX()<0?this.facing=n.LEFT:this.deltaX()>0&&(this.facing=n.RIGHT),this.deltaY()<0?this.facing=n.UP:this.deltaY()>0&&(this.facing=n.DOWN),this.moves&&(this._dx=this.deltaX(),this._dy=this.deltaY(),0!==this.deltaMax.x&&0!==this._dx&&(this._dx<0&&this._dx<-this.deltaMax.x?this._dx=-this.deltaMax.x:this._dx>0&&this._dx>this.deltaMax.x&&(this._dx=this.deltaMax.x)),0!==this.deltaMax.y&&0!==this._dy&&(this._dy<0&&this._dy<-this.deltaMax.y?this._dy=-this.deltaMax.y:this._dy>0&&this._dy>this.deltaMax.y&&(this._dy=this.deltaMax.y)),this.sprite.position.x+=this._dx,this.sprite.position.y+=this._dy,this._reset=!0),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this.allowRotation&&(this.sprite.angle+=this.deltaZ()),this.prev.x=this.position.x,this.prev.y=this.position.y)},destroy:function(){this.sprite.body=null,this.sprite=null},checkWorldBounds:function(){this.position.x<this.game.physics.arcade.bounds.x&&this.game.physics.arcade.checkCollision.left?(this.position.x=this.game.physics.arcade.bounds.x,this.velocity.x*=-this.bounce.x,this.blocked.left=!0):this.right>this.game.physics.arcade.bounds.right&&this.game.physics.arcade.checkCollision.right&&(this.position.x=this.game.physics.arcade.bounds.right-this.width,this.velocity.x*=-this.bounce.x,this.blocked.right=!0),this.position.y<this.game.physics.arcade.bounds.y&&this.game.physics.arcade.checkCollision.up?(this.position.y=this.game.physics.arcade.bounds.y,this.velocity.y*=-this.bounce.y,this.blocked.up=!0):this.bottom>this.game.physics.arcade.bounds.bottom&&this.game.physics.arcade.checkCollision.down&&(this.position.y=this.game.physics.arcade.bounds.bottom-this.height,this.velocity.y*=-this.bounce.y,this.blocked.down=!0)},setSize:function(e,t,n,r){"undefined"==typeof n&&(n=this.offset.x),"undefined"==typeof r&&(r=this.offset.y),this.sourceWidth=e,this.sourceHeight=t,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.offset.setTo(n,r),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},reset:function(e,t){this.velocity.set(0),this.acceleration.set(0),this.speed=0,this.angularVelocity=0,this.angularAcceleration=0,this.position.x=e-this.sprite.anchor.x*this.width+this.offset.x,this.position.y=t-this.sprite.anchor.y*this.height+this.offset.y,this.prev.x=this.position.x,this.prev.y=this.position.y,this.rotation=this.sprite.angle,this.preRotation=this.rotation,this._sx=this.sprite.scale.x,this._sy=this.sprite.scale.y,this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},hitTest:function(e,t){return n.Rectangle.contains(this,e,t)},onFloor:function(){return this.blocked.down},onWall:function(){return this.blocked.left||this.blocked.right},deltaAbsX:function(){return this.deltaX()>0?this.deltaX():-this.deltaX()},deltaAbsY:function(){return this.deltaY()>0?this.deltaY():-this.deltaY()},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation}},Object.defineProperty(n.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.position.y+this.height}}),Object.defineProperty(n.Physics.Arcade.Body.prototype,"right",{get:function(){return this.position.x+this.width}}),Object.defineProperty(n.Physics.Arcade.Body.prototype,"x",{get:function(){return this.position.x},set:function(e){this.position.x=e}}),Object.defineProperty(n.Physics.Arcade.Body.prototype,"y",{get:function(){return this.position.y},set:function(e){this.position.y=e}}),n.Physics.Arcade.Body.render=function(e,t,n,r){"undefined"==typeof r&&(r=!0),n=n||"rgba(0,255,0,0.4)",r?(e.fillStyle=n,e.fillRect(t.position.x-t.game.camera.x,t.position.y-t.game.camera.y,t.width,t.height)):(e.strokeStyle=n,e.strokeRect(t.position.x-t.game.camera.x,t.position.y-t.game.camera.y,t.width,t.height))},n.Physics.Arcade.Body.renderBodyInfo=function(e,t){e.line("x: "+t.x.toFixed(2),"y: "+t.y.toFixed(2),"width: "+t.width,"height: "+t.height),e.line("velocity x: "+t.velocity.x.toFixed(2),"y: "+t.velocity.y.toFixed(2),"deltaX: "+t._dx.toFixed(2),"deltaY: "+t._dy.toFixed(2)),e.line("acceleration x: "+t.acceleration.x.toFixed(2),"y: "+t.acceleration.y.toFixed(2),"speed: "+t.speed.toFixed(2),"angle: "+t.angle.toFixed(2)),e.line("gravity x: "+t.gravity.x,"y: "+t.gravity.y,"bounce x: "+t.bounce.x.toFixed(2),"y: "+t.bounce.y.toFixed(2)),e.line("touching left: "+t.touching.left,"right: "+t.touching.right,"up: "+t.touching.up,"down: "+t.touching.down),e.line("blocked left: "+t.blocked.left,"right: "+t.blocked.right,"up: "+t.blocked.up,"down: "+t.blocked.down)},n.Physics.Arcade.Body.prototype.constructor=n.Physics.Arcade.Body,n.Physics.Arcade.TilemapCollision=function(){},n.Physics.Arcade.TilemapCollision.prototype={TILE_BIAS:16,collideSpriteVsTilemapLayer:function(e,t,n,r,i){if(e.body){var s=t.getTiles(e.body.position.x-e.body.tilePadding.x,e.body.position.y-e.body.tilePadding.y,e.body.width+e.body.tilePadding.x,e.body.height+e.body.tilePadding.y,!1,!1);if(0!==s.length)for(var o=0;o<s.length;o++)r?r.call(i,e,s[o])&&this.separateTile(o,e.body,s[o])&&(this._total++,n&&n.call(i,e,s[o])):this.separateTile(o,e.body,s[o])&&(this._total++,n&&n.call(i,e,s[o]))}},collideGroupVsTilemapLayer:function(e,t,n,r,i){if(0!==e.length)for(var s=0;s<e.children.length;s++)e.children[s].exists&&this.collideSpriteVsTilemapLayer(e.children[s],t,n,r,i)},separateTile:function(e,t,n){if(!t.enable||!n.intersects(t.position.x,t.position.y,t.right,t.bottom))return!1;if(n.collisionCallback&&!n.collisionCallback.call(n.collisionCallbackContext,t.sprite,n))return!1;if(n.layer.callbacks[n.index]&&!n.layer.callbacks[n.index].callback.call(n.layer.callbacks[n.index].callbackContext,t.sprite,n))return!1;if(!(n.faceLeft||n.faceRight||n.faceTop||n.faceBottom))return!1;var r=0,i=0,s=0,o=1;if(t.deltaAbsX()>t.deltaAbsY()?s=-1:t.deltaAbsX()<t.deltaAbsY()&&(o=-1),0!==t.deltaX()&&0!==t.deltaY()&&(n.faceLeft||n.faceRight)&&(n.faceTop||n.faceBottom)&&(s=Math.min(Math.abs(t.position.x-n.right),Math.abs(t.right-n.left)),o=Math.min(Math.abs(t.position.y-n.bottom),Math.abs(t.bottom-n.top))),o>s){if((n.faceLeft||n.faceRight)&&(r=this.tileCheckX(t,n),0!==r&&!n.intersects(t.position.x,t.position.y,t.right,t.bottom)))return!0;(n.faceTop||n.faceBottom)&&(i=this.tileCheckY(t,n))}else{if((n.faceTop||n.faceBottom)&&(i=this.tileCheckY(t,n),0!==i&&!n.intersects(t.position.x,t.position.y,t.right,t.bottom)))return!0;(n.faceLeft||n.faceRight)&&(r=this.tileCheckX(t,n))}return 0!==r||0!==i},tileCheckX:function(e,t){var n=0;return e.deltaX()<0&&!e.blocked.left&&t.collideRight&&e.checkCollision.left?t.faceRight&&e.x<t.right&&(n=e.x-t.right,n<-this.TILE_BIAS&&(n=0)):e.deltaX()>0&&!e.blocked.right&&t.collideLeft&&e.checkCollision.right&&t.faceLeft&&e.right>t.left&&(n=e.right-t.left,n>this.TILE_BIAS&&(n=0)),0!==n&&(e.customSeparateX?e.overlapX=n:this.processTileSeparationX(e,n)),n},tileCheckY:function(e,t){var n=0;return e.deltaY()<0&&!e.blocked.up&&t.collideDown&&e.checkCollision.up?t.faceBottom&&e.y<t.bottom&&(n=e.y-t.bottom,n<-this.TILE_BIAS&&(n=0)):e.deltaY()>0&&!e.blocked.down&&t.collideUp&&e.checkCollision.down&&t.faceTop&&e.bottom>t.top&&(n=e.bottom-t.top,n>this.TILE_BIAS&&(n=0)),0!==n&&(e.customSeparateY?e.overlapY=n:this.processTileSeparationY(e,n)),n},processTileSeparationX:function(e,t){0>t?e.blocked.left=!0:t>0&&(e.blocked.right=!0),e.position.x-=t,e.velocity.x=0===e.bounce.x?0:-e.velocity.x*e.bounce.x},processTileSeparationY:function(e,t){0>t?e.blocked.up=!0:t>0&&(e.blocked.down=!0),e.position.y-=t,e.velocity.y=0===e.bounce.y?0:-e.velocity.y*e.bounce.y}},n.Utils.mixinPrototype(n.Physics.Arcade.prototype,n.Physics.Arcade.TilemapCollision.prototype),n.Tile=function(e,t,n,r,i,s){this.layer=e,this.index=t,this.x=n,this.y=r,this.rotation=0,this.flipped=!1,this.worldX=n*i,this.worldY=r*s,this.width=i,this.height=s,this.centerX=Math.abs(i/2),this.centerY=Math.abs(s/2),this.alpha=1,this.properties={},this.scanned=!1,this.faceTop=!1,this.faceBottom=!1,this.faceLeft=!1,this.faceRight=!1,this.collideLeft=!1,this.collideRight=!1,this.collideUp=!1,this.collideDown=!1,this.collisionCallback=null,this.collisionCallbackContext=this},n.Tile.prototype={containsPoint:function(e,t){return!(e<this.worldX||t<this.worldY||e>this.right||t>this.bottom)},intersects:function(e,t,n,r){return n<=this.worldX?!1:r<=this.worldY?!1:e>=this.worldX+this.width?!1:t>=this.worldY+this.height?!1:!0},setCollisionCallback:function(e,t){this.collisionCallback=e,this.collisionCallbackContext=t},destroy:function(){this.collisionCallback=null,this.collisionCallbackContext=null,this.properties=null},setCollision:function(e,t,n,r){this.collideLeft=e,this.collideRight=t,this.collideUp=n,this.collideDown=r,this.faceLeft=e,this.faceRight=t,this.faceTop=n,this.faceBottom=r},resetCollision:function(){this.collideLeft=!1,this.collideRight=!1,this.collideUp=!1,this.collideDown=!1,this.faceTop=!1,this.faceBottom=!1,this.faceLeft=!1,this.faceRight=!1},isInteresting:function(e,t){return e&&t?this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback:e?this.collideLeft||this.collideRight||this.collideUp||this.collideDown:t?this.faceTop||this.faceBottom||this.faceLeft||this.faceRight:!1},copy:function(e){this.index=e.index,this.alpha=e.alpha,this.properties=e.properties,this.collideUp=e.collideUp,this.collideDown=e.collideDown,this.collideLeft=e.collideLeft,this.collideRight=e.collideRight,this.collisionCallback=e.collisionCallback,this.collisionCallbackContext=e.collisionCallbackContext}},n.Tile.prototype.constructor=n.Tile,Object.defineProperty(n.Tile.prototype,"collides",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown}}),Object.defineProperty(n.Tile.prototype,"canCollide",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback}}),Object.defineProperty(n.Tile.prototype,"left",{get:function(){return this.worldX}}),Object.defineProperty(n.Tile.prototype,"right",{get:function(){return this.worldX+this.width}}),Object.defineProperty(n.Tile.prototype,"top",{get:function(){return this.worldY}}),Object.defineProperty(n.Tile.prototype,"bottom",{get:function(){return this.worldY+this.height}}),n.Tilemap=function(e,t,r,i,s,o){this.game=e,this.key=t;var u=n.TilemapParser.parse(this.game,t,r,i,s,o);null!==u&&(this.width=u.width,this.height=u.height,this.tileWidth=u.tileWidth,this.tileHeight=u.tileHeight,this.orientation=u.orientation,this.format=u.format,this.version=u.version,this.properties=u.properties,this.widthInPixels=u.widthInPixels,this.heightInPixels=u.heightInPixels,this.layers=u.layers,this.tilesets=u.tilesets,this.tiles=u.tiles,this.objects=u.objects,this.collideIndexes=[],this.collision=u.collision,this.images=u.images,this.currentLayer=0,this.debugMap=[],this._results=[],this._tempA=0,this._tempB=0)},n.Tilemap.CSV=0,n.Tilemap.TILED_JSON=1,n.Tilemap.NORTH=0,n.Tilemap.EAST=1,n.Tilemap.SOUTH=2,n.Tilemap.WEST=3,n.Tilemap.prototype={create:function(e,t,n,r,i,s){return"undefined"==typeof s&&(s=this.game.world),this.width=t,this.height=n,this.setTileSize(r,i),this.layers.length=0,this.createBlankLayer(e,t,n,r,i,s)},setTileSize:function(e,t){this.tileWidth=e,this.tileHeight=t,this.widthInPixels=this.width*e,this.heightInPixels=this.height*t},addTilesetImage:function(e,t,r,i,s,o,u){if("undefined"==typeof r&&(r=this.tileWidth),"undefined"==typeof i&&(i=this.tileHeight),"undefined"==typeof s&&(s=0),"undefined"==typeof o&&(o=0),"undefined"==typeof u&&(u=0),0===r&&(r=32),0===i&&(i=32),"undefined"==typeof t){if("string"!=typeof e)return null;if(t=e,!this.game.cache.checkImageKey(t))return console.warn('Phaser.Tilemap.addTilesetImage: Invalid image key given: "'+t+'"'),null}if("string"==typeof e&&(e=this.getTilesetIndex(e),null===e&&this.format===n.Tilemap.TILED_JSON))return console.warn('Phaser.Tilemap.addTilesetImage: No data found in the JSON matching the tileset name: "'+t+'"'),null;if(this.tilesets[e])return this.tilesets[e].setImage(this.game.cache.getImage(t)),this.tilesets[e];var a=new n.Tileset(t,u,r,i,s,o,{});a.setImage(this.game.cache.getImage(t)),this.tilesets.push(a);for(var f=this.tilesets.length-1,l=s,c=s,h=0,p=0,d=0,v=u;v<u+a.total&&(this.tiles[v]=[l,c,f],l+=r+o,h++,h!==a.total)&&(p++,p!==a.columns||(l=s,c+=i+o,p=0,d++,d!==a.rows));v++);return a},createFromObjects:function(e,t,r,i,s,o,u,a,f){if("undefined"==typeof s&&(s=!0),"undefined"==typeof o&&(o=!1),"undefined"==typeof u&&(u=this.game.world),"undefined"==typeof a&&(a=n.Sprite),"undefined"==typeof f&&(f=!0),!this.objects[e])return void console.warn("Tilemap.createFromObjects: Invalid objectgroup name given: "+e);for(var l,c=0,h=this.objects[e].length;h>c;c++)if(this.objects[e][c].gid===t){l=new a(this.game,this.objects[e][c].x,this.objects[e][c].y,r,i),l.name=this.objects[e][c].name,l.visible=this.objects[e][c].visible,l.autoCull=o,l.exists=s,this.objects[e][c].rotation&&(l.angle=this.objects[e][c].rotation),f&&(l.y-=l.height),u.add(l);for(var p in this.objects[e][c].properties)u.set(l,p,this.objects[e][c].properties[p],!1,!1,0,!0)}},createFromTiles:function(e,t,r,i,s,o){"number"==typeof e&&(e=[e]),"undefined"==typeof t||null===t?t=[]:"number"==typeof t&&(t=[t]),i=this.getLayer(i),"undefined"==typeof s&&(s=this.game.world),"undefined"==typeof o&&(o={}),void 0===o.customClass&&(o.customClass=n.Sprite),void 0===o.adjustY&&(o.adjustY=!0);var u=this.layers[i].width,a=this.layers[i].height;if(this.copy(0,0,u,a,i),this._results.length<2)return 0;for(var f,l=0,c=1,h=this._results.length;h>c;c++)if(-1!==e.indexOf(this._results[c].index)){f=new o.customClass(this.game,this._results[c].worldX,this._results[c].worldY,r);for(var p in o)f[p]=o[p];s.add(f),l++}if(1===t.length)for(c=0;c<e.length;c++)this.replace(e[c],t[0],0,0,u,a,i);else if(t.length>1)for(c=0;c<e.length;c++)this.replace(e[c],t[c],0,0,u,a,i);return l},createLayer:function(e,t,r,i){"undefined"==typeof t&&(t=this.game.width),"undefined"==typeof r&&(r=this.game.height),"undefined"==typeof i&&(i=this.game.world);var s=e;return"string"==typeof e&&(s=this.getLayerIndex(e)),null===s||s>this.layers.length?void console.warn("Tilemap.createLayer: Invalid layer ID given: "+s):i.add(new n.TilemapLayer(this.game,this,s,t,r))},createBlankLayer:function(e,t,r,i,s,o){if("undefined"==typeof o&&(o=this.game.world),null!==this.getLayerIndex(e))return void console.warn("Tilemap.createBlankLayer: Layer with matching name already exists");for(var u,a={name:e,x:0,y:0,width:t,height:r,widthInPixels:t*i,heightInPixels:r*s,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:null},f=[],l=0;r>l;l++){u=[];for(var c=0;t>c;c++)u.push(new n.Tile(a,-1,c,l,i,s));f.push(u)}a.data=f,this.layers.push(a),this.currentLayer=this.layers.length-1;var h=a.widthInPixels,p=a.heightInPixels;h>this.game.width&&(h=this.game.width),p>this.game.height&&(p=this.game.height);var f=new n.TilemapLayer(this.game,this,this.layers.length-1,h,p);return f.name=e,o.add(f)},getIndex:function(e,t){for(var n=0;n<e.length;n++)if(e[n].name===t)return n;return null},getLayerIndex:function(e){return this.getIndex(this.layers,e)},getTilesetIndex:function(e){return this.getIndex(this.tilesets,e)},getImageIndex:function(e){return this.getIndex(this.images,e)},getObjectIndex:function(e){return this.getIndex(this.objects,e)},setTileIndexCallback:function(e,t,n,r){if(r=this.getLayer(r),"number"==typeof e)this.layers[r].callbacks[e]={callback:t,callbackContext:n};else for(var i=0,s=e.length;s>i;i++)this.layers[r].callbacks[e[i]]={callback:t,callbackContext:n}},setTileLocationCallback:function(e,t,n,r,i,s,o){if(o=this.getLayer(o),this.copy(e,t,n,r,o),!(this._results.length<2))for(var u=1;u<this._results.length;u++)this._results[u].setCollisionCallback(i,s)},setCollision:function(e,t,n,r){if("undefined"==typeof t&&(t=!0),"undefined"==typeof r&&(r=!0),n=this.getLayer(n),"number"==typeof e)return this.setCollisionByIndex(e,t,n,!0);if(Array.isArray(e)){for(var i=0;i<e.length;i++)this.setCollisionByIndex(e[i],t,n,!1);r&&this.calculateFaces(n)}},setCollisionBetween:function(e,t,n,r,i){if("undefined"==typeof n&&(n=!0),"undefined"==typeof i&&(i=!0),r=this.getLayer(r),!(e>t)){for(var s=e;t>=s;s++)this.setCollisionByIndex(s,n,r,!1);i&&this.calculateFaces(r)}},setCollisionByExclusion:function(e,t,n,r){"undefined"==typeof t&&(t=!0),"undefined"==typeof r&&(r=!0),n=this.getLayer(n);for(var i=0,s=this.tiles.length;s>i;i++)-1===e.indexOf(i)&&this.setCollisionByIndex(i,t,n,!1);r&&this.calculateFaces(n)},setCollisionByIndex:function(e,t,n,r){if("undefined"==typeof t&&(t=!0),"undefined"==typeof n&&(n=this.currentLayer),"undefined"==typeof r&&(r=!0),t)this.collideIndexes.push(e);else{var i=this.collideIndexes.indexOf(e);i>-1&&this.collideIndexes.splice(i,1)}for(var s=0;s<this.layers[n].height;s++)for(var o=0;o<this.layers[n].width;o++){var u=this.layers[n].data[s][o];u&&u.index===e&&(t?u.setCollision(!0,!0,!0,!0):u.resetCollision(),u.faceTop=t,u.faceBottom=t,u.faceLeft=t,u.faceRight=t)}return r&&this.calculateFaces(n),n},getLayer:function(e){return"undefined"==typeof e?e=this.currentLayer:"string"==typeof e?e=this.getLayerIndex(e):e instanceof n.TilemapLayer&&(e=e.index),e},setPreventRecalculate:function(e){if(e===!0&&this.preventingRecalculate!==!0&&(this.preventingRecalculate=!0,this.needToRecalculate={}),e===!1&&this.preventingRecalculate===!0){this.preventingRecalculate=!1;for(var t in this.needToRecalculate)this.calculateFaces(t);this.needToRecalculate=!1}},calculateFaces:function(e){if(this.preventingRecalculate)return void (this.needToRecalculate[e]=!0);for(var t=null,n=null,r=null,i=null,s=0,o=this.layers[e].height;o>s;s++)for(var u=0,a=this.layers[e].width;a>u;u++){var f=this.layers[e].data[s][u];f&&(t=this.getTileAbove(e,u,s),n=this.getTileBelow(e,u,s),r=this.getTileLeft(e,u,s),i=this.getTileRight(e,u,s),f.collides&&(f.faceTop=!0,f.faceBottom=!0,f.faceLeft=!0,f.faceRight=!0),t&&t.collides&&(f.faceTop=!1),n&&n.collides&&(f.faceBottom=!1),r&&r.collides&&(f.faceLeft=!1),i&&i.collides&&(f.faceRight=!1))}},getTileAbove:function(e,t,n){return n>0?this.layers[e].data[n-1][t]:null},getTileBelow:function(e,t,n){return n<this.layers[e].height-1?this.layers[e].data[n+1][t]:null},getTileLeft:function(e,t,n){return t>0?this.layers[e].data[n][t-1]:null},getTileRight:function(e,t,n){return t<this.layers[e].width-1?this.layers[e].data[n][t+1]:null},setLayer:function(e){e=this.getLayer(e),this.layers[e]&&(this.currentLayer=e)},hasTile:function(e,t,n){return n=this.getLayer(n),this.layers[n].data[t][e].index>-1},removeTile:function(e,t,r){if(r=this.getLayer(r),e>=0&&e<this.layers[r].width&&t>=0&&t<this.layers[r].height&&this.hasTile(e,t,r)){var i=this.layers[r].data[t][e];return this.layers[r].data[t][e]=new n.Tile(this.layers[r],-1,e,t,this.tileWidth,this.tileHeight),this.layers[r].dirty=!0,this.calculateFaces(r),i}},removeTileWorldXY:function(e,t,n,r,i){return i=this.getLayer(i),e=this.game.math.snapToFloor(e,n)/n,t=this.game.math.snapToFloor(t,r)/r,this.removeTile(e,t,i)},putTile:function(e,t,r,i){if(null===e)return this.removeTile(t,r,i);if(i=this.getLayer(i),t>=0&&t<this.layers[i].width&&r>=0&&r<this.layers[i].height){var s;return e instanceof n.Tile?(s=e.index,this.hasTile(t,r,i)?this.layers[i].data[r][t].copy(e):this.layers[i].data[r][t]=new n.Tile(i,s,t,r,e.width,e.height)):(s=e,this.hasTile(t,r,i)?this.layers[i].data[r][t].index=s:this.layers[i].data[r][t]=new n.Tile(this.layers[i],s,t,r,this.tileWidth,this.tileHeight)),this.collideIndexes.indexOf(s)>-1?this.layers[i].data[r][t].setCollision(!0,!0,!0,!0):this.layers[i].data[r][t].resetCollision(),this.layers[i].dirty=!0,this.calculateFaces(i),this.layers[i].data[r][t]}return null},putTileWorldXY:function(e,t,n,r,i,s){return s=this.getLayer(s),t=this.game.math.snapToFloor(t,r)/r,n=this.game.math.snapToFloor(n,i)/i,this.putTile(e,t,n,s)},searchTileIndex:function(e,t,n,r){"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=!1),r=this.getLayer(r);var i=0;if(n){for(var s=this.layers[r].height-1;s>=0;s--)for(var o=this.layers[r].width-1;o>=0;o--)if(this.layers[r].data[s][o].index===e){if(i===t)return this.layers[r].data[s][o];i++}}else for(var s=0;s<this.layers[r].height;s++)for(var o=0;o<this.layers[r].width;o++)if(this.layers[r].data[s][o].index===e){if(i===t)return this.layers[r].data[s][o];i++}return null},getTile:function(e,t,n,r){return"undefined"==typeof r&&(r=!1),n=this.getLayer(n),e>=0&&e<this.layers[n].width&&t>=0&&t<this.layers[n].height?-1===this.layers[n].data[t][e].index?r?this.layers[n].data[t][e]:null:this.layers[n].data[t][e]:null},getTileWorldXY:function(e,t,n,r,i){return"undefined"==typeof n&&(n=this.tileWidth),"undefined"==typeof r&&(r=this.tileHeight),i=this.getLayer(i),e=this.game.math.snapToFloor(e,n)/n,t=this.game.math.snapToFloor(t,r)/r,this.getTile(e,t,i)},copy:function(e,t,n,r,i){if(i=this.getLayer(i),!this.layers[i])return void (this._results.length=0);"undefined"==typeof e&&(e=0),"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=this.layers[i].width),"undefined"==typeof r&&(r=this.layers[i].height),0>e&&(e=0),0>t&&(t=0),n>this.layers[i].width&&(n=this.layers[i].width),r>this.layers[i].height&&(r=this.layers[i].height),this._results.length=0,this._results.push({x:e,y:t,width:n,height:r,layer:i});for(var s=t;t+r>s;s++)for(var o=e;e+n>o;o++)this._results.push(this.layers[i].data[s][o]);return this._results},paste:function(e,t,n,r){if("undefined"==typeof e&&(e=0),"undefined"==typeof t&&(t=0),r=this.getLayer(r),n&&!(n.length<2)){for(var i=e-n[1].x,s=t-n[1].y,o=1;o<n.length;o++)this.layers[r].data[s+n[o].y][i+n[o].x].copy(n[o]);this.layers[r].dirty=!0,this.calculateFaces(r)}},swap:function(e,t,n,r,i,s,o){o=this.getLayer(o),this.copy(n,r,i,s,o),this._results.length<2||(this._tempA=e,this._tempB=t,this._results.forEach(this.swapHandler,this),this.paste(n,r,this._results,o))},swapHandler:function(e){e.index===this._tempA?e.index=this._tempB:e.index===this._tempB&&(e.index=this._tempA)},forEach:function(e,t,n,r,i,s,o){o=this.getLayer(o),this.copy(n,r,i,s,o),this._results.length<2||(this._results.forEach(e,t),this.paste(n,r,this._results,o))},replace:function(e,t,n,r,i,s,o){if(o=this.getLayer(o),this.copy(n,r,i,s,o),!(this._results.length<2)){for(var u=1;u<this._results.length;u++)this._results[u].index===e&&(this._results[u].index=t);this.paste(n,r,this._results,o)}},random:function(e,t,n,r,i){if(i=this.getLayer(i),this.copy(e,t,n,r,i),!(this._results.length<2)){for(var s=[],o=1;o<this._results.length;o++)if(this._results[o].index){var u=this._results[o].index;-1===s.indexOf(u)&&s.push(u)}for(var a=1;a<this._results.length;a++)this._results[a].index=this.game.rnd.pick(s);this.paste(e,t,this._results,i)}},shuffle:function(e,t,r,i,s){if(s=this.getLayer(s),this.copy(e,t,r,i,s),!(this._results.length<2)){for(var o=[],u=1;u<this._results.length;u++)this._results[u].index&&o.push(this._results[u].index);n.Utils.shuffle(o);for(var a=1;a<this._results.length;a++)this._results[a].index=o[a-1];this.paste(e,t,this._results,s)}},fill:function(e,t,n,r,i,s){if(s=this.getLayer(s),this.copy(t,n,r,i,s),!(this._results.length<2)){for(var o=1;o<this._results.length;o++)this._results[o].index=e;this.paste(t,n,this._results,s)}},removeAllLayers:function(){this.layers.length=0,this.currentLayer=0},dump:function(){for(var e="",t=[""],n=0;n<this.layers[this.currentLayer].height;n++){for(var r=0;r<this.layers[this.currentLayer].width;r++)e+="%c  ",t.push(this.layers[this.currentLayer].data[n][r]>1?this.debugMap[this.layers[this.currentLayer].data[n][r]]?"background: "+this.debugMap[this.layers[this.currentLayer].data[n][r]]:"background: #ffffff":"background: rgb(0, 0, 0)");e+="\n"}t[0]=e,console.log.apply(console,t)},destroy:function(){this.removeAllLayers(),this.data=[],this.game=null}},n.Tilemap.prototype.constructor=n.Tilemap,Object.defineProperty(n.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(e){e!==this.currentLayer&&this.setLayer(e)}}),n.TilemapLayer=function(e,t,r,i,s){i|=0,s|=0,PIXI.Sprite.call(this,PIXI.TextureCache.__default),n.Component.Core.init.call(this,e,0,0,null,null),this.map=t,this.index=r,this.layer=t.layers[r],this.canvas=n.Canvas.create(i,s),this.context=this.canvas.getContext("2d"),this.baseTexture=new PIXI.BaseTexture(this.canvas),this.texture=new PIXI.Texture(this.baseTexture),this.textureFrame=new n.Frame(0,0,0,i,s,"tilemapLayer",e.rnd.uuid()),this.type=n.TILEMAPLAYER,this.physicsType=n.TILEMAPLAYER,this.renderSettings={enableScrollDelta:!0,overdrawRatio:.2,copyCanvas:null},this.debug=!1,this.exists=!0,this.debugSettings={missingImageFill:"rgb(255,255,255)",debuggedTileOverfill:"rgba(0,255,0,0.4)",forceFullRedraw:!0,debugAlpha:.5,facingEdgeStroke:"rgba(0,255,0,1)",collidingTileOverfill:"rgba(0,255,0,0.2)"},this.scrollFactorX=1,this.scrollFactorY=1,this.dirty=!0,this.rayStepRate=4,this._wrap=!1,this._mc={scrollX:0,scrollY:0,renderWidth:0,renderHeight:0,tileWidth:t.tileWidth,tileHeight:t.tileHeight,cw:t.tileWidth,ch:t.tileHeight,tilesets:[]},this._scrollX=0,this._scrollY=0,this._results=[],e.device.canvasBitBltShift||(this.renderSettings.copyCanvas=n.TilemapLayer.ensureSharedCopyCanvas()),this.fixedToCamera=!0},n.TilemapLayer.prototype=Object.create(PIXI.Sprite.prototype),n.TilemapLayer.prototype.constructor=n.TilemapLayer;var c=["Bounds","Destroy","FixedToCamera","Reset","Smoothed"];n.Component.Core.install.call(n.TilemapLayer.prototype,c),n.TilemapLayer.sharedCopyCanvas=null,n.TilemapLayer.ensureSharedCopyCanvas=function(){return this.sharedCopyCanvas||(this.sharedCopyCanvas=n.Canvas.create(2,2)),this.sharedCopyCanvas},n.TilemapLayer.prototype.preUpdate=function(){return n.Component.Core.preUpdate.call(this),!0},n.TilemapLayer.prototype.postUpdate=function(){n.Component.Core.prototype.postUpdate.call(this);var e=this.game.camera;this.scrollX=e.x*this.scrollFactorX/this.scale.x,this.scrollY=e.y*this.scrollFactorY/this.scale.y,this.render()},n.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels*this.scale.x,this.layer.heightInPixels*this.scale.y)},n.TilemapLayer.prototype._fixX=function(e){return 0>e&&(e=0),1===this.scrollFactorX?e:this._scrollX+(e-this._scrollX/this.scrollFactorX)},n.TilemapLayer.prototype._unfixX=function(e){return 1===this.scrollFactorX?e:this._scrollX/this.scrollFactorX+(e-this._scrollX)},n.TilemapLayer.prototype._fixY=function(e){return 0>e&&(e=0),1===this.scrollFactorY?e:this._scrollY+(e-this._scrollY/this.scrollFactorY)},n.TilemapLayer.prototype._unfixY=function(e){return 1===this.scrollFactorY?e:this._scrollY/this.scrollFactorY+(e-this._scrollY)},n.TilemapLayer.prototype.getTileX=function(e){return Math.floor(this._fixX(e)/this._mc.tileWidth)},n.TilemapLayer.prototype.getTileY=function(e){return Math.floor(this._fixY(e)/this._mc.tileHeight)},n.TilemapLayer.prototype.getTileXY=function(e,t,n){return n.x=this.getTileX(e),n.y=this.getTileY(t),n},n.TilemapLayer.prototype.getRayCastTiles=function(e,t,n,r){t||(t=this.rayStepRate),"undefined"==typeof n&&(n=!1),"undefined"==typeof r&&(r=!1);var i=this.getTiles(e.x,e.y,e.width,e.height,n,r);if(0===i.length)return[];for(var s=e.coordinatesOnLine(t),o=[],u=0;u<i.length;u++)for(var a=0;a<s.length;a++){var f=i[u],l=s[a];if(f.containsPoint(l[0],l[1])){o.push(f);break}}return o},n.TilemapLayer.prototype.getTiles=function(e,t,n,r,i,s){"undefined"==typeof i&&(i=!1),"undefined"==typeof s&&(s=!1);var o=!i&&!s;e=this._fixX(e),t=this._fixY(t);for(var u=Math.floor(e/(this._mc.cw*this.scale.x)),a=Math.floor(t/(this._mc.ch*this.scale.y)),f=Math.ceil((e+n)/(this._mc.cw*this.scale.x))-u,l=Math.ceil((t+r)/(this._mc.ch*this.scale.y))-a;this._results.length;)this._results.pop();for(var c=a;a+l>c;c++)for(var h=u;u+f>h;h++){var p=this.layer.data[c];p&&p[h]&&(o||p[h].isInteresting(i,s))&&this._results.push(p[h])}return this._results.slice()},Object.defineProperty(n.TilemapLayer.prototype,"tileColor",{get:function(){return this.debugSettings.missingImageFill},set:function(e){this.debugSettings.missingImageFill=e}}),Object.defineProperty(n.TilemapLayer.prototype,"wrap",{get:function(){return this._wrap},set:function(e){this._wrap=e,this.dirty=!0}}),n.TilemapLayer.prototype.resolveTileset=function(e){var t=this._mc.tilesets;if(2e3>e)for(;t.length<e;)t.push(void 0);var n=this.map.tiles[e]&&this.map.tiles[e][2];if(null!=n){var r=this.map.tilesets[n];if(r&&r.containsTileIndex(e))return t[e]=r}return t[e]=null},n.TilemapLayer.prototype.resetTilesetCache=function(){for(var e=this._mc.tilesets;e.length;)e.pop()},n.TilemapLayer.prototype.setScale=function(e,t){e=e||1,t=t||e;for(var n=0;n<this.layer.data.length;n++)for(var r=this.layer.data[n],i=0;i<r.length;i++){var s=r[i];s.width=this.map.tileWidth*e,s.height=this.map.tileHeight*t,s.worldX=s.x*s.width,s.worldY=s.y*s.height}this.scale.setTo(e,t)},n.TilemapLayer.prototype.shiftCanvas=function(e,t,n){var r=e.canvas,i=r.width-Math.abs(t),s=r.height-Math.abs(n),o=0,u=0,a=t,f=n;0>t&&(o=-t,a=0),0>n&&(u=-n,f=0);var l=this.renderSettings.copyCanvas;if(l){(l.width<i||l.height<s)&&(l.width=i,l.height=s);var c=l.getContext("2d");c.clearRect(0,0,i,s),c.drawImage(r,o,u,i,s,0,0,i,s),e.clearRect(a,f,i,s),e.drawImage(l,0,0,i,s,a,f,i,s)}else e.save(),e.globalCompositeOperation="copy",e.drawImage(r,o,u,i,s,a,f,i,s),e.restore()},n.TilemapLayer.prototype.renderRegion=function(e,t,n,r,i,s){var o=this.context,u=this.layer.width,a=this.layer.height,f=this._mc.tileWidth,l=this._mc.tileHeight,c=this._mc.tilesets,h=0/0;this._wrap||(i>=n&&(n=Math.max(0,n),i=Math.min(u-1,i)),s>=r&&(r=Math.max(0,r),s=Math.min(a-1,s)));var p,d,v,m,g,y,b=n*f-e,w=r*l-t,E=(n+(1<<20)*u)%u,S=(r+(1<<20)*a)%a;for(o.fillStyle=this.tileColor,m=S,y=s-r,d=w;y>=0;m++,y--,d+=l){m>=a&&(m-=a);var x=this.layer.data[m];for(v=E,g=i-n,p=b;g>=0;v++,g--,p+=f){v>=u&&(v-=u);var T=x[v];if(T&&!(T.index<0)){var N=T.index,C=c[N];void 0===C&&(C=this.resolveTileset(N)),T.alpha===h||this.debug||(o.globalAlpha=T.alpha,h=T.alpha),C?T.rotation||T.flipped?(o.save(),o.translate(p+T.centerX,d+T.centerY),o.rotate(T.rotation),T.flipped&&o.scale(-1,1),C.draw(o,-T.centerX,-T.centerY,N),o.restore()):C.draw(o,p,d,N):this.debugSettings.missingImageFill&&(o.fillStyle=this.debugSettings.missingImageFill,o.fillRect(p,d,f,l)),T.debug&&this.debugSettings.debuggedTileOverfill&&(o.fillStyle=this.debugSettings.debuggedTileOverfill,o.fillRect(p,d,f,l))}}}},n.TilemapLayer.prototype.renderDeltaScroll=function(e,t){var n=this._mc.scrollX,r=this._mc.scrollY,i=this.canvas.width,s=this.canvas.height,o=this._mc.tileWidth,u=this._mc.tileHeight,a=0,f=-o,l=0,c=-u;if(0>e?(a=i+e,f=i-1):e>0&&(f=e),0>t?(l=s+t,c=s-1):t>0&&(c=t),this.shiftCanvas(this.context,e,t),a=Math.floor((a+n)/o),f=Math.floor((f+n)/o),l=Math.floor((l+r)/u),c=Math.floor((c+r)/u),f>=a){this.context.clearRect(a*o-n,0,(f-a+1)*o,s);var h=Math.floor((0+r)/u),p=Math.floor((s-1+r)/u);this.renderRegion(n,r,a,h,f,p)}if(c>=l){this.context.clearRect(0,l*u-r,i,(c-l+1)*u);var d=Math.floor((0+n)/o),v=Math.floor((i-1+n)/o);this.renderRegion(n,r,d,l,v,c)}},n.TilemapLayer.prototype.renderFull=function(){var e=this._mc.scrollX,t=this._mc.scrollY,n=this.canvas.width,r=this.canvas.height,i=this._mc.tileWidth,s=this._mc.tileHeight,o=Math.floor(e/i),u=Math.floor((n-1+e)/i),a=Math.floor(t/s),f=Math.floor((r-1+t)/s);this.context.clearRect(0,0,n,r),this.renderRegion(e,t,o,a,u,f)},n.TilemapLayer.prototype.render=function(){var e=!1;if(this.visible){this.context.save(),(this.dirty||this.layer.dirty)&&(this.layer.dirty=!1,e=!0);var t=this.canvas.width,n=this.canvas.height,r=0|this._scrollX,i=0|this._scrollY,s=this._mc,o=s.scrollX-r,u=s.scrollY-i;if(e||0!==o||0!==u||s.renderWidth!==t||s.renderHeight!==n)return s.scrollX=r,s.scrollY=i,(s.renderWidth!==t||s.renderHeight!==n)&&(s.renderWidth=t,s.renderHeight=n),this.debug&&(this.context.globalAlpha=this.debugSettings.debugAlpha,this.debugSettings.forceFullRedraw&&(e=!0)),!e&&this.renderSettings.enableScrollDelta&&Math.abs(o)+Math.abs(u)<Math.min(t,n)?this.renderDeltaScroll(o,u):this.renderFull(),this.debug&&(this.context.globalAlpha=1,this.renderDebug()),this.baseTexture.dirty(),this.dirty=!1,this.context.restore(),!0}},n.TilemapLayer.prototype.renderDebug=function(){var e,t,n,r,i,s,o=this._mc.scrollX,u=this._mc.scrollY,a=this.context,f=this.canvas.width,l=this.canvas.height,c=this.layer.width,h=this.layer.height,p=this._mc.tileWidth,d=this._mc.tileHeight,v=Math.floor(o/p),m=Math.floor((f-1+o)/p),g=Math.floor(u/d),y=Math.floor((l-1+u)/d),b=v*p-o,w=g*d-u,E=(v+(1<<20)*c)%c,S=(g+(1<<20)*h)%h;for(a.strokeStyle=this.debugSettings.facingEdgeStroke,r=S,s=y-g,t=w;s>=0;r++,s--,t+=d){r>=h&&(r-=h);var x=this.layer.data[r];for(n=E,i=m-v,e=b;i>=0;n++,i--,e+=p){n>=c&&(n-=c);var T=x[n];!T||T.index<0||!T.collides||(this.debugSettings.collidingTileOverfill&&(a.fillStyle=this.debugSettings.collidingTileOverfill,a.fillRect(e,t,this._mc.cw,this._mc.ch)),this.debugSettings.facingEdgeStroke&&(a.beginPath(),T.faceTop&&(a.moveTo(e,t),a.lineTo(e+this._mc.cw,t)),T.faceBottom&&(a.moveTo(e,t+this._mc.ch),a.lineTo(e+this._mc.cw,t+this._mc.ch)),T.faceLeft&&(a.moveTo(e,t),a.lineTo(e,t+this._mc.ch)),T.faceRight&&(a.moveTo(e+this._mc.cw,t),a.lineTo(e+this._mc.cw,t+this._mc.ch)),a.stroke()))}}},Object.defineProperty(n.TilemapLayer.prototype,"scrollX",{get:function(){return this._scrollX},set:function(e){this._scrollX=e}}),Object.defineProperty(n.TilemapLayer.prototype,"scrollY",{get:function(){return this._scrollY},set:function(e){this._scrollY=e}}),Object.defineProperty(n.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._mc.cw},set:function(e){this._mc.cw=0|e,this.dirty=!0}}),Object.defineProperty(n.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(e){this._mc.ch=0|e,this.dirty=!0}}),n.TilemapParser={parse:function(e,t,r,i,s,o){if("undefined"==typeof r&&(r=32),"undefined"==typeof i&&(i=32),"undefined"==typeof s&&(s=10),"undefined"==typeof o&&(o=10),"undefined"==typeof t)return this.getEmptyData();if(null===t)return this.getEmptyData(r,i,s,o);var u=e.cache.getTilemapData(t);if(u){if(u.format===n.Tilemap.CSV)return this.parseCSV(t,u.data,r,i);if(!u.format||u.format===n.Tilemap.TILED_JSON)return this.parseTiledJSON(u.data)}else console.warn("Phaser.TilemapParser.parse - No map data found for key "+t)},parseCSV:function(e,t,r,i){var s=this.getEmptyData();t=t.trim();for(var o=[],u=t.split("\n"),a=u.length,f=0,l=0;l<u.length;l++){o[l]=[];for(var c=u[l].split(","),h=0;h<c.length;h++)o[l][h]=new n.Tile(s.layers[0],parseInt(c[h],10),h,l,r,i);0===f&&(f=c.length)}return s.format=n.Tilemap.CSV,s.name=e,s.width=f,s.height=a,s.tileWidth=r,s.tileHeight=i,s.widthInPixels=f*r,s.heightInPixels=a*i,s.layers[0].width=f,s.layers[0].height=a,s.layers[0].widthInPixels=s.widthInPixels,s.layers[0].heightInPixels=s.heightInPixels,s.layers[0].data=o,s},getEmptyData:function(e,t,n,r){var i={};i.width=0,i.height=0,i.tileWidth=0,i.tileHeight=0,"undefined"!=typeof e&&null!==e&&(i.tileWidth=e),"undefined"!=typeof t&&null!==t&&(i.tileHeight=t),"undefined"!=typeof n&&null!==n&&(i.width=n),"undefined"!=typeof r&&null!==r&&(i.height=r),i.orientation="orthogonal",i.version="1",i.properties={},i.widthInPixels=0,i.heightInPixels=0;var s=[],o={name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:[]};return s.push(o),i.layers=s,i.images=[],i.objects={},i.collision={},i.tilesets=[],i.tiles=[],i},parseTiledJSON:function(e){function t(e,t){var n={};for(var r in t){var i=t[r];e[i]&&(n[i]=e[i])}return n}if("orthogonal"!==e.orientation)return console.warn("TilemapParser.parseTiledJSON - Only orthogonal map types are supported in this version of Phaser"),null;var r={};r.width=e.width,r.height=e.height,r.tileWidth=e.tilewidth,r.tileHeight=e.tileheight,r.orientation=e.orientation,r.format=n.Tilemap.TILED_JSON,r.version=e.version,r.properties=e.properties,r.widthInPixels=r.width*r.tileWidth,r.heightInPixels=r.height*r.tileHeight;for(var i=[],s=0;s<e.layers.length;s++)if("tilelayer"===e.layers[s].type){var o={name:e.layers[s].name,x:e.layers[s].x,y:e.layers[s].y,width:e.layers[s].width,height:e.layers[s].height,widthInPixels:e.layers[s].width*e.tilewidth,heightInPixels:e.layers[s].height*e.tileheight,alpha:e.layers[s].opacity,visible:e.layers[s].visible,properties:{},indexes:[],callbacks:[],bodies:[]};e.layers[s].properties&&(o.properties=e.layers[s].properties);for(var u,a,f,l,c=0,h=[],p=[],d=0,v=e.layers[s].data.length;v>d;d++){if(u=0,a=!1,l=e.layers[s].data[d],l>536870912)switch(f=0,l>2147483648&&(l-=2147483648,f+=4),l>1073741824&&(l-=1073741824,f+=2),l>536870912&&(l-=536870912,f+=1),f){case 5:u=Math.PI/2;break;case 6:u=Math.PI;break;case 3:u=3*Math.PI/2;break;case 4:u=0,a=!0;break;case 7:u=Math.PI/2,a=!0;break;case 2:u=Math.PI,a=!0;break;case 1:u=3*Math.PI/2,a=!0}l>0?(h.push(new n.Tile(o,l,c,p.length,e.tilewidth,e.tileheight)),h[h.length-1].rotation=u,h[h.length-1].flipped=a):h.push(new n.Tile(o,-1,c,p.length,e.tilewidth,e.tileheight)),c++,c===e.layers[s].width&&(p.push(h),c=0,h=[])}o.data=p,i.push(o)}r.layers=i;for(var m=[],s=0;s<e.layers.length;s++)if("imagelayer"===e.layers[s].type){var g={name:e.layers[s].name,image:e.layers[s].image,x:e.layers[s].x,y:e.layers[s].y,alpha:e.layers[s].opacity,visible:e.layers[s].visible,properties:{}};e.layers[s].properties&&(g.properties=e.layers[s].properties),m.push(g)}r.images=m;for(var y=[],s=0;s<e.tilesets.length;s++){var b=e.tilesets[s];if(b.image){var w=new n.Tileset(b.name,b.firstgid,b.tilewidth,b.tileheight,b.margin,b.spacing,b.properties);b.tileproperties&&(w.tileProperties=b.tileproperties),w.updateTileData(b.imagewidth,b.imageheight),y.push(w)}else console.warn("Phaser.TilemapParser - Image Collection Tilesets are not support")}r.tilesets=y;for(var E={},S={},s=0;s<e.layers.length;s++)if("objectgroup"===e.layers[s].type){E[e.layers[s].name]=[],S[e.layers[s].name]=[];for(var x=0,v=e.layers[s].objects.length;v>x;x++)if(e.layers[s].objects[x].gid){var T={gid:e.layers[s].objects[x].gid,name:e.layers[s].objects[x].name,type:e.layers[s].objects[x].hasOwnProperty("type")?e.layers[s].objects[x].type:"",x:e.layers[s].objects[x].x,y:e.layers[s].objects[x].y,visible:e.layers[s].objects[x].visible,properties:e.layers[s].objects[x].properties};e.layers[s].objects[x].rotation&&(T.rotation=e.layers[s].objects[x].rotation),E[e.layers[s].name].push(T)}else if(e.layers[s].objects[x].polyline){var T={name:e.layers[s].objects[x].name,type:e.layers[s].objects[x].type,x:e.layers[s].objects[x].x,y:e.layers[s].objects[x].y,width:e.layers[s].objects[x].width,height:e.layers[s].objects[x].height,visible:e.layers[s].objects[x].visible,properties:e.layers[s].objects[x].properties};e.layers[s].objects[x].rotation&&(T.rotation=e.layers[s].objects[x].rotation),T.polyline=[];for(var N=0;N<e.layers[s].objects[x].polyline.length;N++)T.polyline.push([e.layers[s].objects[x].polyline[N].x,e.layers[s].objects[x].polyline[N].y]);S[e.layers[s].name].push(T),E[e.layers[s].name].push(T)}else if(e.layers[s].objects[x].polygon){var T=t(e.layers[s].objects[x],["name","type","x","y","visible","rotation","properties"]);T.polygon=[];for(var N=0;N<e.layers[s].objects[x].polygon.length;N++)T.polygon.push([e.layers[s].objects[x].polygon[N].x,e.layers[s].objects[x].polygon[N].y]);E[e.layers[s].name].push(T)}else if(e.layers[s].objects[x].ellipse){var T=t(e.layers[s].objects[x],["name","type","ellipse","x","y","width","height","visible","rotation","properties"]);E[e.layers[s].name].push(T)}else{var T=t(e.layers[s].objects[x],["name","type","x","y","width","height","visible","rotation","properties"]);T.rectangle=!0,E[e.layers[s].name].push(T)}}r.objects=E,r.collision=S,r.tiles=[];for(var s=0;s<r.tilesets.length;s++)for(var b=r.tilesets[s],c=b.tileMargin,C=b.tileMargin,k=0,L=0,A=0,d=b.firstgid;d<b.firstgid+b.total&&(r.tiles[d]=[c,C,s],c+=b.tileWidth+b.tileSpacing,k++,k!==b.total)&&(L++,L!==b.columns||(c=b.tileMargin,C+=b.tileHeight+b.tileSpacing,L=0,A++,A!==b.rows));d++);for(var o,O,M,b,s=0;s<r.layers.length;s++){o=r.layers[s];for(var _=0;_<o.data.length;_++){h=o.data[_];for(var D=0;D<h.length;D++)O=h[D],O.index<0||(M=r.tiles[O.index][2],b=r.tilesets[M],b.tileProperties&&b.tileProperties[O.index-b.firstgid]&&(O.properties=n.Utils.mixin(b.tileProperties[O.index-b.firstgid],O.properties)))}}return r}},n.Tileset=function(e,t,n,r,i,s,o){("undefined"==typeof n||0>=n)&&(n=32),("undefined"==typeof r||0>=r)&&(r=32),"undefined"==typeof i&&(i=0),"undefined"==typeof s&&(s=0),this.name=e,this.firstgid=0|t,this.tileWidth=0|n,this.tileHeight=0|r,this.tileMargin=0|i,this.tileSpacing=0|s,this.properties=o||{},this.image=null,this.rows=0,this.columns=0,this.total=0,this.drawCoords=[]},n.Tileset.prototype={draw:function(e,t,n,r){var i=r-this.firstgid<<1;i>=0&&i+1<this.drawCoords.length&&e.drawImage(this.image,this.drawCoords[i],this.drawCoords[i+1],this.tileWidth,this.tileHeight,t,n,this.tileWidth,this.tileHeight)},containsTileIndex:function(e){return e>=this.firstgid&&e<this.firstgid+this.total},setImage:function(e){this.image=e,this.updateTileData(e.width,e.height)},setSpacing:function(e,t){this.tileMargin=0|e,this.tileSpacing=0|t,this.image&&this.updateTileData(this.image.width,this.image.height)},updateTileData:function(e,t){var n=(t-2*this.tileMargin+this.tileSpacing)/(this.tileHeight+this.tileSpacing),r=(e-2*this.tileMargin+this.tileSpacing)/(this.tileWidth+this.tileSpacing);(n%1!==0||r%1!==0)&&console.warn("Phaser.Tileset - image tile area is not an even multiple of tile size"),n=Math.floor(n),r=Math.floor(r),(this.rows&&this.rows!==n||this.columns&&this.columns!==r)&&console.warn("Phaser.Tileset - actual and expected number of tile rows and columns differ"),this.rows=n,this.columns=r,this.total=n*r,this.drawCoords.length=0;for(var i=this.tileMargin,s=this.tileMargin,o=0;o<this.rows;o++){for(var u=0;u<this.columns;u++)this.drawCoords.push(i),this.drawCoords.push(s),i+=this.tileWidth+this.tileSpacing;i=this.tileMargin,s+=this.tileHeight+this.tileSpacing}}},n.Tileset.prototype.constructor=n.Tileset,n.Particles=function(e){this.game=e,this.emitters={},this.ID=0},n.Particles.prototype={add:function(e){return this.emitters[e.name]=e,e},remove:function(e){delete this.emitters[e.name]},update:function(){for(var e in this.emitters)this.emitters[e].exists&&this.emitters[e].update()}},n.Particles.prototype.constructor=n.Particles,n.Particles.Arcade={},n.Particles.Arcade.Emitter=function(e,t,r,i){this.maxParticles=i||50,n.Group.call(this,e),this.name="emitter"+this.game.particles.ID++,this.type=n.EMITTER,this.physicsType=n.GROUP,this.area=new n.Rectangle(t,r,1,1),this.minParticleSpeed=new n.Point(-100,-100),this.maxParticleSpeed=new n.Point(100,100),this.minParticleScale=1,this.maxParticleScale=1,this.scaleData=null,this.minRotation=-360,this.maxRotation=360,this.minParticleAlpha=1,this.maxParticleAlpha=1,this.alphaData=null,this.gravity=100,this.particleClass=n.Particle,this.particleDrag=new n.Point,this.angularDrag=0,this.frequency=100,this.lifespan=2e3,this.bounce=new n.Point,this.on=!1,this.particleAnchor=new n.Point(.5,.5),this.blendMode=n.blendModes.NORMAL,this.emitX=t,this.emitY=r,this.autoScale=!1,this.autoAlpha=!1,this.particleBringToTop=!1,this.particleSendToBack=!1,this._minParticleScale=new n.Point(1,1),this._maxParticleScale=new n.Point(1,1),this._quantity=0,this._timer=0,this._counter=0,this._flowQuantity=0,this._flowTotal=0,this._explode=!0,this._frames=null},n.Particles.Arcade.Emitter.prototype=Object.create(n.Group.prototype),n.Particles.Arcade.Emitter.prototype.constructor=n.Particles.Arcade.Emitter,n.Particles.Arcade.Emitter.prototype.update=function(){if(this.on&&this.game.time.time>=this._timer)if(this._timer=this.game.time.time+this.frequency*this.game.time.slowMotion,0!==this._flowTotal)if(this._flowQuantity>0){for(var e=0;e<this._flowQuantity;e++)if(this.emitParticle()&&(this._counter++,-1!==this._flowTotal&&this._counter>=this._flowTotal)){this.on=!1;break}}else this.emitParticle()&&(this._counter++,-1!==this._flowTotal&&this._counter>=this._flowTotal&&(this.on=!1));else this.emitParticle()&&(this._counter++,this._quantity>0&&this._counter>=this._quantity&&(this.on=!1));for(var e=this.children.length;e--;)this.children[e].exists&&this.children[e].update()},n.Particles.Arcade.Emitter.prototype.makeParticles=function(e,t,n,r,i){"undefined"==typeof t&&(t=0),"undefined"==typeof n&&(n=this.maxParticles),"undefined"==typeof r&&(r=!1),"undefined"==typeof i&&(i=!1);var s,o=0,u=e,a=t;for(this._frames=t,n>this.maxParticles&&(this.maxParticles=n);n>o;)Array.isArray(e)&&(u=this.game.rnd.pick(e)),Array.isArray(t)&&(a=this.game.rnd.pick(t)),s=new this.particleClass(this.game,0,0,u,a),this.game.physics.arcade.enable(s,!1),r?(s.body.checkCollision.any=!0,s.body.checkCollision.none=!1):s.body.checkCollision.none=!0,s.body.collideWorldBounds=i,s.body.skipQuadTree=!0,s.exists=!1,s.visible=!1,s.anchor.copyFrom(this.particleAnchor),this.add(s),o++;return this},n.Particles.Arcade.Emitter.prototype.kill=function(){this.on=!1,this.alive=!1,this.exists=!1},n.Particles.Arcade.Emitter.prototype.revive=function(){this.alive=!0,this.exists=!0},n.Particles.Arcade.Emitter.prototype.explode=function(e,t){this._flowTotal=0,this.start(!0,e,0,t,!1)},n.Particles.Arcade.Emitter.prototype.flow=function(e,t,n,r,i){("undefined"==typeof n||0===n)&&(n=1),"undefined"==typeof r&&(r=-1),"undefined"==typeof i&&(i=!0),n>this.maxParticles&&(n=this.maxParticles),this._counter=0,this._flowQuantity=n,this._flowTotal=r,i?(this.start(!0,e,t,n),this._counter+=n,this.on=!0,this._timer=this.game.time.time+t*this.game.time.slowMotion):this.start(!1,e,t,n)},n.Particles.Arcade.Emitter.prototype.start=function(e,t,n,r,i){if("undefined"==typeof e&&(e=!0),"undefined"==typeof t&&(t=0),("undefined"==typeof n||null===n)&&(n=250),"undefined"==typeof r&&(r=0),"undefined"==typeof i&&(i=!1),r>this.maxParticles&&(r=this.maxParticles),this.revive(),this.visible=!0,this.lifespan=t,this.frequency=n,e||i)for(var s=0;r>s;s++)this.emitParticle();else this.on=!0,this._quantity+=r,this._counter=0,this._timer=this.game.time.time+n*this.game.time.slowMotion},n.Particles.Arcade.Emitter.prototype.emitParticle=function(){var e=this.getFirstExists(!1);return null===e?!1:(this.width>1||this.height>1?e.reset(this.game.rnd.integerInRange(this.left,this.right),this.game.rnd.integerInRange(this.top,this.bottom)):e.reset(this.emitX,this.emitY),e.angle=0,e.lifespan=this.lifespan,this.particleBringToTop?this.bringToTop(e):this.particleSendToBack&&this.sendToBack(e),this.autoScale?e.setScaleData(this.scaleData):1!==this.minParticleScale||1!==this.maxParticleScale?e.scale.set(this.game.rnd.realInRange(this.minParticleScale,this.maxParticleScale)):(this._minParticleScale.x!==this._maxParticleScale.x||this._minParticleScale.y!==this._maxParticleScale.y)&&e.scale.set(this.game.rnd.realInRange(this._minParticleScale.x,this._maxParticleScale.x),this.game.rnd.realInRange(this._minParticleScale.y,this._maxParticleScale.y)),e.frame=Array.isArray("object"===this._frames)?this.game.rnd.pick(this._frames):this._frames,this.autoAlpha?e.setAlphaData(this.alphaData):e.alpha=this.game.rnd.realInRange(this.minParticleAlpha,this.maxParticleAlpha),e.blendMode=this.blendMode,e.body.updateBounds(),e.body.bounce.setTo(this.bounce.x,this.bounce.y),e.body.velocity.x=this.game.rnd.between(this.minParticleSpeed.x,this.maxParticleSpeed.x),e.body.velocity.y=this.game.rnd.between(this.minParticleSpeed.y,this.maxParticleSpeed.y),e.body.angularVelocity=this.game.rnd.between(this.minRotation,this.maxRotation),e.body.gravity.y=this.gravity,e.body.drag.x=this.particleDrag.x,e.body.drag.y=this.particleDrag.y,e.body.angularDrag=this.angularDrag,e.onEmit(),!0)},n.Particles.Arcade.Emitter.prototype.destroy=function(){this.game.particles.remove(this),n.Group.prototype.destroy.call(this,!0,!1)},n.Particles.Arcade.Emitter.prototype.setSize=function(e,t){this.area.width=e,this.area.height=t},n.Particles.Arcade.Emitter.prototype.setXSpeed=function(e,t){e=e||0,t=t||0,this.minParticleSpeed.x=e,this.maxParticleSpeed.x=t},n.Particles.Arcade.Emitter.prototype.setYSpeed=function(e,t){e=e||0,t=t||0,this.minParticleSpeed.y=e,this.maxParticleSpeed.y=t},n.Particles.Arcade.Emitter.prototype.setRotation=function(e,t){e=e||0,t=t||0,this.minRotation=e,this.maxRotation=t},n.Particles.Arcade.Emitter.prototype.setAlpha=function(e,t,r,i,s){if("undefined"==typeof e&&(e=1),"undefined"==typeof t&&(t=1),"undefined"==typeof r&&(r=0),"undefined"==typeof i&&(i=n.Easing.Linear.None),"undefined"==typeof s&&(s=!1),this.minParticleAlpha=e,this.maxParticleAlpha=t,this.autoAlpha=!1,r>0&&e!==t){var o={v:e},u=this.game.make.tween(o).to({v:t},r,i);u.yoyo(s),this.alphaData=u.generateData(60),this.alphaData.reverse(),this.autoAlpha=!0}},n.Particles.Arcade.Emitter.prototype.setScale=function(e,t,r,i,s,o,u){if("undefined"==typeof e&&(e=1),"undefined"==typeof t&&(t=1),"undefined"==typeof r&&(r=1),"undefined"==typeof i&&(i=1),"undefined"==typeof s&&(s=0),"undefined"==typeof o&&(o=n.Easing.Linear.None),"undefined"==typeof u&&(u=!1),this.minParticleScale=1,this.maxParticleScale=1,this._minParticleScale.set(e,r),this._maxParticleScale.set(t,i),this.autoScale=!1,s>0&&(e!==t||r!==i)){var a={x:e,y:r},f=this.game.make.tween(a).to({x:t,y:i},s,o);f.yoyo(u),this.scaleData=f.generateData(60),this.scaleData.reverse(),this.autoScale=!0}},n.Particles.Arcade.Emitter.prototype.at=function(e){e.center?(this.emitX=e.center.x,this.emitY=e.center.y):(this.emitX=e.world.x+e.anchor.x*e.width,this.emitY=e.world.y+e.anchor.y*e.height)},Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"width",{get:function(){return this.area.width},set:function(e){this.area.width=e}}),Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"height",{get:function(){return this.area.height},set:function(e){this.area.height=e}}),Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(e){this.emitX=e}}),Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(e){this.emitY=e}}),Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-this.area.width/2)}}),Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+this.area.width/2)}}),Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-this.area.height/2)}}),Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+this.area.height/2)}}),void 0===PIXI.blendModes&&(PIXI.blendModes=n.blendModes),void 0===PIXI.scaleModes&&(PIXI.scaleModes=n.scaleModes),void 0===PIXI.Texture.emptyTexture&&(PIXI.Texture.emptyTexture=new PIXI.Texture(new PIXI.BaseTexture)),void 0===PIXI.DisplayObject._tempMatrix&&(PIXI.DisplayObject._tempMatrix=new PIXI.Matrix),void 0===PIXI.RenderTexture.tempMatrix&&(PIXI.RenderTexture.tempMatrix=new PIXI.Matrix),void 0===PIXI.Graphics.POLY&&(PIXI.Graphics.POLY=n.POLYGON,PIXI.Graphics.RECT=n.RECTANGLE,PIXI.Graphics.CIRC=n.CIRCLE,PIXI.Graphics.ELIP=n.ELLIPSE,PIXI.Graphics.RREC=n.ROUNDEDRECTANGLE),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports.Phaser=n):"undefined"!=typeof define&&define.amd?define("Phaser",function(){return t.Phaser=n}()):t.Phaser=n}.call(this),define("phaser",function(e){return function(){var t,n;return t||e.Phaser}}(this)),define("Boot",["phaser"],function(e){"use strict";function t(){console.log("Booting the Game")}return t.prototype={constructor:t,init:function(){this.input.maxPointers=1,this.stage.disableVisibilityChange=!0,this.game.stage.smoothed=!1,this.game.device.desktop?(this.scale.scaleMode=e.ScaleManager.EXACT_FIT,this.scale.pageAlignHorizontally=!0,this.scale.pageAlignVertically=!0,this.scale.setScreenSize(!0),this.scale.refresh()):(this.scale.scaleMode=e.ScaleManager.EXACT_FIT,this.scale.pageAlignHorizontally=!0,this.scale.pageAlignVertically=!0,this.scale.forceOrientation(!0,!1),this.scale.refresh())},preload:function(){this.load.image("loader","assets/loading.png"),this.load.image("preloaderBar","assets/preload.png")},create:function(){this.state.start("Preloader")}},t}),define("Preloader",["phaser"],function(e){"use strict";function t(){this.background=null,this.preloadBar=null,this.ready=!1}return t.prototype={constructor:t,preload:function(){this.background=this.add.sprite(0,0,"loader"),this.preloadBar=this.add.sprite(this.game.width/2-100,450,"preloaderBar"),this.load.setPreloadSprite(this.preloadBar),this.load.image("font","assets/font.png"),this.load.image("play","assets/play.png"),this.load.image("logo","assets/logo.png"),this.load.image("bg","assets/background.png"),this.load.atlasJSONHash("spritesheet","assets/spritesheet.png","assets/spritesheet.json"),this.load.image("platform-particle","assets/platform-particle.png"),this.game.load.audio("bounce",["assets/bounce.mp3"]),this.game.load.audio("coin",["assets/collectBonus.mp3"]),this.game.load.audio("splat",["assets/wrong.mp3"]),this.game.load.audio("button",["assets/button.mp3"])},create:function(){this.state.start("MainMenu")}},t}),define("Player",["phaser"],function(e){"use strict";var t=function(n,r,i,s){e.Sprite.call(this,n,r,i,"spritesheet","frame-1.png"),this.anchor.setTo(.5,.5),this.game.physics.arcade.enableBody(this),this.body.allowGravity=!0,this.body.immovable=!1,this.body.gravity.y=500,this.body.width=32,this.body.height=32,this.angle=45,this.body.bounce.set(0),this.animations.add("fly",["frame-1.png","frame-2.png","frame-3.png"],10,!0,!1),this.animations.add("killed",["frame-4.png"],10,!0,!1),this.animations.add("explode",["explode-1.png","explode-2.png","explode-3.png","explode-4.png","explode-5.png"],10,!0,!1),this.animations.play("fly",10,!0)};return t.prototype=Object.create(e.Sprite.prototype),t.prototype.constructor=t,t.prototype.restartGame=function(e,t){this.alive=!0,this.body.allowGravity=!0,this.reset(e,t)},t.prototype.bounce=function(){this.body.velocity.y=-400,this.body.angle=0},t.prototype.flyAway=function(){this.body.velocity.y=0,this.body.velocity.x=30,this.body.angle=0},t}),define("Platform",["phaser"],function(e){"use strict";var t=function(n,r,i,s){e.Sprite.call(this,n,r,i,"spritesheet","platform.png"),this.anchor.setTo(.5,.5),this.game.physics.arcade.enableBody(this),this.body.immovable=!0,this.body.checkCollision.up=!0,this.body.checkCollision.down=!1,this.checkWorldBounds=!0,this.outOfBoundsKill=!0};return t.prototype=Object.create(e.Sprite.prototype),t.prototype.constructor=t,t}),define("Barrier",["phaser"],function(e){"use strict";var t=function(n,r,i,s){e.Sprite.call(this,n,r,i,"spritesheet","barrier.png",s),this.anchor.setTo(.5,.5),this.game.physics.arcade.enableBody(this),this.body.width=32,this.body.immovable=!0,this.checkWorldBounds=!0,this.outOfBoundsKill=!0};return t.prototype=Object.create(e.Sprite.prototype),t.prototype.constructor=t,t}),define("Coin",["phaser"],function(e){"use strict";var t=function(n,r,i,s){e.Sprite.call(this,n,r,i,"spritesheet","a1.png");var o=!1;this.game=n,this.anchor.setTo(.5,.5),this.game.physics.arcade.enableBody(this),this.checkWorldBounds=!0,this.outOfBoundsKill=!0,this.animations.add("spin",["a1.png","a2.png","a3.png","a4.png","a5.png","a6.png","a7.png","a8.png"],10,!0,!1),this.animations.play("spin",10,!0)};return t.prototype=Object.create(e.Sprite.prototype),t.prototype.constructor=t,t.prototype.regenerate=function(e,t,n){this.reset(e,t),this.revive(),this.alpha=1,this.isCollected=!1,this.body.velocity.x=n,this.scale.x=.2,this.scale.y=.2},t}),define("Baddie",["phaser"],function(e){"use strict";var t=function(n,r,i,s){e.Sprite.call(this,n,r,i,"spritesheet","baddy1-1.png"),this.game=n,this.maxSpawns=10,this.spawnCount=0,this.startVelocityX=-85,this.game.physics.arcade.enableBody(this),this.anchor.setTo(.5,.5),this.body.immovable=!0,this.checkWorldBounds=!0,this.outOfBoundsKill=!0,this.animations.add("flap",["frame-1-2.png","frame-2-2.png","frame-3-2.png","frame-4-2.png","frame-5-2.png","frame-6-2.png","frame-7-2.png","frame-8-2.png"],10,!0,!1),this.animations.play("flap",10,!0)};return t.prototype=Object.create(e.Sprite.prototype),t.prototype.constructor=t,t.prototype.respawn=function(t){this.spawnCount<this.maxSpawns&&this.spawnCount++,this.reset(this.game.world.width,this.game.world.height),this.body.x=this.game.world.width,this.body.y=this.game.rnd.integerInRange(100,this.game.height-100),this.body.velocity.x=this.velocity;var n=this.game.world.height/2+this.spawnCount*10,r=2e3-this.spawnCount*10;this.game.add.tween(this).to({y:n},r,e.Easing.Linear.None,!0,0,1e3,!0)},t.prototype.update=function(){this.body.x<0&&this.respawn()},t}),define("Birdie",["phaser"],function(e){"use strict";var t=function(n,r,i,s){e.Sprite.call(this,n,r,i,"spritesheet","frame-1-2.png"),this.chaseTween=null,this.anchor.setTo(.5,.5),this.game.physics.arcade.enableBody(this),this.body.immovable=!0,this.game=n,this.scale.x=-1,this.animations.add("flap",["baddy1-1.png","baddy1-2.png","baddy1-3.png","baddy1-4.png","baddy1-5.png","baddy1-6.png"],10,!0,!1),this.animations.add("explode",["explode-1.png","explode-2.png","explode-3.png","explode-4.png","explode-5.png"],10,!0,!1),this.animations.play("flap",10,!0)};return t.prototype=Object.create(e.Sprite.prototype),t.prototype.constructor=t,t.prototype.respawn=function(){this.reset(this.game.world.width-50,this.game.world.height/2),this.body.x=this.game.world.width-50,this.body.y=this.game.rnd.integerInRange(100,this.game.height-100),this.chaseTween=this.game.add.tween(this).to({angle:30,x:"-35"},2e3,e.Easing.Linear.None,!0,0,1e3,!0)},t.prototype.flyAway=function(){this.chaseTween.stop(),this.game.add.tween(this).to({x:this.game.world.width+50},2e3,e.Easing.Linear.None,!0,0,1e3,!0)},t.prototype.update=function(){},t}),define("Game",["phaser","Player","Platform","Barrier","Coin","Baddie","Birdie"],function(e,t,n,r,i,s,o){"use strict";function u(){this.player=null,this.platformsGroup=null,this.barriersGroup=null,this.coinsGroup=null,this.groundFG=null,this.groundBG=null,this.canPlacePlatform=!1,this.baddie=null,this.birdie=null,this.emitter=null,this.arrow=null,this.helpplatform=null,this.scoreText=null,this.finalScoreText=null,this.boardText=null,this.helpText=null,this.sponsorText=null,this.gameOverBoard=null,this.score=0,this.difficulty=1,this.scrollVelocity=-200,this.bounce=null,this.coin=null,this.splat=null,this.buttonClick=null,this.groundBGOffset=-80,this.groundFGOffset=-64,this.groundScrollSpeedBG=-100,this.groundScrollSpeedFG=-200,this.barrierGeneratorEvent=null,this.coinGeneratorEvent=null,this.difficultyIncrementEvent=null}return u.prototype={constructor:u,preload:function(){},create:function(){var n={font:"20px Arial",fill:"#fff",align:"center"};this.game.stage.backgroundColor="#71c5cf",this.game.renderer.renderSession.roundPixels=!0,this.game.stage.smoothed=!1,this.game.physics.startSystem(e.Physics.ARCADE),this.game.physics.arcade.enableBody(this),this.game.add.tileSprite(0,0,800,600,"bg"),this.groundBG=this.game.add.tileSprite(0,this.game.world.height+this.groundBGOffset,this.game.world.width,64,"spritesheet","ground2.png"),this.groundFG=this.game.add.tileSprite(0,this.game.world.height+this.groundFGOffset,this.game.world.width,64,"spritesheet","ground.png"),this.game.physics.arcade.enable(this.groundFG),this.groundFG.body.immovable=!0,this.groundFG.body.allowGravity=!1,this.groundBG.autoScroll(this.groundScrollSpeedBG,0),this.groundFG.autoScroll(this.groundScrollSpeedFG,0),this.emitter=this.game.add.emitter(0,0,4),this.emitter.makeParticles("platform-particle"),this.emitter.gravity=200,this.game.physics.arcade.enable(this.groundFG),this.input.onUp.add(this.addPlatform,this),this.platformsGroup=this.game.add.group(),this.barriersGroup=this.game.add.group(),this.coinsGroup=this.game.add.group(),this.createGameObjects(),this.player=new t(this.game,100,50,null),this.player.kill(),this.game.add.existing(this.player),this.game.physics.enable(this.player,e.Physics.ARCADE),this.baddie=new s(this.game,this.game.width+100,this.game.world.height/2,null),this.game.add.existing(this.baddie),this.birdie=new o(this.game,-50,this.game.world.height/2,null),this.game.add.existing(this.birdie),this.gameOverBoard=this.game.add.group();var r={font:"50px Arial",fill:"#fff",align:"center"};this.finalScoreText=this.game.add.text(this.game.world.centerX,this.game.world.centerY-20,"Score: "+this.score,r),this.finalScoreText.anchor.set(.5,0),this.finalScoreText.visible=!1,this.gameOverBoard.add(this.finalScoreText),this.boardText=this.gameOverBoard.create(this.game.world.centerX,this.game.world.centerY-100,"spritesheet","Get-Ready.png"),this.boardText.anchor.set(.5,0),this.helpText=this.game.add.text(this.game.world.centerX,this.game.world.centerY,"Add Platform",r),this.helpText.anchor.set(.5,0),this.helpText.visible=!1,this.sponsorText=this.game.add.text(this.game.width-15,10,"symmetrical-cow.com",n),this.sponsorText.anchor.set(1,.5);var i=this.sponsorText.context.createLinearGradient(0,0,0,this.sponsorText.height);i.addColorStop(0,"#000000"),i.addColorStop(1,"#6b9e04"),this.sponsorText.fill=i,this.sponsorText.inputEnabled=!0,this.sponsorText.events.onInputDown.add(function(){window.open("http://www.symmetrical-cow.com")},this),this.startButton=this.game.add.button(this.game.world.centerX,350,"play",this.startButtonEvent,this),this.startButton.anchor.set(.5,0),this.gameOverBoard.add(this.startButton),this.gameOverBoard.visible=!0;var u=this.game.add.tween(this.gameOverBoard);this.gameOverBoard.alpha=1,u.from({y:-this.game.world.height},1e3,e.Easing.Bounce.Out),u.start(),this.bounce=this.game.add.audio("bounce"),this.coin=this.game.add.audio("coin"),this.splat=this.game.add.audio("splat"),this.buttonClick=this.game.add.audio("button");var a=this.game.add.sprite(this.game.width/2-5,5,"spritesheet","Coin-Collection.png");a.anchor.set(1,0),this.scoreText=this.game.add.text(this.game.world.centerX+5,5,this.score,n),this.scoreText.anchor.set(0,0),this.helpplatform=this.game.add.sprite(this.player.x,this.game.world.centerY+100,"spritesheet","helpplatform.png"),this.helpplatform.anchor.set(.5,.5),this.helpplatform.visible=!1,this.arrow=this.game.add.sprite(100,40,"spritesheet","Up-Green.png"),this.arrow.anchor.set(.5,.5),this.arrow.kill()},startButtonEvent:function(){this.buttonClick.play(),this.restartGame()},restartGame:function(){this.score=0,this.scoreText.text=this.score,this.player.animations.play("fly",10,!0),this.birdie.animations.play("flap",10,!0),this.canPlacePlatform=!0,this.difficulty=1,this.gameStartedTime=this.game.time,this.barriersGroup.callAll("kill"),this.coinsGroup.callAll("kill"),this.platformsGroup.callAll("kill"),this.barrierGeneratorEvent=this.game.time.create(!1),this.barrierGeneratorEvent.loop(e.Timer.SECOND*2,this.addOneBarrier,this),this.coinGeneratorEvent=this.game.time.create(!1),this.coinGeneratorEvent.loop(e.Timer.SECOND*.75,this.generateCoins,this),this.difficultyIncrementEvent=this.game.time.create(!1),this.difficultyIncrementEvent.loop(e.Timer.SECOND*7,this.increaseDifficulty,this),this.coinGeneratorEvent.start(),this.difficultyIncrementEvent.start(),this.groundBG.autoScroll(this.groundScrollSpeedBG,0),this.groundFG.autoScroll(this.groundScrollSpeedFG,0);var t=this.game.add.tween(this.gameOverBoard);t.to({alpha:0},200,e.Easing.Linear.None),t.onComplete.addOnce(function(){this.gameOverBoard.visible=!1},this),t.start(),this.playerXPos=100,this.birdie.x=-50;var n=this.game.add.tween(this.birdie).to({x:this.game.width-50},2e3,e.Easing.Cubic.Out,!0);n.onComplete.addOnce(function(){this.player.restartGame(100,0),this.chaseTween=this.game.add.tween(this.birdie).to({x:"-20",y:"-30"},2e3,e.Easing.Linear.None,!0,0,1e3,!0)},this),this.arrow.reset(this.player.x,40),this.helpplatform.visible=!0,this.game.add.tween(this.helpplatform).to({alpha:0},150,e.Easing.Cubic.InOut,!0,0,10,!0).onComplete.addOnce(function(){this.arrow.kill(),this.helpplatform.visible=!1},this);var n=this.game.add.tween(this.arrow).to({alpha:0},300,e.Easing.Cubic.InOut,!0,0,5,!0).onComplete.addOnce(function(){this.arrow.kill(),this.helpText.visible=!1},this)},playerGameOver:function(){this.player.kill(),this.baddie.kill(),this.finalScoreText.visible=!0,this.gameOverBoard.visible=!0,this.boardText.frameName="Game-Over.png";var t=this.game.add.tween(this.gameOverBoard);this.gameOverBoard.alpha=1,t.from({y:-this.game.world.height},1e3,e.Easing.Bounce.Out),t.start();if(localStorage){var n=localStorage.highscore;n?this.score>parseInt(n)&&(localStorage.highscore=this.score):localStorage.highscore=this.score}this.finalScoreText.visible=!0,this.finalScoreText.text=" High: "+localStorage.highscore,this.currentLevel=1},playerNextLevel:function(){this.player.kill(),this.baddie.kill(),this.finalScoreText.visible=!0,this.gameOverBoard.visible=!0,this.boardText.frameName="Stage-Clear.png",this.finalScoreText.visible=!1;var t=this.game.add.tween(this.gameOverBoard);this.gameOverBoard.alpha=1,t.from({y:-this.game.world.height},1e3,e.Easing.Bounce.Out),t.start(),this.currentLevel++,this.scrollVelocity=-200-this.currentLevel*10,this.groundBG.autoScroll(this.scrollVelocity/2,0),this.groundFG.autoScroll(this.scrollVelocity,0)},playerDeath:function(t){this.stopGame();var n=this.game.add.tween(this.player.body);n.to({y:"-250"},1e3,e.Easing.Cubic.Out,!1,500),n.to({y:this.game.height+30},1e3,e.Easing.Cubic.In,!0),n.onComplete.addOnce(this.playerGameOver,this),this.player.animations.play("killed",10,!1),this.chaseTween.stop();var r=this.game.add.tween(this.birdie).to({x:this.game.width+50},2e3,e.Easing.Cubic.Out,!0);this.splat.play()},stopGame:function(){this.barrierGeneratorEvent.destroy(),this.coinGeneratorEvent.destroy(),this.difficultyIncrementEvent.destroy(),this.player.alive=!1,this.player.body.allowGravity=!1,this.canPlacePlatform=!1,this.groundBG.autoScroll(0,0),this.groundFG.autoScroll(0,0),this.coinsGroup.setAll("body.velocity.x",0),this.barriersGroup.setAll("body.velocity.x",0),this.platformsGroup.setAll("body.velocity.x",0),this.playerTween&&this.playerTween.pause()},createGameObjects:function(){for(var e=0;e<15;e++){var t=new i(this.game,-100,-100);this.coinsGroup.add(t)}for(var s=0;s<5;s++){var o=new r(this.game,-100,-100);this.barriersGroup.add(o)}for(var u=0;u<3;u++){var a=new n(this.game,-100,-100);this.platformsGroup.add(a)}},quitGame:function(e){},addOneBarrier:function(){var e=this.barriersGroup.getFirstExists(!1);if(e){var t=this.game.rnd.pick([1,2]),n=0,r=0,i=null;this.game.tweens.removeFrom(e.body),this.difficulty>3?(i=this.game.rnd.integerInRange(10,150+this.difficulty).toString(),n=0):n=this.game.rnd.integerInRange(0,80),t===1?(r=128-n,i="-"+i,e.scale.y=1):this.difficulty>3&&(r=this.game.height-128+n,i="+"+i,e.scale.y=-1),e.reset(this.game.width,r),e.revive(),this.difficulty>3&&this.game.add.tween(e.body).to({y:i},this.game.rnd.integerInRange(1e3,2e3),"Cubic.easeInOut",!0,0,-1,!0),e.body.velocity.x=this.scrollVelocity,e.checkWorldBounds=!0,e.outOfBoundsKill=!0,e.body.width=32}},generateCoins:function(){var e=this.coinsGroup.getFirstDead();if(e){var t=this.game.rnd.integerInRange(this.game.height/2-100,this.game.height/2+100);e.regenerate(this.birdie.x,this.birdie.y,this.scrollVelocity),e.tween2||(e.tween2=this.game.add.tween(e.scale).to({x:1,y:1},1500,"Cubic.easeOut")),e.tween2.start()}},addPlatform:function(){if(!this.canPlacePlatform)return;var e=this.platformsGroup.getFirstExists(!1);e&&(e.reset(this.game.input.x,this.game.input.y),e.body.velocity.x=this.scrollVelocity,e.alpha=1,this.canPlacePlatform=!1)},collectCoin:function(t,n){if(!n.isCollected){var r=this.game.add.tween(n);r.to({y:5,x:this.game.width/2,alpha:0},1500,e.Easing.Linear.None),r.onComplete.addOnce(function(){n.kill,this.score++,this.scoreText.text=this.score},this),r.start(),n.isCollected=!0;var i=this.game.add.tween(this);i.to({playerXPos:"10"},500,e.Easing.Linear.None),i.start(),this.coin.play()}return!1},platformPlayerCollideHandler:function(e,t){t.alive&&(this.player.bounce(),this.playerTween=this.game.add.tween(this.player).to({angle:360},4e3).start(),this.canPlacePlatform=!0,t.alive=!1,t.kill(),this.emitter.x=t.body.x+32,this.emitter.y=t.body.y,this.emitter.setAlpha(1,0),this.emitter.start(!0,1e3,null,10),this.bounce.play())},addBaddie:function(){this.baddie.respawn(this.currentLevel)},increaseDifficulty:function(){this.difficulty++;switch(this.difficulty){case 2:this.barrierGeneratorEvent.start();break;case 3:this.addBaddie();break;default:}},gameWin:function(){this.stopGame(),this.player.animations.play("explode",10,!1),this.birdie.animations.play("explode",10,!1),this.playerNextLevel()},update:function(){this.player.body.x=this.playerXPos,this.player.alive&&(this.game.physics.arcade.collide(this.player,this.platformsGroup,this.platformPlayerCollideHandler,null,this),this.game.physics.arcade.collide(this.player,this.barriersGroup,this.playerDeath,null,this),this.game.physics.arcade.collide(this.player,this.baddie,this.playerDeath,null,this),this.game.physics.arcade.collide(this.player,this.birdie,this.gameWin,null,this),this.game.physics.arcade.collide(this.player,this.coinsGroup,null,this.collectCoin,this),this.player.inWorld||this.playerDeath())},render:function(){}},u}),define("MainMenu",["phaser","Birdie"],function(e,t){"use strict";function n(){this.player=null,this.platformsGroup=null,this.barriersGroup=null,this.coinsGroup=null,this.groundFG=null,this.groundBG=null,this.canPlacePlatform=!1,this.baddie=null,this.emitter=null,this.infoBoard=null,this.boardText=null,this.buttonClickSound=null,this.gameOverBoard=null,this.groundBGOffset=-80,this.groundFGOffset=-64,this.groundScrollSpeedBG=-100,this.groundScrollSpeedFG=-200}return n.prototype={constructor:n,preload:function(){},create:function(){var n={font:"20px Arial",fill:"#fff",align:"center"};this.game.stage.backgroundColor="#71c5cf",this.game.renderer.renderSession.roundPixels=!0,this.game.stage.smoothed=!1,this.game.add.tileSprite(0,0,800,600,"bg"),this.buttonClickSound=this.game.add.audio("button"),this.groundBG=this.game.add.tileSprite(0,this.game.world.height+this.groundBGOffset,this.game.world.width,64,"spritesheet","ground2.png"),this.groundFG=this.game.add.tileSprite(0,this.game.world.height+this.groundFGOffset,this.game.world.width,64,"spritesheet","ground.png"),this.game.physics.arcade.enable(this.groundFG),this.groundFG.body.immovable=!0,this.groundFG.body.allowGravity=!1,this.groundBG.autoScroll(this.groundScrollSpeedBG,0),this.groundFG.autoScroll(this.groundScrollSpeedFG,0),this.sponsorText=this.game.add.text(this.game.width-15,10,"symmetrical-cow.com",n),this.sponsorText.anchor.set(1,.5);var r=this.sponsorText.context.createLinearGradient(0,0,0,this.sponsorText.height);r.addColorStop(0,"#000000"),r.addColorStop(1,"#6b9e04"),this.sponsorText.fill=r,this.sponsorText.inputEnabled=!0,this.sponsorText.events.onInputDown.add(function(){window.open("http://www.symmetrical-cow.com")},this),this.startButton=this.game.add.button(this.game.world.centerX,400,"play",this.restartGame,this),this.startButton.anchor.set(.5,0),this.startButton.angle=-5;var i=this.game.add.tween(this.startButton);i.to({angle:5},2e3,e.Easing.Sinusoidal.InOut,!0,100,-1,!0);var s=this.game.add.sprite(this.game.world.centerX,175,"logo");s.anchor.set(.5,.5);var o=this.game.add.tween(s.scale);o.to({x:.8,y:1.2},1e3,e.Easing.Sinusoidal.InOut,!0,100,-1,!0),this.birdie=new t(this.game,this.game.world.width/2,this.game.world.height/2+40,null),this.game.add.existing(this.birdie)},restartGame:function(){this.buttonClickSound.play(),this.state.start("Game")}},n}),function(){"use strict";requirejs.config({baseUrl:"src/",paths:{phaser:"lib/phaser"},shim:{phaser:{exports:"Phaser"}}}),require(["phaser","Boot","Preloader","Game","MainMenu"],function(e,t,n,r,i){var s=new e.Game(800,600,e.AUTO),o=new t;s.state.add("Boot",o),s.state.add("Preloader",new n),s.state.add("MainMenu",new i),s.state.add("Game",new r),s.state.start("Boot")})}(),define("Main",function(){});